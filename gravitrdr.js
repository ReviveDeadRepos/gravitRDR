!function(t){var e={init:function(n){return n=t.extend({selector:null},n),this.each(function(){var o=this;t(this).data("gautoedit",{options:n,input:null}).on("dblclick",function(t){e.open.call(o)})})},open:function(){var n=this,o=t(this),i=o.data("gautoedit");i.input&&e.close.call(this);var a=o.find(i.options.selector);if(0===a.length){if(i.options.selector)return;a=o}var r=a.offset();i.value=a.text(),i.input=t("<input>").css({position:"absolute",left:r.left+"px",top:r.top+"px",width:a.outerWidth()+"px",height:a.outerHeight()+"px"}).val(i.value).on("blur",function(t){e.submit.call(n)}).on("keyup",function(t){13===t.keyCode?e.submit.call(n):27===t.keyCode&&e.close.call(n)}).appendTo(t("body")).focus().select()},submit:function(){var n=t(this),o=n.data("gautoedit"),i=o.input?o.input.val():null;e.close.call(this),i&&o.value!==i&&n.trigger("submitvalue",i)},close:function(){var e=t(this).data("gautoedit");e.input&&(e.input.remove(),e.input=null,e.value=null)}};t.fn.gAutoEdit=function(n){return e[n]?e[n].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof n&&n?void t.error("Method "+n+" does not exist on jQuery.myPlugin"):e.init.apply(this,arguments)}}(jQuery),function(t){var e={init:function(n){return n=t.extend({title:"",content:"",controls:null},n),this.each(function(){var o=this;t(this).empty().addClass("g-panel").data("gpanel",{options:n,expanded:!0}).append(t("<div></div>").addClass("header").append(t("<div></div>").addClass("title").append(t("<i></i>").addClass("fa fa-angle-down")).append(t("<span></span>").text(n.title)).on("click",function(){e.toggle.call(o)})).append(t("<div></div>").addClass("controls").append(n.controls))).append(t("<div></div>").addClass("content").append(n.content))})},toggle:function(){var n=t(this).data("gpanel");e.expanded.call(this,!n.expanded)},expanded:function(e){var n=t(this),o=n.data("gpanel");return arguments.length?(e!==o.expanded&&(o.expanded=e,n.find(".content").css("display",o.expanded?"":"none"),n.find(".controls").css("visibility",o.expanded?"":"hidden"),n.find(".header i.fa").toggleClass("fa-angle-down",o.expanded).toggleClass("fa-angle-right",!o.expanded)),this):o.expanded}};t.fn.gPanel=function(n){return e[n]?e[n].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof n&&n?void t.error("Method "+n+" does not exist on jQuery.myPlugin"):e.init.apply(this,arguments)}}(jQuery),function(t){var e=t("<div></div>").css({position:"absolute",left:"0px",top:"0px",width:"20px",height:"20px","z-index":"-1"}).appendTo(t("body")),n={init:function(o){return o=t.extend({allowDrag:!0,allowDrop:!0,types:null},o),this.each(function(){var i=this,a=t(this);a.data("gpatterntarget",{options:o,pattern:null}),o.allowDrag&&a.attr("draggable","true").on("dragstart",function(t){var n=t.originalEvent,o=a.data("gpatterntarget").pattern;o?(n.stopPropagation(),a.trigger("patterndrag",o),e.css("background",IFPattern.asCSSBackground(o)),n.dataTransfer.effectAllowed="move",n.dataTransfer.setData(IFPattern.MIME_TYPE,IFPattern.asString(o)),n.dataTransfer.setDragImage(e[0],10,10),n.dataTransfer.sourceElement=this):n.preventDefault()}).on("dragend",function(t){t.originalEvent.stopPropagation()}),o.allowDrop&&a.on("dragover",function(t){var e=t.originalEvent;e.preventDefault(),e.stopPropagation(),t.originalEvent.dataTransfer.dropEffect="move"}).on("drop",function(t){var e=t.originalEvent,r=e.dataTransfer.getData(IFPattern.MIME_TYPE);if(r&&(r=IFPattern.parsePattern(r))&&(!o.types||0===o.types.length||o.types.indexOf(r.getPatternType())>=0)){var s=a.data("gpatterntarget").pattern;IFPattern.equals(r,s)||(n.value.call(i,r),a.trigger("patternchange",r)),a.trigger("patterndrop",[r,e])}return!1})})},value:function(e){var n=t(this).data("gpatterntarget");return arguments.length?(e="string"==typeof e?IFPattern.parsePattern(e):e,n.pattern=e,this):n.pattern}};t.fn.gPatternTarget=function(e){return n[e]?n[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void t.error("Method "+e+" does not exist on jQuery.myPlugin"):n.init.apply(this,arguments)}}(jQuery),function(t){var e=null;function n(){return e||(e=t("<div></div>").css("padding","5px").gColorPanel().gOverlay()),e}var o={init:function(e){return(e=t.extend({transient:!1,autoOpen:!0,allowClear:!1,immediateClose:!1,scene:null},e)).types=[IFPattern.Type.Color],this.each(function(){var i=this,a=t(this);a.addClass("g-input").css("min-width","20px").data("g-colorbutton",{options:e,scene:e.scene,panelCloseListener:function(t){var e=a.data("g-colorbutton"),o=n();o.gColorPanel("scene",null),o.off("colorchange",e.panelChangeListener),o.off("close",e.panelCloseListener)},panelChangeListener:function(t,n){e.immediateClose&&o.close.call(i),o.value.call(i,n),a.trigger("colorchange",n)}}).gPatternTarget(e).on("patternchange",function(t,e){o.value.call(i,e)}),e.transient||a.addClass("g-cursor-pipette"),e.autoOpen&&a.on("click",function(){o.open.call(i)})})},open:function(){var e=t(this).data("g-colorbutton"),i=n();return i.gOverlay("close",this),i.gColorPanel("scene",e.scene),i.gColorPanel("value",o.value.call(this)),i.gColorPanel("allowClear",e.options.allowClear),i.on("colorchange",e.panelChangeListener),i.on("close",e.panelCloseListener),i.gOverlay("open",this),this},close:function(){return n().gOverlay("close",this),this},scene:function(e){var n=t(this).data("g-colorbutton");return arguments.length?(n.scene=e,this):n.scene},value:function(e){var n=t(this),o=n.data("g-colorbutton");return arguments.length?(n.gPatternTarget("value",e),o.options.transient||n.css("background",IFPattern.asCSSBackground(e)),this):n.gPatternTarget("value")}};t.fn.gColorButton=function(e){return o[e]?o[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void t.error("Method "+e+" does not exist on jQuery.myPlugin"):o.init.apply(this,arguments)}}(jQuery),function(t){var e={Palette:"palette",Swatches:"swatches",Trends:"trends",Image:"image"};ColorModes=[{type:IFColor.Type.RGB,name:"RGB",components:[{label:"R",min:0,max:255,unit:" ",stops:function(t){var e=t;return[new IFColor(IFColor.Type.RGB,[0,e[1],e[2],100]),new IFColor(IFColor.Type.RGB,[255,e[1],e[2],100])]}},{label:"G",min:0,max:255,unit:" ",stops:function(t){var e=t;return[new IFColor(IFColor.Type.RGB,[e[0],0,e[2],100]),new IFColor(IFColor.Type.RGB,[e[0],255,e[2],100])]}},{label:"B",min:0,max:255,unit:" ",stops:function(t){var e=t;return[new IFColor(IFColor.Type.RGB,[e[0],e[1],0,100]),new IFColor(IFColor.Type.RGB,[e[0],e[1],255,100])]}},{label:"A",min:0,max:100,unit:"%"}],makeColor:function(t){return new IFColor(IFColor.Type.RGB,t)}},{type:IFColor.Type.HSL,name:"HSL",components:[{label:"H",min:0,max:360,unit:"Â° ",stops:function(t){for(var e=t,n=[],o=0;o<=360;o+=60)n.push(new IFColor(IFColor.Type.HSL,[o,e[1],e[2],100]));return n}},{label:"S",min:0,max:100,unit:"%",stops:function(t){var e=t;return[new IFColor(IFColor.Type.HSL,[e[0],0,e[2],100]),new IFColor(IFColor.Type.HSL,[e[0],100,e[2],100])]}},{label:"L",min:0,max:100,unit:"%",stops:function(t){var e=t;return[new IFColor(IFColor.Type.HSL,[e[0],e[1],0,100]),new IFColor(IFColor.Type.HSL,[e[0],e[1],100,100])]}},{label:"A",min:0,max:100,unit:"%"}],makeColor:function(t){return new IFColor(IFColor.Type.HSL,t)}},{type:IFColor.Type.Tone,name:"Tone",components:[{label:"T",min:0,max:100,unit:"%",stops:function(t){return[IFColor.parseCSSColor("white"),IFColor.parseCSSColor("black")]}},{label:"A",min:0,max:100,unit:"%"}],makeColor:function(t){return new IFColor(IFColor.Type.Tone,t)}},{type:IFColor.Type.CMYK,name:"CMYK",components:[{label:"C",min:0,max:100,unit:"%",stops:function(t){var e=t;return[new IFColor(IFColor.Type.CMYK,[0,e[1],e[2],e[3]]),new IFColor(IFColor.Type.CMYK,[100,e[1],e[2],e[3]])]}},{label:"M",min:0,max:100,unit:"%",stops:function(t){var e=t;return[new IFColor(IFColor.Type.CMYK,[e[0],0,e[2],e[3]]),new IFColor(IFColor.Type.CMYK,[e[0],100,e[2],e[3]])]}},{label:"Y",min:0,max:100,unit:"%",stops:function(t){var e=t;return[new IFColor(IFColor.Type.CMYK,[e[0],e[1],0,e[3]]),new IFColor(IFColor.Type.CMYK,[e[0],e[1],100,e[3]])]}},{label:"K",min:0,max:100,unit:"%",stops:function(t){var e=t;return[new IFColor(IFColor.Type.CMYK,[e[0],e[1],e[2],0]),new IFColor(IFColor.Type.CMYK,[e[0],e[1],e[2],100])]}}],makeColor:function(t){return new IFColor(IFColor.Type.CMYK,t)}}];var n=["000000","001F3F","DDDDDD","000000","003300","006600","009900","00CC00","00FF00","330000","333300","336600","339900","33CC00","33FF00","660000","663300","666600","669900","66CC00","66FF00","333333","0074D9","CCCCCC","000033","003333","006633","009933","00CC33","00FF33","330033","333333","336633","339933","33CC33","33FF33","660033","663333","666633","669933","66CC33","66FF33","666666","7FDBFF","BBBBBB","000066","003366","006666","009966","00CC66","00FF66","330066","333366","336666","339966","33CC66","33FF66","660066","663366","666666","669966","66CC66","66FF66","999999","39CCCC","AAAAAA","000099","003399","006699","009999","00CC99","00FF99","330099","333399","336699","339999","33CC99","33FF99","660099","663399","666699","669999","66CC99","66FF99","CCCCCC","3D9970","999999","0000CC","0033CC","0066CC","0099CC","00CCCC","00FFCC","3300CC","3333CC","3366CC","3399CC","33CCCC","33FFCC","6600CC","6633CC","6666CC","6699CC","66CCCC","66FFCC","FFFFFF","2ECC40","888888","0000FF","0033FF","0066FF","0099FF","00CCFF","00FFFF","3300FF","3333FF","3366FF","3399FF","33CCFF","33FFFF","6600FF","6633FF","6666FF","6699FF","66CCFF","66FFFF","FF0000","01FF70","777777","990000","993300","996600","999900","99CC00","99FF00","CC0000","CC3300","CC6600","CC9900","CCCC00","CCFF00","FF0000","FF3300","FF6600","FF9900","FFCC00","FFFF00","00FF00","FFDC00","666666","990033","993333","996633","999933","99CC33","99FF33","CC0033","CC3333","CC6633","CC9933","CCCC33","CCFF33","FF0033","FF3333","FF6633","FF9933","FFCC33","FFFF33","0000FF","FF851B","555555","990066","993366","996666","999966","99CC66","99FF66","CC0066","CC3366","CC6666","CC9966","CCCC66","CCFF66","FF0066","FF3366","FF6666","FF9966","FFCC66","FFFF66","FFFF00","FF4136","444444","990099","993399","996699","999999","99CC99","99FF99","CC0099","CC3399","CC6699","CC9999","CCCC99","CCFF99","FF0099","FF3399","FF6699","FF9999","FFCC99","FFFF99","00FFFF","85144B","333333","9900CC","9933CC","9966CC","9999CC","99CCCC","99FFCC","CC00CC","CC33CC","CC66CC","CC99CC","CCCCCC","CCFFCC","FF00CC","FF33CC","FF66CC","FF99CC","FFCCCC","FFFFCC","FF00FF","B10DC9","222222","9900FF","9933FF","9966FF","9999FF","99CCFF","99FFFF","CC00FF","CC33FF","CC66FF","CC99FF","CCCCFF","CCFFFF","FF00FF","FF33FF","FF66FF","FF99FF","FFCCFF","FFFFFF"];function o(t,e,n){var o=t.data("gcolorpanel").color;if(!o)return null;switch(e){case 1:return o.withTint(n);case 2:return o.withShade(n);case 3:return o.withTone(n);default:throw new Error("Unknown trend: "+e)}}function i(t,e,n){"string"==typeof n&&(n=parseInt(n),isNaN(n)&&(n=50)),n<0?n=0:n>100&&(n=100);var i=t.find('[data-view="trends"]').find(".color-trend-"+e.toString()),a=o(t,e,n);return i.find(".color-trend-box-current").attr("data-color",a?a.asString():"").css("background",IFPattern.asCSSBackground(a)),i.find(".color-trend-value > input").val(n),a}function a(t){return new IFColor(IFColor.Type.RGB,[t[0],t[1],t[2],100])}function r(o,r){var s=null;if(r===e.Palette)s=function(e){for(var o=t("<table></table>"),i=t("<tr></tr>").appendTo(o),a=0,r=0;r<n.length;++r){var s="#"+n[r];t("<td></td>").addClass("swatch").css("background",s).attr("data-color",s).on("click",function(){var n=IFColor.parseCSSColor(t(this).attr("data-color"));u(e,n,!1),e.trigger("colorchange",n)}).appendTo(i),21===++a&&(a=0,i=t("<tr></tr>").appendTo(o))}return o}(o);else if(r===e.Swatches)s=function(e){var n=e.data("gcolorpanel");return t("<div></div>").gSwatchPanel({nullSwatch:t("<span></span>").addClass("fa fa-plus-circle"),nullName:"Add current color as new swatch",types:[IFPattern.Type.Color],allowSelect:!1}).on("swatchchange",function(t,o){if(o){var i=o.getProperty("pat");u(e,i,!1),e.trigger("colorchange",i)}else{if(!n.scene||!n.color)return;for(var a=n.scene.getSwatchCollection(),r=a.getFirstChild();null!==r;r=r.getNext())if(r instanceof IFSwatch&&r.getPatternType()===IFPattern.Type.Color&&IFColor.equals(n.color,r.getProperty("pat")))return;var s=prompt("Enter a name for the new swatch:",n.color.asString());if(null===s)return;""===s.trim()&&(s=n.color.asString());var p=IFEditor.getEditor(n.scene);p&&p.beginTransaction();try{(o=new IFSwatch).setProperties(["name","pat"],[s,n.color]),a.appendChild(o)}finally{p&&p.commitTransaction("Add Swatch")}}})}(o);else if(r===e.Trends)s=function(e){var n=function(n,o){var a=null;switch(n){case 1:a="Tint";break;case 2:a="Shade";break;case 3:a="Tone"}t("<div></div>").addClass("color-trend-label").text(a).appendTo(o);for(var r=t("<div></div>").addClass("color-trend color-trend-"+n.toString()).append(t("<div></div>").addClass("color-palette").append(t("<div></div>").addClass("color-preview"))).append(t("<div></div>").addClass("color-trend-value").append(t("<input>").attr("type","text").on("input",function(o){var a=t(this).val();i(e,n,a)}))).appendTo(o).find(".color-preview"),s=1;s<=10;++s)t("<div>&nbsp;</div>").addClass("g-input color-trend-box-"+(10===s?"current":s.toString())).css("width","10%").on("click",function(n){var o=IFColor.parseColor(t(this).attr("data-color"));o&&(u(e,o,!1),e.trigger("colorchange",o))}).appendTo(r)}.bind(this),o=t("<div></div>");return n(1,o),n(2,o),n(3,o),o}(o);else{if(r!==e.Image)throw new Error("Unknown color view: "+r);s=function(e){return t("<div></div>").append(t("<div></div>").addClass("image-panel").text("Drag an image here").on("dragenter",function(){return t(this).css("background","maroon"),!1}).on("dragleave",function(){return t(this).css("background",""),!1}).on("dragover",function(){return!1}).on("drop",function(n){var o=t(this);o.css("background","");var i=o.closest("[data-view]").find(".image-palette");i.empty();for(var r=function(n){t("<div></div>").css("background",IFPattern.asCSSBackground(n)).on("click",function(){u(e,n,!1),e.trigger("colorchange",n)}.bind(this)).appendTo(i)}.bind(this),s=n.originalEvent.dataTransfer.files,p=s.length,l=/image.*/,c=0;c<p;c++){var d=s[c];if(d.type.match(l)){var g=new FileReader;g.onload=function(t){var e=new Image;e.src=t.target.result,e.onload=function(){var t=new ColorThief,n=a(t.getColor(e));r(n);for(var o=t.getPalette(e,8),i=0;i<o.length;++i){var s=a(o[i]);IFColor.equals(s,n)||r(s)}}.bind(this),o.css("background-image","url("+t.target.result+")").text("")}.bind(this),g.readAsDataURL(d);break}}return!1})).append(t("<div></div>").addClass("image-palette"))}(o)}s&&s.attr("data-view",r).css("display","none").appendTo(o.find(".color-view"))}function s(e){var n=e.data("gcolorpanel"),o=e.find(".matcher-palette");if(o.empty(),n.matcher&&n.color){var i=function(n,i){t("<div></div>").css("width",i.toString()+"%").css("background",IFPattern.asCSSBackground(n)).on("click",function(){u(e,n,!1),e.trigger("colorchange",n)}.bind(this)).appendTo(o)}.bind(this),a=n.matcher.match(n.color);if(a&&a.length>0)for(var r=Math.min(a.length,8),s=100/r,p=0;p<r;++p){i(n.color?a[p].toType(n.color.getType()):a[p],s)}}}function p(t,e){t.data("gcolorpanel").matcher=e,s(t)}function l(t,e){var n=t.data("gcolorpanel");if(!n.colorMode||e!==n.colorMode.type.key)for(var o=0;o<ColorModes.length;++o){var i=ColorModes[o];if(i.type.key===e){n.colorMode=i;for(o=0;o<4;++o){var a=t.find(".color-component-"+o.toString());if(o>=i.components.length)a.css("visibility","hidden");else{a.css("visibility","");var r=i.components[o],s=a.find('input[type="range"]'),p=a.find(".color-label"),l=a.find(".color-unit");p.text(r.label),l.text(r.unit),l.css("display",""!=r.unit?"":"none"),s.attr("min",r.min),s.attr("max",r.max)}}d(t),c(t);break}}t.find(".color-mode-select").val(n.colorMode?n.colorMode.type.key:IFColor.Type.RGB.key)}function c(t){for(var e=t.data("gcolorpanel"),n=[],o=0;o<e.colorMode.components.length;++o){var i=e.colorMode.components[o],a=t.find(".color-component-"+o.toString()),r=a.find('input[type="text"]'),s=a.find('input[type="range"]'),p=parseInt(r.val());isNaN(p)||p<i.min?p=i.min:p>i.max&&(p=i.max),n.push(p),r.val(p),s.val(p)}var l=e.colorMode.makeColor(n);return u(t,l),l}function d(t){var e=t.data("gcolorpanel"),n=e.color?e.color:IFColor.TRANSPARENT_WHITE,o=null;if(e.colorMode.type===IFColor.Type.RGB)o=n.asRGB();else if(e.colorMode.type===IFColor.Type.HSL)o=n.asHSL();else if(e.colorMode.type===IFColor.Type.Tone)o=n.asTone();else{if(e.colorMode.type!==IFColor.Type.CMYK)throw new Error("Unknown mode.");o=n.asCMYK()}if(o)for(var i=0;i<e.colorMode.components.length;++i){var a=e.colorMode.components[i],r=t.find(".color-component-"+i.toString()),s=r.find('input[type="text"]'),p=r.find('input[type="range"]'),l=Math.min(a.max,Math.max(a.min,o[i])).toFixed(0),c=e.colorMode.components[i].stops,d=c?c(o):null;if(d)if(1===d.length)p.css("background",d[0].asCSSString());else{for(var u="",g=0;g<d.length;++g)""!==u&&(u+=","),u+=d[g].asCSSString();p.css("background","linear-gradient(90deg, "+u+")")}else p.css("background","");s.val(l),p.val(l)}}function u(t,e,n){var a=t.data("gcolorpanel");e="string"==typeof e?IFColor.parseColor(e):e,a.color=e,n&&(a.previousColor=e),t.find('input[type="color"]').val(e?e.asHTMLHexString():""),t.find(".previous-color").css("background",IFPattern.asCSSBackground(a.previousColor)),t.find(".current-color").css("background",IFPattern.asCSSBackground(a.color)),t.find(".color-input").val(a.color?a.color.asHTMLHexString():"");var r="&ndash;";if(a.previousColor&&a.color){var p=a.color.difference(a.previousColor);r="&Delta;&nbsp;"+(p<0?ifUtil.formatNumber(p,2):p.toFixed(0))}t.find(".color-difference").html(r),l(t,e?e.getType().key:IFColor.Type.RGB.key),s(t),d(t),function(t){for(var e=t.find('[data-view="trends"]'),n=1;n<=3;++n)for(var a=e.find(".color-trend-"+n.toString()),r=1;r<=9;++r){var s=o(t,n,10*r);a.find(".color-trend-box-"+r.toString()).attr("data-color",s?s.asString():"").css("background",IFPattern.asCSSBackground(s)),5===r&&i(t,n,50)}}(t)}var g={init:function(n){return n=t.extend({defaultView:e.Palette},n),this.each(function(){var o=this,i={options:n,allowClear:!1,scene:null},a=t(this).data("gcolorpanel",i);a.addClass("g-color-panel").append(t("<input>").attr("type","color").css({position:"absolute",visibility:"hidden"}).on("change",function(){var e=IFColor.parseCSSColor(t(this).val());u(a,e,!1),a.trigger("colorchange",e)})).append(t("<div></div>").addClass("toolbar").append(t("<div></div>").addClass("section-start").append(t("<button></button>").attr("data-action","clear").attr("title","Clear Color").css("display","none").append(t("<span></span>").addClass("fa fa-ban")).on("click",function(){u(a,null,!1),a.trigger("colorchange",null)})).append(t("<button></button>").attr("data-action","system-color").attr("title","System").append(t("<span></span>").addClass("fa fa-cog")).on("click",function(){a.find('input[type="color"]').trigger("click")}))).append(t("<div></div>").addClass("section-center").append(t("<button></button>").attr("data-activate-view",e.Palette).attr("title","Palette").append(t("<span></span>").addClass("fa fa-th"))).append(t("<button></button>").attr("data-activate-view",e.Swatches).attr("title","Swatches").css("display","none").append(t("<span></span>").addClass("fa fa-bars"))).append(t("<button></button>").attr("data-activate-view",e.Trends).attr("title","Trends").append(t("<span></span>").addClass("fa fa-sliders"))).append(t("<button></button>").attr("data-activate-view",e.Image).attr("title","From Image").append(t("<span></span>").addClass("fa fa-image")))).append(t("<div></div>").addClass("section-end").append(t("<select></select>").addClass("color-mode-select").on("change",function(){l(a,t(this).val())})))).append(t("<div></div>").addClass("color-view")).append(t("<div></div>").addClass("color-components")).append(t("<hr/>")).append(t("<div></div>").addClass("color").append(t("<div></div>").append(t("<div>&nbsp;</div>").addClass("previous-color g-input").on("click",function(){i.previousColor&&(u(a,i.previousColor,!1),a.trigger("colorchange",i.previousColor))})).append(t("<div>&nbsp;</div>").addClass("current-color g-input")).append(t("<div></div>").addClass("color-difference g-input").attr("title","Color Difference (CIEDE2000)")).append(t("<input>").addClass("color-input").on("change",function(){var e=IFColor.parseCSSColor(t(this).val());e&&(u(a,e,!1),a.trigger("colorchange",e))}))).append(t("<div></div>").append(t("<select></select>").addClass("matcher-select").on("change",function(){p(a,t(this).find(":selected").data("matcher"))})))).append(t("<div></div>").addClass("matcher-palette")),a.find("[data-activate-view]").each(function(e,n){var i=t(n);i.on("click",function(t){g.view.call(o,i.attr("data-activate-view"))})});for(var s=a.find(".color-components"),d=function(e){t("<div></div>").addClass("color-component color-component-"+e.toString()).append(t("<div></div>").addClass("color-label").on("click",function(){var t=a.find(".color-component-"+e.toString()+' input[type="text"]');t.val()==i.colorMode.components[e].max?t.val(i.colorMode.components[e].min):t.val(i.colorMode.components[e].max);var n=c(a);a.trigger("colorchange",n)}.bind(this))).append(t("<div></div>").addClass("color-range").append(t("<input>").attr("type","range").attr("tabIndex","-1").on("input",function(n){a.find(".color-component-"+e.toString()+' input[type="text"]').val(t(n.target).val());var o=c(a);a.trigger("colorchange",o)}.bind(this)))).append(t("<div></div>").addClass("color-value").append(t("<input>").attr("type","text").on("input",function(){var t=c(a);a.trigger("colorchange",t)}))).append(t("<div></div>").addClass("color-unit")).appendTo(s)}.bind(this),h=0;h<4;++h)d(h);var f=a.find(".color-mode-select");for(h=0;h<ColorModes.length;++h){var y=ColorModes[h];t("<option></option>").attr("value",y.type.key).text(y.name).appendTo(f),i.colorMode||l(a,y.type.key)}var v=a.find(".matcher-select"),m=v,_=null;for(h=0;h<gravitrdr.colorMatchers.length;++h){var I=gravitrdr.colorMatchers[h],F=ifLocale.get(I.getCategory());_&&F===_||(m=t("<optgroup></optgroup>").attr("label",F).appendTo(v),_=F),t("<option></option>").data("matcher",I).text(ifLocale.get(I.getTitle())).appendTo(m),i.matcher||p(a,I)}for(var E in e)e.hasOwnProperty(E)&&r(a,e[E]);g.view.call(o,n.defaultView)})},view:function(e){var n=t(this),o=n.data("gcolorpanel");return arguments.length?(e!==o.view&&(o.view=e,n.find("[data-activate-view]").each(function(n,o){var i=t(o);i.toggleClass("g-active",i.attr("data-activate-view")===e)}),n.find(".color-view > *").each(function(n,o){var i=t(o);i.css("display",i.attr("data-view")===e?"":"none")})),this):o.view},allowClear:function(e){var n=t(this);return arguments.length?(n.data("gcolorpanel").allowClear=e,n.find('[data-action="clear"]').css("display",e?"":"none"),this):n.data("gcolorpanel").allowClear},scene:function(n){var o=t(this),i=o.data("gcolorpanel");if(arguments.length){var a=i.scene;i.scene=n;var r=o.find('[data-view="'+e.Swatches+'"]');return a&&r.gSwatchPanel("detach"),i.scene&&r.gSwatchPanel("attach",i.scene.getSwatchCollection()),o.find('[data-activate-view="'+e.Swatches+'"]').css("display",i.scene?"":"none"),this}return i.scene},value:function(e){var n=t(this);if(arguments.length){var o=n.data("gcolorpanel");if(u(n,e,!0),o.scene&&(!o.color||o.color.getType()===IFColor.Type.Black||o.color.getType()===IFColor.Type.White||o.color.getType()===IFColor.Type.Registration)){var i=o.scene.getProperty("clspace");if(i)for(var a=0;a<ColorModes.length;++a)if(ColorModes[a].type.space===i){l(n,ColorModes[a].type.key);break}}return this}return n.data("gcolorpanel").color}};t.fn.gColorPanel=function(e){return g[e]?g[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void t.error("Method "+e+" does not exist on jQuery.myPlugin"):g.init.apply(this,arguments)}}(jQuery),function(t){var e=[{type:IFPathBase.CornerType.Rounded,name:"Rounded"},{type:IFPathBase.CornerType.InverseRounded,name:"Inverse Rounded"},{type:IFPathBase.CornerType.Bevel,name:"Beveled"},{type:IFPathBase.CornerType.Inset,name:"Inset"},{type:IFPathBase.CornerType.Fancy,name:"Fancy"}],n={init:function(n){return n=t.extend({},n),this.each(function(){var n=t(this);if(n.is("select")){var o=n,i=n.find(":last");i.is("optgroup")&&(o=i);for(var a=0;a<e.length;++a)o.append(t("<option></option>").attr("value",e[a].type).text(e[a].name))}})}};t.fn.gCornerType=function(e){return n[e]?n[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void t.error("Method "+e+" does not exist on jQuery.myPlugin"):n.init.apply(this,arguments)}}(jQuery),function(t){var e=[{type:IFPaintCanvas.BlendMode.Normal,name:"Normal"},{type:IFPaintCanvas.BlendMode.Multiply,name:"Multiply"},{type:IFPaintCanvas.BlendMode.Screen,name:"Screen"},{type:IFPaintCanvas.BlendMode.Overlay,name:"Overlay"},{type:IFPaintCanvas.BlendMode.Darken,name:"Darken"},{type:IFPaintCanvas.BlendMode.Lighten,name:"Lighten"},{type:IFPaintCanvas.BlendMode.ColorDodge,name:"Color Dodge"},{type:IFPaintCanvas.BlendMode.ColorBurn,name:"Color Burn"},{type:IFPaintCanvas.BlendMode.HardLight,name:"Hard Light"},{type:IFPaintCanvas.BlendMode.SoftLight,name:"Soft Light"},{type:IFPaintCanvas.BlendMode.Difference,name:"Difference"},{type:IFPaintCanvas.BlendMode.Exclusion,name:"Exclusion"},{type:IFPaintCanvas.BlendMode.Hue,name:"Hue"},{type:IFPaintCanvas.BlendMode.Saturation,name:"Saturation"},{type:IFPaintCanvas.BlendMode.Color,name:"Color"},{type:IFPaintCanvas.BlendMode.Luminosity,name:"Luminosity"}],n={init:function(n){return n=t.extend({},n),this.each(function(){var n=t(this);if(n.is("select")){var o=n,i=n.find(":last");i.is("optgroup")&&(o=i);for(var a=0;a<e.length;++a)o.append(t("<option></option>").attr("value",e[a].type).text(e[a].name))}})}};t.fn.gBlendMode=function(e){return n[e]?n[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void t.error("Method "+e+" does not exist on jQuery.myPlugin"):n.init.apply(this,arguments)}}(jQuery),function(t){var e=[{unit:IFLength.Unit.PX,name:"Pixels"},{unit:IFLength.Unit.MM,name:"Millimeters"},{unit:IFLength.Unit.CM,name:"Centimeters"},{unit:IFLength.Unit.IN,name:"Inches"},{unit:IFLength.Unit.PC,name:"Picas"},{unit:IFLength.Unit.PT,name:"Points"}],n={init:function(n){return n=t.extend({},n),this.each(function(){var n=t(this);if(n.is("select"))for(var o=0;o<e.length;++o)n.append(t("<option></option>").attr("value",e[o].unit).text(e[o].name))})}};t.fn.gUnit=function(e){return n[e]?n[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void t.error("Method "+e+" does not exist on jQuery.myPlugin"):n.init.apply(this,arguments)}}(jQuery),function(t){function e(t,e){e.css("left",e.data("stop-position")+"%"),e.find(".stop-color").css("background",e.data("stop-color").asCSSString()),e.gColorButton("value",e.data("stop-color")),function(t){for(var e=t.gGradientEditor("value"),n=[],o=0;o<e.length;++o){var i=e[o];n.push(i.color.asCSSString()+" "+i.position+"%")}t.find(".gradient").css("background","linear-gradient(90deg, "+n.join(", ")+")"),t.gPatternTarget("value",new IFGradient(e))}(t)}var n={init:function(e){return e=t.extend({scene:null},e),this.each(function(){var o=this,i={options:e},a=t(this).addClass("g-gradient-editor").data("ggradienteditor",i).gPatternTarget({types:[IFPattern.Type.Color,IFPattern.Type.Gradient]}).on("patterndrop",function(e,i,r){if(i&&i instanceof IFColor){var s=t(this).find(".stops"),p=s.width(),l=r.pageX-s.offset().left,c=l<=0?0:l>=p?100:l/p*100;n.insertStop.call(o,c,i),a.trigger("change")}else i instanceof IFGradient&&(n.value.call(o,i.getStops()),a.trigger("change"))});t("<div></div>").addClass("container").appendTo(a).append(t("<div></div>").addClass("editor").append(t("<div></div>").addClass("gradient g-input").css("background","transparent")).append(t("<div></div>").addClass("stops").on("mousedown",function(t){t.preventDefault(),t.stopPropagation()}).on("dblclick",function(e){var i=t(e.target);if(i.hasClass("stops")){var r=i.width(),s=e.pageX-i.offset().left,p=s<=0?0:s>=r?100:s/r*100,l=n.insertStop.call(o,p,IFColor.parseCSSColor("black"));a.trigger("change"),i.find("> .stop").each(function(e,n){var o=t(n);if(o.data("stop-position")===l)return o.gColorButton("open"),!1})}})))})},value:function(o){var i=t(this),a=(i.data("ggradienteditor"),i.find(".stops > .stop"));if(arguments.length){if(o&&o.length===a.length)a.each(function(n,a){var r=t(a);r.data("stop-position",o[n].position).data("stop-color",o[n].color).data("stop-delete",!1),e(i,r)});else if(i.find(".stops").empty(),o)for(var r=0;r<o.length;++r)n.insertStop.call(this,o[r].position,o[r].color);return this}var s=[];return a.each(function(e,n){var o=t(n);!1===o.data("stop-delete")&&s.push({position:o.data("stop-position"),color:o.data("stop-color")})}),s.sort(function(t,e){return t.position>e.position}),s},insertStop:function(n,o){var i=t(this),a=i.data("ggradienteditor"),r=i.find(".stops");n=(n=Math.round(n))<0?0:n>100?100:n;var s=!1,p=t("<div></div>").addClass("stop").data("stop-position",n).data("stop-color",o).data("stop-delete",!1).gColorButton({drag:!1,transient:!0,autoOpen:!1,scene:a.options.scene}).append(t("<div></div>").addClass("stop-color")).on("colorchange",function(t,n){n&&(p.data("stop-color",n),e(i,p),i.trigger("change"))}).on("click",function(e){s||t(this).gColorButton("open")}).on("mousedown",function(n){s=!1;var o=r.offset(),a=o.left,l=a+r.width(),c=o.top+r.outerHeight(),d=p.outerWidth(),u=p.offset().left+d-n.pageX,g=p.offset().top-n.pageY,h=t(document),f=function(t){var n=t.pageX+u-d/2,o=t.pageY+g;n<=a?n=a:n>=l&&(n=l),o>c?p.css("display","none").data("stop-delete",!0):p.css("display","").data("stop-delete",!1);var r=n-a,h=l-a,f=r<=0?0:r>=h?100:r/h*100;p.data("stop-position",f),e(i,p),s=!0},y=function(t){h.off("mousemove",f).off("mouseup",y);var e=!0;!0===p.data("stop-delete")&&(r.find("> .stop").length>2?(p.remove(),s=!0):(p.data("stop-delete",!1),s=!0,e=!1)),s&&e&&i.trigger("change")};h.on("mousemove",f).on("mouseup",y)}).appendTo(r);return e(i,p),n}};t.fn.gGradientEditor=function(e){return n[e]?n[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void t.error("Method "+e+" does not exist on jQuery.myPlugin"):n.init.apply(this,arguments)}}(jQuery),function(t){var e=[];document.addEventListener("keydown",function(t){e.length>0&&27===t.keyCode&&e[e.length-1].gOverlay("close")});var n={init:function(e){return e=t.extend({releaseOnClose:!1},e),this.each(function(){var o=this,i=t(this).data("goverlay",{releaseOnClose:e.releaseOnClose}),a=t("<div></div>").addClass("g-modal-background").on("click",function(e){t(e.target).hasClass("g-modal-background")&&n.close.call(o)});t("<div></div>").addClass("g-overlay").css("position","absolute").append(i).appendTo(a)})},open:function(n){var o=t(this);o.data("goverlay");o.parents(".g-modal-background").appendTo(t("body"));var i=t(window),a=i.width(),r=i.height(),s=o.parents(".g-overlay"),p=s.outerWidth(),l=s.outerHeight(),c=t(n),d=c.offset(),u=d.top,g=d.left,h=d.left+c.outerWidth(),f=g,y=d.top+ +c.outerHeight();return f+p>a&&(f=h-p),f+p>a&&(f=a-p),y+l>r&&(y=u-l),y+l>r&&(y=r-l),y<0&&(y=0),f<0&&(f=0),s.css("left",f+"px").css("top",y+"px"),e.push(o),this},close:function(){var n=t(this),o=n.data("goverlay");return n.trigger("close"),o.releaseOnClose?n.parents(".g-modal-background").remove():n.parents(".g-modal-background").detach(),e.pop(),this}};t.fn.gOverlay=function(e){return n[e]?n[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void t.error("Method "+e+" does not exist on jQuery.myPlugin"):n.init.apply(this,arguments)}}(jQuery),function(t){var e={init:function(n){return this.each(function(){var n=this,o=t(this).data("gpivot",{value:null}).addClass("g-pivot"),i=function(i){t("<div></div>").addClass("side").attr("data-side",i).on("click",function(t){e.value.call(n,i),o.trigger("pivotchange",i)}).appendTo(o)};for(var a in t("<div></div>").addClass("borderline").appendTo(o),IFRect.Side)if(IFRect.Side.hasOwnProperty(a)){var r=IFRect.Side[a];"string"==typeof r&&i(r)}})},value:function(e){var n=t(this),o=n.data("gpivot");return arguments.length?(o.value=e,n.find("div[data-side]").each(function(n,o){var i=t(o);i.toggleClass("g-active",i.attr("data-side")===e)}),this):o.value}};t.fn.gPivot=function(n){return e[n]?e[n].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof n&&n?void t.error("Method "+n+" does not exist on jQuery.myPlugin"):e.init.apply(this,arguments)}}(jQuery),function(t){function e(e,n){e.find(".style-block").each(function(e,o){var i=t(o);i.toggleClass("selected",i.data("style")===n)})}function n(e){var n=e.data("gstylepanel");if(n.options.placeholder){var o=e.find(".placeholder");0===e.find("> .style-block").length?0===o.length&&(o=t("<div></div>").addClass("placeholder").text(n.options.placeholder).appendTo(e)):o.length>0&&o.remove()}}function o(e){var n=t(this).data("gstylepanel").container;e.node instanceof IFStyle&&e.node.getParent()===n&&l.insertStyle.call(this,e.node)}function i(e){var n=t(this).data("gstylepanel").container;e.node instanceof IFStyle&&e.node.getParent()===n&&l.removeStyle.call(this,e.node)}function a(e){var n=t(this).data("gstylepanel").container;e.node.getParent()===n&&l.updateStyle.call(this,e.node)}function r(e){var n=t(this).data("gstylepanel").container;e.style.getParent()===n&&l.updateStyle.call(this,e.style)}var s=null;function p(e,n){var o=e.data("gstylepanel");if(s){var i=t(n).data("style");if(i&&(i!==s||ifPlatform.modifiers.shiftKey))return s.getParent()===i.getParent()?o.options.allowReorder:o.options.allowDrop}return!1}var l={init:function(o){return o=t.extend({allowDrag:!0,allowDrop:!1,allowReorder:!0,allowNameEdit:!1,nullStyle:null,nullName:null,placeholder:null,previewWidth:30,previewHeight:30},o),this.each(function(){var i=t(this).addClass("g-style-panel").data("gstylepanel",{selected:null,options:o});o.nullStyle&&t("<div></div>").addClass("style-block style-null").data("style",null).attr("title",o.nullName?o.nullName:"").append(t("<div></div>").addClass("style-content").append(t("<div></div>").addClass("style-preview").append(t("<div></div>").css({display:"inline-block",width:o.previewWidth+"px",height:o.previewHeight+"px","line-height":o.previewHeight+"px"}).append(o.nullStyle))).append(t("<div></div>").addClass("style-name").text(o.nullName?o.nullName:""))).on("click",function(){i.data("gstylepanel").selected=null,e(i,null),i.trigger("stylechange",null)}).appendTo(i),n(i)})},insertStyle:function(o,i){var a=t(this),r=a.data("gstylepanel"),c=null;"number"==typeof i?(r.options.nullStyle&&(i+=1),c=a.children(".style-block").eq(i)):o.getNext()&&a.find(".style-block").each(function(e,n){var i=t(n);if(i.data("style")===o.getNext())return c=i,!1});var d=t("<div></div>").addClass("style-block").data("style",o).append(t("<div></div>").addClass("style-content").append(t("<div></div>").addClass("style-preview").append(t("<img>"))).append(t("<div></div>").addClass("style-name"))).on("mousedown",function(){a.data("gstylepanel").selected=o,e(a,o)}).on("click",function(){a.trigger("stylechange",o)});r.options.allowNameEdit&&o instanceof IFSharedStyle&&d.gAutoEdit({selector:".style-name"}).on("submitvalue",function(t,e){e&&""!==e.trim()&&IFEditor.tryRunTransaction(o,function(){o.setProperty("name",e)},"Rename Style")}),(r.options.allowDrag||r.options.allowReorder)&&d.attr("draggable","true").on("dragstart",function(e){var n=e.originalEvent;n.stopPropagation(),s=t(this).data("style"),r.options.allowDrag&&(a.trigger("styledragstart",o),n.dataTransfer.effectAllowed="move",n.dataTransfer.setData(IFNode.MIME_TYPE,IFNode.serialize(o)),n.dataTransfer.setDragImage(d.find(".style-preview > img")[0],r.options.previewWidth/2,r.options.previewHeight/2))}).on("dragend",function(t){var e=t.originalEvent;if(e.stopPropagation(),s=null,r.options.allowDrag){var n=a.offset(),i=a.outerWidth(),p=a.outerHeight(),l=e.pageX,c=e.pageY;l<=n.left||l>=n.left+i||c<=n.top||c>=n.top+p?a.trigger("styledragaway",o):a.trigger("styledragend",o)}}),(r.options.allowDrop||r.options.allowReorder)&&d.on("dragenter",function(e){p(a,this)&&t(this).addClass("drop")}).on("dragleave",function(e){p(a,this)&&t(this).removeClass("drop")}).on("dragover",function(t){var e=t.originalEvent;p(a,this)&&(e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="move")}).on("drop",function(e){t(this).removeClass("drop");var n=t(this).data("style");if(r.options.allowReorder&&s){if(r.container&&s.getParent()===r.container){var o=s.getParent(),i=o.getIndexOfChild(s),p=o.getIndexOfChild(n);IFEditor.tryRunTransaction(o,function(){if(ifPlatform.modifiers.shiftKey){var t=s.clone();t.setProperty("name",t.getProperty("name")+"-copy"),o.insertChild(t,i<p?n.getNext():n)}else o.removeChild(s),o.insertChild(s,i<p?n.getNext():n)},ifPlatform.modifiers.shiftKey?"Duplicate Style":"Move Style")}a.trigger("stylemove",[s,n])}else r.options.allowDrop&&a.trigger("styledrop",[s,n])}),c&&c.length>0?d.insertBefore(c):d.appendTo(a),n(a),l.updateStyle.call(this,o)},updateStyle:function(e){var n=t(this),o=n.data("gstylepanel");n.find(".style-block").each(function(n,i){var a=t(i);if(a.data("style")===e){a.find(".style-preview > img").attr("src",e.createPreviewImage(o.options.previewWidth,o.options.previewHeight));var r="";return e instanceof IFSharedStyle&&(r=e.getProperty("name")),a.attr("title",r),a.find(".style-name").text(r),!1}})},removeStyle:function(e){var o=t(this),i=o.data("gstylepanel");o.find(".style-block").each(function(a,r){var s=t(r);if(s.data("style")===e)return s.remove(),e===i.selected&&(i.selected=null,o.trigger("stylechange",null)),n(o),!1})},clear:function(){var e=t(this),o=(e.data("gstylepanel"),[]);e.find(".style-block").each(function(e,n){var i=t(n);i.hasClass("style-null")||o.push(i)});for(var i=0;i<o.length;++i)o[i].remove();n(e)},attach:function(e){var n=t(this).data("gstylepanel");if(l.detach.call(this),n.container=e,e){for(var s=e.getFirstChild();null!==s;s=s.getNext())s instanceof IFStyle&&l.insertStyle.call(this,s);var p=e.getScene();p&&(n.afterInsertHandler=o.bind(this),n.beforeRemoveHandler=i.bind(this),n.styleChangeHandler=r.bind(this),n.afterPropertiesChangeHandler=a.bind(this),p.addEventListener(IFNode.AfterInsertEvent,n.afterInsertHandler),p.addEventListener(IFNode.BeforeRemoveEvent,n.beforeRemoveHandler),p.addEventListener(IFNode.AfterPropertiesChangeEvent,n.afterPropertiesChangeHandler),p.addEventListener(IFStyle.StyleChangeEvent,n.styleChangeHandler))}return this},detach:function(){var e=t(this).data("gstylepanel"),n=e.container;if(n){var o=n.getScene();o&&(o.removeEventListener(IFNode.AfterInsertEvent,e.afterInsertHandler),o.removeEventListener(IFNode.BeforeRemoveEvent,e.beforeRemoveHandler),o.removeEventListener(IFNode.AfterPropertiesChangeEvent,e.afterPropertiesChangeHandler),o.removeEventListener(IFStyle.StyleChangeEvent,e.styleChangeHandler))}return e.container=null,e.afterInsertHandler=null,e.beforeRemoveHandler=null,e.afterPropertiesChangeHandler=null,e.styleChangeHandler=null,l.clear.call(this),this},value:function(n){var o=t(this);return arguments.length?(o.data("gstylepanel").selected=n,e(o,n),this):o.data("gstylepanel").selected}};t.fn.gStylePanel=function(e){return l[e]?l[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void t.error("Method "+e+" does not exist on jQuery.myPlugin"):l.init.apply(this,arguments)}}(jQuery),function(t){function e(e,n){e.data("gswatchpanel").options.allowSelect&&e.find(".swatch-block").each(function(e,o){var i=t(o);i.toggleClass("selected",i.data("swatch")===n)})}function n(e){var n=e.data("gswatchpanel");if(n.options.placeholder){var o=e.find(".placeholder");0===e.find("> .swatch-block").length?0===o.length&&(o=t("<div></div>").addClass("placeholder").text(n.options.placeholder).appendTo(e)):o.length>0&&o.remove()}}function o(e){var n=t(this).data("gswatchpanel").container;e.node instanceof IFSwatch&&e.node.getParent()===n&&p.insertSwatch.call(this,e.node)}function i(e){var n=t(this).data("gswatchpanel").container;e.node instanceof IFSwatch&&e.node.getParent()===n&&p.removeSwatch.call(this,e.node)}function a(e){var n=t(this).data("gswatchpanel").container;e.node.getParent()===n&&p.updateSwatch.call(this,e.node)}var r=null;function s(e,n){var o=e.data("gswatchpanel");if(r){var i=t(n).data("swatch");if(i&&i!==r)return r.getParent()===i.getParent()?o.options.allowReorder:o.options.allowDrop}return!1}var p={init:function(o){return o=t.extend({types:null,allowDrag:!0,allowDrop:!1,allowReorder:!0,allowSelect:!0,allowNameEdit:!1,nullSwatch:null,nullName:null,placeholder:null,previewWidth:20,previewHeight:20},o),this.each(function(){var i=t(this).addClass("g-swatch-panel").data("gswatchpanel",{selected:null,options:o}).on("dragover",function(t){var e=t.originalEvent;e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="move"}).on("drop",function(t){var e=i.data("gswatchpanel"),n=t.originalEvent;if(n.stopPropagation(),!r&&e.container&&e.container.getScene()){var o=e.container.getScene(),a=n.dataTransfer.getData(IFPattern.MIME_TYPE);if(a){var s=IFPattern.parsePattern(a);if(s){for(var p=o.getSwatchCollection(),l=p.getFirstChild();null!==l;l=l.getNext())if(l instanceof IFSwatch&&IFPattern.equals(s,l.getProperty("pat")))return;var c=s instanceof IFColor?s.asString():"pattern",d=prompt("Enter a name for the new swatch:",c);if(null===d)return;""===d.trim()&&(d=c),IFEditor.tryRunTransaction(o,function(){var t=new IFSwatch;t.setProperties(["name","pat"],[d,s]),p.appendChild(t)},"Add Swatch")}}}else r=null});o.nullSwatch&&t("<div></div>").addClass("swatch-block swatch-null").data("swatch",null).attr("title",o.nullName?o.nullName:"").append(t("<div></div>").addClass("swatch-content").append(t("<div></div>").addClass("swatch-preview").append(t("<div></div>").css({width:o.previewWidth+"px",height:o.previewHeight+"px","line-height":o.previewHeight+"px"}).append(o.nullSwatch))).append(t("<div></div>").addClass("swatch-name").text(o.nullName?o.nullName:""))).on("click",function(){i.data("gswatchpanel").selected=null,e(i,null),i.trigger("swatchchange",null)}).appendTo(i),n(i)})},insertSwatch:function(o,i){var a=t(this),l=a.data("gswatchpanel"),c=l.options.types;if(!(null!==c&&c.length>0&&c.indexOf(o.getPatternType())<0)){var d=null;"number"==typeof i?(l.options.nullSwatch&&(i+=1),d=a.children(".swatch-block").eq(i)):o.getNext()&&a.find(".swatch-block").each(function(e,n){var i=t(n);if(i.data("swatch")===o.getNext())return d=i,!1});var u=t("<div></div>").addClass("swatch-block").data("swatch",o).append(t("<div></div>").addClass("swatch-content").append(t("<div></div>").addClass("swatch-preview").append(t("<div></div>").css({width:l.options.previewWidth+"px",height:l.options.previewHeight+"px"}))).append(t("<div></div>").addClass("swatch-name"))).on("mousedown",function(){a.data("gswatchpanel").selected=o,e(a,o)}).on("click",function(){a.trigger("swatchchange",o)});l.options.allowNameEdit&&u.gAutoEdit({selector:".swatch-name"}).on("submitvalue",function(t,e){e&&""!==e.trim()&&IFEditor.tryRunTransaction(o,function(){o.setProperty("name",e)},"Rename Swatch")}),(l.options.allowDrag||l.options.allowReorder)&&u.attr("draggable","true").on("dragstart",function(e){var n=e.originalEvent;n.stopPropagation();var o=(r=t(this).data("swatch")).getProperty("pat");o?l.options.allowDrag&&(a.trigger("swatchdragstart",r),n.dataTransfer.effectAllowed="move",n.dataTransfer.setData(IFPattern.MIME_TYPE,IFPattern.asString(o)),n.dataTransfer.setDragImage(u.find(".swatch-preview > div")[0],l.options.previewWidth/2,l.options.previewHeight/2)):n.preventDefault()}).on("dragend",function(t){var e=t.originalEvent;if(e.stopPropagation(),r=null,l.options.allowDrag){var n=a.offset(),i=a.outerWidth(),s=a.outerHeight(),p=e.pageX,c=e.pageY;p<=n.left||p>=n.left+i||c<=n.top||c>=n.top+s?a.trigger("swatchdragaway",o):a.trigger("swatchdragend",o)}}),(l.options.allowDrop||l.options.allowReorder)&&u.on("dragenter",function(e){s(a,this)&&t(this).addClass("drop")}).on("dragleave",function(e){s(a,this)&&t(this).removeClass("drop")}).on("dragover",function(t){var e=t.originalEvent;s(a,this)&&(e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="move")}).on("drop",function(e){t(this).removeClass("drop");var n=t(this).data("swatch");if(r)if(l.options.allowReorder){if(l.container&&r.getParent()===l.container){var o=r.getParent(),i=o.getIndexOfChild(r),s=o.getIndexOfChild(n);IFEditor.tryRunTransaction(o,function(){o.removeChild(r),o.insertChild(r,i<s?n.getNext():n)},"Move Swatch")}a.trigger("swatchmove",[r,n])}else l.options.allowDrop&&a.trigger("swatchdrop",[r,n])}),d&&d.length>0?u.insertBefore(d):u.appendTo(a),n(a),p.updateSwatch.call(this,o)}},updateSwatch:function(e){var n=t(this);n.data("gswatchpanel");n.find(".swatch-block").each(function(n,o){var i=t(o);if(i.data("swatch")===e){i.find(".swatch-preview > div").css("background",IFPattern.asCSSBackground(e.getProperty("pat")));var a=e.getProperty("name");return i.attr("title",a),i.find(".swatch-name").text(a),!1}})},removeSwatch:function(e){var o=t(this),i=o.data("gswatchpanel");o.find(".swatch-block").each(function(a,r){var s=t(r);if(s.data("swatch")===e)return s.remove(),e===i.selected&&(i.selected=null,o.trigger("swatchchange",null)),n(o),!1})},clear:function(){var e=t(this),o=(e.data("gswatchpanel"),[]);e.find(".swatch-block").each(function(e,n){var i=t(n);i.hasClass("swatch-null")||o.push(i)});for(var i=0;i<o.length;++i)o[i].remove();n(e)},attach:function(e){var n=t(this).data("gswatchpanel");if(p.detach.call(this),n.container=e,e){for(var r=e.getFirstChild();null!==r;r=r.getNext())r instanceof IFSwatch&&p.insertSwatch.call(this,r);var s=e.getScene();s&&(n.afterInsertHandler=o.bind(this),n.beforeRemoveHandler=i.bind(this),n.afterPropertiesChangeHandler=a.bind(this),s.addEventListener(IFNode.AfterInsertEvent,n.afterInsertHandler),s.addEventListener(IFNode.BeforeRemoveEvent,n.beforeRemoveHandler),s.addEventListener(IFNode.AfterPropertiesChangeEvent,n.afterPropertiesChangeHandler))}return this},detach:function(){var e=t(this).data("gswatchpanel"),n=e.container;if(n){var o=n.getScene();o&&(o.removeEventListener(IFNode.AfterInsertEvent,e.afterInsertHandler),o.removeEventListener(IFNode.BeforeRemoveEvent,e.beforeRemoveHandler),o.removeEventListener(IFNode.AfterPropertiesChangeEvent,e.afterPropertiesChangeHandler))}return e.container=null,e.afterInsertHandler=null,e.beforeRemoveHandler=null,e.afterPropertiesChangeHandler=null,p.clear.call(this),this},value:function(n){var o=t(this);return arguments.length?(o.data("gswatchpanel").selected=n,e(o,n),this):o.data("gswatchpanel").selected}};t.fn.gSwatchPanel=function(e){return p[e]?p[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void t.error("Method "+e+" does not exist on jQuery.myPlugin"):p.init.apply(this,arguments)}}(jQuery),function(t){function e(t){this._parent=t,this._htmlElement=$("<ul></ul>").addClass("g-menu"),this._htmlElement.on("mouseover",this._mouseOver.bind(this)),this._htmlElement.on("mouseout",this._mouseOut.bind(this))}IFObject.inherit(e,GEventTarget),e.Position={Left_Top:0,Center:1,Right_Bottom:2},e._activeMenu=null,e._activeMenuMouseLocations=null,e.getActiveMenu=function(){return e._activeMenu},e.setActiveMenu=function(t,n){this._activeMenu&&(n||this._activeMenu.close(),this._activeMenu=null,document.removeEventListener("mousemove",e._activeMenuMouseMoveListener),document.removeEventListener("mousedown",e._activeMenuMouseUpDownListener),document.removeEventListener("mouseup",e._activeMenuMouseUpDownListener),document.removeEventListener("keyup",e._activeMenuKeyDownListener)),this._activeMenu=t,this._activeMenu&&(document.addEventListener("mousemove",e._activeMenuMouseMoveListener),document.addEventListener("mousedown",e._activeMenuMouseUpDownListener),setTimeout(function(){document.addEventListener("mouseup",e._activeMenuMouseUpDownListener)},250),document.addEventListener("keyup",e._activeMenuKeyDownListener))},e._activeMenuMouseMoveListener=function(t){e._activeMenuMouseLocations||(e._activeMenuMouseLocations=[]),e._activeMenuMouseLocations.push({x:t.pageX,y:t.pageY}),e._activeMenuMouseLocations.length>3&&e._activeMenuMouseLocations.shift()},e._activeMenuMouseUpDownListener=function(t){e.setActiveMenu(null)},e._activeMenuKeyDownListener=function(t){27==t.keyCode&&e.setActiveMenu(null)},e.createActionMenu=function(t,e){for(var n=[],o=function(t,e,o){if(t.getItemCount()>0){var i=function(t){for(var e=0;e<n.length;++e)if(n[e].item===t)return n[e].group}(t.getItem(t.getItemCount()-1));i!==o&&t.addItem(new GMenuItem(GMenuItem.Type.Divider))}n.push({item:e,group:o})},i=0;i<t.length;++i){var a=t[i];if(a.isAvailable()){var r=ifLocale.get(a.getCategory()),s=a.getGroup(),p=r?r.split("/"):null,l=s?[""].concat(s.split("/")):null;if(l&&p&&p.length!==l.length-1)throw new Error("Number of categories different thant number of groups.");var c=e;if(p)for(var d=0;d<p.length;++d){r=p[d],s=l?l[d]:null;var u=c.findItem(r);u||((u=new GMenuItem(GMenuItem.Type.Menu)).setCaption(r),o(c,u,s),c.addItem(u)),c=u.getMenu()}var g=new GMenuItem;g.setAction(a),o(c,g,l?l[l.length-1]:null),c.addItem(g)}}},e.OpenEvent=function(){},IFObject.inherit(e.OpenEvent,GEvent),e.OpenEvent.prototype.toString=function(){return"[Object GMenu.OpenEvent]"},e.OPEN_EVENT=new e.OpenEvent,e.CloseEvent=function(){},IFObject.inherit(e.CloseEvent,GEvent),e.CloseEvent.prototype.toString=function(){return"[Object GMenu.CloseEvent]"},e.CLOSE_EVENT=new e.CloseEvent,e.prototype._parent=null,e.prototype._htmlElement=null,e.prototype._items=null,e.prototype._hovered=!1,e.prototype.getParent=function(){return this._parent},e.prototype.isHovered=function(t){if(this._hovered)return!0;if(t){for(var e=0;e<this.getItemCount();++e){var n=this.getItem(e);if(n instanceof GMenuItem&&n.getType()===GMenuItem.Type.Menu&&n.getMenu().isHovered(!0))return!0}return!1}return!1},e.prototype.isRootMenu=function(){return!(this._parent&&this._parent instanceof GMenuItem)},e.prototype.isSubMenu=function(){return!!(this._parent&&this._parent instanceof GMenuItem)&&!this._parent.isRootItem()},e.prototype.createAddDivider=function(){return this.createInsertDivider(this.getItemCount())},e.prototype.createInsertDivider=function(t){var e=new GMenuItem(GMenuItem.Type.Divider);return this.insertItem(t,e),e},e.prototype.createAddItem=function(t,e,n,o){return this.createInsertItem(this.getItemCount(),t,e,n,o)},e.prototype.createInsertItem=function(t,e,n,o,i){var a=new GMenuItem;return a.setCaption(e),n&&a.addEventListener(GMenuItem.ActivateEvent,n),o&&a.addEventListener(GMenuItem.EnterEvent,o),i&&a.addEventListener(GMenuItem.LeaveEvent,i),this.insertItem(t,a),a},e.prototype.addItem=function(t){return this.insertItem(this.getItemCount(),t)},e.prototype.insertItem=function(t,e){null==this._items&&(this._items=[]),t+1<this._items.length?(this._items.splice(t,0,e),this._items[t+1]._htmlElement.before(e._htmlElement)):(this._items.push(e),this._htmlElement.append(e._htmlElement)),e._parent=this},e.prototype.removeItem=function(t){t>=0&&t<this.getItemCount()&&(this._items[t]._parent=null,this._items[t]._htmlElement.detach(),this._items.splice(t,1))},e.prototype.clearItems=function(){if(this._items){for(var t=0;t<this._items.length;++t)this._items[t]._parent=null,this._items[t]._htmlElement.detach();this._items=[]}},e.prototype.getItem=function(t){return t>=0&&t<this.getItemCount()?this._items[t]:null},e.prototype.getItemCount=function(){return this._items?this._items.length:0},e.prototype.indexOf=function(t){return this._items?this._items.indexOf(t):-1},e.prototype.findItem=function(t){for(var e=0;e<this.getItemCount();++e){var n=this.getItem(e);if(t==n.getCaption())return n}return null},e.prototype.update=function(){for(var t=0;t<this.getItemCount();++t){this.getItem(t).update()}},e.prototype.isOpen=function(){return!!this._htmlElement.parent().length},e.prototype.open=function(t,n,o){if(n="number"==typeof n?n:e.Position.Center,o="number"==typeof o?o:e.Position.Center,this.isOpen()||(this.update(),this._htmlElement.appendTo($("body")),this.isSubMenu()||e.setActiveMenu(this),this.trigger(e.OPEN_EVENT)),this._htmlElement.parent().is("body")){var i=this._htmlElement.outerWidth(),a=this._htmlElement.outerHeight(),r=$(window).width(),s=$(window).height(),p={x:0,y:0,width:0,height:0};if("number"==typeof t.x&&"number"==typeof t.y)p.x=t.x,p.y=t.y;else{var l=t.offset();p.x=l.left,p.y=l.top,p.width=t.outerWidth(),p.height=t.outerHeight()}var c=0;switch(n){case e.Position.Left_Top:c=p.x-i;break;case e.Position.Center:c=p.x;break;case e.Position.Right_Bottom:c=p.x+p.width}var d=0;switch(o){case e.Position.Left_Top:d=p.y-a;break;case e.Position.Center:d=p.y;break;case e.Position.Right_Bottom:d=p.y+p.height}switch(c<0&&(c=0),c+i>=r&&(c=r-i),d<0&&(d=0),d+a>=s&&(d=s-a),this._htmlElement.css("left",c),this._htmlElement.css("top",d),n){case e.Position.Left_Top:this._htmlElement.addClass("g-menu-left");break;case e.Position.Right_Bottom:this._htmlElement.addClass("g-menu-right")}switch(o){case e.Position.Left_Top:this._htmlElement.addClass("g-menu-top");break;case e.Position.Right_Bottom:this._htmlElement.addClass("g-menu-bottom")}}},e.prototype.close=function(){this.isOpen()&&this._htmlElement.parent().is("body")&&(this.closeMenus(),this._htmlElement.removeClass("g-menu-left g-menu-right g-menu-top g-menu-bottom"),this._htmlElement.detach(),this===e._activeMenu&&e.setActiveMenu(null,!0),this.trigger(e.CLOSE_EVENT))},e.prototype.closeMenus=function(){for(var t=0;t<this.getItemCount();++t){var e=this.getItem(t);e instanceof GMenuItem&&e.getType()===GMenuItem.Type.Menu&&e.getMenu().close()}},e.prototype._mouseOver=function(t){this._hovered=!0},e.prototype._mouseOut=function(t){this._hovered=!1,this.isSubMenu()&&setTimeout(function(){this.isHovered(!0)||this.closeMenus()}.bind(this),150)},t.GMenu=e}(this),function(t){function e(t){this._menu=t||new GMenu(this),this._menu._parent=this,this._menu._htmlElement.addClass("g-menu-root"),this._htmlElement=$("<nav></nav>").addClass("g-menu-bar").append(this._menu._htmlElement)}e.prototype._menu=null,e.prototype.getMenu=function(){return this._menu},e.prototype.isActive=function(){var t=GMenu.getActiveMenu();return!!(t&&t._parent&&t._parent instanceof GMenuItem)&&t._parent.getMenuBar()===this},e.prototype.toString=function(){return"[Object GMenuBar]"},t.GMenuBar=e}(this),function(t){function e(t){this._htmlElement=$("<li></li>").addClass("g-menu-item"),this._type=t||e.Type.Item,this._type===e.Type.Divider?this._htmlElement.addClass("g-menu-item-divider"):(this._htmlElement.append($("<span></span>").addClass("g-menu-item-icon").css("display","none")).append($("<span></span>").addClass("g-menu-item-caption")).append($("<span></span>").addClass("g-menu-item-shortcut").css("display","none")).append($("<span></span>").addClass("g-menu-item-tail")),this._type===e.Type.Menu&&(this._htmlElement.addClass("g-menu-item-menu"),this.setMenu(new GMenu(this)))),this._htmlElement.on("mouseover",this._mouseOver.bind(this)),this._htmlElement.on("mouseout",this._mouseOut.bind(this)),this._htmlElement.on("mousedown",this._mouseDown.bind(this)),this._htmlElement.on("mouseup",this._mouseUp.bind(this))}IFObject.inherit(e,GEventTarget),e.Type={Item:0,Menu:1,Divider:2},e.EnterEvent=function(){},IFObject.inherit(e.EnterEvent,GEvent),e.EnterEvent.prototype.toString=function(){return"[Object GMenuItem.EnterEvent]"},e.ENTER_EVENT=new e.EnterEvent,e.LeaveEvent=function(){},IFObject.inherit(e.LeaveEvent,GEvent),e.LeaveEvent.prototype.toString=function(){return"[Object GMenuItem.LeaveEvent]"},e.LEAVE_EVENT=new e.LeaveEvent,e.ActivateEvent=function(){},IFObject.inherit(e.ActivateEvent,GEvent),e.ActivateEvent.prototype.toString=function(){return"[Object GMenuItem.ActivateEvent]"},e.ACTIVATE_EVENT=new e.ActivateEvent,e.UpdateEvent=function(){},IFObject.inherit(e.UpdateEvent,GEvent),e.UpdateEvent.prototype.toString=function(){return"[Object GMenuItem.UpdateEvent]"},e.UPDATE_EVENT=new e.UpdateEvent,e.prototype._parent=null,e.prototype._type=null,e.prototype._menu=null,e.prototype._icon=null,e.prototype._caption=null,e.prototype._shortcutHint=null,e.prototype._action=null,e.prototype.getParent=function(){return this._parent},e.prototype.getType=function(){return this._type},e.prototype.getIcon=function(){return this._icon},e.prototype.setIcon=function(t){if(t!==this._icon){this._icon=t;var e=this._htmlElement.find(".g-menu-item-icon");e.empty(),this._icon?("string"==typeof this._icon?e.append($("<i></i>").addClass(t)):e.append(this._icon),e.css("display","")):e.css("display","none")}},e.prototype.getCaption=function(){return this._caption},e.prototype.setCaption=function(t){if(t!==this._caption){this._caption=t;var e=this._htmlElement.find(".g-menu-item-caption");e.empty(),!this._caption||this._caption instanceof IFLocale.Key||"string"==typeof this._caption?e.text(this._caption?ifLocale.get(this._caption):""):e.append(this._caption)}},e.prototype.getShortcutHint=function(){return this._shortcutHint},e.prototype.setShortcutHint=function(t){this._shortcutHint=t;var e=this._htmlElement.find(".g-menu-item-shortcut");this._shortcutHint&&this._shortcutHint.length>0?(e.text(ifKey.shortcutToString(t)),e.css("display","")):(e.empty(),e.css("display","none"))},e.prototype.getAction=function(){return this._action},e.prototype.setAction=function(t){if(t!==this._action){var e;if(this._action)(e=t.getShortcut())&&e===this.getShortcutHint()&&this.setShortcutHint(null);if(this._action=t,this._action)(e=t.getShortcut())&&this.setShortcutHint(e),this.setCaption(this._action.getTitle()),this.setEnabled(!0===this._action.isEnabled())}},e.prototype.isChecked=function(){return this._htmlElement.hasClass("g-menu-item-checked")},e.prototype.setChecked=function(t){t!=this.isChecked()&&(t?this._htmlElement.addClass("g-menu-item-checked"):this._htmlElement.removeClass("g-menu-item-checked"))},e.prototype.isEnabled=function(){return!this._htmlElement.hasClass("g-disabled")},e.prototype.setEnabled=function(t){t!=this.isEnabled()&&(t?this._htmlElement.removeClass("g-disabled"):this._htmlElement.addClass("g-disabled"))},e.prototype.isRootItem=function(){return this._parent&&this._parent instanceof GMenu&&null!=this._parent._parent&&!(this._parent._parent instanceof e)},e.prototype.isRootMenuBarItem=function(){return this.isRootItem()&&this._parent._parent instanceof GMenuBar},e.prototype.getMenuBar=function(){return this.isRootMenuBarItem()?this._parent._parent:null},e.prototype.getMenu=function(){return this._menu},e.prototype.setMenu=function(t){t&&t!==this._menu&&this._type===e.Type.Menu&&(this._menu=t,this._menu._parent=this,this._menu.addEventListener(GMenu.OPEN_EVENT,this._menuOpen.bind(this)),this._menu.addEventListener(GMenu.CLOSE_EVENT,this._menuClose.bind(this)))},e.prototype.update=function(){this._action&&(this.setCaption(this._action.getTitle()),this.setEnabled(this._action.isEnabled()),this.setChecked(this._action.isChecked())),this.hasEventListeners(e.UpdateEvent)&&this.trigger(e.UPDATE_EVENT)},e.prototype.toString=function(){return"[Object GMenuItem]"},e.prototype._mouseOver=function(t){this._parent&&this._parent instanceof GMenu&&!this.isRootItem()&&this._parent.closeMenus(),this.isEnabled()&&(this._type==e.Type.Menu&&ifSystem.hardware===IFSystem.Hardware.Desktop&&(!this.isRootItem()||this.isRootMenuBarItem()&&this.getMenuBar().isActive())&&this._openMenu(),this._type!=e.Type.Divider&&(this._htmlElement.addClass("g-hover"),this.hasEventListeners(e.EnterEvent)&&this.trigger(e.ENTER_EVENT)))},e.prototype._mouseOut=function(t){this.isEnabled()&&this._type!=e.Type.Divider&&(this._htmlElement.removeClass("g-hover"),this.hasEventListeners(e.LeaveEvent)&&this.trigger(e.LEAVE_EVENT))},e.prototype._mouseDown=function(t){this.isEnabled()&&t.button==GUIMouseEvent.BUTTON_LEFT&&(t.stopPropagation(),t.preventDefault(),this._type!==e.Type.Menu||!this.isRootItem()&&ifSystem.hardware===IFSystem.Hardware.Desktop||(this._htmlElement.hasClass("g-active")?this.getMenu().close():this._openMenu()))},e.prototype._mouseUp=function(t){t.stopPropagation(),t.preventDefault(),this.isRootMenuBarItem()||(this._mouseOut(t),GMenu.setActiveMenu(null)),this._type==e.Type.Item&&(this._action&&this._action.isAvailable()&&this._action.isEnabled()&&this._action.execute(),this.isEnabled()&&this.hasEventListeners(e.ActivateEvent)&&this.trigger(e.ACTIVATE_EVENT))},e.prototype._openMenu=function(){this.getMenu().open(this._htmlElement,this.isRootItem()?GMenu.Position.Center:GMenu.Position.Right_Bottom,this.isRootItem()?GMenu.Position.Right_Bottom:GMenu.Position.Center)},e.prototype._menuOpen=function(){this._htmlElement.addClass("g-active"),this.isRootItem()&&this._parent._parent._htmlElement.addClass("g-active")},e.prototype._menuClose=function(){this._htmlElement.removeClass("g-active"),this.isRootItem()&&this._parent._parent._htmlElement.removeClass("g-active")},t.GMenuItem=e}(this),function(t){var e={margin:"0px 1px",transform:"rotate(-45deg)",position:"absolute",bottom:"3px","font-size":"10px"},n={"margin-left":"3px"},o={init:function(i){return i=t.extend({menu:null,defaultAction:null,arrow:!0},i),this.each(function(){var a=this,r=null,s=t(this).data("gmenubutton",{options:i}).on("mousedown",function(t){t.stopPropagation(),//!! prevent menu closing !!
i.defaultAction?r=setTimeout(function(){o.open.call(a),r=null}.bind(this),250):o.open.call(a)}).on("mouseup",function(t){t.stopPropagation(),//!! prevent menu closing !!
null!==r&&(clearTimeout(r),r=null),!i.menu.isOpen()&&i.defaultAction&&i.defaultAction()});i.arrow&&s.append(t("<span></span>").addClass("fa fa-caret-down").css(i.defaultAction?e:n))})},open:function(){var e=t(this),n=e.data("gmenubutton").options.menu;n.isOpen()||n.open(e,GMenu.Position.Center,GMenu.Position.Right_Bottom)},close:function(){var t=$this.data("gmenubutton").options.menu;t.isOpen()&&t.close()}};t.fn.gMenuButton=function(e){return o[e]?o[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void t.error("Method "+e+" does not exist on jQuery.myPlugin"):o.init.apply(this,arguments)}}(jQuery),function(t){function e(){}IFObject.inherit(e,IFObject),e.prototype.getId=function(){throw new Error("Not Supported")},e.prototype.getTitle=function(){throw new Error("Not Supported")},e.prototype.getCategory=function(){return null},e.prototype.getGroup=function(){return null},e.prototype.getShortcut=function(){return null},e.prototype.isEnabled=function(){return!0},e.prototype.isCheckable=function(){return!1},e.prototype.isChecked=function(){return!1},e.prototype.isAvailable=function(){return!0},e.prototype.execute=function(){throw new Error("Not Supported")},e.prototype.toString=function(){return"[Object GAction]"},t.GAction=e}(this),function(t){function e(){}e.CATEGORY_HARMONY=new IFLocale.Key(e,"category.harmony"),e.CATEGORY_PALETTE=new IFLocale.Key(e,"category.palette"),e.prototype.getTitle=function(){throw new Error("Not Supported")},e.prototype.getCategory=function(){return null},e.prototype.match=function(t){throw new Error("Not Supported")},e.prototype.toString=function(){return"[Object GColorMatcher]"},t.GColorMatcher=e}(this),function(t){function e(){}e.parseSize=function(t){var e=null,n=null,o=t.split("@"),i=function(t){if("?"===t)return null;var e=ifUtil.parseNumber(t);if("number"!=typeof e)return null;var n=t.substr(e.toString().length);return n&&n.length>0&&"x"===(n=n.trim().toLowerCase())?e:IFLength.parseLength(t)};e=null,n=null;switch(o[0].charAt(o[0].length-1)){case"w":case"W":e=i(o[0].substr(0,o[0].length-1));break;case"h":case"H":n=i(o[0].substr(0,o[0].length-1));break;default:e=i(o[0]),o.length>1&&(n=i(o[1]))}return{width:e,height:n}},e.prototype.isStandalone=function(){throw new Error("Not Supported.")},e.prototype.getName=function(){throw new Error("Not Supported.")},e.prototype.getExtensions=function(){throw new Error("Not Supported.")},e.prototype.exportPart=function(t,e,n,o,i){throw new Error("Not Supported.")},t.GExporter=e}(this),function(t){function e(){}e.prototype.init=function(){},t.GModule=e}(this),function(t){function e(){}IFObject.inherit(e,GEventTarget),e.UpdateEvent=function(){},IFObject.inherit(e.UpdateEvent,GEvent),e.UpdateEvent.prototype.toString=function(){return"[Object GView.UpdateEvent]"},e.UPDATE_EVENT=new e.UpdateEvent,e.DocumentState=function(t){this.document=t},e.DocumentState.prototype.document=null,e.DocumentState.prototype.activate=function(){},e.DocumentState.prototype.deactivate=function(){},e.DocumentState.prototype.init=function(){},e.DocumentState.prototype.release=function(){},e.prototype._documentStates=null,e.prototype.getId=function(){throw new Error("Not Supported")},e.prototype.getTitle=function(){throw new Error("Not Supported")},e.prototype._createDocumentState=function(t){return null},e.prototype._activateDocumentState=function(t){},e.prototype._deactivateDocumentState=function(t){},e.prototype._documentEvent=function(t){switch(t.type){case GApplication.DocumentEvent.Type.Added:(n=this._createDocumentState(t.document))&&(n.init(),this._documentStates||(this._documentStates=[]),this._documentStates.push(n),this.trigger(e.UPDATE_EVENT));break;case GApplication.DocumentEvent.Type.Removed:(n=this._findDocumentState(t.document))&&(n.release(),this._documentStates.splice(this._documentStates.indexOf(n),1),0===this._documentStates.length&&(this._documentStates=null),this.trigger(e.UPDATE_EVENT));break;case GApplication.DocumentEvent.Type.Activated:(n=this._findDocumentState(t.document))&&(n.activate(),this._activateDocumentState(n),this.trigger(e.UPDATE_EVENT));break;case GApplication.DocumentEvent.Type.Deactivated:var n;(n=this._findDocumentState(t.document))&&(n.deactivate(),this._deactivateDocumentState(n),this.trigger(e.UPDATE_EVENT))}},e.prototype._findDocumentState=function(t){if(!this._documentStates)return null;for(var e=0;e<this._documentStates.length;++e)if(this._documentStates[e].document===t)return this._documentStates[e]},e.prototype.toString=function(){return"[Object GView]"},t.GView=e}(this),function(t){function e(){GView.call(this)}IFObject.inherit(e,GView),e.prototype.getGroup=function(){return null},e.prototype.isEnabled=function(){return!0},e.prototype.init=function(t,e){gApp.addEventListener(GApplication.DocumentEvent,this._documentEvent,this)},e.prototype.toString=function(){return"[Object GPalette]"},t.GPalette=e}(this),function(t){function e(){GView.call(this)}IFObject.inherit(e,GView),e.prototype.getTitle=function(){return null},e.prototype.init=function(t){gApp.addEventListener(GApplication.DocumentEvent,this._documentEvent,this)},e.prototype.activate=function(){},e.prototype.deactivate=function(){},e.prototype.toString=function(){return"[Object GPanel]"},t.GPanel=e}(this),function(t){function e(){}e.prototype.getCategory=function(){throw new Error("Not Supported.")},e.prototype.init=function(t){throw new Error("Not Supported.")},e.prototype.update=function(t,e){throw new Error("Not Supported.")},e.prototype.toString=function(){return"[Object GProperties]"},t.GProperties=e}(this),function(t){function e(){GView.call(this)}IFObject.inherit(e,GView),e.prototype.getIcon=function(){return null},e.prototype.init=function(t){gApp.addEventListener(GApplication.DocumentEvent,this._documentEvent,this)},e.prototype.activate=function(){},e.prototype.deactivate=function(){},e.prototype.toString=function(){return"[Object GSidebar]"},t.GSidebar=e}(this),function(t){function e(){}e.prototype.isAvailable=function(){throw new Error("Not supported.")},e.prototype.isSaving=function(){throw new Error("Not supported.")},e.prototype.isPrompting=function(){throw new Error("Not supported.")},e.prototype.isDirectory=function(){throw new Error("Not supported.")},e.prototype.getProtocol=function(){throw new Error("Not supported.")},e.prototype.getExtensions=function(){throw new Error("Not Supported.")},e.prototype.getName=function(){throw new Error("Not supported.")},e.prototype.openResourcePrompt=function(t,e,n){throw new Error("Not supported.")},e.prototype.saveResourcePrompt=function(t,e,n,o){throw new Error("Not supported.")},e.prototype.openDirectoryPrompt=function(t,e){throw new Error("Not supported.")},e.prototype.saveDirectoryPrompt=function(t,e){throw new Error("Not supported.")},e.prototype.load=function(t,e,n){throw new Error("Not Supported.")},e.prototype.save=function(t,e,n,o){throw new Error("Not Supported.")},e.prototype.releaseUrl=function(t){},e.prototype.resolveUrl=function(t,e){throw new Error("Not Supported.")},t.GStorage=e}(this),function(t){function e(){}e.prototype.getEntryClass=function(){throw new Error("Not Supported.")},e.prototype.getEntryName=function(){throw new Error("Not Supported.")},e.prototype.createContent=function(t,e,n){throw new Error("Not Supported.")},e.prototype.updateProperties=function(t,e){throw new Error("Not Supported.")},e.prototype.assignProperties=function(t,e){throw new Error("Not Supported.")},e.prototype.toString=function(){return"[Object GStyleEntry]"},t.GStyleEntry=e}(this),function(t){function e(){}e.prototype.getCategory=function(){throw new Error("Not Supported.")},e.prototype.init=function(t){throw new Error("Not Supported.")},e.prototype.update=function(t,e){throw new Error("Not Supported.")},e.prototype.toString=function(){return"[Object GTransformer]"},t.GTransformer=e}(this),function(t){function e(t){this._htmlElement=t}e.prototype._htmlElement=null,e.prototype.init=function(){},e.prototype.relayout=function(){},t.GHeader=e}(this),function(t){function e(t){this._htmlElement=t,this._palettesInfo=[],this._groupsInfo=[]}e.prototype._htmlElement=null,e.prototype._palettesInfo=null,e.prototype._groupsInfo=null,e.prototype.groupPalettes=function(t){for(var e=0;e<t.length;++e)this._detachPaletteFromGroup(t[e].getId());var n=this._addGroupInfo();for(e=0;e<t.length;++e)this._attachPaletteToGroup(n,t[e].getId())},e.prototype.isPaletteActive=function(t){var e=this._getGroupInfoForPalette(t);return!!e&&(e.activePalette===t&&e.visible&&e.expanded)},e.prototype.setPaletteActive=function(t,e){var n=this._getGroupInfoForPalette(t);if(n&&(n.activePalette!==t||!e||!n.visible||!n.expanded))if(e){var o=this._getPaletteInfo(t);n.activePalette=t,n.container.find(".palette-group-tabs > button").each(function(){var e=$(this);e.attr("data-palette-id")===t?e.addClass("g-active"):e.removeClass("g-active")}),n.container.find(".palette-group-panels > div").each(function(){var e=$(this);e.attr("data-palette-id")===t?e.css("display",""):e.css("display","none")});var i=n.container.find(".palette-group-controls");i.children().detach(),i.append(o.controls),this._setGroupVisible(n,!0),this._setGroupExpanded(n,!0)}else this._setGroupVisible(n,!1)},e.prototype.isPaletteEnabled=function(t){var e=this._getPaletteInfo(t);return!!e&&0==e.panel.find(".panel-disabled-overlay").length},e.prototype.setPaletteEnabled=function(t,e){var n=this._getPaletteInfo(t);if(n){var o=n.panel.find(".panel-disabled-overlay");e&&o.length>0?o.remove():e||0!==o.length||(o=$("<div></div>").addClass("panel-disabled-overlay").appendTo(n.panel))}},e.prototype.init=function(){for(var t=[],e=null,n=null,o=0;o<gravitrdr.palettes.length;++o){var i=gravitrdr.palettes[o];this._addPaletteInfo(i);var a=i.getGroup();a||(a=i.getId()),e&&e===a||(n&&t.push(n),n=[],e=a),n.push(i)}n&&t.push(n);for(o=0;o<t.length;++o){this.groupPalettes(t[o]),this.setPaletteActive(t[o][0].getId(),!0);for(var r=0;r<t[o].length;++r){i=t[o][r];this.setPaletteEnabled(i.getId(),i.isEnabled())}}},e.prototype.relayout=function(){},e.prototype._addPaletteInfo=function(t){var e=$("<div></div>").attr("data-palette-id",t.getId()).addClass("palette-panel").addClass("palette-"+t.getId()).css("display","none"),n=$("<div></div>");t.init(e,n);var o={palette:t,panel:e,controls:n};return this._palettesInfo.push(o),t.addEventListener(GView.UpdateEvent,function(){this.setPaletteEnabled(t.getId(),t.isEnabled())}.bind(this)),o},e.prototype._getPaletteInfo=function(t){for(var e=0;e<this._palettesInfo.length;++e)if(this._palettesInfo[e].palette.getId()===t)return this._palettesInfo[e];return null},e.prototype._detachPaletteFromGroup=function(t){var e=this._getGroupInfoForPalette(t),n=this._getPaletteInfo(t);e&&n&&(e.container.find('.palette-group-tabs > button[data-palette-id="'+t+'"]').remove(),e.container.find('.palette-group-panels > div[data-palette-id="'+t+'"]').detach(),e.palettes.slice(e.palettes.indexOf(t)))},e.prototype._attachPaletteToGroup=function(t,e){var n=this._getPaletteInfo(e);if(n){var o=t.container.find(".palette-group-tabs"),i=t.container.find(".palette-group-panels");o.append($("<button></button>").attr("data-palette-id",n.palette.getId()).text(ifLocale.get(n.palette.getTitle())).on("click",function(){this.isPaletteActive(n.palette.getId())?this._setGroupExpanded(t,!t.expanded):this.setPaletteActive(n.palette.getId(),!0)}.bind(this))),i.append(n.panel),t.palettes.push(e)}},e.prototype._addGroupInfo=function(){var t={expanded:!0,visible:!0,activePalette:null,palettes:[]};return t.container=$("<div></div>").addClass("palette-group").append($("<div></div>").addClass("palette-group-header").append($("<div></div>").addClass("palette-group-collapse").append($("<button></button>").append($("<span></span>").addClass("fa fa-angle-double-down fa-fw")).on("click",function(){this._setGroupExpanded(t,!t.expanded)}.bind(this)))).append($("<div></div>").addClass("palette-group-tabs")).append($("<div></div>").addClass("palette-group-controls"))).append($("<div></div>").addClass("palette-group-panels")).appendTo(this._htmlElement),this._groupsInfo.push(t),t},e.prototype._getGroupInfoForPalette=function(t){for(var e=0;e<this._groupsInfo.length;++e)if(this._groupsInfo[e].palettes.indexOf(t)>=0)return this._groupsInfo[e];return null},e.prototype._setGroupExpanded=function(t,e){if(e!==t.expanded){t.expanded=e;var n=t.container.find(".palette-group-collapse > button > span");if(t.expanded)t.container.css("height",""),t.container.removeClass("collapsed-palette"),n.attr("class","fa  fa-angle-double-down fa-fw");else{var o=t.container.find(".palette-group-header");t.container.height(o.outerHeight()),t.container.addClass("collapsed-palette"),n.attr("class","fa  fa-angle-double-right fa-fw")}}},e.prototype._setGroupVisible=function(t,e){e!==t.visible&&(t.visible=e,t.visible?t.container.css("display",""):t.container.css("display","none"))},t.GPalettes=e}(this),function(t){function e(t){this._htmlElement=t}e.prototype._htmlElement=null,e.prototype._panels=null,e.prototype._activePanel=null,e.prototype.getActivePanel=function(){return this._activePanel},e.prototype.setActivePanel=function(t){if(t!==this._activePanel){for(var e=0;e<this._panels.length;++e){var n=this._panels[e],o=n.panel.getId();o===t?(n.container.css("display",""),n.tab.addClass("g-active"),n.panel.activate()):(n.container.css("display","none"),n.tab.removeClass("g-active"),o===this._activePanel&&n.panel.deactivate())}this._activePanel=t}},e.prototype.init=function(){this._panels=[];var t=$("<div></div>").addClass("panels-tabs").appendTo(this._htmlElement),e=$("<div></div>").addClass("panels-frame").appendTo(this._htmlElement);if(gravitrdr.panels)for(var n=0;n<gravitrdr.panels.length;++n){var o=gravitrdr.panels[n],i=$("<button></button>").addClass("panel-tab").attr("data-panel-id",o.getId()).text(ifLocale.get(o.getTitle())).on("click",function(t){this.setActivePanel($(t.target).attr("data-panel-id"))}.bind(this)).appendTo(t),a=$("<div></div>").addClass("panel-container panel-"+o.getId()).css("display","none").appendTo(e);o.init(a),this._panels.push({tab:i,container:a,panel:o}),this._activePanel||this.setActivePanel(o.getId())}},e.prototype.relayout=function(){},t.GPanels=e}(this),function(t){function e(t){this._htmlElement=t}e.prototype._htmlElement=null,e.prototype._sidebars=null,e.prototype._activeSidebar=null,e.prototype.getActiveSidebar=function(){return this._activeSidebar},e.prototype.setActiveSidebar=function(t){if(t!==this._activeSidebar){for(var e=0;e<this._sidebars.length;++e){var n=this._sidebars[e],o=n.sidebar.getId();o===t?(n.container.css("display",""),n.sidebar.activate()):(n.container.css("display","none"),o===this._activeSidebar&&n.sidebar.deactivate())}this._activeSidebar=t}},e.prototype.init=function(){if(this._sidebars=[],gravitrdr.sidebars)for(var t=0;t<gravitrdr.sidebars.length;++t){var e=gravitrdr.sidebars[t],n=$("<div></div>").addClass("sidebar-container sidebar-"+e.getId()).css("display","none").appendTo(this._htmlElement);e.init(n),this._sidebars.push({container:n,sidebar:e})}},e.prototype.relayout=function(){},t.GSidebars=e}(this),function(t){function e(t){this._htmlElement=t,t.append($("<div></div>").addClass("section sidebars")).append($("<div></div>").addClass("section toolpanel"))}e.prototype._htmlElement=null,e.prototype._groupedTools=null,e.prototype.init=function(){if(gravitrdr.sidebars&&gravitrdr.sidebars.length>0)for(var t=this._htmlElement.find(".sidebars"),e=0;e<gravitrdr.sidebars.length;++e){var n=gravitrdr.sidebars[e];$("<button></button>").append($(n.getIcon())).attr("title",ifLocale.get(n.getTitle())).attr("data-sidebar-id",n.getId()).on("click",function(){var e=$(this),n=e.hasClass("g-active");t.find("button").each(function(t,e){$(e).removeClass("g-active")}),n?(gApp.getSidebars().setActiveSidebar(null),gApp.setPartVisible(GApplication.Part.Sidebars,!1)):(gApp.getSidebars().setActiveSidebar(e.attr("data-sidebar-id")),gApp.setPartVisible(GApplication.Part.Sidebars,!0),e.addClass("g-active"))}).appendTo(t)}var o=this._htmlElement.find(".toolpanel");this._groupedTools=[];for(e=0;e<gravitrdr.tools.length;++e){for(var i=gravitrdr.tools[e],a=!1,r=0;r<this._groupedTools.length;++r)this._groupedTools[r].group===i.group&&(this._groupedTools[r].tools.push(i),a=!0);a||this._groupedTools.push({group:i.group,tools:[i]})}var s=null;for(e=0;e<this._groupedTools.length;++e){var p=this._groupedTools[e].group,l=this._groupedTools[e].tools,c=l[0],d=ifLocale.get(c.category);d!=s&&($("<div></div>").addClass("divider").text(d).appendTo(o),s=d,c.category===GApplication.TOOL_CATEGORY_VIEW&&$("<div></div>").addClass("zoom").append($("<button></button>").on("click",function(){gApp.executeAction(GZoomOutAction.ID)}).append($("<span></span>").addClass("fa fa-minus"))).append($("<input>").css("border","none").on("click",function(){$(this).select()}).on("change",function(){var t=ifUtil.parseNumber($(this).val());if(!isNaN(t)&&0!==t){var e=gApp.getWindows().getActiveWindow().getView(),n=e.getViewTransform().mapPoint(new IFPoint(e.getWidth()/2,e.getHeight()/2));e.zoomAtCenter(n,t)}})).append($("<button></button>").on("click",function(){gApp.executeAction(GZoomInAction.ID)}).append($("<span></span>").addClass("fa fa-plus"))).appendTo(o));$("<button></button>").attr("data-group",p).appendTo(o);l.length,this._updateGroupTool(c.instance)}gApp.getToolManager().addEventListener(IFToolManager.ToolChangedEvent,this._toolChanged,this),gApp.getWindows().addEventListener(GWindows.WindowEvent,this._windowEvent,this),this._updateZoomFromWindow()},e.prototype.relayout=function(){},e.prototype._toolChanged=function(t){t.previousTool&&this._updateGroupTool(t.previousTool),t.newTool&&this._updateGroupTool(t.newTool)},e.prototype._windowEvent=function(t){t.type===GWindows.WindowEvent.Type.Activated?t.window.getView().addEventListener(IFView.TransformEvent,this._updateZoomFromWindow,this):t.type===GWindows.WindowEvent.Type.Deactivated&&t.window&&t.window.getView().removeEventListener(IFView.TransformEvent,this._updateZoomFromWindow,this),this._updateZoomFromWindow()},e.prototype._updateZoomFromWindow=function(){var t=this._htmlElement.find(".toolpanel > .zoom"),e=gApp.getWindows().getActiveWindow();t.find("*").prop("disabled",!e),e&&t.find("input").val(ifUtil.formatNumber(e.getView().getZoom())+"x")},e.prototype._updateGroupTool=function(t){for(var e=this._getToolInfo(t),n=[],o=0;o<this._groupedTools.length;++o)this._groupedTools[o].group===e.group&&(n=this._groupedTools[o].tools.slice());var i=this._htmlElement.find('.toolpanel button[data-group="'+e.group+'"]');i.empty().toggleClass("g-active",t==gApp.getToolManager().getActiveTool()).attr("title",this._getToolTitle(e)).append($(e.icon).attr("width","18px").attr("height","18px")).off("mousedown").on("mousedown",function(e){if(gApp.getToolManager().activateTool(t),n.length>1){var o=setTimeout(function(){for(var t=$("<div></div>").gOverlay({releaseOnClose:!0}),e=function(e){$("<button></button>").addClass("toolbar-tool-button").append($("<span></span>").addClass("fa fa-check fa-fw").css("visibility",e.instance!==gApp.getToolManager().getActiveTool()?"hidden":"")).append($(e.icon).attr("width","18px").attr("height","18px")).append($("<span></span>").html("&nbsp;"+this._getToolTitle(e))).on("mouseenter",function(){$(this).addClass("g-hover")}).on("mouseleave",function(){$(this).removeClass("g-hover")}).on("mouseup",function(){gApp.getToolManager().activateTool(e.instance),t.gOverlay("close")}).on("click",function(){gApp.getToolManager().getActiveTool()!==e.instance&&(gApp.getToolManager().activateTool(e.instance),t.gOverlay("close"))}).appendTo(t)}.bind(this),o=0;o<n.length;++o)e(n[o]);t.gOverlay("open",i)}.bind(this),250);i.off("mouseup").on("mouseup",function(t){clearTimeout(o),o=null})}}.bind(this)),n.length>1&&i.append($("<span></span>").addClass("fa fa-caret-down"))},e.prototype._getToolTitle=function(t){var e=ifLocale.get(t.title);if(t.keys&&t.keys.length>0){for(var n=0;n<t.keys.length;++n)e+=0==n?" (":", ",e+=t.keys[n];e+=")"}return e},e.prototype._getToolInfo=function(t){for(var e=0;e<gravitrdr.tools.length;++e)if(gravitrdr.tools[e].instance===t)return gravitrdr.tools[e];return null},t.GToolbar=e}(this),function(t){function e(t){this._container=$("<div></div>"),this._document=t,this._view=new IFEditorView(this._document.getEditor()),this._view.setViewMargin([e.VIEW_MARGIN,e.VIEW_MARGIN,e.VIEW_MARGIN,e.VIEW_MARGIN]),this._container.append(this._view._htmlElement),this._container.on("mousedown",function(t){this._view.focus()}.bind(this));var n=this._createContextMenu();this._container.on("contextmenu",function(t){var e=gApp.getToolManager().getActiveTool();if(!e||!e.catchesContextMenu())return this._contextMenuClientPosition=new IFPoint(t.clientX,t.clientY),n.open({x:t.pageX,y:t.pageY}),!0}.bind(this))}IFObject.inherit(e,GEventTarget),e.VIEW_MARGIN=10,e.prototype._container=null,e.prototype._document=null,e.prototype._view=null,e.prototype._contextMenuClientPosition=null,e.prototype.getDocument=function(){return this._document},e.prototype.getView=function(){return this._view},e.prototype.getTitle=function(){var t=this._document.getTitle(),e=this._document._windows.indexOf(this);return e>0&&(t+=":"+e.toString()),t},e.prototype.activate=function(){},e.prototype.deactivate=function(){this._document.getEditor().closeInlineEditor()},e.prototype.release=function(){this._view.release()},e.prototype._createContextMenu=function(){var t=new GMenu,e=new GMenuItem(GMenuItem.Type.Menu);return e.setCaption("Select"),e.addEventListener(GMenuItem.UpdateEvent,function(){e.getMenu().clearItems(),e.setEnabled(!1);var t=this._document.getScene().hitTest(this._contextMenuClientPosition,this._view.getWorldTransform(),function(t){return!0}.bind(this),!0,-1,this._document.getScene().getProperty("pickDist"),!0);if(t&&t.length>0){e.setEnabled(!0);for(var n=0;n<t.length;++n){var o=this,i=t[n].element,a=i instanceof IFBlock?i.getLabel():i.getNodeNameTranslated();e.getMenu().createAddItem((n+1).toString()+". "+a,function(){this.element.removeFlag(IFNode.Flag.Highlighted),o._document.getEditor().updateSelection(ifPlatform.modifiers.shiftKey,[this.element])},function(){this.element.setFlag(IFNode.Flag.Highlighted)},function(){this.element.removeFlag(IFNode.Flag.Highlighted)}).element=i}}}.bind(this)),t.addItem(e),t},t.GWindow=e}(this),function(t){function e(t){this._htmlElement=t,this._windows=[]}IFObject.inherit(e,GEventTarget),e.WindowEvent=function(t,e){this.type=t,this.window=e},IFObject.inherit(e.WindowEvent,GEvent),e.WindowEvent.Type={Added:0,Removed:1,Deactivated:10,Activated:11},e.WindowEvent.prototype.type=null,e.WindowEvent.prototype.window=null,e.WindowEvent.prototype.toString=function(){return"[Object GWindows.WindowEvent]"},e.prototype._htmlElement=null,e.prototype._windows=null,e.prototype._activeWindow=null,e.prototype._viewOffset=null,e.prototype.getWindows=function(){return this._windows},e.prototype.getActiveWindow=function(){return this._activeWindow},e.prototype.activateWindow=function(t){if(t!=this._activeWindow){this._activeWindow&&(this._activeWindow.deactivate(),this._activeWindow.getDocument()._activeWindow=null,this._activeWindow._container.detach()),null===t?gApp.activateDocument(null,!0):(t&&this._activeWindow&&t.getDocument()!==this._activeWindow.getDocument()||!this._activeWindow)&&gApp.activateDocument(t.getDocument(),!0);var n=this._activeWindow;this._activeWindow=t,this._activeWindow&&this.hasEventListeners(e.WindowEvent)&&this.trigger(new e.WindowEvent(e.WindowEvent.Type.Deactivated,n)),t&&(this._activeWindow.activate(),t.getDocument()._activeWindow=t,this._htmlElement.append(t._container),this._relayoutWindow(t),t.getView().focus(),this.hasEventListeners(e.WindowEvent)&&this.trigger(new e.WindowEvent(e.WindowEvent.Type.Activated,t)))}},e.prototype.addWindow=function(t){var e=t instanceof GWindow?t.getDocument():t,n=this._addWindow(e);if(t instanceof GWindow){var o=t.getView();n.getView().transform(o.getScrollX(),o.getScrollY(),o.getZoom())}else n.getView().zoomActivePage();return n},e.prototype.closeWindow=function(t){var n=t.getDocument();if(t===this._activeWindow){var o=this._windows.indexOf(t);o>0?this.activateWindow(this._windows[o-1]):o+1<this._windows.length?this.activateWindow(this._windows[o+1]):this.activateWindow(null)}n._windows.splice(n._windows.indexOf(t),1),this._windows.splice(this._windows.indexOf(t),1),t._container.remove(),this.hasEventListeners(e.WindowEvent)&&this.trigger(new e.WindowEvent(e.WindowEvent.Type.Removed,t)),t.release(),0===n._windows.length&&gApp.closeDocument(n)},e.prototype.init=function(){},e.prototype.relayout=function(t){this._viewOffset=t||this._viewOffset,this._activeWindow&&this._relayoutWindow(this._activeWindow)},e.prototype._relayoutWindow=function(t){var e=this._htmlElement.width(),n=this._htmlElement.height();t._container.width(e),t._container.height(n),t.getView().setViewOffset(this._viewOffset);var o=t.getView().getWidth(),i=t.getView().getHeight();t.getView().resize(e,n),null==o||null==i||o==e&&i==n||t.getView().scrollBy((o-e)/2,(i-n)/2)},e.prototype._addWindow=function(t){var n=new GWindow(t);return t._windows.push(n),this._windows.push(n),this.hasEventListeners(e.WindowEvent)&&this.trigger(new e.WindowEvent(e.WindowEvent.Type.Added,n)),this.activateWindow(n),n},t.GWindows=e}(this),function(t){
/**
     * @author Markus NÃ¤sman
     * @copyright 2012 (c) Markus NÃ¤sman <markus at botten dot org >
     * @license Copyright (c) 2012, Markus NÃ¤sman
     * All rights reserved.
     * Redistribution and use in source and binary forms, with or without
     * modification, are permitted provided that the following conditions are met:
     *    * Redistributions of source code must retain the above copyright
     *      notice, this list of conditions and the following disclaimer.
     *    * Redistributions in binary form must reproduce the above copyright
     *      notice, this list of conditions and the following disclaimer in the
     *      documentation and/or other materials provided with the distribution.
     *    * Neither the name of the <organization> nor the
     *      names of its contributors may be used to endorse or promote products
     *      derived from this software without specific prior written permission.
     *
     * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
     * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
     * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
     * DISCLAIMED. IN NO EVENT SHALL MARKUS NÃSMAN BE LIABLE FOR ANY
     * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
     * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
     * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
     * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
     * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
     * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
     */
t.ciede2000=function(t,c){var d=t.L,u=t.a,g=t.b,h=c.L,f=c.a,y=c.b,v=e(n(u,2)+n(g,2)),m=e(n(f,2)+n(y,2)),_=(v+m)/2,I=.5*(1-e(n(_,7)/(n(_,7)+n(25,7)))),F=(1+I)*u,E=(1+I)*f,w=e(n(F,2)+n(g,2)),C=e(n(E,2)+n(y,2)),b=function(t,e){if(0==t&&0==e)return 0;var n=i(t,e)*(180/p);return n>=0?n:n+360},T=b(g,F),P=b(y,E),S=h-d,A=C-w,x=function(t,e,n,o){if(t*e==0)return 0;if(r(o-n)<=180)return o-n;if(o-n>180)return o-n-360;if(o-n<-180)return o-n+360;throw new Error}(v,m,T,P),G=2*e(w*C)*a(l(x)/2),L=(d+h)/2,M=(w+C)/2,$=function(t,e,n,o){if(t*e==0)return n+o;if(r(n-o)<=180)return(n+o)/2;if(r(n-o)>180&&n+o<360)return(n+o+360)/2;if(r(n-o)>180&&n+o>=360)return(n+o-360)/2;throw new Error}(v,m,T,P),D=1-.17*o(l($-30))+.24*o(l(2*$))+.32*o(l(3*$+6))-.2*o(l(4*$-63)),O=30*s(-n(($-275)/25,2)),k=e(n(M,7)/(n(M,7)+n(25,7))),N=1+.015*n(L-50,2)/e(20+n(L-50,2)),R=1+.045*M,B=1+.015*M*D,W=-2*k*a(l(2*O));return e(n(S/(1*N),2)+n(A/(1*R),2)+n(G/(1*B),2)+W*(A/(1*R))*(G/(1*B)))};var e=Math.sqrt,n=Math.pow,o=Math.cos,i=Math.atan2,a=Math.sin,r=Math.abs,s=Math.exp,p=Math.PI;function l(t){return t*(p/180)}}(this),function(t){t.image2Canvas=function(e,n){if("string"==typeof e&&"data:"!==e.substr(0,5)){var o=new Image;o.src=e,o.onload=function(){t.image2Canvas(o,n)}}else{var i=document.createElement("canvas");i.width=e.naturalWidth,i.height=e.naturalHeight,i.getContext("2d").drawImage(e,0,0),n(i)}},t.image2Base64=function(e,n){t.image2Canvas(e,function(t){n(t.toDataURL("image/png"))})},t.image2ArrayBuffer=function(e,n){t.image2Canvas(e,function(t){t.toBlob(function(t){var e=new FileReader;e.onload=function(t){n(t.target.result)},e.readAsArrayBuffer(t)})})}}(this),function(t){t.expr[":"].editable=function(e){var n=t(e);return n.is(":input")||"true"===n.attr("contenteditable")||e.isContentEditable}}(jQuery),function(t){function e(){}IFObject.inherit(e,GEventTarget),e.prototype.isDevelopment=function(){return!1},e.prototype.prepare=function(){},e.prototype.start=function(){gApp.createNewDocument()},e.prototype.addMenu=function(t,e,n){throw new Error("Not Supported.")},e.prototype.addMenuSeparator=function(t){throw new Error("Not Supported.")},e.prototype.addMenuItem=function(t,e,n,o,i){throw new Error("Not Supported.")},e.prototype.updateMenuItem=function(t,e,n,o){throw new Error("Not Supported.")},e.prototype.removeMenuItem=function(t,e){throw new Error("Not Supported.")},e.prototype.getClipboardMimeTypes=function(){throw new Error("Not Supported.")},e.prototype.getClipboardContent=function(t){throw new Error("Not Supported.")},e.prototype.setClipboardContent=function(t,e){throw new Error("Not Supported.")},t.GShell=e,t.gShell=null}(this),function(t){function e(){this._actions=[],this._toolManager=new IFToolManager,this._documents=[],this._windowMenuMap=[],document.addEventListener("touchstart",this._touchHandler,!0),document.addEventListener("touchmove",this._touchHandler,!0),document.addEventListener("touchend",this._touchHandler,!0),document.addEventListener("touchcancel",this._touchHandler,!0),document.addEventListener("keydown",function(t){var e=this._windows.getActiveWindow();!e||document.activeElement&&$(document.activeElement).is(":editable")||e.getView().focus()}.bind(this),!1),document.addEventListener("contextmenu",function(t){return $(t.target).is(":editable")?(t.stopPropagation(),!0):(t.preventDefault(),!1)},!0)}IFObject.inherit(e,GEventTarget),e.CATEGORY_FILE=new IFLocale.Key(e,"category.file"),e.CATEGORY_EDIT=new IFLocale.Key(e,"category.edit"),e.CATEGORY_MODIFY=new IFLocale.Key(e,"category.modify"),e.CATEGORY_MODIFY_ARRANGE=new IFLocale.Key(e,"category.modify.arrange"),e.CATEGORY_MODIFY_ALIGN=new IFLocale.Key(e,"category.modify.align"),e.CATEGORY_MODIFY_TRANSFORM=new IFLocale.Key(e,"category.modify.transform"),e.CATEGORY_MODIFY_PAGE=new IFLocale.Key(e,"category.modify.page"),e.CATEGORY_MODIFY_LAYER=new IFLocale.Key(e,"category.modify.layer"),e.CATEGORY_VIEW=new IFLocale.Key(e,"category.view"),e.CATEGORY_VIEW_MAGNIFICATION=new IFLocale.Key(e,"category.view.magnification"),e.CATEGORY_WINDOW=new IFLocale.Key(e,"category.window"),e.CATEGORY_HELP=new IFLocale.Key(e,"category.help"),e.TOOL_CATEGORY_SELECT=new IFLocale.Key(e,"tool-category.select"),e.TOOL_CATEGORY_IMAGE=new IFLocale.Key(e,"tool-category.image"),e.TOOL_CATEGORY_VECTOR=new IFLocale.Key(e,"tool-category.vector"),e.TOOL_CATEGORY_OTHER=new IFLocale.Key(e,"tool-category.other"),e.TOOL_CATEGORY_COLOR=new IFLocale.Key(e,"tool-category.color"),e.TOOL_CATEGORY_VIEW=new IFLocale.Key(e,"tool-category.view"),e.Part={Header:{id:"header"},Toolbar:{id:"toolbar"},Panels:{id:"panels"},Sidebars:{id:"sidebars"},Windows:{id:"windows"},Palettes:{id:"palettes"}},e.DocumentEvent=function(t,e){this.type=t,this.document=e},IFObject.inherit(e.DocumentEvent,GEvent),e.DocumentEvent.Type={Added:0,Removed:1,Deactivated:10,Activated:11,UrlUpdated:12},e.DocumentEvent.prototype.type=null,e.DocumentEvent.prototype.document=null,e.DocumentEvent.prototype.toString=function(){return"[Object GApplication.DocumentEvent]"},e.prototype._initialized=!1,e.prototype._toolManager=null,e.prototype._documentUntitledCount=0,e.prototype._documents=null,e.prototype._activeDocument=null,e.prototype._view=null,e.prototype._header=null,e.prototype._toolbar=null,e.prototype._panels=null,e.prototype._sidebars=null,e.prototype._windows=null,e.prototype._palettes=null,e.prototype._resizeTimerId=null,e.prototype._actions=null,e.prototype._windowMenu=null,e.prototype._windowMenuMap=null,e.prototype.getToolManager=function(){return this._toolManager},e.prototype.getDocuments=function(){return this._documents},e.prototype.getActiveDocument=function(){return this._activeDocument?this._activeDocument:null},e.prototype.getHeader=function(){return this._header},e.prototype.getToolbar=function(){return this._toolbar},e.prototype.getPanels=function(){return this._panels},e.prototype.getSidebars=function(){return this._sidebars},e.prototype.getWindows=function(){return this._windows},e.prototype.getPalettes=function(){return this._palettes},e.prototype.isPartVisible=function(t){return"none"!==this.getPart(t).css("display")},e.prototype.setPartVisible=function(t,e){e!=this.isPartVisible(t)&&(this.getPart(t).css("display",e?"block":"none"),this.relayout())},e.prototype.getPart=function(t){return this._view.find("#"+t.id)},e.prototype.getActions=function(){return this._actions},e.prototype.getAction=function(t){for(var e=0;e<this._actions.length;++e)if(this._actions[e].getId()===t)return this._actions[e];return null},e.prototype.getStorage=function(t){var e=new URI(t).protocol();if(e&&e.length)for(var n=0;n<gravitrdr.storages.length;++n)if(gravitrdr.storages[n].getProtocol()===e)return gravitrdr.storages[n];return null},e.prototype.getMatchingStorage=function(t,e,n,o,i){var a=[];i&&a.push(i);for(var r=0;r<gravitrdr.storages.length;++r){(s=gravitrdr.storages[r])!==i&&a.push(s)}for(r=0;r<a.length;++r){var s=a[r];if((!t||s.isPrompting())&&(!e||s.isSaving())){if(n&&""!==n){var p=s.getExtensions();if(p&&p.length&&p.indexOf(n)<0)continue}if(!o||s.isDirectory())return s}}return null},e.prototype.createNewDocument=function(){var t=new IFScene;t.setProperty("unit",IFLength.Unit.PX),this.addDocument(t).createNewPage(!0)},e.prototype.addDocument=function(t,e){var n=new GDocument(t,null,e||"Untitled-"+(++this._documentUntitledCount).toString());return this._addDocument(n),n},e.prototype.openDocument=function(t){for(var e=!1,n=0;n<this._documents.length;++n){var o=this._documents[n];o.getUrl()===t&&(this.activateDocument(o),e=!0)}if(!e){var i=this.getStorage(t);i&&i.load(t,!0,function(e,n){var o=function(e){var o=new IFScene,i=new GDocument(o,t,n);try{var a=JSON.parse(e);if(!o.restore(a))throw new Error("Failure.")}catch(t){i.close(),o=null,i=null,console.log(t),alert("An error has ocurred while trying to open the document.")}i&&this._addDocument(i)}.bind(this),i=new Uint8Array(e);if(31===i[0]&&139===i[1]&&8===i[2]){var a=pako.ungzip(i,{to:"string"});o(a)}else{var r=new FileReader;r.onload=function(t){o(t.target.result)},r.readAsText(new Blob([e]))}}.bind(this))}},e.prototype.openDocumentFrom=function(t){var e=gApp.getActiveDocument()?gApp.getActiveDocument().getUrl():null;t.openResourcePrompt(e&&""!==e?e:null,["gravitrdr"],function(t){gApp.openDocument(t)})},e.prototype.saveDocumentAs=function(t,n){(n=n||this.getActiveDocument())&&t.saveResourcePrompt(null,n.getTitle(),"gravitrdr",function(t){n.setUrl(t),n.save();for(var o=n.getWindows(),i=0;i<o.length;++i)this._updateWindowMenuItem(o[i]);this.hasEventListeners(e.DocumentEvent)&&this.trigger(new e.DocumentEvent(e.DocumentEvent.Type.UrlUpdated,this))}.bind(this))},e.prototype.activateDocument=function(t,n){t!=this._activeDocument&&(this._activeDocument&&(this._activeDocument&&(this._activeDocument.deactivate(),this.hasEventListeners(e.DocumentEvent)&&this.trigger(new e.DocumentEvent(e.DocumentEvent.Type.Deactivated,this._activeDocument))),this._activeDocument=null),t&&(n||this._windows.activateWindow(t.getActiveWindow()),t.activate(),this._activeDocument=t,this.hasEventListeners(e.DocumentEvent)&&this.trigger(new e.DocumentEvent(e.DocumentEvent.Type.Activated,t))))},e.prototype.closeDocument=function(t){if(t._windows.length)for(;t._windows.length>0;)this._windows.closeWindow(t._windows[0]);else t===this.getActiveDocument()&&this.activateDocument(null),t.release(),this._documents.splice(this._documents.indexOf(t),1),this.hasEventListeners(e.DocumentEvent)&&this.trigger(new e.DocumentEvent(e.DocumentEvent.Type.Removed,t))},e.prototype.canExecuteAction=function(t,e){var n=this.getAction(t);return!!n&&(n.isAvailable()&&n.isEnabled.apply(n,e))},e.prototype.executeAction=function(t,e){var n=this.getAction(t);if(!n)throw new Error("Unable to execute action '"+t+"' - not registered.");if(n.isAvailable()&&n.isEnabled.apply(n,e)){var o=n.execute.apply(n,e);return void 0===o||o}return!1},e.prototype.init=function(){for(var t=$("body"),n=0;n<gravitrdr.modules.length;++n){var o=gravitrdr.modules[n];console.log("Init module <"+o.toString()+">"),o.init()}this._view=$("<div></div>").attr("id","workspace").css("display","none").prependTo(t);var i=$("<div></div>").attr("id",e.Part.Windows.id).appendTo(this._view);this._windows=new GWindows(i);var a=$("<div></div>").attr("id",e.Part.Header.id).appendTo(this._view);this._header=new GHeader(a);var r=$("<div></div>").attr("id",e.Part.Toolbar.id).appendTo(this._view);this._toolbar=new GToolbar(r);var s=$("<div></div>").attr("id",e.Part.Panels.id).appendTo(this._view);this._panels=new GPanels(s);var p=$("<div></div>").attr("id",e.Part.Sidebars.id).appendTo(this._view);this._sidebars=new GSidebars(p);var l=$("<div></div>").attr("id",e.Part.Palettes.id).appendTo(this._view);switch(this._palettes=new GPalettes(l),ifSystem.hardware){case IFSystem.Hardware.Desktop:t.addClass("g-desktop");break;case IFSystem.Hardware.Tablet:t.addClass("g-touch"),t.addClass("g-tablet");break;case IFSystem.Hardware.Phone:t.addClass("g-touch"),t.addClass("g-phone")}if($(window).resize(function(){null!=this._resizeTimerId&&(clearTimeout(this._resizeTimerId),this._resizeTimerId=null),this._windows.relayout(),this._resizeTimerId=setTimeout(function(){this.relayout(),this._resizeTimerId=null}.bind(this),200)}.bind(this)),this._actions=gravitrdr.actions.slice(),this._createMainMenu(),gravitrdr.tools){var c=function(t){return function(){this._toolManager.activateTool(t)}.bind(this)}.bind(this);for(n=0;n<gravitrdr.tools.length;++n){var d=gravitrdr.tools[n];if(this._toolManager.addTool(d.instance),d.keys&&d.keys.length>0)for(var u=c(d.instance),g=0;g<d.keys.length;++g)this.registerShortcut([d.keys[g]],u)}}this._header.init(),this._toolbar.init(),this._panels.init(),this._sidebars.init(),this._windows.init(),this._palettes.init(),this.setPartVisible(e.Part.Sidebars,!1),this._view.css("display",""),this._initialized=!0,this._windows.addEventListener(GWindows.WindowEvent,this._windowEvent,this)},e.prototype.relayout=function(){this._initialized&&setTimeout(function(){var t=0,n=0,o=0,i=0,a=this.getPart(e.Part.Header);t+=this.isPartVisible(e.Part.Header)?a.outerHeight():0;var r=this.getPart(e.Part.Toolbar);r.css("top",t.toString()+"px"),r.height(this._view.height()-t),n+=this.isPartVisible(e.Part.Toolbar)?r.outerWidth():0;var s=this.getPart(e.Part.Sidebars);s.css("top",t.toString()+"px"),s.css("left",n.toString()+"px"),s.height(this._view.height()-t),n+=this.isPartVisible(e.Part.Sidebars)?s.outerWidth():0;var p=this.getPart(e.Part.Palettes);p.css("top",t.toString()+"px"),p.height(this._view.height()-t),o+=this.isPartVisible(e.Part.Palettes)?p.outerWidth():0;var l=this.getPart(e.Part.Panels);l.css("left",n.toString()+"px"),l.css("width",(this._view.width()-n-o).toString()+"px"),i+=this.isPartVisible(e.Part.Panels)?l.outerHeight():0,this._header.relayout(),this._toolbar.relayout(),this._panels.relayout(),this._sidebars.relayout(),this._windows.relayout([n,t,o,i]),this._palettes.relayout()}.bind(this),0)},e.prototype.registerShortcut=function(t,e){Mousetrap.bind(this._shortcutToMouseTrapShortcut(t),function(){return e(),!1}.bind(this))},e.prototype._addDocument=function(t){this.hasEventListeners(e.DocumentEvent)&&this.trigger(new e.DocumentEvent(e.DocumentEvent.Type.Added,t)),this._windows.addWindow(t)},e.prototype._createMainMenu=function(){for(var t=[],n={items:[]},o=function(e,n,o){if(e.items.length>0){var i=function(e){for(var n=0;n<t.length;++n)if(t[n].item===e)return t[n].group}(e.items[e.items.length-1]);i!==o&&e.items.push({type:"divider"})}t.push({item:n,group:o})},i=0;i<this._actions.length;++i){var a=this._actions[i];if(a.isAvailable()){var r=ifLocale.get(a.getCategory()),s=a.getGroup(),p=r?r.split("/"):null,l=s?[""].concat(s.split("/")):null;if(l&&p&&p.length!==l.length-1)throw new Error("Number of categories different thant number of groups.");var c=n;if(p)for(var d=0;d<p.length;++d){r=p[d],s=l?l[d]:null;for(var u=null,g=0;g<c.items.length;++g)r==c.items[g].caption&&(u=c.items[g]);u||(o(c,u={type:"menu",caption:r,items:[],windowMenu:e.CATEGORY_WINDOW===a.getCategory()&&c===n},s),c.items.push(u)),c=u}var h={type:"item",action:a};o(c,h,l?l[l.length-1]:null),c.items.push(h)}}var f=function(t,e){"menu"===t.type?t.menu=y(t,e):"divider"===t.type?t.separator=gShell.addMenuSeparator(e):"item"===t.type&&(t.item=gShell.addMenuItem(e,ifLocale.get(t.action.getTitle()),t.action.isCheckable(),t.action.getShortcut(),function(){this.executeAction(t.action.getId())}.bind(this)))}.bind(this),y=function(t,e){for(var n=gShell.addMenu(e,t.caption,function(){for(var e=0;e<t.items.length;++e){var n=t.items[e];"item"===n.type&&gShell.updateMenuItem(n.item,ifLocale.get(n.action.getTitle()),n.action.isEnabled(),!!n.action.isCheckable()&&n.action.isChecked())}}),o=0;o<t.items.length;++o)f(t.items[o],n);return n};for(i=0;i<n.items.length;++i){u=n.items[i];var v=y(n.items[i],null);u.windowMenu&&(this._windowMenu=v,gShell.addMenuSeparator(this._windowMenu))}},e.prototype._windowEvent=function(t){switch(t.type){case GWindows.WindowEvent.Type.Added:this._addWindowMenuItem(t.window);break;case GWindows.WindowEvent.Type.Removed:this._removeWindowMenuItem(t.window);break;case GWindows.WindowEvent.Type.Activated:this._updateWindowMenuItem(t.window),this._toolManager.setView(t.window.getView());break;case GWindows.WindowEvent.Type.Deactivated:this._updateWindowMenuItem(t.window),this._toolManager.setView(null)}},e.prototype._addWindowMenuItem=function(t){this._windowMenuMap.push({window:t,item:gShell.addMenuItem(this._windowMenu,t.getTitle(),!0,null,function(){this._windows.activateWindow(t)}.bind(this))}),this._updateWindowMenuItem(t)},e.prototype._removeWindowMenuItem=function(t){for(var e=0;e<this._windowMenuMap.length;++e){var n=this._windowMenuMap[e];if(n.window===t){gShell.removeMenuItem(this._windowMenu,n.item),this._windowMenuMap.splice(e,1);break}}this._updateTitle()},e.prototype._updateWindowMenuItem=function(t){for(var e=0;e<this._windowMenuMap.length;++e){var n=this._windowMenuMap[e];if(n.window===t){gShell.updateMenuItem(n.item,n.window.getTitle(),!0,n.window===this._windows.getActiveWindow());break}}this._updateTitle()},e.prototype._updateTitle=function(){var t="GravitRDR",e=this.getWindows().getActiveWindow();e&&(t+=" - "+e.getTitle()),document.title=t},e.prototype._touchHandler=function(t){if(!(t.touches.length>1)){var e=t.changedTouches[0];switch(t.type){case"touchstart":n("mousedown",e);break;case"touchmove":n("mousemove",e);break;case"touchend":n("mouseup",e),n("click",e);break;default:return}t.preventDefault(),t.stopPropagation()}function n(t,e){var n=document.createEvent("MouseEvent");n.initMouseEvent(t,!0,!0,window,1,e.screenX,e.screenY,e.clientX,e.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(n)}},e.prototype._shortcutToMouseTrapShortcut=function(t){for(var e="",n=0;n<t.length;++n){n>0&&(e+="+");var o=t[n];if("number"==typeof o)switch(o){case IFKey.Constant.META:e+="meta";break;case IFKey.Constant.OPTION:e+="option";break;case IFKey.Constant.REMOVE:e+="del";break;case IFKey.Constant.SPACE:e+="space";break;case IFKey.Constant.ENTER:e+="enter";break;case IFKey.Constant.TAB:e+="tab";break;case IFKey.Constant.BACKSPACE:e+="backspace";break;case IFKey.Constant.CONTROL:e+="ctrl";break;case IFKey.Constant.SHIFT:e+="shift";break;case IFKey.Constant.ALT:e+="alt";break;case IFKey.Constant.LEFT:e+="left";break;case IFKey.Constant.UP:e+="up";break;case IFKey.Constant.RIGHT:e+="right";break;case IFKey.Constant.DOWN:e+="down";break;case IFKey.Constant.PAGE_UP:e+="pageup";break;case IFKey.Constant.PAGE_DOWN:e+="pagedown";break;case IFKey.Constant.HOME:e+="home";break;case IFKey.Constant.END:e+="end";break;case IFKey.Constant.INSERT:e+="ins";break;case IFKey.Constant.DELETE:e+="del";break;case IFKey.Constant.COMMAND:e+="meta";break;case IFKey.Constant.F1:e+="f1";break;case IFKey.Constant.F2:e+="f2";break;case IFKey.Constant.F3:e+="f3";break;case IFKey.Constant.F4:e+="f4";break;case IFKey.Constant.F5:e+="f5";break;case IFKey.Constant.F6:e+="f6";break;case IFKey.Constant.F7:e+="f7";break;case IFKey.Constant.F8:e+="f8";break;case IFKey.Constant.F9:e+="f9";break;case IFKey.Constant.F10:e+="f10";break;case IFKey.Constant.F11:e+="f11";break;case IFKey.Constant.F12:e+="f12";break;default:throw new Error("Unknown key code")}else e+=o.toLowerCase()}return e},t.GApplication=e}(this),function(t){function e(t,e,n){this.setUrl(e),this._scene=t,this._editor=new IFEditor(t),this._windows=[],this._activeWindow=null,this._title=n,this._scene.addEventListener(IFScene.ResolveUrlEvent,this._resolveUrl,this)}IFObject.inherit(e,GEventTarget),e.prototype._scene=null,e.prototype._url=null,e.prototype._editor=null,e.prototype._windows=null,e.prototype._activeWindow=null,e.prototype._title=null,e.prototype.getScene=function(){return this._scene},e.prototype.getStorage=function(){return this._storage},e.prototype.getUrl=function(){return this._url},e.prototype.setUrl=function(t){t!==this._url&&(this._storage&&this._storage.releaseUrl(this._url),this._url=t,this._storage=t?gApp.getStorage(t):null)},e.prototype.getEditor=function(){return this._editor},e.prototype.getWindows=function(){return this._windows},e.prototype.getActiveWindow=function(){return this._activeWindow},e.prototype.getTitle=function(){return this._title},e.prototype.isSaveable=function(){return!!this._storage},e.prototype.save=function(){if(this._url){var t=IFNode.serialize(this._scene),e=pako.gzip(t,{level:9});this._storage.save(this._url,e.buffer,!0,function(t){this._title=t}.bind(this))}},e.prototype.createNewPage=function(t){var e=this._scene,n=this._scene.getPageInsertPosition(),o=new IFPage;o.setProperties(["name","x","y","w","h","cls"],["Page "+(e.queryCount("> page")+1).toString(),n.getX(),n.getY(),800,600,IFColor.WHITE]);var i=new IFLayer;i.setProperties(["name"],["Background"]),o.appendChild(i);var a=function(){e.appendChild(o),e.setActiveLayer(i)};return t?a():IFEditor.tryRunTransaction(e,a,"Add new Page"),o},e.prototype.activate=function(){},e.prototype.deactivate=function(){},e.prototype.release=function(){this._editor.release(),this._scene.removeEventListener(IFScene.ResolveUrlEvent,this._resolveUrl,this),this._storage&&this._storage.releaseUrl(this._url)},e.prototype._resolveUrl=function(t){var e=new URI(t.url);if(0===e.protocol().length&&(e=e.absoluteTo(this._url)),e.protocol().length>0){var n=gApp.getStorage(e.protocol()+":");n&&n.resolveUrl(e.toString(),t.resolved)}},t.GDocument=e}(this);var gravitrdr={modules:[],storages:[],exporters:[],actions:[],palettes:[],sidebars:[],panels:[],tools:[],colorMatchers:[],properties:[],styleEntries:[],transformers:[]},gLoaderCode='<div style="position: absolute; left: 0px; top: 0px; right: 0px; bottom: 0px; background: rgb(213, 223, 0);">\n    <style type="text/css">\n        .spinner {\n            width: 120px;\n            height: 120px;\n            position: absolute;\n            top: 50%;\n            left: 50%;\n            margin: -80px 0 0 -60px;\n            text-align: center;\n            -webkit-animation: rotate 2.0s infinite linear;\n            animation: rotate 2.0s infinite linear;\n        }\n\n        .spinner-dot1, .spinner-dot2 {\n            width: 60%;\n            height: 60%;\n            display: inline-block;\n            position: absolute;\n            top: 0;\n            background-color: rgb(229, 71, 97);\n            border-radius: 100%;\n            -webkit-animation: bounce 2.0s infinite ease-in-out;\n            animation: bounce 2.0s infinite ease-in-out;\n        }\n\n        .spinner-dot1 {\n            top: auto;\n            bottom: 0px;\n            -webkit-animation-delay: -1.0s;\n            animation-delay: -1.0s;\n        }\n\n        @-webkit-keyframes rotate { 100% { -webkit-transform: rotate(360deg) }}\n        @keyframes rotate { 100% { transform: rotate(360deg); -webkit-transform: rotate(360deg) }}\n\n        @-webkit-keyframes bounce {\n            0%, 100% { -webkit-transform: scale(0.0) }\n            50% { -webkit-transform: scale(1.0) }\n        }\n\n        @keyframes bounce {\n            0%, 100% {\n                transform: scale(0.0);\n                -webkit-transform: scale(0.0);\n            } 50% {\n                  transform: scale(1.0);\n                  -webkit-transform: scale(1.0);\n              }\n        }\n    </style>\n    <div class="spinner">\n        <div class="spinner-dot1"></div>\n        <div class="spinner-dot2"></div>\n    </div>\n</div>',gShell=null,gApp=null,__loader=null;function gShellReady(){gApp=new GApplication}function gShellFinished(){gApp.init(),gShell.prepare(),gApp.relayout(),setTimeout(function(){gShell.start(),__loader.remove()},2500)}$(document).ready(function(){if(!gShell)throw new Error("Shell needs to be initialized, first.");__loader=$(gLoaderCode).appendTo($("body")),ifFont.addType("Open Sans",IFFont.Style.Normal,IFFont.Weight.Light,"font/OpenSans-Light.ttf",IFFont.Category.Serif),ifFont.addType("Open Sans",IFFont.Style.Italic,IFFont.Weight.Light,"font/OpenSans-LightItalic.ttf"),ifFont.addType("Open Sans",IFFont.Style.Normal,IFFont.Weight.Regular,"font/OpenSans-Regular.ttf"),ifFont.addType("Open Sans",IFFont.Style.Italic,IFFont.Weight.Regular,"font/OpenSans-Italic.ttf"),ifFont.addType("Open Sans",IFFont.Style.Normal,IFFont.Weight.SemiBold,"font/OpenSans-Semibold.ttf"),ifFont.addType("Open Sans",IFFont.Style.Italic,IFFont.Weight.SemiBold,"font/OpenSans-SemiboldItalic.ttf"),ifFont.addType("Open Sans",IFFont.Style.Normal,IFFont.Weight.Bold,"font/OpenSans-Bold.ttf"),ifFont.addType("Open Sans",IFFont.Style.Italic,IFFont.Weight.Bold,"font/OpenSans-BoldItalic.ttf"),ifFont.addType("Open Sans",IFFont.Style.Normal,IFFont.Weight.ExtraBold,"font/OpenSans-ExtraBold.ttf"),ifFont.addType("Open Sans",IFFont.Style.Italic,IFFont.Weight.ExtraBold,"font/OpenSans-ExtraBoldItalic.ttf"),ifFont.addType("Source Sans Pro",IFFont.Style.Normal,IFFont.Weight.ExtraLight,"font/SourceSansPro-ExtraLight.ttf",IFFont.Category.Serif),ifFont.addType("Source Sans Pro",IFFont.Style.Italic,IFFont.Weight.ExtraLight,"font/SourceSansPro-ExtraLightIt.ttf"),ifFont.addType("Source Sans Pro",IFFont.Style.Normal,IFFont.Weight.Light,"font/SourceSansPro-Light.ttf"),ifFont.addType("Source Sans Pro",IFFont.Style.Italic,IFFont.Weight.Light,"font/SourceSansPro-LightIt.ttf"),ifFont.addType("Source Sans Pro",IFFont.Style.Normal,IFFont.Weight.Regular,"font/SourceSansPro-Regular.ttf"),ifFont.addType("Source Sans Pro",IFFont.Style.Italic,IFFont.Weight.Regular,"font/SourceSansPro-It.ttf"),ifFont.addType("Source Sans Pro",IFFont.Style.Normal,IFFont.Weight.SemiBold,"font/SourceSansPro-Semibold.ttf"),ifFont.addType("Source Sans Pro",IFFont.Style.Italic,IFFont.Weight.SemiBold,"font/SourceSansPro-SemiboldIt.ttf"),ifFont.addType("Source Sans Pro",IFFont.Style.Normal,IFFont.Weight.Bold,"font/SourceSansPro-Bold.ttf"),ifFont.addType("Source Sans Pro",IFFont.Style.Italic,IFFont.Weight.Bold,"font/SourceSansPro-BoldIt.ttf"),ifFont.addType("Source Sans Pro",IFFont.Style.Normal,IFFont.Weight.Heavy,"font/SourceSansPro-Black.ttf"),ifFont.addType("Source Sans Pro",IFFont.Style.Italic,IFFont.Weight.Heavy,"font/SourceSansPro-BlackIt.ttf"),ifFont.addType("Source Code Pro",IFFont.Style.Normal,IFFont.Weight.ExtraLight,"font/SourceCodePro-ExtraLight.ttf",IFFont.Category.Monospace),ifFont.addType("Source Code Pro",IFFont.Style.Normal,IFFont.Weight.Light,"font/SourceCodePro-Light.ttf"),ifFont.addType("Source Code Pro",IFFont.Style.Normal,IFFont.Weight.Regular,"font/SourceCodePro-Regular.ttf"),ifFont.addType("Source Code Pro",IFFont.Style.Normal,IFFont.Weight.Medium,"font/SourceCodePro-Medium.ttf"),ifFont.addType("Source Code Pro",IFFont.Style.Normal,IFFont.Weight.SemiBold,"font/SourceCodePro-Semibold.ttf"),ifFont.addType("Source Code Pro",IFFont.Style.Normal,IFFont.Weight.Bold,"font/SourceCodePro-Bold.ttf"),ifFont.addType("Source Code Pro",IFFont.Style.Normal,IFFont.Weight.Heavy,"font/SourceCodePro-Black.ttf"),ifFont.addType("FontAwesome",IFFont.Style.Normal,IFFont.Weight.Regular,gShell.isDevelopment()?"../node_modules/@fortawesome/fontawesome-free/webfonts/fa-solid-900.ttf":"font/fa-solid-900.ttf",IFFont.Category.Iconic)}),$(window).load(function(){rangy.init()}),ifLocale.setValues(GColorMatcher,IFLocale.Language.English,["category.harmony","category.palette"],["Harmony","Palette"]),ifLocale.setValues(GApplication,IFLocale.Language.English,["category.window","category.file","category.edit","category.modify","category.modify.arrange","category.modify.align","category.modify.transform","category.modify.page","category.modify.layer","category.arrange","category.arrange.transform","category.view","category.view.magnification","category.help","tool-category.select","tool-category.image","tool-category.vector","tool-category.other","tool-category.color","tool-category.view"],["Window","File","Edit","Modify","Modify/Arrange","Modify/Align","Modify/Transform","Modify/Page","Modify/Layer","Arrange","Arrange/Transform","View","View/Magnification","Help","Select","Image","Vector","Other","Color","View"]),function(t){function e(){}IFObject.inherit(e,GAction),e.ID="modify.add-layer",e.TITLE=new IFLocale.Key(e,"title"),e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.getCategory=function(){return GApplication.CATEGORY_MODIFY_LAYER},e.prototype.getGroup=function(){return"structure/modify"},e.prototype.isEnabled=function(){return!!gApp.getActiveDocument()},e.prototype.execute=function(){var t=gApp.getActiveDocument().getScene(),e=t.getActivePage();IFEditor.tryRunTransaction(e,function(){var n=new IFLayer;n.setProperty("name","Layer "+t.queryCount("layer").toString()),e.appendChild(n),t.setActiveLayer(n)},ifLocale.get(this.getTitle()))},e.prototype.toString=function(){return"[Object GAddLayerAction]"},t.GAddLayerAction=e}(this),function(t){function e(){}IFObject.inherit(e,GAction),e.ID="modify.delete-layer",e.TITLE=new IFLocale.Key(e,"title"),e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.getCategory=function(){return GApplication.CATEGORY_MODIFY_LAYER},e.prototype.getGroup=function(){return"structure/modify"},e.prototype.isEnabled=function(t){return t||(t=gApp.getActiveDocument()?gApp.getActiveDocument().getScene().getActiveLayer():null),!!t},e.prototype.execute=function(t){var e=(t=t||gApp.getActiveDocument().getScene().getActiveLayer()).getScene();if(!e)throw new Error("No scene on layer.");for(var n=null,o=t.getPrevious();null!==o;o=o.getPrevious())if(o instanceof IFLayer){n=o;break}if(!n)for(o=t.getNext();null!==o;o=o.getNext())if(o instanceof IFLayer){n=o;break}!n&&t.getParent()instanceof IFLayer&&(n=t.getParent()),n?(t.hasFlag(IFNode.Flag.Active)&&e.setActiveLayer(n),IFEditor.tryRunTransaction(e,function(){t.getParent().removeChild(t)},ifLocale.get(this.getTitle()))):alert("Unable to delete - the page needs to contain at least one layer.")},e.prototype.toString=function(){return"[Object GDeleteLayerAction]"},t.GDeleteLayerAction=e}(this),function(t){function e(){}IFObject.inherit(e,GAction),e.ID="modify.add-page",e.TITLE=new IFLocale.Key(e,"title"),e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.getCategory=function(){return GApplication.CATEGORY_MODIFY_PAGE},e.prototype.getGroup=function(){return"structure/modify"},e.prototype.isEnabled=function(){return!!gApp.getActiveDocument()},e.prototype.execute=function(){gApp.getActiveDocument().createNewPage()},e.prototype.toString=function(){return"[Object GAddPageAction]"},t.GAddPageAction=e}(this),function(t){function e(t){this._type=t,this._title=new IFLocale.Key(e,"title."+t)}IFObject.inherit(e,GAction),e.Type={AlignLeft:"align-left",AlignCenter:"align-center",AlignRight:"align-right",AlignTop:"align-top",AlignMiddle:"align-middle",AlignBottom:"align-bottom",AlignJustifyHorizontal:"align-justify-horizontal",AlignJustifyVertical:"align-justify-vertical"},e.ID="arrange.align",e.prototype._type=null,e.prototype._title=null,e.prototype.getId=function(){return e.ID+"."+this._type},e.prototype.getTitle=function(){return this._title},e.prototype.getCategory=function(){return GApplication.CATEGORY_MODIFY_ALIGN},e.prototype.getGroup=function(){var t="";switch(this._type){case e.Type.AlignLeft:case e.Type.AlignCenter:case e.Type.AlignRight:case e.Type.AlignJustifyHorizontal:t="horizontal";break;case e.Type.AlignTop:case e.Type.AlignMiddle:case e.Type.AlignBottom:case e.Type.AlignJustifyVertical:t="vertical"}return"arrange/align-"+t},e.prototype.getShortcut=function(){return null},e.prototype.isEnabled=function(t,e,n,o){return!!(t=t||(gApp.getActiveDocument()?gApp.getActiveDocument().getEditor().getSelection():null))&&(o?t.length>0:t.length>1)},e.prototype.execute=function(t,n,o,i){var a=gApp.getActiveDocument(),r=a.getScene();t||(t=a.getEditor().getSelection());for(var s=t,p=(t=[],null),l=0;l<s.length;++l){var c=s[l];if(c.hasMixin(IFElement.Transform)){if(!(d=o?c.getGeometryBBox():c.getPaintBBox())||d.isEmpty())continue;p=p?p.united(d):d,t.push({bbox:d,element:c})}}if(!i)for(l=0;l<t.length;++l){var d;(d=t[l].element.getPaintBBox())&&!d.isEmpty()&&(i=i?i.united(d):d)}i&&!i.isEmpty()&&IFEditor.tryRunTransaction(r,function(){for(var o=0;o<t.length;++o){var a=n?p:t[o].bbox,r=t[o].element;switch(this._type){case e.Type.AlignLeft:i.getX()!==a.getX()&&r.transform(new IFTransform(1,0,0,1,i.getX()-a.getX(),0));break;case e.Type.AlignCenter:(l=i.getX()+i.getWidth()/2)!==a.getX()+a.getWidth()/2&&r.transform(new IFTransform(1,0,0,1,l-a.getX()-a.getWidth()/2,0));break;case e.Type.AlignRight:var s=i.getX()+i.getWidth();s!==a.getX()+a.getWidth()&&r.transform(new IFTransform(1,0,0,1,s-a.getWidth()-a.getX(),0));break;case e.Type.AlignTop:i.getY()!==a.getY()&&r.transform(new IFTransform(1,0,0,1,0,i.getY()-a.getY()));break;case e.Type.AlignMiddle:var l;(l=i.getY()+i.getHeight()/2)!==a.getY()+a.getHeight()/2&&r.transform(new IFTransform(1,0,0,1,0,l-a.getY()-a.getHeight()/2));break;case e.Type.AlignBottom:var c=i.getY()+i.getHeight();c!==a.getY()+a.getHeight()&&r.transform(new IFTransform(1,0,0,1,0,c-a.getHeight()-a.getY()));break;case e.Type.AlignJustifyHorizontal:i.getX()===a.getX()&&a.getWidth()===i||r.transform(new IFTransform(1,0,0,1,0,0).translated(-a.getX(),-a.getY()).scaled(i.getWidth()/a.getWidth(),1).translated(a.getX(),a.getY()).translated(i.getX()-a.getX(),0));break;case e.Type.AlignJustifyVertical:i.getY()===a.getY()&&a.getHeight()===i||r.transform(new IFTransform(1,0,0,1,0,0).translated(-a.getX(),-a.getY()).scaled(1,i.getHeight()/a.getHeight()).translated(a.getX(),a.getY()).translated(0,i.getY()-a.getY()))}}}.bind(this),ifLocale.get(this.getTitle()))},e.prototype.toString=function(){return"[Object GAlignAction]"},t.GAlignAction=e}(this),function(t){function e(){}IFObject.inherit(e,GAction),e.ID="edit.clone",e.TITLE=new IFLocale.Key(e,"title"),e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.getCategory=function(){return GApplication.CATEGORY_EDIT},e.prototype.getGroup=function(){return"selection"},e.prototype.getShortcut=function(){return[IFKey.Constant.SHIFT,IFKey.Constant.META,"D"]},e.prototype.isEnabled=function(){var t=gApp.getActiveDocument();return t&&null!=t.getEditor().getSelection()},e.prototype.execute=function(){var t=gApp.getActiveDocument().getEditor();t.beginTransaction();try{t.cloneSelection()}finally{t.commitTransaction(ifLocale.get(this.getTitle()))}},e.prototype.toString=function(){return"[Object GCloneAction]"},t.GCloneAction=e}(this),function(t){function e(){}IFObject.inherit(e,GAction),e.ID="file.close",e.TITLE=new IFLocale.Key(e,"title"),e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.getCategory=function(){return GApplication.CATEGORY_FILE},e.prototype.getGroup=function(){return"close"},e.prototype.getShortcut=function(){return[IFKey.Constant.META,"Q"]},e.prototype.isEnabled=function(){return!!gApp.getWindows().getActiveWindow()},e.prototype.execute=function(){gApp.getWindows().closeWindow(gApp.getWindows().getActiveWindow())},e.prototype.toString=function(){return"[Object GCloseAction]"},t.GCloseAction=e}(this),function(t){function e(){}IFObject.inherit(e,GAction),e.ID="file.close-all",e.TITLE=new IFLocale.Key(e,"title"),e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.getCategory=function(){return GApplication.CATEGORY_FILE},e.prototype.getGroup=function(){return"close"},e.prototype.isEnabled=function(){return!!gApp.getActiveDocument()},e.prototype.execute=function(){for(;gApp.getActiveDocument();)gApp.closeDocument(gApp.getActiveDocument())},e.prototype.toString=function(){return"[Object GCloseAllAction]"},t.GCloseAllAction=e}(this),function(t){function e(){}IFObject.inherit(e,GAction),e.ID="edit.copy",e.TITLE=new IFLocale.Key(e,"title"),e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.getCategory=function(){return GApplication.CATEGORY_EDIT},e.prototype.getGroup=function(){return"ccp"},e.prototype.getShortcut=function(){return[IFKey.Constant.META,"C"]},e.prototype.isEnabled=function(){return!(!document.activeElement||!$(document.activeElement).is(":editable"))||!(!gApp.getActiveDocument()||!gApp.getActiveDocument().getEditor().getSelection())},e.prototype.execute=function(){if(document.activeElement&&$(document.activeElement).is(":editable"))document.execCommand("copy");else{var t=IFNode.order(gApp.getActiveDocument().getEditor().getSelectionCopy()),e=IFNode.serialize(t);gShell.setClipboardContent(IFNode.MIME_TYPE,e)}},e.prototype.toString=function(){return"[Object GCopyAction]"},t.GCopyAction=e}(this),function(t){function e(){}IFObject.inherit(e,GAction),e.ID="edit.copy-attributes",e.TITLE=new IFLocale.Key(e,"title"),e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.getCategory=function(){return GApplication.CATEGORY_EDIT},e.prototype.getGroup=function(){return"ccp_special"},e.prototype.getShortcut=function(){return[IFKey.Constant.SHIFT,IFKey.Constant.F4]},e.prototype.isEnabled=function(){return!1},e.prototype.execute=function(){for(var t=gApp.getActiveDocument().getEditor().getSelection(),e=0;e<t.length;++e)if(t[e].hasMixin(IFElement.Attributes)){var n=t[e].getAttributes();if(n&&n.hasMixin(IFNode.Container)&&n.getFirstChild()){var o=IFNode.serialize(n);gShell.setClipboardContent(IFAttribute.MIME_TYPE,o);break}}},e.prototype.toString=function(){return"[Object GCopyAttributesAction]"},t.GCopyAttributesAction=e}(this),function(t){function e(){}IFObject.inherit(e,GAction),e.ID="edit.cut",e.TITLE=new IFLocale.Key(e,"title"),e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.getCategory=function(){return GApplication.CATEGORY_EDIT},e.prototype.getGroup=function(){return"ccp"},e.prototype.getShortcut=function(){return[IFKey.Constant.META,"X"]},e.prototype.isEnabled=function(){return!(!document.activeElement||!$(document.activeElement).is(":editable"))||!(!gApp.getActiveDocument()||!gApp.getActiveDocument().getEditor().getSelection())},e.prototype.execute=function(){if(document.activeElement&&$(document.activeElement).is(":editable"))document.execCommand("cut");else{var t=gApp.getActiveDocument().getEditor();gApp.executeAction(GCopyAction.ID),t.beginTransaction();try{t.deleteSelection(!0)}finally{t.commitTransaction("Cut Selection")}}},e.prototype.toString=function(){return"[Object GCutAction]"},t.GCutAction=e}(this),function(t){function e(){}IFObject.inherit(e,GAction),e.ID="edit.delete",e.TITLE=new IFLocale.Key(e,"title"),e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.getCategory=function(){return GApplication.CATEGORY_EDIT},e.prototype.getGroup=function(){return"ccp"},e.prototype.getShortcut=function(){return[IFKey.Constant.REMOVE]},e.prototype.isEnabled=function(){var t=gApp.getActiveDocument();if(t){var e=t.getEditor().getSelection();if(e)for(var n=0;n<e.length;++n)if(e[n]instanceof IFItem)return!0}return!1},e.prototype.execute=function(){gApp.getActiveDocument().getEditor().deleteSelection()},e.prototype.toString=function(){return"[Object GDeleteAction]"},t.GDeleteAction=e}(this),function(t){function e(){}IFObject.inherit(e,GAction),e.ID="modify.delete-page",e.TITLE=new IFLocale.Key(e,"title"),e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.getCategory=function(){return GApplication.CATEGORY_MODIFY_PAGE},e.prototype.getGroup=function(){return"structure/modify"},e.prototype.isEnabled=function(t){return t||(t=gApp.getActiveDocument()?gApp.getActiveDocument().getScene().getActivePage():null),!!t},e.prototype.execute=function(t){var e=(t=t||gApp.getActiveDocument().getScene().getActivePage()).getScene();if(!e)throw new Error("No scene on page.");for(var n=null,o=t.getPrevious();null!==o;o=o.getPrevious())if(o instanceof IFPage){n=o;break}if(!n)for(o=t.getNext();null!==o;o=o.getNext())if(o instanceof IFPage){n=o;break}n?(t.hasFlag(IFNode.Flag.Active)&&e.setActivePage(n),IFEditor.tryRunTransaction(e,function(){t.getParent().removeChild(t)},ifLocale.get(this.getTitle()))):alert("Unable to delete - the document needs to contain at least one page.")},e.prototype.toString=function(){return"[Object GDeletePageAction]"},t.GDeletePageAction=e}(this),function(t){function e(t){this._type=t,this._title=new IFLocale.Key(e,"title."+t)}IFObject.inherit(e,GAction),e.Type={Horizontal:"horizontal",Vertical:"vertical"},e.ID="arrange.distribute",e.prototype._type=null,e.prototype._title=null,e.prototype.getId=function(){return e.ID+"."+this._type},e.prototype.getTitle=function(){return this._title},e.prototype.getCategory=function(){return GApplication.CATEGORY_MODIFY_ALIGN},e.prototype.getGroup=function(){return"arrange/align-distribute"},e.prototype.getShortcut=function(){return null},e.prototype.isEnabled=function(t,e,n,o){return!!(t=t||(gApp.getActiveDocument()?gApp.getActiveDocument().getEditor().getSelection():null))&&(n?t.length>1:t.length>2)},e.prototype.execute=function(t,n,o,i){var a=gApp.getActiveDocument(),r=a.getScene();t||(t=a.getEditor().getSelection());for(var s=t,p=(t=[],0);p<s.length;++p){var l=s[p];if(l.hasMixin(IFElement.Transform)){if(!(c=n?l.getGeometryBBox():l.getPaintBBox())||c.isEmpty())continue;t.push({bbox:c,element:l})}}if(!o)for(p=0;p<t.length;++p){var c;(c=t[p].element.getPaintBBox())&&!c.isEmpty()&&(o=o?o.united(c):c)}if(o&&!o.isEmpty())if(this._type===e.Type.Horizontal){if(t.sort(function(t,e){return t.bbox.getX()>e.bbox.getX()}),!i){var d=0;for(p=0;p<t.length;++p)d+=t[p].bbox.getWidth();i=(o.getWidth()-d)/(t.length-1)}IFEditor.tryRunTransaction(r,function(){for(var e=o.getX(),n=0;n<t.length;++n)e!==t[n].bbox.getX()&&t[n].element.transform(new IFTransform(1,0,0,1,e-t[n].bbox.getX(),0)),e+=t[n].bbox.getWidth()+i}.bind(this),ifLocale.get(this.getTitle()))}else if(this._type===e.Type.Vertical){if(t.sort(function(t,e){return t.bbox.getY()>e.bbox.getY()}),!i){for(d=0,p=0;p<t.length;++p)d+=t[p].bbox.getHeight();i=(o.getHeight()-d)/(t.length-1)}IFEditor.tryRunTransaction(r,function(){for(var e=o.getY(),n=0;n<t.length;++n)e!==t[n].bbox.getY()&&t[n].element.transform(new IFTransform(1,0,0,1,0,e-t[n].bbox.getY())),e+=t[n].bbox.getHeight()+i}.bind(this),ifLocale.get(this.getTitle()))}},e.prototype.toString=function(){return"[Object GDistributeAction]"},t.GDistributeAction=e}(this),function(t){function e(){}IFObject.inherit(e,GAction),e.ID="edit.duplicate",e.TITLE=new IFLocale.Key(e,"title"),e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.getCategory=function(){return GApplication.CATEGORY_EDIT},e.prototype.getGroup=function(){return"selection"},e.prototype.getShortcut=function(){return[IFKey.Constant.META,"D"]},e.prototype.isEnabled=function(){var t=gApp.getActiveDocument();return t&&null!=t.getEditor().getSelection()},e.prototype.execute=function(){var t=gApp.getActiveDocument().getEditor();t.beginTransaction();try{t.cloneSelection(!0,!0)}finally{t.commitTransaction(ifLocale.get(this.getTitle()))}},e.prototype.toString=function(){return"[Object GDuplicateAction]"},t.GDuplicateAction=e}(this),function(t){function e(){}IFObject.inherit(e,GAction),e.ID="view.zoom.fit.all",e.TITLE=new IFLocale.Key(e,"title"),e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.getCategory=function(){return GApplication.CATEGORY_VIEW},e.prototype.getGroup=function(){return"zoom"},e.prototype.getShortcut=function(){return[IFKey.Constant.META,"O"]},e.prototype.isEnabled=function(){var t=gApp.getActiveDocument(),e=t?t.getScene().getPaintBBox():null;return e&&!e.isEmpty()},e.prototype.execute=function(){var t=gApp.getActiveDocument();if(t.getScene().getProperty("singlePage")){var e=t.getScene().getActivePage();t.getActiveWindow().getView().zoomAll(e.getPaintBBox(),!1)}else t.getActiveWindow().getView().zoomAll(t.getScene().getPaintBBox(),!1)},e.prototype.toString=function(){return"[Object GFitAllAction]"},t.GFitAllAction=e}(this),function(t){function e(){}IFObject.inherit(e,GAction),e.ID="view.zoom.fit-current-layer",e.TITLE=new IFLocale.Key(e,"title"),e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.getCategory=function(){return GApplication.CATEGORY_VIEW},e.prototype.getGroup=function(){return"zoom"},e.prototype.isEnabled=function(){var t=gApp.getActiveDocument(),e=t?t.getScene().getActiveLayer():null;return e&&e.getPaintBBox()&&!e.getPaintBBox().isEmpty()},e.prototype.execute=function(){var t=gApp.getActiveDocument(),e=t.getScene().getActiveLayer();t.getActiveWindow().getView().zoomAll(e.getPaintBBox(),!1)},e.prototype.toString=function(){return"[Object GFitCurrentLayerAction]"},t.GFitCurrentLayerAction=e}(this),function(t){function e(){}IFObject.inherit(e,GAction),e.ID="view.zoom.fit-current-page",e.TITLE=new IFLocale.Key(e,"title"),e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.getCategory=function(){return GApplication.CATEGORY_VIEW},e.prototype.getGroup=function(){return"zoom"},e.prototype.getShortcut=function(){return[IFKey.Constant.META,IFKey.Constant.SHIFT,"W"]},e.prototype.isEnabled=function(){var t=gApp.getActiveDocument(),e=t?t.getScene().getActivePage():null;return e&&e.getPaintBBox()&&!e.getPaintBBox().isEmpty()},e.prototype.execute=function(){var t=gApp.getActiveDocument(),e=t.getScene().getActivePage();t.getActiveWindow().getView().zoomAll(e.getPaintBBox(),!1)},e.prototype.toString=function(){return"[Object GFitCurrentPageAction]"},t.GFitCurrentPageAction=e}(this),function(t){function e(){}IFObject.inherit(e,GAction),e.ID="view.zoom.fit-selection",e.TITLE=new IFLocale.Key(e,"title"),e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.getCategory=function(){return GApplication.CATEGORY_VIEW},e.prototype.getGroup=function(){return"zoom"},e.prototype.getShortcut=function(){return[IFKey.Constant.META,IFKey.Constant.OPTION,"O"]},e.prototype.isEnabled=function(){var t=gApp.getActiveDocument(),e=t?t.getEditor():null;return e&&e.hasSelection()},e.prototype.execute=function(){for(var t=gApp.getActiveDocument(),e=(t?t.getEditor():null).getSelection(),n=null,o=0;o<e.length;++o){var i=e[o].getPaintBBox();i&&!i.isEmpty()&&(n=n?n.united(i):i)}n&&!n.isEmpty()&&t.getActiveWindow().getView().zoomAll(n,!1)},e.prototype.toString=function(){return"[Object GFitSelectionAction]"},t.GFitSelectionAction=e}(this),function(t){function e(){}IFObject.inherit(e,GAction),e.ID="modify.group",e.TITLE=new IFLocale.Key(e,"title"),e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.getCategory=function(){return GApplication.CATEGORY_MODIFY},e.prototype.getGroup=function(){return"structure-group"},e.prototype.getShortcut=function(){return[IFKey.Constant.META,"G"]},e.prototype.isEnabled=function(){var t=gApp.getActiveDocument();if(t){var e=t.getEditor().getSelection();return e&&e.length>1}return!1},e.prototype.execute=function(){var t=gApp.getActiveDocument().getEditor(),e=t.getSelection();t.beginTransaction();try{for(var n=new IFShapeSet,o=[],i=0;i<e.length;++i){(a=e[i]).validateInsertion(n)&&o.push(a)}if(o.length>0){for(i=0;i<o.length;++i){var a;(a=o[i]).getParent().removeChild(a),n.appendChild(a)}t.insertElements([n],!0,!0)}}finally{t.commitTransaction("Group")}},e.prototype.toString=function(){return"[Object GGroupAction]"},t.GGroupAction=e}(this),function(t){function e(){}IFObject.inherit(e,GAction),e.ID="file.place-image",e.TITLE=new IFLocale.Key(e,"title"),e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.getCategory=function(){return GApplication.CATEGORY_FILE},e.prototype.getGroup=function(){return"insert"},e.prototype.isEnabled=function(){var t=gApp.getActiveDocument();return!(!t||!t.isSaveable())},e.prototype.execute=function(){var t=gApp.getActiveDocument();t.getStorage().openResourcePrompt(t.getUrl(),["jpg","jpeg","png","gif"],function(e){var n=new URI(e);alert("uri: "+n.toString()),alert("make_relative_to: "+t.getUrl()),e=n.relativeTo(t.getUrl()).toString();var o=n.filename(),i=n.suffix(),a=i.length>0?o.substr(0,o.length-i.length-1):o,r=t.getScene().getActivePage().getGeometryBBox().getSide(IFRect.Side.TOP_LEFT),s=new IFImage;s.setProperties(["name","url","transform"],[a,e,new IFTransform(1,0,0,1,r.getX(),r.getY())]),s.transform(),t.getEditor().insertElements([s])})},e.prototype.toString=function(){return"[Object GPlaceImageAction]"},t.GPlaceImageAction=e}(this),function(t){function e(){}IFObject.inherit(e,GAction),e.ID="edit.invert-selection",e.TITLE=new IFLocale.Key(e,"title"),e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.getCategory=function(){return GApplication.CATEGORY_EDIT},e.prototype.getGroup=function(){return"select"},e.prototype.getShortcut=function(){return[IFKey.Constant.SHIFT,IFKey.Constant.META,"A"]},e.prototype.isEnabled=function(){return!!gApp.getActiveDocument()},e.prototype.execute=function(){var t=gApp.getActiveDocument(),e=t.getScene(),n=null;n=e.getProperty("singlePage")?e.getActivePage():e;var o=[];n.accept(function(t){t instanceof IFItem&&t.getParent()instanceof IFLayer&&!t.hasFlag(IFNode.Flag.Selected)&&o.push(t)}),t.getEditor().updateSelection(!1,o)},e.prototype.toString=function(){return"[Object GInvertSelectionAction]"},t.GInvertSelectionAction=e}(this),function(t){function e(t){this._layerType=t}IFObject.inherit(e,GAction),e.ID="modify.layer-type",e.TITLE=new IFLocale.Key(e,"title"),e.prototype._layerType=null,e.prototype.getId=function(){return e.ID+"."+this._layerType},e.prototype.getTitle=function(){return ifLocale.get(e.TITLE).replace("%name%",ifLocale.get(IFLayer.TypeName[this._layerType]))},e.prototype.getCategory=function(){return GApplication.CATEGORY_MODIFY_LAYER},e.prototype.getGroup=function(){return"structure/type"},e.prototype.isCheckable=function(){return!0},e.prototype.isChecked=function(){var t=gApp.getActiveDocument()?gApp.getActiveDocument().getScene().getActiveLayer():null;return!!t&&t.getProperty("tp")===this._layerType},e.prototype.isEnabled=function(){return!!gApp.getActiveDocument()},e.prototype.execute=function(){var t=gApp.getActiveDocument()?gApp.getActiveDocument().getScene().getActiveLayer():null;t&&t.setProperty("tp",this._layerType)},e.prototype.toString=function(){return"[Object GLayerTypeAction]"},t.GLayerTypeAction=e}(this),function(t){function e(t,e){this._magnification=t,this._shortcut=e}IFObject.inherit(e,GAction),e.ID="view.magnification",e.prototype._magnification=null,e.prototype._shortcut=null,e.prototype.getId=function(){return e.ID+"."+this._magnification.toString()},e.prototype.getTitle=function(){return this._magnification.toString()+"%"},e.prototype.getCategory=function(){return GApplication.CATEGORY_VIEW_MAGNIFICATION},e.prototype.getGroup=function(){return"zoom/magnification-level"},e.prototype.getShortcut=function(){return this._shortcut},e.prototype.isEnabled=function(){return!!gApp.getWindows().getActiveWindow()},e.prototype.execute=function(){var t=gApp.getWindows().getActiveWindow().getView(),e=this._magnification/100,n=t.getScene(),o=null;if(n.getProperty("singlePage")){var i=n.getActivePage().getGeometryBBox();i&&!i.isEmpty()&&(o=i.getSide(IFRect.Side.CENTER))}o||(o=t.getViewTransform().mapPoint(new IFPoint(t.getWidth()/2,t.getHeight()/2))),t.zoomAt(o,e)},e.prototype.toString=function(){return"[Object GMagnificationAction]"},t.GMagnificationAction=e}(this),function(t){function e(){}IFObject.inherit(e,GAction),e.ID="file.new",e.TITLE=new IFLocale.Key(e,"title"),e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.getCategory=function(){return GApplication.CATEGORY_FILE},e.prototype.getGroup=function(){return"file"},e.prototype.getShortcut=function(){return[IFKey.Constant.META,"N"]},e.prototype.execute=function(){gApp.createNewDocument()},e.prototype.toString=function(){return"[Object GNewAction]"},t.GNewAction=e}(this),function(t){function e(){}IFObject.inherit(e,GAction),e.ID="view.clone",e.TITLE=new IFLocale.Key(e,"title"),e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.getCategory=function(){return GApplication.CATEGORY_WINDOW},e.prototype.getGroup=function(){return"view"},e.prototype.getShortcut=function(){return[IFKey.Constant.META,IFKey.Constant.OPTION,"N"]},e.prototype.isEnabled=function(){return!!gApp.getWindows().getActiveWindow()},e.prototype.execute=function(){gApp.getWindows().addWindow(gApp.getWindows().getActiveWindow())},e.prototype.toString=function(){return"[Object GNewWindowAction]"},t.GNewWindowAction=e}(this),function(t){function e(){}IFObject.inherit(e,GAction),e.ID="file.open",e.TITLE=new IFLocale.Key(e,"title"),e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.getCategory=function(){return GApplication.CATEGORY_FILE},e.prototype.getGroup=function(){return"file"},e.prototype.getShortcut=function(){return[IFKey.Constant.META,"O"]},e.prototype.isEnabled=function(){return!!this._getViableStorage()},e.prototype.execute=function(){gApp.openDocumentFrom(this._getViableStorage())},e.prototype._getViableStorage=function(){for(var t=0;t<gravitrdr.storages.length;++t){var e=gravitrdr.storages[t];if(e.isAvailable()&&e.isPrompting()){var n=e.getExtensions();if(!n||n.isEmpty()||n.indexOf("gravitrdr")>=0)return e}}return null},e.prototype.toString=function(){return"[Object GOpenAction]"},t.GOpenAction=e}(this),function(t){function e(t){this._type=t,this._title=new IFLocale.Key(e,"title."+t)}IFObject.inherit(e,GAction),e.Type={SendToFront:"send-front",BringForward:"bring-forward",SendBackward:"send-backward",SendToBack:"send-back"},e.ID="arrange.order",e.prototype._type=null,e.prototype._title=null,e.prototype.getId=function(){return e.ID+"."+this._type},e.prototype.getTitle=function(){return this._title},e.prototype.getCategory=function(){return GApplication.CATEGORY_MODIFY_ARRANGE},e.prototype.getGroup=function(){return"arrange/arrange"},e.prototype.getShortcut=function(){switch(this._type){case e.Type.SendToFront:return[IFKey.Constant.SHIFT,IFKey.Constant.META,IFKey.Constant.UP];case e.Type.BringForward:return[IFKey.Constant.META,IFKey.Constant.UP];case e.Type.SendBackward:return[IFKey.Constant.META,IFKey.Constant.DOWN];case e.Type.SendToBack:return[IFKey.Constant.SHIFT,IFKey.Constant.META,IFKey.Constant.DOWN]}return null},e.prototype.isEnabled=function(t){return(t=t||(gApp.getActiveDocument()?gApp.getActiveDocument().getEditor().getSelection():null))&&t.length>0},e.prototype.execute=function(t){var n=gApp.getActiveDocument(),o=n.getScene(),i=null;t||(i=n.getEditor().getSelection().slice(),t=i),t=IFNode.order(t,!0),IFEditor.tryRunTransaction(o,function(){for(var n=0;n<t.length;++n){var o=t[n],i=o.getParent();switch(this._type){case e.Type.SendToFront:null!==o.getNext()&&(i.removeChild(o),i.appendChild(o));break;case e.Type.BringForward:if(null!==o.getNext()){var a=o.getNext()?o.getNext().getNext():null;i.removeChild(o),i.insertChild(o,a)}break;case e.Type.SendBackward:if(null!==o.getPrevious()){a=o.getPrevious()?o.getPrevious():i.getFirstChild();i.removeChild(o),i.insertChild(o,a)}break;case e.Type.SendToBack:null!==o.getPrevious()&&(i.removeChild(o),i.insertChild(o,i.getFirstChild()))}}}.bind(this),ifLocale.get(this.getTitle())),i&&n.getEditor().updateSelection(!1,i)},e.prototype.toString=function(){return"[Object GArrangeAction]"},t.GArrangeAction=e}(this),function(t){function e(){}IFObject.inherit(e,GAction),e.ID="view.zoom.original",e.TITLE=new IFLocale.Key(e,"title"),e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.getCategory=function(){return GApplication.CATEGORY_VIEW},e.prototype.getGroup=function(){return"zoom"},e.prototype.getShortcut=function(){return[IFKey.Constant.META,"0"]},e.prototype.isEnabled=function(){return!!gApp.getActiveDocument()},e.prototype.execute=function(){var t=gApp.getActiveDocument(),e=t.getScene().getPaintBBox();t.getActiveWindow().getView().zoomAtCenter(e&&!e.isEmpty()?e.getSide(IFRect.Side.CENTER):new IFPoint(0,0),1)},e.prototype.toString=function(){return"[Object GOriginalViewAction]"},t.GOriginalViewAction=e}(this),function(t){function e(){}IFObject.inherit(e,GAction),e.ID="view.pixel-preview",e.TITLE=new IFLocale.Key(e,"title"),e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.getCategory=function(){return GApplication.CATEGORY_VIEW},e.prototype.getGroup=function(){return"render"},e.prototype.isCheckable=function(){return!0},e.prototype.isChecked=function(){var t=gApp.getWindows().getActiveWindow();return!!t&&t.getView().getViewConfiguration().pixelMode},e.prototype.isEnabled=function(){return!!gApp.getWindows().getActiveWindow()},e.prototype.execute=function(){var t=gApp.getWindows().getActiveWindow().getView();t.getViewConfiguration().pixelMode=!t.getViewConfiguration().pixelMode,t.invalidate()},e.prototype.toString=function(){return"[Object GPixelPreviewAction]"},t.GPixelPreviewAction=e}(this),function(t){function e(t){this._paintMode=t}IFObject.inherit(e,GAction),e.ID="view.page.decoration",e.TITLE=new IFLocale.Key(e,"title"),e.prototype._paintMode=null,e.prototype.getId=function(){return e.ID+"."+this._paintMode},e.prototype.getTitle=function(){return ifLocale.get(e.TITLE).replace("%name%",ifLocale.get(IFScenePaintConfiguration.PaintModeName[this._paintMode]))},e.prototype.getCategory=function(){return GApplication.CATEGORY_VIEW},e.prototype.getGroup=function(){return"paint-mode"},e.prototype.isCheckable=function(){return!0},e.prototype.isChecked=function(){var t=gApp.getWindows().getActiveWindow();return!!t&&t.getView().getViewConfiguration().paintMode===this._paintMode},e.prototype.isEnabled=function(){return!!gApp.getWindows().getActiveWindow()},e.prototype.execute=function(){var t=gApp.getWindows().getActiveWindow().getView();t.getViewConfiguration().paintMode=this._paintMode,t.invalidate()},e.prototype.toString=function(){return"[Object GPaintModeAction]"},t.GPaintModeAction=e}(this),function(t){function e(){}IFObject.inherit(e,GAction),e.ID="edit.paste",e.TITLE=new IFLocale.Key(e,"title"),e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.getCategory=function(){return GApplication.CATEGORY_EDIT},e.prototype.getGroup=function(){return"ccp"},e.prototype.getShortcut=function(){return[IFKey.Constant.META,"V"]},e.prototype.isEnabled=function(){if(document.activeElement&&$(document.activeElement).is(":editable"))return!0;var t=gShell.getClipboardMimeTypes();return!!(t&&t.indexOf(IFNode.MIME_TYPE)>=0)&&!!gApp.getActiveDocument()},e.prototype.execute=function(){if(document.activeElement&&$(document.activeElement).is(":editable"))document.execCommand("paste");else{var t=IFNode.deserialize(gShell.getClipboardContent(IFNode.MIME_TYPE));if(t&&t.length>0){for(var e=[],n=gApp.getActiveDocument().getEditor(),o=gApp.getActiveDocument().getScene().querySingle("page:active").getGeometryBBox().getSide(IFRect.Side.CENTER),i=0;i<t.length;++i)if(t[i]instanceof IFElement){var a=t[i],r=a.getGeometryBBox(),s=r?r.getSide(IFRect.Side.CENTER):new IFPoint(0,0);a.transform(new IFTransform(1,0,0,1,-s.getX()+o.getX(),-s.getY()+o.getY())),e.push(a)}if(e.length>0){n.beginTransaction();try{n.insertElements(e,!0,!0)}finally{n.commitTransaction("Paste")}}}}},e.prototype.toString=function(){return"[Object GPasteAction]"},t.GPasteAction=e}(this),function(t){function e(){}IFObject.inherit(e,GPasteAction),e.ID="edit.paste-in-place",e.TITLE=new IFLocale.Key(e,"title"),e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.execute=function(){if(document.activeElement&&$(document.activeElement).is(":editable"))document.execCommand("paste");else{var t=IFNode.deserialize(gShell.getClipboardContent(IFNode.MIME_TYPE));if(t&&t.length>0){for(var e=[],n=gApp.getActiveDocument().getScene().querySingle("page:active"),o=0;o<t.length;++o)if(t[o]instanceof IFElement){var i=t[o];i.transform(new IFTransform(1,0,0,1,n.getProperty("x"),n.getProperty("y"))),e.push(i)}if(e.length>0){var a=gApp.getActiveDocument().getEditor();a.beginTransaction();try{a.insertElements(e,!0,!0)}finally{a.commitTransaction("Paste")}}}}},e.prototype.toString=function(){return"[Object GPasteInPlaceAction]"},t.GPasteInPlaceAction=e}(this),function(t){function e(){}IFObject.inherit(e,GAction),e.ID="edit.paste-inside",e.TITLE=new IFLocale.Key(e,"title"),e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.getCategory=function(){return GApplication.CATEGORY_EDIT},e.prototype.getGroup=function(){return"ccp"},e.prototype.getShortcut=function(){return[IFKey.Constant.SHIFT,IFKey.Constant.META,"V"]},e.prototype.isEnabled=function(){var t=gShell.getClipboardMimeTypes();if(t&&t.indexOf(IFNode.MIME_TYPE)>=0){var e=gApp.getActiveDocument();if(e){var n=e.getEditor().getSelection();if(n)for(var o=0;o<n.length;++o)if(n[o].hasMixin(IFNode.Container))return!0}}return!1},e.prototype.execute=function(){var t=IFNode.deserialize(gShell.getClipboardContent(IFNode.MIME_TYPE));if(t&&t.length>0){for(var e=[],n=0;n<t.length;++n)t[n]instanceof IFElement&&e.push(t[n]);if(e.length>0){var o=gApp.getActiveDocument().getEditor(),i=o.getSelection(),a=[];o.beginTransaction();try{for(n=0;n<i.length;++n){var r=i[n];if(r.hasMixin(IFNode.Container)){for(var s=[],p=0;p<e.length;++p)e[p].validateInsertion(r)&&s.push(e[p].clone());var l=IFElement.prototype.getGroupGeometryBBox(s),c=l?l.getSide(IFRect.Side.CENTER):new IFPoint(0,0),d=r instanceof IFElement?r.getGeometryBBox():null,u=d?d.getSide(IFRect.Side.CENTER):new IFPoint(0,0);for(p=0;p<s.length;++p)s[p].transform(new IFTransform(1,0,0,1,-c.getX()+u.getX(),-c.getY()+u.getY())),r.appendChild(s[p]),a.push(s[p])}}o.updateSelection(!1,a)}finally{o.commitTransaction("Paste Inside")}}}},e.prototype.toString=function(){return"[Object GPasteInsideAction]"},t.GPasteInsideAction=e}(this),function(t){function e(){}IFObject.inherit(e,GAction),e.ID="edit.paste-attributes",e.TITLE=new IFLocale.Key(e,"title"),e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.getCategory=function(){return GApplication.CATEGORY_EDIT},e.prototype.getGroup=function(){return"ccp_special"},e.prototype.getShortcut=function(){return[IFKey.Constant.F4]},e.prototype.isEnabled=function(){return!1},e.prototype.execute=function(){var t=IFNode.deserialize(gShell.getClipboardContent(IFAttribute.MIME_TYPE));if(t){var e=gApp.getActiveDocument().getEditor(),n=e.getSelection();e.beginTransaction();try{for(var o=0;o<n.length;++o){var i=n[o];i.hasMixin(IFElement.Attributes)&&i.getAttributes().assignAttributesFrom(t)}}finally{e.commitTransaction("Paste Attributes")}}},e.prototype.toString=function(){return"[Object GPasteAttributesAction]"},t.GPasteAttributesAction=e}(this),function(t){function e(){}IFObject.inherit(e,GAction),e.ID="edit.redo",e.TITLE=new IFLocale.Key(e,"title"),e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){var t=ifLocale.get(e.TITLE),n=gApp.getActiveDocument();return n&&n.getEditor().hasRedoState()&&(t+=" "+n.getEditor().getRedoStateName()),t},e.prototype.getCategory=function(){return GApplication.CATEGORY_EDIT},e.prototype.getGroup=function(){return"undo_redo"},e.prototype.getShortcut=function(){return[IFKey.Constant.SHIFT,IFKey.Constant.META,"z"]},e.prototype.isEnabled=function(){return!(!document.activeElement||!$(document.activeElement).is(":editable"))||!(!gApp.getActiveDocument()||!gApp.getActiveDocument().getEditor().hasRedoState())},e.prototype.execute=function(){document.activeElement&&$(document.activeElement).is(":editable")?document.execCommand("redo"):gApp.getActiveDocument().getEditor().redoState()},e.prototype.toString=function(){return"[Object GRedoAction]"},t.GRedoAction=e}(this),function(t){function e(){}IFObject.inherit(e,GAction),e.ID="file.save",e.TITLE=new IFLocale.Key(e,"title"),e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.getCategory=function(){return GApplication.CATEGORY_FILE},e.prototype.getGroup=function(){return"file"},e.prototype.getShortcut=function(){return[IFKey.Constant.META,"S"]},e.prototype.isEnabled=function(){var t=gApp.getActiveDocument();return t&&t.isSaveable()},e.prototype.execute=function(){gApp.getActiveDocument().save()},e.prototype.toString=function(){return"[Object GSaveAction]"},t.GSaveAction=e}(this),function(t){function e(){}IFObject.inherit(e,GAction),e.ID="file.save-all",e.TITLE=new IFLocale.Key(e,"title"),e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.getCategory=function(){return GApplication.CATEGORY_FILE},e.prototype.getGroup=function(){return"file"},e.prototype.isEnabled=function(){for(var t=gApp.getDocuments(),e=0;e<t.length;++e)if(t[e].isSaveable())return!0;return!1},e.prototype.execute=function(){for(var t=gApp.getDocuments(),e=0;e<t.length;++e)t[e].isSaveable()&&t[e].save()},e.prototype.toString=function(){return"[Object GSaveAllAction]"},t.GSaveAllAction=e}(this),function(t){function e(){}IFObject.inherit(e,GAction),e.ID="file.save-as",e.TITLE=new IFLocale.Key(e,"title"),e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.getCategory=function(){return GApplication.CATEGORY_FILE},e.prototype.getGroup=function(){return"file"},e.prototype.getShortcut=function(){return[IFKey.Constant.SHIFT,IFKey.Constant.META,"S"]},e.prototype.isEnabled=function(){return!!this._getViableStorage()&&!!gApp.getActiveDocument()},e.prototype.execute=function(){gApp.saveDocumentAs(this._getViableStorage(),gApp.getActiveDocument())},e.prototype._getViableStorage=function(){for(var t=0;t<gravitrdr.storages.length;++t){var e=gravitrdr.storages[t];if(e.isAvailable()&&e.isPrompting()&&e.isSaving()){var n=e.getExtensions();if(!n||n.isEmpty()||n.indexOf("gravitrdr")>=0)return e}}return null},e.prototype.toString=function(){return"[Object GSaveAsAction]"},t.GSaveAsAction=e}(this),function(t){function e(){}IFObject.inherit(e,GAction),e.ID="view.show-rulers",e.TITLE=new IFLocale.Key(e,"title"),e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.getCategory=function(){return GApplication.CATEGORY_VIEW},e.prototype.getGroup=function(){return"show"},e.prototype.getShortcut=function(){return[IFKey.Constant.META,IFKey.Constant.OPTION,"R"]},e.prototype.isEnabled=function(){return!1},e.prototype.isCheckable=function(){return!0},e.prototype.isChecked=function(){return!1},e.prototype.execute=function(){return!1},e.prototype.toString=function(){return"[Object GShowRulersAction]"},t.GShowRulersAction=e}(this),function(t){function e(){}IFObject.inherit(e,GAction),e.ID="edit.select-all",e.TITLE=new IFLocale.Key(e,"title"),e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.getCategory=function(){return GApplication.CATEGORY_EDIT},e.prototype.getGroup=function(){return"select"},e.prototype.getShortcut=function(){return[IFKey.Constant.META,"A"]},e.prototype.isEnabled=function(){return!(!document.activeElement||!$(document.activeElement).is(":editable"))||!!gApp.getActiveDocument()},e.prototype.execute=function(){if(document.activeElement&&$(document.activeElement).is(":editable"))document.execCommand("selectAll");else{var t=gApp.getActiveDocument().getEditor(),e=gApp.getActiveDocument().getScene(),n=null;n=e.getProperty("singlePage")?e.getActivePage():e;var o=[];n.accept(function(t){t instanceof IFItem&&t.getParent()instanceof IFLayer&&o.push(t)}),t.updateSelection(!1,o)}},e.prototype.toString=function(){return"[Object GSelectAllAction]"},t.GSelectAllAction=e}(this),function(t){function e(){}IFObject.inherit(e,GAction),e.ID="view.show-all-pages",e.TITLE=new IFLocale.Key(e,"title"),e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.getCategory=function(){return GApplication.CATEGORY_VIEW},e.prototype.getGroup=function(){return"render"},e.prototype.isCheckable=function(){return!0},e.prototype.isChecked=function(){var t=gApp.getActiveDocument();return!!t&&!t.getScene().getProperty("singlePage")},e.prototype.isEnabled=function(){return!!gApp.getActiveDocument()},e.prototype.execute=function(){var t=gApp.getActiveDocument().getScene();t.setProperty("singlePage",!t.getProperty("singlePage"))},e.prototype.toString=function(){return"[Object GShowAllPagesAction]"},t.GShowAllPagesAction=e}(this),function(t){function e(){}IFObject.inherit(e,GAction),e.ID="view.show-grid",e.TITLE=new IFLocale.Key(e,"title"),e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.getCategory=function(){return GApplication.CATEGORY_VIEW},e.prototype.getGroup=function(){return"show"},e.prototype.getShortcut=function(){return[IFKey.Constant.META,IFKey.Constant.OPTION,"G"]},e.prototype.isEnabled=function(){return!!gApp.getWindows().getActiveWindow()},e.prototype.isCheckable=function(){return!0},e.prototype.isChecked=function(){var t=gApp.getWindows().getActiveWindow();return!!t&&!0===t.getView().getViewConfiguration().gridVisible},e.prototype.execute=function(){var t=gApp.getWindows().getActiveWindow().getView();t.getViewConfiguration().gridVisible=!t.getViewConfiguration().gridVisible,t.invalidate()},e.prototype.toString=function(){return"[Object GShowGridAction]"},t.GShowGridAction=e}(this),function(t){function e(){}IFObject.inherit(e,GAction),e.ID="modify.slice-from-selection",e.TITLE=new IFLocale.Key(e,"title"),e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.getCategory=function(){return GApplication.CATEGORY_MODIFY},e.prototype.getGroup=function(){return"structure-slice"},e.prototype.isEnabled=function(){var t=gApp.getActiveDocument();return!!t&&t.getEditor().hasSelection()},e.prototype.execute=function(){var t=gApp.getActiveDocument(),e=t.getScene(),n=t.getEditor(),o=t.getEditor().getSelectionBBox(!1);o&&!o.isEmpty()&&IFEditor.tryRunTransaction(e,function(){var t=new IFSlice;t.setProperty("trf",new IFTransform(o.getWidth()/2,0,0,o.getHeight()/2,o.getX()+o.getWidth()/2,o.getY()+o.getHeight()/2)),e.getActiveLayer().appendChild(t),n.updateSelection(!1,[t])},ifLocale.get(this.getTitle()))},e.prototype.toString=function(){return"[Object GSliceFromSelectionAction]"},t.GSliceFromSelectionAction=e}(this),function(t){function e(t){this._type=t,this._title=new IFLocale.Key(e,"title."+t)}IFObject.inherit(e,GAction),e.Type={FullUnit:"full",HalfUnit:"half"},e.ID="arrange.snap-unit",e.prototype._type=null,e.prototype._title=null,e.prototype.getId=function(){return e.ID+"."+this._type},e.prototype.getTitle=function(){return this._title},e.prototype.getCategory=function(){return GApplication.CATEGORY_MODIFY_ALIGN},e.prototype.getGroup=function(){return"arrange/snap-unit"},e.prototype.getShortcut=function(){return null},e.prototype.isEnabled=function(t){return(t=t||(gApp.getActiveDocument()?gApp.getActiveDocument().getEditor().getSelection():null))&&t.length>0},e.prototype.execute=function(t){var n=gApp.getActiveDocument(),o=n.getScene();t||(t=n.getEditor().getSelection()),IFEditor.tryRunTransaction(o,function(){for(var n=0;n<t.length;++n){var o=t[n];if(o.hasMixin(IFElement.Transform)){var i=o.getGeometryBBox();if(i&&!i.isEmpty()){var a=ifMath.round(i.getX(),!0),r=ifMath.round(i.getY(),!0),s=ifMath.round(i.getWidth(),!0),p=ifMath.round(i.getHeight(),!0);this._type===e.Type.HalfUnit&&(a+=.5,r+=.5,s+=.5,p+=.5);var l=(new IFTransform).translated(-i.getX(),-i.getY()).scaled(s/i.getWidth(),p/i.getHeight()).translated(i.getX(),i.getY()).translated(a-i.getX(),r-i.getY());o.transform(l)}}}}.bind(this),ifLocale.get(this.getTitle()))},e.prototype.toString=function(){return"[Object GSnapUnitAction]"},t.GSnapUnitAction=e}(this),function(t){function e(t){this._type=t,this._title=new IFLocale.Key(e,"title."+t)}IFObject.inherit(e,GAction),e.Type={Rotate45Left:"rotate-45-left",Rotate90Left:"rotate-90-left",Rotate180Left:"rotate-180-left",Rotate45Right:"rotate-45-right",Rotate90Right:"rotate-90-right",Rotate180Right:"rotate-180-right",FlipVertical:"flip-vertical",FlipHorizontal:"flip-horizontal"},e.ID="arrange.transform",e.prototype._type=null,e.prototype._title=null,e.prototype.getId=function(){return e.ID+"."+this._type},e.prototype.getTitle=function(){return this._title},e.prototype.getCategory=function(){return GApplication.CATEGORY_MODIFY_TRANSFORM},e.prototype.getGroup=function(){var t="";switch(this._type){case e.Type.Rotate45Left:case e.Type.Rotate90Left:case e.Type.Rotate180Left:t="rotate-left";break;case e.Type.Rotate45Right:case e.Type.Rotate90Right:case e.Type.Rotate180Right:t="rotate-right";break;case e.Type.FlipVertical:case e.Type.FlipHorizontal:t="flip"}return"arrange/transform-"+t},e.prototype.getShortcut=function(){return null},e.prototype.isEnabled=function(t){return(t=t||(gApp.getActiveDocument()?gApp.getActiveDocument().getEditor().getSelection():null))&&t.length>0},e.prototype.execute=function(t){var n=gApp.getActiveDocument(),o=n.getScene();t||(t=n.getEditor().getSelection()),IFEditor.tryRunTransaction(o,function(){for(var n=0;n<t.length;++n){var o=t[n],i=o.getGeometryBBox();if(o.hasMixin(IFElement.Transform)&&i&&!i.isEmpty()){var a=i.getSide(IFRect.Side.CENTER),r=0,s=1,p=1;switch(this._type){case e.Type.Rotate45Left:r=-45;break;case e.Type.Rotate90Left:r=-90;break;case e.Type.Rotate180Left:r=-180;break;case e.Type.Rotate45Right:r=45;break;case e.Type.Rotate90Right:r=90;break;case e.Type.Rotate180Right:r=180;break;case e.Type.FlipVertical:p=-1;break;case e.Type.FlipHorizontal:s=-1}var l=(new IFTransform).translated(-a.getX(),-a.getY()).scaled(s,p).rotated(ifMath.toRadians(r)).translated(a.getX(),a.getY());o.transform(l)}}}.bind(this),ifLocale.get(this.getTitle()))},e.prototype.toString=function(){return"[Object GTransformAction]"},t.GTransformAction=e}(this),function(t){function e(){}IFObject.inherit(e,GAction),e.ID="edit.undo",e.TITLE=new IFLocale.Key(e,"title"),e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){var t=ifLocale.get(e.TITLE),n=gApp.getActiveDocument();return n&&n.getEditor().hasUndoState()&&(t+=" "+n.getEditor().getUndoStateName()),t},e.prototype.getCategory=function(){return GApplication.CATEGORY_EDIT},e.prototype.getGroup=function(){return"undo_redo"},e.prototype.getShortcut=function(){return[IFKey.Constant.META,"z"]},e.prototype.isEnabled=function(){return!(!document.activeElement||!$(document.activeElement).is(":editable"))||!(!gApp.getActiveDocument()||!gApp.getActiveDocument().getEditor().hasUndoState())},e.prototype.execute=function(){document.activeElement&&$(document.activeElement).is(":editable")?document.execCommand("undo"):gApp.getActiveDocument().getEditor().undoState()},e.prototype.toString=function(){return"[Object GUndoAction]"},t.GUndoAction=e}(this),function(t){function e(){}IFObject.inherit(e,GAction),e.ID="modify.ungroup",e.TITLE=new IFLocale.Key(e,"title"),e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.getCategory=function(){return GApplication.CATEGORY_MODIFY},e.prototype.getGroup=function(){return"structure-group"},e.prototype.getShortcut=function(){return[IFKey.Constant.SHIFT,IFKey.Constant.META,"G"]},e.prototype.isEnabled=function(){var t=gApp.getActiveDocument();if(t){var e=t.getEditor().getSelection();if(e)for(var n=0;n<e.length;++n)if(e[n]instanceof IFShapeSet)return!0}return!1},e.prototype.execute=function(){var t=gApp.getActiveDocument().getEditor(),e=t.getSelection();t.beginTransaction();try{for(var n=[],o=0;o<e.length;++o){var i=e[o];if(i instanceof IFShapeSet){var a=i.getParent(),r=i.getNext(),s=i.getChildren();a.removeChild(i);for(var p=0;p<s.length;++p){var l=s[p];i.removeChild(l),a.insertChild(l,r),n.push(l)}}}n.length>0&&t.updateSelection(!1,n)}finally{t.commitTransaction("Ungroup")}},e.prototype.toString=function(){return"[Object GUngroupAction]"},t.GUngroupAction=e}(this),function(t){function e(){}IFObject.inherit(e,GAction),e.ID="view.zoom.in",e.TITLE=new IFLocale.Key(e,"title"),e.ZOOM_STEP=2,e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.getCategory=function(){return GApplication.CATEGORY_VIEW_MAGNIFICATION},e.prototype.getGroup=function(){return"zoom/magnification"},e.prototype.getShortcut=function(){return[IFKey.Constant.META,"+"]},e.prototype.isEnabled=function(){var t=gApp.getWindows().getActiveWindow(),e=t?t.getView():null;return e&&e.getZoom()<IFView.options.maxZoomFactor},e.prototype.execute=function(){var t=gApp.getWindows().getActiveWindow().getView(),n=t.getZoom()*e.ZOOM_STEP,o=t.getScene(),i=null;if(o.getProperty("singlePage")){var a=o.getActivePage().getGeometryBBox();a&&!a.isEmpty()&&(i=a.getSide(IFRect.Side.CENTER))}i||(i=t.getViewTransform().mapPoint(new IFPoint(t.getWidth()/2,t.getHeight()/2))),t.zoomAt(i,n)},e.prototype.toString=function(){return"[Object GZoomInAction]"},t.GZoomInAction=e}(this),function(t){function e(){}IFObject.inherit(e,GAction),e.ID="zoom.out",e.TITLE=new IFLocale.Key(e,"title"),e.ZOOM_STEP=2,e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.getCategory=function(){return GApplication.CATEGORY_VIEW_MAGNIFICATION},e.prototype.getGroup=function(){return"zoom/magnification"},e.prototype.getShortcut=function(){return[IFKey.Constant.META,"-"]},e.prototype.isEnabled=function(){var t=gApp.getWindows().getActiveWindow(),e=t?t.getView():null;return e&&e.getZoom()>IFView.options.minZoomFactor},e.prototype.execute=function(){var t=gApp.getWindows().getActiveWindow().getView(),n=t.getZoom()/e.ZOOM_STEP,o=t.getScene(),i=null;if(o.getProperty("singlePage")){var a=o.getActivePage().getGeometryBBox();a&&!a.isEmpty()&&(i=a.getSide(IFRect.Side.CENTER))}i||(i=t.getViewTransform().mapPoint(new IFPoint(t.getWidth()/2,t.getHeight()/2))),t.zoomAt(i,n)},e.prototype.toString=function(){return"[Object GZoomOutAction]"},t.GZoomOutAction=e}(this),function(t){function e(){}IFObject.inherit(e,GColorMatcher),e.TITLE=new IFLocale.Key(e,"title"),e.prototype.getTitle=function(){return e.TITLE},e.prototype.getCategory=function(){return GColorMatcher.CATEGORY_HARMONY},e.prototype.match=function(t){for(var e=[],n=t.asHSL(),o=n.slice(),i=3;i>=0;--i)o[0]=ifMath.normalizeAngleDegrees(o[0]+22.5),e[i]=new IFColor(IFColor.Type.HSL,o);for(i=0;i<4;++i)n[0]=ifMath.normalizeAngleDegrees(n[0]-22.5),e.push(new IFColor(IFColor.Type.HSL,n));return e},e.prototype.toString=function(){return"[Object GAnalogousMatcher]"},t.GAnalogousMatcher=e}(this),function(t){function e(){}IFObject.inherit(e,GColorMatcher),e.TITLE=new IFLocale.Key(e,"title"),e.prototype.getTitle=function(){return e.TITLE},e.prototype.getCategory=function(){return GColorMatcher.CATEGORY_HARMONY},e.prototype.match=function(t){var e=t.asHSL();return e[0]=ifMath.normalizeAngleDegrees(e[0]+180),[new IFColor(IFColor.Type.HSL,e)]},e.prototype.toString=function(){return"[Object GComplementaryMatcher]"},t.GComplementaryMatcher=e}(this),function(t){function e(){GExporter.call(this)}IFObject.inherit(e,GExporter),e.prototype.isStandalone=function(){return!1},e.prototype.getName=function(){return"Raster Image"},e.prototype.getExtensions=function(){return["png","jpg"]},e.prototype.exportPart=function(t,e,n,o,i){e=GExporter.parseSize(e);var a=t.toBitmap(e.width,e.height?e.height:e.width,2);a&&a.toImageBuffer(this._getImageTypeByExt(i),function(t){n.save(o,t,!0)})},e.prototype._getImageTypeByExt=function(t){if("png"===t)return IFBitmap.ImageType.PNG;if("jpg"===t)return IFBitmap.ImageType.JPEG;throw new Error("Unknown image extension - "+t)},t.GImageExporter=e}(this),function(t){function e(){GPalette.call(this),this._extensions=[]}IFObject.inherit(e,GPalette),e.ID="export",e.TITLE=new IFLocale.Key(e,"title"),e.prototype._htmlElement=null,e.prototype._controls=null,e.prototype._document=null,e.prototype._element=null,e.prototype._extensions=null,e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.getGroup=function(){return"export"},e.prototype.isEnabled=function(){return!!gApp.getActiveDocument()},e.prototype.init=function(t,e){GPalette.prototype.init.call(this,t,e);for(var n=0;n<gravitrdr.exporters.length;++n){var o=gravitrdr.exporters[n];if(!o.isStandalone())for(var i=o.getExtensions(),a=0;a<i.length;++a)this._extensions.push({extension:i[a].toLowerCase(),exporter:o})}this._htmlElement=t,this._controls=e,$("<button></button>").attr("data-action","add").attr("title","Add Export").on("click",function(){var t=this._element.getProperty("export",!0);(t=t?t.slice():[]).push({sz:"1x",sf:"",ex:gravitrdr.exporters[0].getExtensions()[0]}),this._element.setProperty("export",t,!0)}.bind(this)).append($("<span></span>").addClass("fa fa-plus")).appendTo(e)},e.prototype._documentEvent=function(t){if(t.type===GApplication.DocumentEvent.Type.Activated){this._document=t.document;var e=this._document.getScene(),n=this._document.getEditor();e.addEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),n.addEventListener(IFEditor.SelectionChangedEvent,this._updateFromSelection,this),this._updateFromSelection(),this.trigger(GPalette.UPDATE_EVENT)}else if(t.type===GApplication.DocumentEvent.Type.Deactivated){e=this._document.getScene(),n=this._document.getEditor();e.removeEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),n.removeEventListener(IFEditor.SelectionChangedEvent,this._updateFromSelection,this),this._document=null,this._elements=null,this._updateExports(),this.trigger(GPalette.UPDATE_EVENT)}},e.prototype._afterPropertiesChange=function(t){t.node===this._element&&(t.properties.indexOf("export")>=0||t.properties.indexOf("name")>=0)&&this._updateExports()},e.prototype._updateFromSelection=function(){this._element=null;var t=this._document?this._document.getEditor().getSelection():null;t&&1===t.length?this._element=t[0]:this._document&&(this._element=this._document.getScene().getActivePage()),this._updateExports()},e.prototype._updateExports=function(){if(this._htmlElement.empty(),this._element){var t=this._element.getProperty("name"),e="Export "+this._element.getNodeNameTranslated();t&&""!==t.trim()&&(e+=' "'+t+'"'),e+=" as:",$("<div></div>").addClass("title").text(e).appendTo(this._htmlElement);var n=$("<div></div>").addClass("export-table").appendTo(this._htmlElement),o=function(t,e){for(var o=$("<select></select>"),i=0;i<this._extensions.length;++i){var a=this._extensions[i];$("<option></option>").text(a.extension.toUpperCase()).val(a.extension).appendTo(o)}$("<div></div>").addClass("export-row").data("export-index",i).append($("<div></div>").addClass("export-cell").append($("<input>").css("width","8em").attr("placeholder","Size").val(t.sz).on("change",function(e){t.sz=$(e.target).val()})).append($("<input>").css("width","4em").attr("placeholder","Suffix").val(t.sf).on("change",function(e){t.sf=$(e.target).val()})).append(o.val(t.ex).on("change",function(e){t.ex=$(e.target).val()}))).append($("<div></div>").addClass("export-cell").append($("<button></button>").attr("title","Export this item only").on("click",function(){var e=gApp.getMatchingStorage(!0,!0,t.ex,!1,this._document.getStorage());e&&e.saveResourcePrompt(this._document.getUrl(),this._element.getLabel()+t.sf,[t.ex],function(n){this._getExporterByExt(t.ex).exportPart(this._element,t.sz,e,n,t.ex)}.bind(this))}.bind(this)).append($("<span></span>").addClass("fa fa-external-link-square"))).append($("<button></button>").append($("<span></span>").addClass("fa fa-trash-o")).on("click",function(){var t=this._element.getProperty("export",!0).slice();t.splice(e,1),this._element.setProperty("export",t,!0)}.bind(this)))).appendTo(n)}.bind(this),i=this._element.getProperty("export",!0);if(i&&i.length>0){for(var a=0;a<i.length;++a)o(i[a],a);$("<div></div>").addClass("controls").append($("<button></button>").on("click",function(){var t=gApp.getMatchingStorage(!0,!0,null,!0,this._document.getStorage());t&&t.openDirectoryPrompt(this._document.getUrl(),function(e){for(var n=this._element.getProperty("export",!0),o=0;o<n.length;++o){var i=n[o],a=new URI(e).filename(this._element.getLabel()+i.sf+"."+i.ex).toString();this._getExporterByExt(i.ex).exportPart(this._element,i.sz,t,a,i.ex)}}.bind(this))}.bind(this)).append($("<span></span>").text("Export All..."))).appendTo(this._htmlElement)}}this._controls.find('[data-action="add"]').prop("disabled",!this._element)},e.prototype._getExporterByExt=function(t){t=t.toLowerCase();for(var e=0;e<this._extensions.length;++e)if(this._extensions[e].extension===t)return this._extensions[e].exporter;return null},e.prototype.toString=function(){return"[Object GExportPalette]"},t.GExportPalette=e}(this),function(t){function e(){GPalette.call(this),this._styleEntries={}}IFObject.inherit(e,GPalette),e.ID="style",e.TITLE=new IFLocale.Key(e,"title"),e.prototype._styleEntries=null,e.prototype._htmlElement=null,e.prototype._document=null,e.prototype._styleDeleteControl=null,e.prototype._styleAddControl=null,e.prototype._styleSelector=null,e.prototype._styleSettings=null,e.prototype._paintsPanel=null,e.prototype._filtersPanel=null,e.prototype._effectsPanel=null,e.prototype._styleElements=null,e.prototype._styles=null,e.prototype._selectedStyleIndex=-1,e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.getGroup=function(){return"style"},e.prototype.isEnabled=function(){return!!gApp.getActiveDocument()},e.prototype.init=function(t,e){GPalette.prototype.init.call(this,t,e),this._htmlElement=t,this._styleAddControl=$("<button></button>").attr("title","Add new style").on("click",function(t){$("<div></div>").css({width:"250px"}).addClass("g-style-list").gStylePanel({nullStyle:$("<span></span>").addClass("fa fa-plus-circle").css({"font-size":"24px","line-height":"30px"}),nullName:"Add new style to element"}).gStylePanel("attach",this._document.getScene().getStyleCollection()).gOverlay({releaseOnClose:!0}).gOverlay("open",t.target).on("close",function(){$(this).gStylePanel("detach")}).on("stylechange",function(t,e){$(t.target).gOverlay("close");var n=-1,o=this._document.getEditor();o.beginTransaction();try{for(var i=0;i<this._styleElements.length;++i){var a=null;e?(a=new IFLinkedStyle).setProperty("ref",e.getReferenceId()):a=new IFInlineStyle,this._styleElements[i].getStyleSet().appendChild(a),n<0&&(n=this._getStyleIndex(a),this._setSelectedStyle(n))}}finally{o.commitTransaction("Add Style")}}.bind(this))}.bind(this)).append($("<span></span>").addClass("fa fa-plus")).appendTo(e),this._styleDeleteControl=$("<button></button>").attr("title","Remove hidden styles").on("click",function(){var t=this._document.getEditor();t.beginTransaction();try{for(var e=this._styles.slice(),n=0;n<e.length;++n)for(var o=e[n].slice(),i=0;i<o.length;++i)!1===o[i].getProperty("vs")&&o[i].getParent().removeChild(o[i])}finally{t.commitTransaction("Removed Hidden Styles")}}.bind(this)).append($("<span></span>").addClass("fa fa-trash-o")).appendTo(e);for(var n=[],o=[],i=0;i<gravitrdr.styleEntries.length;++i){var a=gravitrdr.styleEntries[i],r=a.getEntryClass();this._styleEntries[IFObject.getTypeId(r)]=a,IFFilterEntry.prototype.isPrototypeOf(a.getEntryClass().prototype)?n.push({entry:a,name:ifLocale.get(a.getEntryName())}):IFEffectEntry.prototype.isPrototypeOf(a.getEntryClass().prototype)?o.push({entry:a,name:ifLocale.get(a.getEntryName()),rootClass:IFEffectEntry}):IFVEffectEntry.prototype.isPrototypeOf(a.getEntryClass().prototype)&&o.push({entry:a,name:ifLocale.get(a.getEntryName()),rootClass:IFVEffectEntry})}n.sort(function(t,e){return t.name.localeCompare(e.name)}),o.sort(function(t,e){return t.rootClass===e.rootClass?t.name.localeCompare(e.name):t.rootClass===IFVEffectEntry?-1:1});var s=function(t,e,n){n.createAddItem("Add "+e,function(){this._modifyEachSelectedStyle(function(e){e.getActualStyle().appendChild(new t)})}.bind(this))}.bind(this);this._styleSelector=$("<div></div>").addClass("style-selector").gStylePanel({allowDrop:!0,previewWidth:40,previewHeight:40}).on("stylechange",function(t,e){this._setSelectedStyle(this._getStyleIndex(e))}.bind(this)).on("styledragaway",function(t,e){var n=this._getStyleIndex(e),o=this._styles[n],i=this._document.getEditor();i.beginTransaction();try{for(var a=0;a<o.length;++a)o[a].getParent().removeChild(o[a])}finally{i.commitTransaction("Remove Style")}}.bind(this)).on("stylemove",function(t,e,n){var o=this._getStyleIndex(e),i=this._getStyleIndex(n),a=this._styles[o].slice(),r=this._styles[i].slice();this._selectedStyleIndex=-1;var s=this._document.getEditor();s.beginTransaction();try{for(var p=0;p<a.length;++p){var l=a[p].getParent();l.removeChild(a[p]),l.insertChild(a[p],o<i?r[p].getNext():r[p])}}finally{s.commitTransaction("Move Style")}this._setSelectedStyle(this._getStyleIndex(e))}.bind(this)).appendTo(this._htmlElement),this._styleSettings=$("<div></div>").addClass("style-settings").append($("<div></div>").addClass("visibility").append($("<span></span>").addClass("fa").attr("title","Toggle Style Visibility").on("click",function(){var t=!1===this._styles[this._selectedStyleIndex][0].getProperty("vs");this._modifyEachSelectedStyle(function(e){e.setProperty("vs",t)})}.bind(this)))).append($("<div></div>").css("width","100%").append($("<select></select>").attr("data-property","blm").gBlendMode().on("change",function(t){var e=$(t.target).val();this._modifyEachSelectedStyle(function(t){t.setProperty("blm",e)})}.bind(this))).append($("<input>").attr("data-property","opc").css("width","3em").on("change",function(t){var e=IFLength.parseEquationValue($(t.target).val());null!==e?(e=e<0?0:e>100?100:e,e/=100,this._modifyEachSelectedStyle(function(t){t.setProperty("opc",e)})):this._updateStyleSettings()}.bind(this))).append($("<select></select>").attr("data-property","tp").append($("<option></option>").attr("value",IFAppliedStyle.Type.Content).text("Content")).append($("<option></option>").attr("value",IFAppliedStyle.Type.Knockout).text("Knockout")).on("change",function(t){var e=$(t.target).val();this._modifyEachSelectedStyle(function(t){t.setProperty("tp",e)})}.bind(this)))).append($("<div></div>").css("text-align","right").append($("<button></button>").attr("data-property","__link").on("click",function(){this._toggleStyleLink()}.bind(this)).append($("<span></span>").addClass("fa")))).appendTo(this._htmlElement),this._paintsPanel=$("<div></div>").addClass("style-entries-panel").append($("<div></div>").addClass("style-entries-panel-table")),$("<div></div>").gPanel({title:"Fills & Borders",content:this._paintsPanel,controls:[$("<button></button>").attr("title","Add Stroke").on("click",function(){this._modifyEachSelectedStyle(function(t){t.getActualStyle().appendChild(new IFStrokePaint)})}.bind(this)).append($("<span></span>").addClass("fa fa-pencil")),$("<button></button>").attr("title","Add Fill").on("click",function(){this._modifyEachSelectedStyle(function(t){t.getActualStyle().appendChild(new IFFillPaint)})}.bind(this)).append($("<span></span>").addClass("fa fa-stop")),$("<button></button>").attr("title","Remove hidden entries").on("click",function(){this._removeHiddenEntries([IFPaintEntry])}.bind(this)).append($("<span></span>").addClass("fa fa-trash-o"))]}).appendTo(this._htmlElement);var p=new GMenu;for(i=0;i<n.length;++i)s(n[i].entry.getEntryClass(),n[i].name,p);this._filtersPanel=$("<div></div>").addClass("style-entries-panel").append($("<div></div>").addClass("style-entries-panel-table")).appendTo(this._htmlElement),$("<div></div>").gPanel({title:"Filters",content:this._filtersPanel,controls:[$("<button></button>").gMenuButton({menu:p,arrow:!1}).append($("<span></span>").addClass("fa fa-plus")),$("<button></button>").attr("title","Remove hidden entries").on("click",function(){this._removeHiddenEntries([IFFilterEntry])}.bind(this)).append($("<span></span>").addClass("fa fa-trash-o"))]}).appendTo(this._htmlElement);var l=new GMenu,c=!1;for(i=0;i<o.length;++i){r=o[i].entry.getEntryClass();var d=o[i].rootClass;c||d!==IFEffectEntry||(l.createAddDivider(),c=!0),s(r,o[i].name,l)}this._effectsPanel=$("<div></div>").addClass("style-entries-panel").append($("<div></div>").addClass("style-entries-panel-table")).appendTo(this._htmlElement),$("<div></div>").gPanel({title:"Effects",content:this._effectsPanel,controls:[$("<button></button>").gMenuButton({menu:l,arrow:!1}).append($("<span></span>").addClass("fa fa-plus")),$("<button></button>").attr("title","Remove hidden entries").on("click",function(){this._removeHiddenEntries([IFEffectEntry,IFVEffectEntry])}.bind(this)).append($("<span></span>").addClass("fa fa-trash-o"))]}).appendTo(this._htmlElement)},e.prototype._documentEvent=function(t){if(t.type===GApplication.DocumentEvent.Type.Activated){this._document=t.document;var e=this._document.getScene(),n=this._document.getEditor();e.addEventListener(IFNode.AfterInsertEvent,this._afterInsert,this),e.addEventListener(IFNode.BeforeRemoveEvent,this._beforeRemove,this),e.addEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),e.addEventListener(IFStyle.StyleChangeEvent,this._styleChange,this),n.addEventListener(IFEditor.SelectionChangedEvent,this._updateFromSelection,this),this._updateFromSelection(),this.trigger(GPalette.UPDATE_EVENT)}else if(t.type===GApplication.DocumentEvent.Type.Deactivated){e=this._document.getScene();(n=this._document.getEditor()).removeEventListener(IFEditor.SelectionChangedEvent,this._updateFromSelection),e.removeEventListener(IFNode.AfterInsertEvent,this._afterInsert,this),e.removeEventListener(IFNode.BeforeRemoveEvent,this._beforeRemove,this),e.removeEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),e.removeEventListener(IFNode.StyleChangeEvent,this._styleChange,this),this._document=null,this._styleElements=null,this._styles=null,this._selectedStyleIndex=-1,this._updateSelectedStyle(),this.trigger(GPalette.UPDATE_EVENT)}},e.prototype._afterInsert=function(t){if(t.node instanceof IFStyleEntry){var e=t.node.getOwnerStyle();e&&this._isSelectedStyle(e)&&this._insertEntryRow(t.node)}else t.node instanceof IFStyle&&this._insertStyles(t.node)},e.prototype._beforeRemove=function(t){if(t.node instanceof IFStyleEntry){var e=t.node.getOwnerStyle();e&&this._isSelectedStyle(e)&&this._removeEntryRow(t.node)}else t.node instanceof IFStyle&&this._removeStyle(t.node)},e.prototype._afterPropertiesChange=function(t){if(t.node instanceof IFStyleEntry){var e=t.node.getOwnerStyle();e&&this._isSelectedStyle(e)&&this._updateEntryRow(t.node)}else t.node instanceof IFStyle&&this._isSelectedStyle(t.node)&&this._updateStyleSettings()},e.prototype._styleChange=function(t){var e=this._getStyleIndex(t.style,!1);if(e>=0&&e===this._selectedStyleIndex){var n=this._styles[e][0];this._styleSelector.gStylePanel("updateStyle",n)}},e.prototype._updateFromSelection=function(){this._styleElements=null,this._styles=null,this._selectedStyleIndex=-1;var t=this._document.getEditor().getSelection();if(t&&t.length>0)for(var e=0;e<t.length;++e){var n=t[e];n.hasMixin(IFElement.Style)&&(this._styleElements||(this._styleElements=[]),this._styleElements.push(n))}this._styleSelector.gStylePanel("clear"),this._styleElements&&this._insertStyles(),this._styles||this._setSelectedStyle(-1)},e.prototype._setSelectedStyle=function(t){this._styleSelector.gStylePanel("value",t>=0?this._styles[t][0]:null),this._selectedStyleIndex=t,this._updateSelectedStyle()},e.prototype._modifyEachSelectedStyle=function(t,e){if("number"==typeof e||this._selectedStyleIndex>=0){var n=this._document.getEditor();n.beginTransaction();try{this._visitEachSelectedStyle(t,e)}finally{n.commitTransaction("Modify Style(s)")}}},e.prototype._visitEachSelectedStyle=function(t,e){if("number"==typeof e||this._selectedStyleIndex>=0)for(var n=this._styles[this._selectedStyleIndex>=0?this._selectedStyleIndex:e].slice(),o=0;o<n.length;++o)t(n[o])},e.prototype._insertStyles=function(t){var e=function(t,e){this._styleSelector.gStylePanel("insertStyle",t,e)}.bind(this),n=function(t){var n=!1;if(i){for(var o=0;o<t.length;++o)if(t[o]===i){n=!0;break}}else n=!0;if(n&&this._styles&&this._styles.length>0)for(o=0;o<this._styles.length;++o)if(this._styles[o][0]===t[0]){n=!1;break}if(n){for(var i=t[0],a=-1,r=i.getNext();null!==r;r=r.getNext())if(r instanceof IFStyle){a=this._getStyleIndex(r);break}this._styles||(this._styles=[]),a>=0?this._styles.splice(a,0,t):this._styles.push(t),e(t[0],a)}}.bind(this);if(this._styleElements&&0!==this._styleElements.length){if(1===this._styleElements.length)for(var o=this._styleElements[0].getStyleSet().getFirstChild();null!==o;o=o.getNext())o instanceof IFStyle&&n([o]);else{for(var i=[],a=[],r=0;r<this._styleElements.length;++r){var s=!1;for(o=this._styleElements[r].getStyleSet().getFirstChild();null!==o;o=o.getNext())if(o instanceof IFLinkedStyle){for(var p=!1,l=0;l<i.length;++l)if(i[l][0].getProperty("ref")===o.getProperty("ref")){i[l].push(o),p=!0;break}p||i.push([o])}else o instanceof IFInlineStyle&&(s||a.push(o),s=!0)}a.length===this._styleElements.length&&n(a);for(r=0;r<i.length;++r)i[r].length===this._styleElements.length&&n(i[r])}this._selectedStyleIndex<0&&this._styles&&this._styles.length>0&&this._setSelectedStyle(0)}},e.prototype._removeStyle=function(t){if(this._styles){var e=this._getStyleIndex(t);e>=0&&(this._styleSelector.gStylePanel("removeStyle",this._styles[e][0]),this._styles.splice(e,1),e===this._selectedStyleIndex?this._setSelectedStyle(this._styles.length>0?0:-1):e<this._selectedStyleIndex&&(this._selectedStyleIndex-=1),0===this._styles.length&&(this._styles=null,this._styleSelector.css("display","none")))}},e.prototype._isSelectedStyle=function(t){return this._selectedStyleIndex>=0&&this._getStyleIndex(t,!0)===this._selectedStyleIndex},e.prototype._getStyleIndex=function(t,e){if(!this._styles||0===this._styles.length)return-1;for(var n=0;n<this._styles.length;++n)for(var o=0;o<this._styles[n].length;++o)if(t instanceof IFSharedStyle&&e){if(this._styles[n][o]instanceof IFLinkedStyle&&this._styles[n][o].getProperty("ref")===t.getReferenceId())return n}else if(this._styles[n][o]===t)return n;return-1},e.prototype._removeHiddenEntries=function(t){this._modifyEachSelectedStyle(function(e){for(var n=[],o=(e=e.getActualStyle()).getFirstChild();null!==o;o=o.getNext())if(o instanceof IFStyleEntry&&!1===o.getProperty("vs"))for(var i=0;i<t.length;++i)if(t[i].prototype.isPrototypeOf(o)){n.push(o);break}for(var a=0;a<n.length;++a)e.removeChild(n[a])})},e.prototype._toggleStyleLink=function(){var t=this._styles[this._selectedStyleIndex][0];if(t instanceof IFLinkedStyle){var e=this._document.getEditor(),n=this._document.getScene();e.beginTransaction();try{var o=t.getActualStyle(),i=this._selectedStyleIndex;this._visitEachSelectedStyle(function(t){var e=new IFInlineStyle;e.transferProperties(t,[IFAppliedStyle.GeometryProperties,IFAppliedStyle.VisualProperties]);for(var n=o.getFirstChild();null!==n;n=n.getNext())n instanceof IFStyleEntry&&e.appendChild(n.clone());t.getParent().insertChild(e,t),t.getParent().removeChild(t)}),this._setSelectedStyle(i)}finally{e.commitTransaction("Unlink Style")}}else{var a="Style-"+((n=this._document.getScene()).getStyleCollection().queryCount("> sharedStyle")+1).toString(),r=prompt("Enter a name for the new style:",a);if(null!==r){""===r.trim()&&(r=a),(e=this._document.getEditor()).beginTransaction();try{(o=new IFSharedStyle).setProperty("name",r);for(var s=t.getFirstChild();null!==s;s=s.getNext())s instanceof IFStyleEntry&&o.appendChild(s.clone());n.getStyleCollection().appendChild(o);i=this._selectedStyleIndex;this._visitEachSelectedStyle(function(t){var e=new IFLinkedStyle;e.transferProperties(t,[IFAppliedStyle.GeometryProperties,IFAppliedStyle.VisualProperties]),e.setProperty("ref",o.getReferenceId()),t.getParent().insertChild(e,t),t.getParent().removeChild(t)}),this._setSelectedStyle(i)}finally{e.commitTransaction("Link Style")}}}},e.prototype._updateSelectedStyle=function(){this._styleSelector.css("display",this._styles?"":"none"),this._updateStyleSettings(),this._updateEntries()},e.prototype._updateStyleSettings=function(){if(this._styleSettings.css("display","none"),this._styleDeleteControl.prop("disabled",!0),this._styleAddControl.prop("disabled",null===this._styleElements||0===this._styleElements.length),this._selectedStyleIndex>=0){this._styleSettings.css("display","");var t=this._styles[this._selectedStyleIndex][0];this._styleSettings.find(".visibility > span").toggleClass("fa-eye",1==t.getProperty("vs")).toggleClass("fa-eye-slash",0==t.getProperty("vs")),this._styleSettings.find('[data-property="__link"]').attr("title",t instanceof IFLinkedStyle?"Unlink style":"Link style").find("> span").toggleClass("fa-link",!(t instanceof IFLinkedStyle)).toggleClass("fa-unlink",t instanceof IFLinkedStyle),this._styleDeleteControl.prop("disabled",!1),this._styleSettings.find('[data-property="blm"]').val(t.getProperty("blm")),this._styleSettings.find('[data-property="opc"]').val(ifUtil.formatNumber(100*t.getProperty("opc"))),this._styleSettings.find('[data-property="tp"]').val(t.getProperty("tp"))}},e.prototype._updateEntries=function(){if(this._paintsPanel.closest(".g-panel").css("display","none"),this._paintsPanel.find(".style-entries-panel-table").empty(),this._filtersPanel.closest(".g-panel").css("display","none"),this._filtersPanel.find(".style-entries-panel-table").empty(),this._effectsPanel.closest(".g-panel").css("display","none"),this._effectsPanel.find(".style-entries-panel-table").empty(),this._selectedStyleIndex>=0){this._paintsPanel.closest(".g-panel").css("display",""),this._filtersPanel.closest(".g-panel").css("display",""),this._effectsPanel.closest(".g-panel").css("display","");for(var t=this._styles[this._selectedStyleIndex][0].getActualStyle().getFirstChild();null!==t;t=t.getNext())t instanceof IFStyleEntry&&this._insertEntryRow(t)}};var n=null,o=!1;e.prototype._insertEntryRow=function(t){var e=this._styleEntries[IFObject.getTypeId(t)];if(e){var i=this._getPanelFromEntry(t).find(".style-entries-panel-table"),a=function(){this._assignEntryRow(t)}.bind(this),r=function(){this._updateEntryRow(t)}.bind(this),s=e.createContent(this._document.getScene(),a,r),p=function(t,e){return t&&e&&t!==e&&t.parentNode===e.parentNode},l=$("<div></div>").data("entry",t).attr("draggable","true").on("dragstart",function(t){var e=$(this),i=t.originalEvent;i.stopPropagation(),i.dataTransfer.effectAllowed="move",i.dataTransfer.setData("text/plain",""),this.className="drag",n=this,o=!1,e.closest(".style-entries-panel-table").find("> div").each(function(t,e){$(e).append($("<div></div>").addClass("drag-overlay").on("dragenter",function(t){p(n,this.parentNode)&&$(this).parent().addClass("drop")}).on("dragleave",function(t){p(n,this.parentNode)&&$(this).parent().removeClass("drop")}).on("dragover",function(t){var e=t.originalEvent;e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="move"}).on("drop",function(t){$(this);var e=$(this.parentNode);o=!0,e.removeClass("drop"),e.closest(".style-entries-panel-table").find(".drag-overlay").remove(),p(n,this.parentNode)}))})}).on("dragend",function(e){var i=$(this);e.originalEvent.stopPropagation(),i.closest(".style-entries-panel-table").find(".drag-overlay").remove(),o||t.getParent().removeChild(t),this.className="",n=null,o=!1}).append($("<div></div>").addClass("visibility").append($("<span></span>").attr("title","Toggle visibility").on("click",function(){t.setProperty("vs",!t.getProperty("vs"))}))).append($("<div></div>").addClass("contents").append(s)).appendTo(i);this._updateEntryRow(t,l)}},e.prototype._removeEntryRow=function(t,e){(e=e||this._getRowForEntry(t))&&e.remove()},e.prototype._updateEntryRow=function(t,e){var n=this._styleEntries[IFObject.getTypeId(t)];n&&(e=e||this._getRowForEntry(t))&&(e.find(".visibility span").attr("class","fa fa-eye"+(t.getProperty("vs")?"":"-slash")),n.updateProperties(e.find(".contents > :first-child"),e.data("entry"),this._document.getScene()))},e.prototype._assignEntryRow=function(t,e){var n=this._styleEntries[IFObject.getTypeId(t)];if(n&&(e=e||this._getRowForEntry(t))){var o=this._document.getEditor();o.beginTransaction();try{n.assignProperties(e.find(".contents > :first-child"),t,this._document.getScene())}finally{o.commitTransaction("Modify "+n.getEntryName()+" Style")}}},e.prototype._getRowForEntry=function(t){var e=this._getPanelFromEntry(t).find(".style-entries-panel-table"),n=null;return e.find("> div").each(function(e,o){var i=$(o);if(i.data("entry")===t)return n=i,!1}),n},e.prototype._getPanelFromEntry=function(t){return t instanceof IFPaintEntry?this._paintsPanel:t instanceof IFFilterEntry?this._filtersPanel:t instanceof IFEffectEntry||t instanceof IFVEffectEntry?this._effectsPanel:void 0},e.prototype.toString=function(){return"[Object GStylePalette]"},t.GStylePalette=e}(this),function(t){function e(){GPanel.call(this),this._propertyPanels=[]}IFObject.inherit(e,GPanel),e.ID="properties",e.TITLE=new IFLocale.Key(e,"title"),e.prototype._htmlElement=null,e.prototype._propertyPanels=null,e.prototype._document=null,e.prototype._elements=null,e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.init=function(t,e){GPanel.prototype.init.call(this,t,e),this._htmlElement=t;for(var n=$("<div></div>").addClass("properties-panels").appendTo(this._htmlElement),o=function(t){var e=$("<div></div>").css("display","none").addClass("properties-panel-content");t.init(e),e.appendTo(n),this._propertyPanels.push({panel:e,properties:t})}.bind(this),i=0;i<gravitrdr.properties.length;++i)o(gravitrdr.properties[i])},e.prototype._documentEvent=function(t){if(t.type===GApplication.DocumentEvent.Type.Activated){this._document=t.document;var e=this._document.getScene();this._document.getEditor().addEventListener(IFEditor.SelectionChangedEvent,this._updateFromSelection,this),e.addEventListener(IFNode.AfterFlagChangeEvent,this._afterFlagChange,this),this._updateFromSelection(),this.trigger(GPanel.UPDATE_EVENT)}else if(t.type===GApplication.DocumentEvent.Type.Deactivated){e=this._document.getScene();this._document.getEditor().removeEventListener(IFEditor.SelectionChangedEvent,this._updateFromSelection,this),e.removeEventListener(IFNode.AfterFlagChangeEvent,this._afterFlagChange,this),this._document=null,this._elements=null,this._updatePropertyPanels(),this.trigger(GPanel.UPDATE_EVENT)}},e.prototype._updateFromSelection=function(){if(this._elements=this._document.getEditor().getSelection(),!this._elements||0===this._elements.length){var t=this._document.getScene().getActivePage();t&&(this._elements=[t])}this._updatePropertyPanels()},e.prototype._afterFlagChange=function(t){t.flag===IFNode.Flag.Active&&this._elements&&1===this._elements.length&&this._elements[0]instanceof IFScene&&this._updatePropertyPanels()},e.prototype._updatePropertyPanels=function(){for(var t=0;t<this._propertyPanels.length;++t){var e=this._propertyPanels[t];!(!this._elements||0===this._elements.length)&&e.properties.update(this._document,this._elements)?e.panel.css("display",""):e.panel.css("display","none")}},e.prototype.toString=function(){return"[Object GPropertiesPanel]"},t.GPropertiesPanel=e}(this),function(t){function e(){GPanel.call(this),this._transformPanels=[]}IFObject.inherit(e,GPanel),e.ID="transform",e.TITLE=new IFLocale.Key(e,"title"),e.prototype._htmlElement=null,e.prototype._transformPanels=null,e.prototype._document=null,e.prototype._elements=null,e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.init=function(t,e){GPanel.prototype.init.call(this,t,e),this._htmlElement=t;for(var n=$("<div></div>").addClass("transform-panels").appendTo(this._htmlElement),o=function(t){var e=$("<div></div>").css("display","none").addClass("transform-panel-content");t.init(e),e.appendTo(n),this._transformPanels.push({panel:e,transformer:t})}.bind(this),i=0;i<gravitrdr.transformers.length;++i)o(gravitrdr.transformers[i])},e.prototype._documentEvent=function(t){if(t.type===GApplication.DocumentEvent.Type.Activated)this._document=t.document,this._document.getEditor().addEventListener(IFEditor.SelectionChangedEvent,this._updateFromSelection,this),this._updateFromSelection(),this.trigger(GPalette.UPDATE_EVENT);else if(t.type===GApplication.DocumentEvent.Type.Deactivated){this._document.getEditor().removeEventListener(IFEditor.SelectionChangedEvent,this._updateFromSelection,this),this._document=null,this._elements=null,this._updateTransformPanels(),this.trigger(GPalette.UPDATE_EVENT)}},e.prototype._updateFromSelection=function(){this._elements=null;var t=this._document.getEditor().getSelection();if(t)for(var e=0;e<t.length;++e)t[e].hasMixin(IFElement.Transform)&&(this._elements||(this._elements=[]),this._elements.push(t[e]));this._updateTransformPanels()},e.prototype._updateTransformPanels=function(){for(var t=0;t<this._transformPanels.length;++t){var e=this._transformPanels[t];!(!this._elements||0===this._elements.length)&&e.transformer.update(this._document,this._elements)?e.panel.css("display",""):e.panel.css("display","none")}},e.prototype.toString=function(){return"[Object GTransformPanel]"},t.GTransformPanel=e}(this),function(t){function e(){}IFObject.inherit(e,GProperties),e.prototype._panel=null,e.prototype._document=null,e.prototype.getCategory=function(){return"Document"},e.prototype.init=function(t,e){this._panel=t,$("<button></button>").attr("title","More Settings").on("click",function(t){var e=$(t.target).closest("button");e.toggleClass("g-active",!e.hasClass("g-active")),this._showMore(e.hasClass("g-active"))}.bind(this)).append($("<span></span>").addClass("fa fa-cog")).appendTo(e);var n=function(t){var e=this;if("unit"===t)return $("<select></select>").attr("data-property",t).gUnit().on("change",function(){e._assignProperty(t,$(this).val())});if("unitSnap"===t)return $("<select></select>").attr("data-property",t).append($("<option></option>").attr("value",IFScene.UnitSnap.None).text("None")).append($("<option></option>").attr("value",IFScene.UnitSnap.Full).text("Full")).append($("<option></option>").attr("value",IFScene.UnitSnap.Half).text("Half")).on("change",function(){e._assignProperty(t,$(this).val())});if("gridSizeX"===t||"gridSizeY"===t)return $("<input>").attr("type","text").attr("data-property",t).css("width","3em").on("change",function(){var n=e._document.getScene().stringToPoint($(this).val());null!==n&&"number"==typeof n&&n>=1?e._assignProperty(t,n<0?0:n):e._updateProperties()});if("gridActive"===t)return $("<div></div>").css("width","4em").addClass("g-switch").append($("<label></label>").append($("<input>").attr("type","checkbox").attr("data-property",t).on("change",function(){e._assignProperty(t,$(this).is(":checked"))})).append($("<span></span>").addClass("switch").attr({"data-on":"On","data-off":"Off"})));if("crDistSmall"===t||"crDistBig"===t)return $("<input>").attr("type","text").attr("data-property",t).css("width","3em").on("change",function(){var n=e._document.getScene().stringToPoint($(this).val());null!==n&&"number"==typeof n&&n>=1?e._assignProperty(t,n<0?0:n):e._updateProperties()});if("crConstraint"===t)return $("<input>").attr("type","text").attr("data-property",t).css("width","3em").on("change",function(){var n=IFLength.parseEquationValue($(this).val());null!==n?(n=ifMath.normalizeAngleRadians(ifMath.toRadians(n)),e._assignProperty(t,n)):e._updateProperties()});if("snapDist"===t||"pickDist"===t)return $("<input>").attr("type","text").attr("data-property",t).css("width","3em").on("change",function(){var n=parseInt($(this).val());isNaN(n)?e._updateProperties():e._assignProperty(t,n)});if("clspace"===t)return $("<select></select>").attr("data-property",t).append($("<option></option>").attr("value",IFColorSpace.RGB).text("RGB")).append($("<option></option>").attr("value",IFColorSpace.CMYK).text("CMYK")).on("change",function(){e._assignProperty(t,$(this).val())});if("pathImage"===t||"pathFont"===t||"pathExport"===t)return $("<input>").attr("type","text").attr("data-property",t).css("width","100%").on("change",function(){e._assignProperty(t,$(this).val())});throw new Error("Unknown input property: "+t)}.bind(this);$("<table></table>").addClass("g-form").css("margin","0px auto").append($("<tr></tr>").append($("<td></td>").addClass("label").text("Unit/Snap:")).append($("<td></td>").attr("colspan","3").append(n("unit")).append(n("unitSnap")))).append($("<tr></tr>").append($("<td></td>").addClass("label").text("Grid:")).append($("<td></td>").append(n("gridSizeX").attr("title","Horizontal Grid-Size")).append(n("gridSizeY").attr("title","Vertical Grid-Size"))).append($("<td></td>").attr("colspan","2").css("text-align","right").append(n("gridActive")))).append($("<tr></tr>").append($("<td></td>").attr("colspan",4).append($("<h1></h1>").addClass("g-divider").text("Defaults")))).append($("<tr></tr>").append($("<td></td>").addClass("label").text("Cursor:")).append($("<td></td>").append(n("crDistSmall").attr("title","Small Distance when moving via Arrow-Keys")).append(n("crDistBig").attr("title","Large Distance when moving via Arrow-Keys"))).append($("<td></td>").addClass("label").text("Â°")).append($("<td></td>").append(n("crConstraint").attr("title","Constraints when moving via Shift in Degrees")))).append($("<tr></tr>").append($("<td></td>").addClass("label").html('<span class="fa fa-arrows"></span> / <span class="fa fa-magnet"></span>')).append($("<td></td>").attr("colspan","3").append(n("pickDist").attr("title","Pick Distance in Pixels")).append(n("snapDist").attr("title","Snap Distance")))).append($("<tr></tr>").attr("data-more","yes").append($("<td></td>").attr("colspan","3").append($("<h1></h1>").addClass("g-divider").text("Color")))).append($("<tr></tr>").attr("data-more","yes").append($("<td></td>").addClass("label").text("Color:")).append($("<td></td>").attr("colspan","3").append(n("clspace").attr("title","Default Colorspace of document")))).append($("<tr></tr>").attr("data-more","yes").append($("<td></td>").attr("colspan","3").append($("<h1></h1>").addClass("g-divider").text("Pathes")))).append($("<tr></tr>").attr("data-more","yes").append($("<td></td>").addClass("label").text("Images")).append($("<td></td>").attr("colspan","3").append(n("pathImage").attr("title","Path for imported image assets")))).append($("<tr></tr>").attr("data-more","yes").append($("<td></td>").addClass("label").text("Fonts")).append($("<td></td>").attr("colspan","3").append(n("pathFont").attr("title","Path for imported font assets")))).append($("<tr></tr>").attr("data-more","yes").append($("<td></td>").addClass("label").text("Export")).append($("<td></td>").attr("colspan","3").append(n("pathExport").attr("title","Path for exported assets")))).appendTo(t),this._showMore(!1)},e.prototype.update=function(t,e){return this._document&&(this._document.getScene().removeEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange),this._document=null),1===e.length&&e[0]instanceof IFScene&&(this._document=t,this._document.getScene().addEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),this._updateProperties(),!0)},e.prototype._afterPropertiesChange=function(t){t.node===this._document.getScene()&&this._updateProperties()},e.prototype._updateProperties=function(){var t=this._document.getScene();this._panel.find('select[data-property="unit"]').val(t.getProperty("unit")),this._panel.find('select[data-property="unitSnap"]').val(t.getProperty("unitSnap")),this._panel.find('input[data-property="gridSizeX"]').val(t.pointToString(t.getProperty("gridSizeX"))),this._panel.find('input[data-property="gridSizeY"]').val(t.pointToString(t.getProperty("gridSizeY"))),this._panel.find('input[data-property="gridActive"]').prop("checked",t.getProperty("gridActive")),this._panel.find('input[data-property="crDistSmall"]').val(t.pointToString(t.getProperty("crDistSmall"))),this._panel.find('input[data-property="crDistBig"]').val(t.pointToString(t.getProperty("crDistBig"))),this._panel.find('input[data-property="crConstraint"]').val(ifUtil.formatNumber(ifMath.toDegrees(t.getProperty("crConstraint")),2)),this._panel.find('input[data-property="snapDist"]').val(t.pointToString(t.getProperty("snapDist"))),this._panel.find('input[data-property="pickDist"]').val(t.pointToString(t.getProperty("pickDist"))),this._panel.find('select[data-property="clspace"]').val(t.getProperty("clspace")),this._panel.find('input[data-property="pathImage"]').val(t.getProperty("pathImage")),this._panel.find('input[data-property="pathFont"]').val(t.getProperty("pathFont")),this._panel.find('input[data-property="pathExport"]').val(t.getProperty("pathExport"))},e.prototype._assignProperty=function(t,e){this._assignProperties([t],[e])},e.prototype._assignProperties=function(t,e){var n=this._document.getEditor();n.beginTransaction();try{this._document.getScene().setProperties(t,e)}finally{n.commitTransaction("Modify Document Properties")}},e.prototype._showMore=function(t){this._panel.find("[data-more]").each(function(e,n){$(n).css("display",t?"":"none")})},e.prototype.toString=function(){return"[Object GDocumentProperties]"},t.GDocumentProperties=e}(this),function(t){function e(){this._polygons=[]}IFObject.inherit(e,GProperties),e.prototype._panel=null,e.prototype._document=null,e.prototype._polygons=null,e.prototype.getCategory=function(){return"Polygon"},e.prototype.init=function(t,e){this._panel=t;var n=function(t){var e=this;if("pts"===t)return $("<input>").attr("type","text").attr("data-property","pts").on("change",function(){var n=parseInt($(this).val());if(isNaN(n))e._updateProperties();else{var o=ifMath.normalizeAngleRadians(e._polygons[0].getProperty("oa")+Math.PI/n);e._assignProperties([t,"ia"],[ifMath.normalizeValue(n,2,360),o])}});if("evenodd"===t)return $("<input>").attr("type","checkbox").attr("data-property",t).on("change",function(){e._assignProperty(t,$(this).is(":checked"))});if("ir"===t||"or"===t)return $("<input>").attr("type","text").attr("data-property",t).on("change",function(){var n=e._document.getScene().stringToPoint($(this).val());null!==n&&"number"==typeof n&&n>=0?e._assignProperty(t,n):e._updateProperties()});if("ia"===t||"oa"===t)return $("<input>").attr("type","text").attr("data-property",t).on("change",function(){var n=IFLength.parseEquationValue($(this).val());null!==n?(n=ifMath.normalizeAngleRadians(ifMath.toRadians(n)),e._assignProperty(t,ifMath.PI2-n)):e._updateProperties()});if("ict"===t||"oct"===t)return $("<select></select>").attr("data-property",t).gCornerType().on("change",function(){e._assignProperty(t,$(this).val())});if("icr"===t||"ocr"===t)return $("<input>").attr("type","text").attr("data-property",t).on("change",function(n){var o=e._document.getScene().stringToPoint($(this).val());null!==o&&"number"==typeof o&&o>=0?e._assignProperty(t,o<0?0:o):e._updateProperties()});throw new Error("Unknown input property: "+t)}.bind(this);t.css("width","198px").append($("<label></label>").css({position:"absolute",top:"5px",left:"5px"}).text("Points:").append(n("pts").css({"margin-left":"3px",width:"48px"}))).append($("<label></label>").css({position:"absolute",top:"5px",left:"101px"}).append(n("evenodd")).append($("<span></span>").text(" Even/odd fill"))).append($("<label></label>").css({position:"absolute",top:"30px",left:"5px"}).html('<span class="fa fa-stop" style="font-size:11px;transform:rotate(45deg)"></span>').append(n("or").css({"margin-left":"5px",width:"48px"}))).append($("<label></label>").css({position:"absolute",top:"30px",left:"103px"}).html('<span class="fa fa-circle"></span>').append(n("ir").css({"margin-left":"3px",width:"48px"}))).append($("<hr>").css({position:"absolute",left:"0px",right:"0px",top:"50px"})).append($("<label></label>").css({position:"absolute",top:"65px",left:"5px"}).html('<span class="fa fa-rotate-right"></span>').append(n("oa").css({"margin-left":"5px",width:"48px"}))).append($("<label></label>").css({position:"absolute",top:"65px",left:"103px"}).html('<span class="fa fa-rotate-right" style="visibility: hidden"></span>').append(n("ia").css({"margin-left":"3px",width:"48px"}))).append($("<label></label>").css({position:"absolute",top:"90px",left:"5px"}).html('<span class="fa fa-square"></span>').append(n("ocr").css({"margin-left":"5px",width:"38px"})).append(n("oct").css("width","32px"))).append($("<label></label>").css({position:"absolute",top:"89px",left:"103px"}).html('<span class="fa fa-square" style="visibility: hidden"></span>').append(n("icr").css({"margin-left":"3px",width:"38px"})).append(n("ict").css("width","32px")))},e.prototype.update=function(t,e){this._document&&(this._document.getScene().removeEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange),this._document=null),this._polygons=[];for(var n=0;n<e.length;++n)e[n]instanceof IFPolygon&&this._polygons.push(e[n]);return this._polygons.length===e.length&&(this._document=t,this._document.getScene().addEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),this._updateProperties(),!0)},e.prototype._afterPropertiesChange=function(t){this._polygons.length>0&&this._polygons[0]===t.node&&this._updateProperties()},e.prototype._updateProperties=function(){var t=this._polygons[0];this._panel.find('input[data-property="pts"]').val(t.getProperty("pts")),this._panel.find('input[data-property="evenodd"]').prop("checked",t.getProperty("evenodd")),this._panel.find('input[data-property="or"]').val(this._document.getScene().pointToString(t.getProperty("or"))),this._panel.find('input[data-property="ir"]').val(this._document.getScene().pointToString(t.getProperty("ir"))),this._panel.find('input[data-property="oa"]').val(ifUtil.formatNumber(ifMath.toDegrees(ifMath.PI2-t.getProperty("oa")),2)),this._panel.find('input[data-property="ia"]').val(ifUtil.formatNumber(ifMath.toDegrees(ifMath.PI2-t.getProperty("ia")),2)),this._panel.find('select[data-property="oct"]').val(t.getProperty("oct")),this._panel.find('select[data-property="ict"]').val(t.getProperty("ict")),this._panel.find('input[data-property="ocr"]').val(this._document.getScene().pointToString(t.getProperty("ocr"))),this._panel.find('input[data-property="icr"]').val(this._document.getScene().pointToString(t.getProperty("icr")))},e.prototype._assignProperty=function(t,e){this._assignProperties([t],[e])},e.prototype._assignProperties=function(t,e){var n=this._document.getEditor();n.beginTransaction();try{for(var o=0;o<this._polygons.length;++o)this._polygons[o].setProperties(t,e)}finally{n.commitTransaction("Modify Polygon Properties")}},e.prototype.toString=function(){return"[Object GPolygonProperties]"},t.GPolygonProperties=e}(this),function(t){function e(){this._pathes=[]}IFObject.inherit(e,GProperties),e.prototype._panel=null,e.prototype._document=null,e.prototype._pathes=null,e.prototype._points=null,e.prototype.getCategory=function(){return"Path"},e.prototype.init=function(t,e){this._panel=t;var n=function(t){var e=this;if("evenodd"===t||"closed"===t)return $("<input>").attr("type","checkbox").attr("data-path-property",t).on("change",function(){e._assignPathProperty(t,$(this).is(":checked"))});throw new Error("Unknown input property: "+t)}.bind(this),o=function(t){var e=this;if("x"===t||"y"===t||"cl"===t||"cr"===t)return $("<input>").attr("type","text").attr("data-point-property",t).on("change",function(n){var o=e._document.getScene().stringToPoint($(this).val());null!==o&&"number"==typeof o&&o>=0?e._assignPointProperty(t,o):e._updatePointProperties()});if("type"===t)return $("<select></select>").attr("data-point-property",t).append($("<optgroup></optgroup>").attr("label","Curve").append($("<option></option>").attr("value",IFPathBase.AnchorPoint.Type.Symmetric).text("Symmetric")).append($("<option></option>").attr("value",IFPathBase.AnchorPoint.Type.Asymmetric).text("Asymmetric")).append($("<option></option>").attr("value",IFPathBase.AnchorPoint.Type.Mirror).text("Mirror")).append($("<option></option>").attr("value",IFPathBase.AnchorPoint.Type.Connector).text("Connector"))).append($("<optgroup></optgroup>").attr("label","Corner")).gCornerType().on("change",function(){var t=$(this).val();"-"===t&&(t=IFPathBase.CornerType.Rounded),e._assignPointProperty("tp",t)});if("ah"===t)return $("<input>").attr("type","checkbox").attr("data-point-property",t).on("change",function(){e._assignPointProperty(t,$(this).is(":checked"))});if("cu"===t)return $("<button></button>").addClass("g-flat").attr("data-point-property",t).on("click",function(){e._assignPointProperty(t,!$(this).hasClass("g-active")),e._updatePointProperties()}).append($("<span></span>").addClass("fa fa-lock"));throw new Error("Unknown input property: "+t)}.bind(this);t.css("width","205px").append($("<label></label>").css({position:"absolute",top:"5px",left:"5px"}).append(n("closed")).append($("<span></span>").text(" Closed"))).append($("<label></label>").css({position:"absolute",top:"5px",left:"75px"}).append(n("evenodd")).append($("<span></span>").text(" Even/odd fill"))).append($("<label></label>").attr("data-point-property","_row").css({position:"absolute",top:"30px",left:"5px"}).text("X:").append(o("x").css({"margin-left":"3px",width:"38px"}))).append($("<label></label>").attr("data-point-property","_row").css({position:"absolute",top:"30px",left:"65px"}).text("Y:").append(o("y").css({"margin-left":"3px",width:"38px"}))).append($("<div></div>").attr("data-point-property","_row").css({position:"absolute",top:"30px",left:"125px"}).append($("<button></button>").attr("title","Clear Left Handle").on("click",function(){this._assignPointProperties(["hlx","hly"],[null,null])}.bind(this)).append($("<span></span>").addClass("fa fa-forward"))).append($("<button></button>").attr("title","Clear Right Handle").on("click",function(){this._assignPointProperties(["hrx","hry"],[null,null])}.bind(this)).append($("<span></span>").addClass("fa fa-backward"))).append($("<button></button>").attr("title","Clear Handles").on("click",function(){this._assignPointProperties(["hlx","hly","hrx","hry"],[null,null,null,null])}.bind(this)).append($("<span></span>").addClass("fa fa-times")))).append($("<hr>").css({position:"absolute",left:"0px",right:"0px",top:"50px"})).append($("<label></label>").attr("data-point-property","_row").css({position:"absolute",top:"65px",left:"5px"}).append(o("type").css("width","100px"))).append($("<label></label>").attr("data-point-property","_row").css({position:"absolute",top:"65px",left:"110px"}).append(o("ah")).append($("<span></span>").text(" Auto Handles"))).append($("<label></label>").attr("data-point-property","_row").css({position:"absolute",top:"89px",left:"5px"}).append(o("cl").css("width","38px").attr("title","Left Smoothness")).append(o("cu").css("width","18px").attr("title","Toggle Lock of Left & Right Smoothness")).append(o("cr").css("width","38px").attr("title","Right Smoothness")))},e.prototype.update=function(t,e){this._document&&(this._document.getScene().removeEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange),this._document.getScene().removeEventListener(IFElement.AfterFlagChangeEvent,this._afterFlagChange),this._document=null),this._pathes=[],this._points=[];for(var n=0;n<e.length;++n)if(e[n]instanceof IFPath){var o=e[n];this._pathes.push(e[n]);for(var i=o.getAnchorPoints().getFirstChild();null!==i;i=i.getNext())i.hasFlag(IFNode.Flag.Selected)&&this._points.push(i)}return this._pathes.length===e.length&&(this._document=t,this._document.getScene().addEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),this._document.getScene().addEventListener(IFElement.AfterFlagChangeEvent,this._afterFlagChange,this),this._updatePathProperties(),this._updatePointProperties(),!0)},e.prototype._afterPropertiesChange=function(t){this._pathes.length>0&&this._pathes[0]===t.node&&this._updatePathProperties(),this._points.length>0&&this._points[0]===t.node&&this._updatePointProperties()},e.prototype._afterFlagChange=function(t){if(t.flag===IFNode.Flag.Selected&&t.node instanceof IFPathBase.AnchorPoint){var e=t.node.getParent().getParent();e&&this._pathes.indexOf(e)>=0&&(t.set?this._points.push(t.node):this._points.splice(this._points.indexOf(t.node),1),this._updatePointProperties())}},e.prototype._updatePathProperties=function(){var t=this._pathes[0];this._panel.find('input[data-path-property="evenodd"]').prop("checked",t.getProperty("evenodd")),this._panel.find('input[data-path-property="closed"]').prop("checked",t.getProperty("closed"))},e.prototype._updatePointProperties=function(){var t=this._points.length>0?this._points[0]:null;if(t){this._panel.find("[data-point-property]").css("visibility",""),this._panel.find('input[data-point-property="x"]').val(this._document.getScene().pointToString(t.getProperty("x"))),this._panel.find('input[data-point-property="y"]').val(this._document.getScene().pointToString(t.getProperty("y"))),this._panel.find('input[data-point-property="ah"]').prop("checked",t.getProperty("ah"));var e=!0,n=t.getProperty("tp");for(var o in IFPathBase.AnchorPoint.Type)if(IFPathBase.AnchorPoint.Type[o]===n){e=!1;break}this._panel.find('select[data-point-property="type"]').val(n),this._panel.find('input[data-point-property="cl"]').prop("disabled",!e).val(this._document.getScene().pointToString(t.getProperty("cl"))),this._panel.find('input[data-point-property="cr"]').prop("disabled",!e||t.getProperty("cu")).val(this._document.getScene().pointToString(t.getProperty("cr"))),this._panel.find('button[data-point-property="cu"]').prop("disabled",!e).toggleClass("g-active",t.getProperty("cu"))}else this._panel.find("[data-point-property]").css("visibility","hidden")},e.prototype._assignPathProperty=function(t,e){this._assignPathProperties([t],[e])},e.prototype._assignPathProperties=function(t,e){var n=this._document.getEditor();n.beginTransaction();try{for(var o=0;o<this._pathes.length;++o)this._pathes[o].setProperties(t,e)}finally{n.commitTransaction("Modify Path Properties")}},e.prototype._assignPointProperty=function(t,e){var n=this._document.getEditor();n.beginTransaction();try{for(var o=0;o<this._points.length;++o){var i=this._points[o];if("x"===t){var a=e-i.getProperty("x"),r=i.getProperty("hlx")?i.getProperty("hlx")+a:null,s=i.getProperty("hrx")?i.getProperty("hrx")+a:null;i.setProperties(["x","hlx","hrx"],[e,r,s])}else if("y"===t){var p=e-i.getProperty("y"),l=i.getProperty("hly")?i.getProperty("hly")+p:null,c=i.getProperty("hry")?i.getProperty("hry")+p:null;i.setProperties(["y","hly","hry"],[e,l,c])}else i.setProperties([t],[e])}}finally{n.commitTransaction("Modify Point Properties")}},e.prototype._assignPointProperties=function(t,e){var n=this._document.getEditor();n.beginTransaction();try{for(var o=0;o<this._points.length;++o)this._points[o].setProperties(t,e)}finally{n.commitTransaction("Modify Point Properties")}},e.prototype.toString=function(){return"[Object GPathProperties]"},t.GPathProperties=e}(this),function(t){function e(){this._rectangles=[]}IFObject.inherit(e,GProperties),e.prototype._panel=null,e.prototype._document=null,e.prototype._rectangles=null,e.prototype.getCategory=function(){return"Rectangle"},e.prototype.init=function(t,e){this._panel=t;var n=function(t){var e=this;if("uf"===t)return $("<input>").attr("type","checkbox").attr("data-property",t).on("change",function(){e._assignProperty("uf",$(this).is(":checked")),e._updateCornerProperties()});if("tl_sx"===t||"tl_sy"===t||"tr_sx"===t||"tr_sy"===t||"bl_sx"===t||"bl_sy"===t||"br_sx"===t||"br_sy"===t)return $("<input>").attr("type","text").attr("data-property",t).css("width","48px").on("change",function(){var n=e._document.getScene().stringToPoint($(this).val());null!==n&&"number"==typeof n&&n>=0?e._assignProperty(t,n):e._updateCornerProperties()});if("tl_ct"===t||"tr_ct"===t||"bl_ct"===t||"br_ct"===t)return $("<select></select>").attr("data-property",t).css("width","32px").gCornerType().on("change",function(){e._assignProperty(t,$(this).val())});if("tl_uf"===t||"tr_uf"===t||"bl_uf"===t||"br_uf"===t)return $("<button></button>").addClass("g-flat").css("width","32px").attr("data-property",t).on("click",function(){e._assignProperty(t,!$(this).hasClass("g-active")),e._updateCornerProperties()}).append($("<span></span>").addClass("fa fa-lock fa-fw"));throw new Error("Unknown input property: "+t)}.bind(this),o="Uniform Corner-Smoothness",i="Horizontal Corner-Smoothness",a="Vertical Corner-Smoothness",r="Corner-Type";t.css("width","180px").append($("<label></label>").css({position:"absolute",top:"5px",left:"5px"}).append(n("uf")).append($("<span></span>").text(" Uniform Corners"))).append($("<label></label>").css({position:"absolute",top:"30px",left:"5px"}).append(n("tl_ct").attr("title",o)).append(n("tl_sx").attr("title",i)).append(n("tr_sx").attr("title",i)).append(n("tr_ct").attr("title",o))).append($("<label></label>").css({position:"absolute",top:"53px",left:"5px"}).append(n("tl_sy").attr("title",a)).append(n("tl_uf").attr("title",r)).append(n("tr_uf").attr("title",r)).append(n("tr_sy").attr("title",a))).append($("<label></label>").css({position:"absolute",top:"76px",left:"5px"}).append(n("bl_sy").attr("title",a)).append(n("bl_uf").attr("title",r)).append(n("br_uf").attr("title",r)).append(n("br_sy").attr("title",a))).append($("<label></label>").css({position:"absolute",top:"99px",left:"5px"}).append(n("bl_ct").attr("title",o)).append(n("bl_sx").attr("title",i)).append(n("br_sx").attr("title",i)).append(n("br_ct").attr("title",o)))},e.prototype.update=function(t,e){this._document&&(this._document.getScene().removeEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange),this._document=null),this._rectangles=[];for(var n=0;n<e.length;++n)e[n]instanceof IFRectangle&&this._rectangles.push(e[n]);return this._rectangles.length===e.length&&(this._document=t,this._document.getScene().addEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),this._updateProperties(),!0)},e.prototype._afterPropertiesChange=function(t){this._rectangles.length>0&&this._rectangles[0]===t.node&&this._updateProperties()},e.prototype._updateProperties=function(){this._updateCornerProperties()},e.prototype._updateCornerProperties=function(){var t=this._rectangles[0],e=t.getProperty("uf"),n=function(n){for(var o=0;o<n.length;++o){var i=n[o],a=this._panel.find('button[data-property="'+i+'_uf"]'),r=this._panel.find('input[data-property="'+i+'_sx"]'),s=this._panel.find('input[data-property="'+i+'_sy"]'),p=this._panel.find('select[data-property="'+i+'_ct"]'),l=e&&"tl"!==i;a.css("visibility",l?"hidden":"visible"),r.css("visibility",l?"hidden":"visible"),s.css("visibility",l?"hidden":"visible"),p.css("visibility",l?"hidden":"visible"),l||(r.val(this._document.getScene().pointToString(t.getProperty(i+"_sx"))),s.val(this._document.getScene().pointToString(t.getProperty(i+"_sy"))),t.getProperty(i+"_uf")?(a.addClass("g-active"),s.prop("disabled",!0)):(a.removeClass("g-active"),s.prop("disabled",!1)),a.prop("disabled",e))}}.bind(this);this._panel.find('input[data-property="uf"]').prop("checked",e),n(["tl","tr","bl","br"])},e.prototype._assignProperty=function(t,e){this._assignProperties([t],[e])},e.prototype._assignProperties=function(t,e){var n=this._document.getEditor();n.beginTransaction();try{for(var o=0;o<this._rectangles.length;++o)this._rectangles[o].setProperties(t,e)}finally{n.commitTransaction("Modify Rectangle Properties")}},e.prototype.toString=function(){return"[Object GRectangleProperties]"},t.GRectangleProperties=e}(this),function(t){function e(){this._ellipses=[]}IFObject.inherit(e,GProperties),e.prototype._panel=null,e.prototype._document=null,e.prototype._ellipses=null,e.prototype.getCategory=function(){return"Ellipse"},e.prototype.init=function(t){this._panel=t;var e=function(t){var e=this;if("etp"===t)return $("<select></select>").attr("data-property","etp").append($("<option></option>").attr("value",IFEllipse.Type.Arc).text("Arc")).append($("<option></option>").attr("value",IFEllipse.Type.Chord).text("Chord")).append($("<option></option>").attr("value",IFEllipse.Type.Pie).text("Pie")).on("change",function(){e._assignProperty(t,$(this).val())});if("sa"===t||"ea"===t)return $("<input>").attr("type","text").attr("data-property",t).on("change",function(){var n=IFLength.parseEquationValue($(this).val());null!==n?(n=ifMath.normalizeAngleRadians(ifMath.toRadians(n)),e._assignProperty(t,ifMath.PI2-n)):e._updateProperties()});throw new Error("Unknown input property: "+t)}.bind(this);t.css("width","127px").append($("<label></label>").css({position:"absolute",top:"5px",left:"5px"}).append(e("etp").css("width","114px"))).append($("<label></label>").css({position:"absolute",top:"30px",left:"5px"}).html('<span class="fa fa-stop" style="font-size:11px;transform:rotate(45deg)"></span>').append(e("sa").css({"margin-left":"5px",width:"38px"}))).append($("<label></label>").css({position:"absolute",top:"30px",left:"66px"}).html('<span class="fa fa-circle"></span>').append(e("ea").css({"margin-left":"3px",width:"38px"})))},e.prototype.update=function(t,e){this._document&&(this._document.getScene().removeEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange),this._document=null),this._ellipses=[];for(var n=0;n<e.length;++n)e[n]instanceof IFEllipse&&this._ellipses.push(e[n]);return this._ellipses.length===e.length&&(this._document=t,this._document.getScene().addEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),this._updateProperties(),!0)},e.prototype._afterPropertiesChange=function(t){this._ellipses.length>0&&this._ellipses[0]===t.node&&this._updateProperties()},e.prototype._updateProperties=function(){var t=this._ellipses[0];this._panel.find('select[data-property="etp"]').val(t.getProperty("etp")),this._panel.find('input[data-property="sa"]').val(ifUtil.formatNumber(ifMath.toDegrees(ifMath.PI2-t.getProperty("sa")),2)),this._panel.find('input[data-property="ea"]').val(ifUtil.formatNumber(ifMath.toDegrees(ifMath.PI2-t.getProperty("ea")),2))},e.prototype._assignProperty=function(t,e){this._assignProperties([t],[e])},e.prototype._assignProperties=function(t,e){var n=this._document.getEditor();n.beginTransaction();try{for(var o=0;o<this._ellipses.length;++o)this._ellipses[o].setProperties(t,e)}finally{n.commitTransaction("Modify Ellipse Properties")}},e.prototype.toString=function(){return"[Object GEllipseProperties]"},t.GEllipseProperties=e}(this),function(t){function e(){}IFObject.inherit(e,GProperties),e.prototype._panel=null,e.prototype._document=null,e.prototype._image=null,e.prototype.getCategory=function(){return"Image"},e.prototype.init=function(t,e){this._panel=t,t.css("width","210px").append($("<label></label>").css({position:"absolute",top:"5px",left:"5px"}).append($("<span></span>").addClass("fa fa-image")).append($("<span></span>").css({"text-overflow":"ellipsis","padding-left":"5px"}).attr("data-property","url"))).append($("<div></div>").css({position:"absolute",top:"30px",left:"5px"}).append($("<button></button>").attr("data-action","embed").text("Embed").on("click",function(){image2Base64(this._image.getImage(),function(t){IFEditor.tryRunTransaction(this._image,function(){this._image.setProperty("url",t)}.bind(this),"Embed Image")}.bind(this))}.bind(this))).append($("<button></button>").attr("data-action","replace").text("Replace").on("click",function(){var t=this._image.getGeometryBBox().getSide(IFRect.Side.TOP_LEFT);this._document.getStorage().openResourcePrompt(this._document.getUrl(),["jpg","jpeg","png","gif"],function(e){IFEditor.tryRunTransaction(this._image,function(){this._image.setProperties(["url","trf"],[new URI(e).relativeTo(this._document.getUrl()).toString(),new IFTransform(1,0,0,1,t.getX(),t.getY())])}.bind(this),"Replace Image")}.bind(this))}.bind(this))).append($("<button></button>").attr("data-action","export").text("Export").on("click",function(){var t=gApp.getMatchingStorage(!0,!0,"png",!1,this._document.getStorage());t&&t.saveResourcePrompt(this._document.getUrl(),this._image.getLabel(),["png"],function(e){image2ArrayBuffer(this._image.getImage(),function(n){t.save(e,n,!0)})}.bind(this))}.bind(this))).append($("<button></button>").attr("data-action","reset-size").text("Reset Size").on("click",function(){var t=this._image.getGeometryBBox().getSide(IFRect.Side.TOP_LEFT);IFEditor.tryRunTransaction(this._image,function(){this._image.setProperty("trf",new IFTransform(1,0,0,1,t.getX(),t.getY()))}.bind(this),"Reset Size")}.bind(this))))},e.prototype.update=function(t,e){this._document&&(this._document.getScene().removeEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),this._document.getScene().removeEventListener(IFImage.StatusEvent,this._imageStatus,this),this._document=null),this._image=null;for(var n=0;n<e.length;++n)if(e[n]instanceof IFImage){if(this._image){this._image=null;break}this._image=e[n]}return!!this._image&&(this._document=t,this._document.getScene().addEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),this._document.getScene().addEventListener(IFImage.StatusEvent,this._imageStatus,this),this._updateProperties(),!0)},e.prototype._afterPropertiesChange=function(t){this._image&&this._image===t.node&&this._updateProperties()},e.prototype._imageStatus=function(t){t.image!==this._image||t.status!==IFImage.ImageStatus.Error&&t.status!==IFImage.ImageStatus.Loaded||this._updateProperties()},e.prototype._updateProperties=function(){var t=this._image.getProperty("url"),e=0===t.indexOf("data:"),n=this._image.getStatus(),o=this._image.getImage(),i=o&&n===IFImage.ImageStatus.Loaded,a=this._image.getGeometryBBox();this._panel.find('[data-property="url"]').text(e?"<Embedded Image>":decodeURIComponent(t)),this._panel.find('button[data-action="embed"]').prop("disabled",!i||e),this._panel.find('button[data-action="replace"]').prop("disabled",!this._document.isSaveable()),this._panel.find('button[data-action="export"]').prop("disabled",!i||!this._document.isSaveable()),this._panel.find('button[data-action="reset-size"]').prop("disabled",!i||o.naturalWidth===a.getWidth()&&o.naturalHeight===a.getHeight())},e.prototype.toString=function(){return"[Object GImageProperties]"},t.GImageProperties=e}(this),function(t){function e(){this._elements=[]}IFObject.inherit(e,GProperties),e.prototype._panel=null,e.prototype._document=null,e.prototype._elements=null,e.prototype._elementsBBox=null,e.prototype._firstElementsBBox=null,e.prototype.getCategory=function(){return"Dimensions"},e.prototype.init=function(t){this._panel=t;var e=function(t){var e=this;return"name"===t?$("<input>").css("width","100%").attr("data-name","").on("change",function(t){IFEditor.tryRunTransaction(e._elements[0],function(){e._elements[0].setProperty("name",$(t.target).val())},"Rename Element")}):"x"===t||"y"===t||"w"===t||"h"===t?$("<input>").attr("type","text").attr("data-dimension",t).on("change",function(n){e._assignDimension(t,$(this).val())}):void 0}.bind(this);t.css("width","136px").append($("<div></div>").addClass("g-input").css({position:"absolute",left:"5px",top:"9px",width:"41px",height:"41px"})).append($("<label></label>").css({position:"absolute",left:"51px",top:"5px",width:"77px","text-transform":"uppercase"}).attr("data-type","")).append(e("name").css({position:"absolute",left:"51px",top:"30px",width:"77px"})).append($("<hr>").css({position:"absolute",left:"0px",right:"0px",top:"50px"})).append($("<button></button>").css({position:"absolute",left:"5px",top:"77px",padding:"0px","font-size":"10px"}).on("click",function(t){var e=$(this);e.toggleClass("g-active",!e.hasClass("g-active"))}).addClass("g-flat fa fa-lock").attr("title","Keep Ratio").attr("data-ratio","")).append($("<label></label>").css({position:"absolute",left:"15px",top:"65px"}).text("W:").append(e("w").css({"margin-left":"3px",width:"38px"}))).append($("<label></label>").css({position:"absolute",left:"15px",top:"89px"}).text("H:").append(e("h").css({"margin-left":"3px",width:"38px"}))).append($("<label></label>").css({position:"absolute",left:"75px",top:"65px"}).text("X:").append(e("x").css({"margin-left":"3px",width:"41px"}))).append($("<label></label>").css({position:"absolute",left:"75px",top:"89px"}).text("Y:").append(e("y").css({"margin-left":"3px",width:"41px"})))},e.prototype.update=function(t,e){return this._document&&(this._document.getScene().removeEventListener(IFElement.GeometryChangeEvent,this._geometryChange,this),this._document.getScene().removeEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),this._document=null),this._elements=e.slice(),this._elements.length>0&&(this._document=t,this._document.getScene().addEventListener(IFElement.GeometryChangeEvent,this._geometryChange,this),this._document.getScene().addEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),this._updateProperties(),this._updateDimensions(),!0)},e.prototype._geometryChange=function(t){t.type!==IFElement.GeometryChangeEvent.Type.After&&t.type!==IFElement.GeometryChangeEvent.Type.Child||this._elements.indexOf(t.element)>=0&&this._updateDimensions()},e.prototype._afterPropertiesChange=function(t){this._elements&&1===this._elements.length&&this._elements[0]===t.node&&t.properties.indexOf("name")>=0&&this._updateProperties()},e.prototype._updateProperties=function(){this._panel.find("input[data-apply]").css("display",this._elements.length<=1?"none":""),this._panel.find("label[data-type]").text(1===this._elements.length?this._elements[0].getNodeNameTranslated():this._elements.length.toString()+" Elements"),this._panel.find("input[data-name]").css("visibility",1===this._elements.length&&this._elements[0]instanceof IFBlock?"visible":"hidden").val(1===this._elements.length&&this._elements[0]instanceof IFBlock?this._elements[0].getLabel():"")},e.prototype._updateDimensions=function(t){var e=function(t,e){this._panel.find('input[data-dimension="'+t+'"]').val(null!==e?this._document.getScene().pointToString(e):"").parents("label").css("display",null===e?"none":"")}.bind(this);if(!t){this._elementsBBox=null,this._firstElementsBBox=null;for(var n=0;n<this._elements.length;++n)if(this._elements[n].hasMixin(IFElement.Transform)){var o=this._elements[n].getGeometryBBox();o&&!o.isEmpty()&&(this._elementsBBox=this._elementsBBox?this._elementsBBox.united(o):o,this._firstElementsBBox||(this._firstElementsBBox=o))}this._elementsBBox||(this._elementsBBox=null,this._firstElementsBBox=this._elementsBBox)}if(this._firstElementsBBox){var i=this._getDelta();this._panel.find("button[data-ratio]").css("display",""),e("x",this._elementsBBox.getX()-i.getX()),e("y",this._elementsBBox.getY()-i.getY()),e("w",this._elementsBBox.getWidth()),e("h",this._elementsBBox.getHeight())}else this._panel.find("button[data-ratio]").css("display","none"),e("x",null),e("y",null),e("w",null),e("h",null)},e.prototype._assignDimension=function(t,e){var n=this._document.getScene().stringToPoint(e);if(null===n||"number"!=typeof n||("w"===t||"h"==t)&&n<=0)this._updateDimensions();else{if("x"===t||"y"===t){var o=this._getDelta();switch(t){case"x":n+=o.getX();break;case"y":n+=o.getY()}}var i=function(e,o){if("w"===t||"h"===t){var i=1,a=1;switch(t){case"w":i=n/e.getWidth(),o&&(a=i);break;case"h":a=n/e.getHeight(),o&&(i=a)}return(new IFTransform).translated(-e.getX(),-e.getY()).scaled(i,a).translated(e.getX(),e.getY())}switch(t){case"x":return(new IFTransform).translated(n-e.getX(),0);case"y":return(new IFTransform).translated(0,n-e.getY())}},a=this._panel.find("button[data-ratio]").hasClass("g-active"),r=this._document.getEditor();r.beginTransaction();try{for(var s=i(this._elementsBBox,a),p=0;p<this._elements.length;++p)this._elements[p].transform(s)}finally{r.commitTransaction("Change Size")}}},e.prototype._getDelta=function(){var t=this._document.getScene();if(!0===t.getProperty("singlePage")){var e=t.getActivePage();if(e)return e.getGeometryBBox().getSide(IFRect.Side.TOP_LEFT)}return new IFPoint(0,0)},e.prototype.toString=function(){return"[Object GInfoProperties]"},t.GInfoProperties=e}(this),function(t){function e(){this._pages=[]}IFObject.inherit(e,GProperties),e.SIZE_PRESETS=[{name:"Paper",sizes:[{name:"A0",width:"841mm",height:"1189mm"},{name:"A1",width:"594mm",height:"841mm"},{name:"A2",width:"420mm",height:"594mm"},{name:"A3",width:"297mm",height:"420mm"},{name:"A4",width:"210mm",height:"297mm"},{name:"A5",width:"148,5mm",height:"210mm"}]},{name:"Phone",sizes:[{name:"Apple iPhone 4 (S)",width:"640px",height:"960px"},{name:"Apple iPhone 5",width:"640px",height:"1136px"}]},{name:"Tablet",sizes:[{name:"Apple iPad 1 & 2 & Mini",width:"768px",height:"1024px"},{name:"Apple iPad 3 & 4",width:"1536px",height:"2048px"}]}],e.prototype._panel=null,e.prototype._document=null,e.prototype._pages=null,e.prototype.getCategory=function(){return"Page"},e.prototype.init=function(t){this._panel=t;var n=function(t){var n=this;if("msref"===t)return $("<select></select>").attr("data-property","msref").on("change",function(){var e=$(this).val();n._assignProperty(t,""===e?null:e)});if("size-preset"===t){var o=$("<select></select>").attr("data-property","size-preset").on("change",function(){var t=n._document.getScene(),o=$(this).val();if(o.indexOf(",")>=0){var i=o.split(","),a=e.SIZE_PRESETS[parseInt(i[0])].sizes[parseInt(i[1])],r=t.stringToPoint(a.width),s=t.stringToPoint(a.height);n._panel.find('[name="w"]').val(t.pointToString(r)),n._panel.find('[name="h"]').val(t.pointToString(s)),n._assignProperties(["w","h"],[r,s])}});o.append($("<option></option>").attr("value","x").text("Custom Size"));for(var i=0;i<e.SIZE_PRESETS.length;++i){var a=e.SIZE_PRESETS[i],r=$("<optgroup></optgroup>").attr("label",a.name);o.append(r);for(var s=0;s<a.sizes.length;++s){var p=a.sizes[s];$("<option></option>").attr("value",i.toString()+","+s.toString()).text(p.name).appendTo(r)}}return o}if("cls"===t)return $("<button></button>").attr("data-property",t).gColorButton({allowClear:!0}).on("colorchange",function(e,o){n._assignProperty(t,o)});if("w"===t||"h"===t)return $("<input>").attr("type","text").attr("data-property",t).on("change",function(){var e=n._document.getScene().stringToPoint($(this).val());null!==e&&"number"==typeof e&&e>=0?n._assignProperty(t,e):n._updateProperties(),n._selectSizePreset()});if("bl"===t)return $("<input>").attr("type","text").attr("data-property",t).on("change",function(){var e=n._document.getScene().stringToPoint($(this).val());null!==e&&"number"==typeof e&&e>=0?n._assignProperty(t,e):n._updateProperties()});if("mt"===t||"mb"===t||"ml"===t||"mr"===t)return $("<input>").attr("type","text").attr("data-property",t).on("change",function(){var e=n._document.getScene().stringToPoint($(this).val());null!==e&&"number"==typeof e&&e>=0?n._panel.find("button[data-lock-margin]").hasClass("g-active")?n._assignProperties(["mt","mb","ml","mr"],[e,e,e,e]):n._assignProperty(t,e):n._updateProperties()});throw new Error("Unknown input property: "+t)}.bind(this);t.css("width","250px").append($("<label></label>").css({position:"absolute",top:"5px",left:"5px"}).append(n("size-preset").css({width:"110px"}))).append($("<label></label>").css({position:"absolute",top:"5px",left:"125px"}).html('<span class="fa fa-link"></span>').append(n("msref").css({"margin-left":"5px",width:"102px"}))).append($("<label></label>").css({position:"absolute",top:"30px",left:"5px"}).text("W:").append(n("w").css({"margin-left":"3px",width:"38px"}))).append($("<label></label>").css({position:"absolute",top:"30px",left:"65px"}).text("H:").append(n("h").css({"margin-left":"3px",width:"38px"}))).append($("<label></label>").css({position:"absolute",top:"30px",left:"125px"}).text("Bleed:").append(n("bl").css({"margin-left":"3px",width:"38px"}))).append($("<label></label>").css({position:"absolute",top:"30px",right:"5px"}).append(n("cls"))).append($("<hr>").css({position:"absolute",left:"0px",right:"0px",top:"50px"})).append($("<label></label>").css({position:"absolute",left:"5px",top:"65px"}).text("L:").append(n("ml").css({"margin-left":"3px",width:"38px"}))).append($("<label></label>").css({position:"absolute",left:"5px",top:"89px"}).text("T:").append(n("mt").css({"margin-left":"3px",width:"38px"}))).append($("<label></label>").css({position:"absolute",left:"65px",top:"65px"}).text("R:").append(n("mr").css({"margin-left":"3px",width:"38px"}))).append($("<label></label>").css({position:"absolute",left:"65px",top:"89px"}).text("B:").append(n("mb").css({"margin-left":"3px",width:"38px"}))).append($("<button></button>").css({position:"absolute",left:"123px",top:"77px",padding:"0px","font-size":"10px"}).on("click",function(t){var e=$(this);e.toggleClass("g-active",!e.hasClass("g-active"))}).addClass("g-flat fa fa-lock g-active").attr("title","Equal Margins").attr("data-lock-margin",""))},e.prototype.update=function(t,e){if(this._document&&(this._document.getScene().removeEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),this._document.getScene().removeEventListener(IFNode.AfterInsertEvent,this._updatePages,this),this._document.getScene().removeEventListener(IFNode.AfterRemoveEvent,this._updatePages,this),this._document=null),this._pages=[],1===e.length&&e[0]instanceof IFScene){var n=e[0].getActivePage();n&&this._pages.push(n)}else for(var o=0;o<e.length;++o)e[o]instanceof IFPage&&this._pages.push(e[o]);return this._pages.length===e.length&&(this._document=t,this._document.getScene().addEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),this._document.getScene().addEventListener(IFNode.AfterInsertEvent,this._updatePages,this),this._document.getScene().addEventListener(IFNode.AfterRemoveEvent,this._updatePages,this),this._updateProperties(),!0)},e.prototype._afterPropertiesChange=function(t){this._pages.length>0&&(this._pages[0]===t.node||t.node instanceof IFScene&&t.properties.indexOf("unit")>=0)&&this._updateProperties()},e.prototype._updateProperties=function(){var t=this._document.getScene(),e=this._pages[0];this._updatePages(),this._panel.find('select[data-property="msref"]').val(e.getProperty("msref")),this._panel.find('input[data-property="bl"]').val(e.getProperty("bl")),this._panel.find('[data-property="cls"]').gColorButton("value",e.getProperty("cls")).gColorButton("scene",t),this._panel.find('input[data-property="w"]').val(t.pointToString(e.getProperty("w"))),this._panel.find('input[data-property="h"]').val(t.pointToString(e.getProperty("h"))),this._panel.find('input[data-property="mt"]').val(t.pointToString(e.getProperty("mt"))),this._panel.find('input[data-property="mb"]').val(t.pointToString(e.getProperty("mb"))),this._panel.find('input[data-property="ml"]').val(t.pointToString(e.getProperty("ml"))),this._panel.find('input[data-property="mr"]').val(t.pointToString(e.getProperty("mr"))),this._selectSizePreset()},e.prototype._updatePages=function(){var t=this._document.getScene(),e=this._panel.find('select[data-property="msref"]'),n=e.val();e.val(null),e.empty(),$("<option></option>").attr("value","").text("").appendTo(e);for(var o=t.getFirstChild();null!==o;o=o.getNext())o instanceof IFPage&&this._pages.indexOf(o)<0&&$("<option></option>").attr("value",o.getReferenceId()).text(o.getLabel()).appendTo(e);e.val(n)},e.prototype._selectSizePreset=function(){for(var t=this._pages[0],n=!1,o=this._panel.find('[data-property="size-preset"]'),i=t.getProperty("w"),a=t.getProperty("h"),r=0;r<e.SIZE_PRESETS.length;++r)for(var s=e.SIZE_PRESETS[r],p=0;p<s.sizes.length;++p){var l=s.sizes[p],c=t.getScene().stringToPoint(l.width),d=t.getScene().stringToPoint(l.height);if(c===i&&d===a){o.val(r.toString()+","+p.toString()),n=!0;break}}n||o.val("x")},e.prototype._assignProperty=function(t,e){this._assignProperties([t],[e])},e.prototype._assignProperties=function(t,e){var n=this._document.getEditor();n.beginTransaction();try{for(var o=0;o<this._pages.length;++o)this._pages[o].setProperties(t,e)}finally{n.commitTransaction("Modify Page Properties")}},e.prototype.toString=function(){return"[Object GPageProperties]"},t.GPageProperties=e}(this),function(t){function e(){this._text=[]}IFObject.inherit(e,GProperties),e.prototype._panel=null,e.prototype._document=null,e.prototype._text=null,e.prototype._textEditor=null,e.prototype.getCategory=function(){return"Text"},e.prototype.init=function(t,e){this._panel=t;var n=function(t){var e=this;if(0===t.indexOf("va-")){var n="",o=t.substr(3);switch(o){case IFText.VerticalAlign.Top:n="fa-align-right fa-rotate-270";break;case IFText.VerticalAlign.Middle:n="fa-align-center fa-rotate-270";break;case IFText.VerticalAlign.Bottom:n="fa-align-left fa-rotate-270"}return $("<button></button>").attr("data-property",t).on("click",function(){e._assignProperty("va",o)}).append($("<span></span>").addClass("fa "+n))}if(0===t.indexOf("al-")){var i="",a=t.substr(3);switch(a){case IFText.Paragraph.Alignment.Left:i="left";break;case IFText.Paragraph.Alignment.Center:i="center";break;case IFText.Paragraph.Alignment.Right:i="right";break;case IFText.Paragraph.Alignment.Justify:i="justify"}return $("<button></button>").attr("data-property",t).on("click",function(){e._assignProperty("al",$(this).hasClass("g-active")?null:a)}).append($("<span></span>").addClass("fa fa-align-"+i))}if("aw"===t||"ah"===t)return $("<input>").attr("type","checkbox").attr("data-property",t).on("change",function(){e._assignProperty(t,$(this).is(":checked"))});if("ff"===t){for(var r=$("<select></select>").attr("data-property",t).append($("<option></option>").attr("value","").text("")).on("change",function(){var n=$(this).val();e._assignProperty(t,""===n?null:n)}),s={},p=ifFont.getFamilies(),l=0;l<p.length;++l){var c=ifFont.getCategory(p[l]),d=null;s.hasOwnProperty(c)?d=s[c]:s[c]=d=$("<optgroup></optgroup>").attr("label",ifLocale.get(IFFont.CategoryName[c])).appendTo(r),$("<option></option>").attr("value",p[l]).text(p[l]).appendTo(d)}return r}if("fi"===t||"ws"===t||"cs"===t||"in"===t||"cg"===t)return $("<input>").attr("type","text").attr("data-property",t).on("change",function(){var n=e._document.getScene().stringToPoint($(this).val());null===n||"number"==typeof n&&n>=0?e._assignProperty(t,n):e._updateProperties()});if("fw"===t){for(r=$("<select></select>").attr("data-property",t).append($("<option></option>").attr("value","").text("")).on("change",function(){var n=$(this).val();e._assignProperty(t,""===n?null:n)}),l=100;l<=900;l+=100)$("<option></option>").attr("value",l).text(ifLocale.get(IFFont.WeightName[l])).appendTo(r);return r}if("fs"===t)return $("<select></select>").attr("data-property",t).append($("<option></option>").attr("value","").text("")).append($("<option></option>").attr("value",IFFont.Style.Normal).text("Normal")).append($("<option></option>").attr("value",IFFont.Style.Italic).text("Italic")).on("change",function(){var n=$(this).val();e._assignProperty(t,""===n?null:n)});if("fc"===t)return $("<button></button>").attr("data-property",t).gColorButton({allowClear:!0,scene:this._document.getScene()}).on("colorchange",function(n,o){e._assignProperty(t,o)});if("wm"===t)return $("<select></select>").attr("data-property",t).append($("<option></option>").attr("value","").text("")).append($("<option></option>").attr("value",IFText.Paragraph.WrapMode.None).text("None")).append($("<option></option>").attr("value",IFText.Paragraph.WrapMode.Words).text("Words")).append($("<option></option>").attr("value",IFText.Paragraph.WrapMode.All).text("All")).on("change",function(){var n=$(this).val();e._assignProperty(t,""===n?null:n)});if("lh"===t)return $("<input>").attr("type","text").attr("data-property",t).on("change",function(){var n=$(this).val();null===(n=n&&""!==n?IFLength.parseEquationValue(n):null)||n>0?e._assignProperty(t,n):e._updateProperties()});if("cc"===t)return $("<input>").attr("type","text").attr("data-property",t).on("change",function(){var n=$(this).val();null===(n=n&&""!==n?parseInt(n):null)||n>1?e._assignProperty(t,n):e._updateProperties()});throw new Error("Unknown input property: "+t)}.bind(this);t.css("width","320px").append($("<label></label>").css({position:"absolute",top:"5px",left:"5px"}).append(n("ff").css({width:"120px"})).append(n("fw").css({width:"83px"})).append(n("fs").css({width:"65px"})).append(n("fi").css({width:"30px"}))).append($("<label></label>").css({position:"absolute",top:"30px",left:"5px"}).html('<span class="fa fa-text-width"></span>').append(n("cs").css({"margin-left":"5px",width:"30px"}).attr("title","Character Spacing"))).append($("<label></label>").css({position:"absolute",top:"30px",left:"60px"}).html('<span class="fa fa-text-width"></span>').append(n("ws").css({"margin-left":"5px",width:"30px"}).attr("title","Word Spacing"))).append($("<label></label>").css({position:"absolute",top:"30px",left:"115px"}).html('<span class="fa fa-text-height"></span>').append(n("lh").css({"margin-left":"5px",width:"30px"}).attr("title","Line Height"))).append($("<div></div>").css({position:"absolute",top:"30px",left:"215px"}).append(n("al-"+IFText.Paragraph.Alignment.Left).attr("title","Align Left")).append(n("al-"+IFText.Paragraph.Alignment.Center).attr("title","Align Centered")).append(n("al-"+IFText.Paragraph.Alignment.Right).attr("title","Align Right")).append(n("al-"+IFText.Paragraph.Alignment.Justify).attr("title","Justify"))).append($("<hr>").css({position:"absolute",left:"0px",right:"0px",top:"50px"})).append($("<div></div>").css({position:"absolute",top:"65px",left:"5px"}).append(n("va-"+IFText.VerticalAlign.Top).attr("title","Align Top")).append(n("va-"+IFText.VerticalAlign.Middle).attr("title","Align Middle")).append(n("va-"+IFText.VerticalAlign.Bottom).attr("title","Align Bottom"))).append($("<label></label>").css({position:"absolute",top:"65px",left:"85px"}).html('<span class="fa fa-sort-alpha-asc"></span>').append(n("wm").css({"margin-left":"5px",width:"60px"}).attr("title","Wrap Mode"))).append($("<label></label>").css({position:"absolute",top:"65px",left:"230px"}).append(n("ah")).append($("<span></span>").text(" Auto Height"))).append($("<label></label>").css({position:"absolute",top:"89px",left:"5px"}).html('<span class="fa fa-indent"></span>').append(n("in").css({"margin-left":"5px",width:"30px"}).attr("title","Indent"))).append($("<label></label>").css({position:"absolute",top:"89px",left:"60px"}).html('<span class="fa fa-reorder fa-rotate-270"></span>').append(n("cc").css({"margin-left":"5px",width:"30px"}).attr("title","Columns"))).append($("<label></label>").css({position:"absolute",top:"89px",left:"115px"}).html('<span class="fa fa-sort-amount-desc fa-rotate-270"></span>').append(n("cg").css({"margin-left":"5px",width:"30px"}).attr("title","Columns Gap"))).append($("<label></label>").css({position:"absolute",top:"89px",left:"230px"}).append(n("aw")).append($("<span></span>").text(" Auto Width")))},e.prototype.update=function(t,e){this._document&&(this._document.getScene().removeEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange),this._document.getEditor().removeEventListener(IFEditor.InlineEditorEvent,this._inlineEditorEvent),this._document=null),this._text=[];for(var n=0;n<e.length;++n)e[n]instanceof IFText&&this._text.push(e[n]);return this._text.length===e.length&&(this._document=t,this._document.getScene().addEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),this._document.getEditor().addEventListener(IFEditor.InlineEditorEvent,this._inlineEditorEvent,this),this._updateProperties(),!0)},e.prototype._afterPropertiesChange=function(t){this._text.length>0&&(this._text[0]===t.node||this._text[0].getContent()===t.node)&&this._updateProperties()},e.prototype._inlineEditorEvent=function(t){switch(t.type){case IFEditor.InlineEditorEvent.Type.AfterOpen:this._textEditor=t.editor,this._updateProperties();break;case IFEditor.InlineEditorEvent.Type.AfterClose:this._textEditor=null,this._updateProperties();break;case IFEditor.InlineEditorEvent.Type.SelectionChanged:this._updateProperties()}},e.prototype._updateProperties=function(){var t=this._textEditor?this._textEditor:IFElementEditor.getEditor(this._text[0]);this._panel.find('button[data-property^="va"]').each(function(e,n){var o=$(n),i=!(!this._textEditor||!this._textEditor.isInlineEdit());o.prop("disabled",i).toggleClass("g-active",!i&&o.attr("data-property")==="va-"+t.getProperty("va"))}.bind(this)),this._panel.find('input[data-property="ah"]').prop("disabled",this._textEditor&&this._textEditor.isInlineEdit()).prop("checked",t.getProperty("ah")),this._panel.find('input[data-property="aw"]').prop("disabled",this._textEditor&&this._textEditor.isInlineEdit()).prop("checked",t.getProperty("aw"));var e=t.getProperty("ff",!0);this._panel.find('select[data-property="ff"]').val(t.getProperty("ff")),this._panel.find('input[data-property="fi"]').val(this._document.getScene().pointToString(t.getProperty("fi")));var n=this._panel.find('select[data-property="fw"]');n.val(t.getProperty("fw"));for(var o=ifFont.getWeights(e),i=100;i<=900;i+=100)n.find('[value="'+i+'"]').prop("disabled",!o||o.indexOf(i)<0);var a=this._panel.find('select[data-property="fs"]');a.val(t.getProperty("fs"));var r=ifFont.getStyles(e);a.find("option").each(function(t,e){var n=$(e),o=n.attr("value");""!==o&&n.prop("disabled",r.indexOf(o)<0)}),this._panel.find('input[data-property="ws"]').val(this._document.getScene().pointToString(t.getProperty("ws"))),this._panel.find('input[data-property="cs"]').val(this._document.getScene().pointToString(t.getProperty("cs"))),this._panel.find('input[data-property="cc"]').val(t.getProperty("cc")),this._panel.find('input[data-property="cg"]').val(this._document.getScene().pointToString(t.getProperty("cg")));var s=t.getProperty("al")||"";this._panel.find('button[data-property^="al"]').each(function(t,e){var n=$(e);n.toggleClass("g-active",n.attr("data-property")==="al-"+s)}),this._panel.find('select[data-property="wm"]').val(t.getProperty("wm")),this._panel.find('input[data-property="in"]').val(this._document.getScene().pointToString(t.getProperty("in")));var p=t.getProperty("lh");this._panel.find('input[data-property="lh"]').val(null!==p?ifUtil.formatNumber(p):"")},e.prototype._assignProperty=function(t,e){this._assignProperties([t],[e])},e.prototype._assignProperties=function(t,e){if(this._textEditor)this._textEditor.setProperties(t,e);else{var n=this._document.getEditor();n.beginTransaction();try{for(var o=0;o<this._text.length;++o){IFElementEditor.getEditor(this._text[o]).setProperties(t,e)}}finally{n.commitTransaction("Modify Text Properties")}}},e.prototype.toString=function(){return"[Object GTextProperties]"},t.GTextProperties=e}(this),function(t){function e(){this._slices=[]}IFObject.inherit(e,GProperties),e.prototype._panel=null,e.prototype._document=null,e.prototype._slices=null,e.prototype.getCategory=function(){return"Slice"},e.prototype.init=function(t,e){this._panel=t;var n=function(t){var e=this;if("cls"===t)return $("<button></button>").attr("data-property",t).gColorButton({allowClear:!0}).on("colorchange",function(n,o){e._assignProperty(t,o)});if("trm"===t)return $("<input>").attr("type","checkbox").attr("data-property",t).on("change",function(){e._assignProperty(t,$(this).is(":checked"))});throw new Error("Unknown input property: "+t)}.bind(this);t.css("width","120px").append($("<label></label>").css({position:"absolute",top:"5px",left:"5px"}).text("Color:").append(n("cls").css({"margin-left":"3px"}))).append($("<label></label>").css({position:"absolute",top:"30px",left:"5px"}).append(n("trm")).append($("<span></span>").text(" Trim Transparent")))},e.prototype.update=function(t,e){this._document&&(this._document.getScene().removeEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),this._document=null),this._slices=[];for(var n=0;n<e.length;++n)e[n]instanceof IFSlice&&this._slices.push(e[n]);return this._slices.length===e.length&&(this._document=t,this._document.getScene().addEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),this._updateProperties(),!0)},e.prototype._afterPropertiesChange=function(t){this._slices.length>0&&this._slices[0]===t.node&&this._updateProperties()},e.prototype._updateProperties=function(){var t=this._document.getScene(),e=this._slices[0];this._panel.find('[data-property="cls"]').gColorButton("value",e.getProperty("cls")).gColorButton("scene",t),this._panel.find('input[data-property="trm"]').prop("checked",e.getProperty("trm"))},e.prototype._assignProperty=function(t,e){this._assignProperties([t],[e])},e.prototype._assignProperties=function(t,e){var n=this._document.getEditor();n.beginTransaction();try{for(var o=0;o<this._slices.length;++o)this._slices[o].setProperties(t,e)}finally{n.commitTransaction("Modify Slice Properties")}},e.prototype.toString=function(){return"[Object GSliceProperties]"},t.GSliceProperties=e}(this),function(t){var e=null;function n(t){if(e){var n=$(t).data("page");if(n&&(n!==e||ifPlatform.modifiers.shiftKey))return e.getParent()===n.getParent()}return!1}function o(){GSidebar.call(this)}IFObject.inherit(o,GSidebar),o.ID="pages-layers",o.TITLE=new IFLocale.Key(o,"title"),o.prototype._pagesPanel=null,o.prototype._pageAddControl=null,o.prototype._pageDeleteControl=null,o.prototype._layersTree=null,o.prototype._layersTreeNodeMap=null,o.prototype._layerAddControl=null,o.prototype._layerDeleteControl=null,o.prototype.getId=function(){return o.ID},o.prototype.getTitle=function(){return o.TITLE},o.prototype.getIcon=function(){return'<span class="fa fa-fw fa-bars"></span>'},o.prototype.init=function(t){GSidebar.prototype.init.call(this,t),this._pagesPanel=$("<div></div>").addClass("pages"),this._pageAddControl=$("<button></button>").attr("title","Add Page").on("click",function(){gApp.executeAction(GAddPageAction.ID)}.bind(this)).append($("<span></span>").addClass("fa fa-plus")),this._pageDeleteControl=$("<button></button>").attr("title","Delete Page").on("click",function(){gApp.executeAction(GDeletePageAction.ID)}.bind(this)).append($("<span></span>").addClass("fa fa-trash-o")),$("<div></div>").gPanel({title:"Pages",content:this._pagesPanel,controls:[this._pageAddControl,this._pageDeleteControl]}).appendTo(t),this._layersTree=$("<div></div>").addClass("layers").tree({data:[],dragAndDrop:!0,openFolderDelay:500,closedIcon:$('<span class="fa fa-caret-right"></span>'),openedIcon:$('<span class="fa fa-caret-down"></span>'),slide:!1,selectable:!1,onIsMoveHandle:function(t){return t.is(".jqtree-title")},onCreateLi:this._createLayerTreeItem.bind(this),onCanMoveTo:this._canMoveLayerTreeNode.bind(this)}).on("tree.open",function(t){t.node.layerOrItem&&t.node.layerOrItem.setFlag(IFNode.Flag.Expanded)}.bind(this)).on("tree.close",function(t){t.node.layerOrItem&&t.node.layerOrItem.removeFlag(IFNode.Flag.Expanded)}.bind(this)).on("tree.click",this._clickLayerTreeNode.bind(this)).on("tree.move",this._moveLayerTreeNode.bind(this)),this._layerAddControl=$("<button></button>").attr("title","Add Layer").on("click",function(){gApp.executeAction(GAddLayerAction.ID)}.bind(this)).append($("<span></span>").addClass("fa fa-plus")),this._layerDeleteControl=$("<button></button>").attr("title","Delete Layer").on("click",function(){gApp.executeAction(GDeleteLayerAction.ID)}.bind(this)).append($("<span></span>").addClass("fa fa-trash-o")),$("<div></div>").gPanel({title:"Layers",content:this._layersTree,controls:[this._layerAddControl,this._layerDeleteControl]}).appendTo(t)},o.prototype._documentEvent=function(t){if(t.type===GApplication.DocumentEvent.Type.Activated)this._document=t.document,(e=this._document.getScene()).addEventListener(IFNode.AfterInsertEvent,this._afterNodeInsert,this),e.addEventListener(IFNode.BeforeRemoveEvent,this._beforeNodeRemove,this),e.addEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),e.addEventListener(IFNode.AfterFlagChangeEvent,this._afterFlagChange,this),e.addEventListener(IFScene.ReferenceEvent,this._referenceEvent,this),this._clear();else if(t.type===GApplication.DocumentEvent.Type.Deactivated){var e=this._document.getScene();this._document=null,e.removeEventListener(IFNode.AfterInsertEvent,this._afterNodeInsert,this),e.removeEventListener(IFNode.BeforeRemoveEvent,this._beforeNodeRemove,this),e.removeEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),e.removeEventListener(IFNode.AfterFlagChangeEvent,this._afterFlagChange,this),e.removeEventListener(IFScene.ReferenceEvent,this._referenceEvent,this),this._clear()}},o.prototype._clear=function(){this._clearLayers(),this._clearPages()},o.prototype._clearPages=function(){if(this._pagesPanel.empty(),this._document)for(var t=this._document.getScene().getFirstChild();null!==t;t=t.getNext())t instanceof IFPage&&this._insertPage(t)},o.prototype._insertPage=function(t){var o=null;t.getNext()&&this._pagesPanel.find(".page-block").each(function(e,n){var i=$(n);if(i.data("page")===t.getNext())return o=i,!1});var i=$("<div></div>").addClass("page-block").data("page",t).attr("draggable","true").append($("<div></div>").addClass("page-visibility").attr("title","Toggle Page Visibility").on("click",function(e){e.stopPropagation(),IFEditor.tryRunTransaction(t,function(){t.setProperty("visible",!t.getProperty("visible"))},"Toggle Page Visibility")}).append($("<span></span>").addClass("fa fa-fw"))).append($("<div></div>").addClass("page-lock").attr("title","Toggle Page Lock").on("click",function(e){e.stopPropagation(),IFEditor.tryRunTransaction(t,function(){t.setProperty("locked",!t.getProperty("locked"))},"Toggle Page Lock")}).append($("<span></span>").addClass("fa fa-fw"))).append($("<div></div>").addClass("page-name").gAutoEdit({}).on("submitvalue",function(e,n){n&&""!==n.trim()&&IFEditor.tryRunTransaction(t,function(){t.setProperty("name",n)},"Rename Page")})).append($("<div></div>").addClass("page-master").append($("<span></span>").addClass("fa fa-fw"))).on("mousedown",function(){}).on("click",function(){t.getScene().setActivePage(t)}).on("dragstart",function(t){var o=$(this),i=t.originalEvent;i.stopPropagation(),e=o.data("page"),i.dataTransfer.effectAllowed="move",i.dataTransfer.setData("text/plain","dummy_data"),o.closest(".pages").find(".page-block").each(function(t,o){$(o).append($("<div></div>").addClass("drag-overlay").on("dragenter",function(t){n(this.parentNode)&&$(this).parent().addClass("drop")}).on("dragleave",function(t){n(this.parentNode)&&$(this).parent().removeClass("drop")}).on("dragover",function(t){var e=t.originalEvent;n(this.parentNode)&&(e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="move")}).on("drop",function(t){$(this);var n=$(this.parentNode);n.removeClass("drop"),n.closest(".pages").find(".drag-overlay").remove();var o=n.data("page");if(e&&e.getParent()===o.getParent()){var i=e.getParent(),a=i.getIndexOfChild(e),r=i.getIndexOfChild(o);IFEditor.tryRunTransaction(i,function(){if(ifPlatform.modifiers.shiftKey){var t=e.getScene().getPageInsertPosition(),n=e.clone();n.setProperties(["x","y","name"],[t.getX(),t.getY(),n.getProperty("name")+"-copy"]),i.insertChild(n,a<r?o.getNext():o)}else i.removeChild(e),i.insertChild(e,a<r?o.getNext():o)},ifPlatform.modifiers.shiftKey?"Duplicate Page":"Move Page")}}))})}).on("dragend",function(t){var n=$(this);t.originalEvent.stopPropagation(),n.closest(".pages").find(".drag-overlay").remove(),e=null});o&&o.length>0?i.insertBefore(o):i.appendTo(this._pagesPanel),this._updatePage(t)},o.prototype._updatePage=function(t){var e=t.getProperty("visible"),n=t.getProperty("locked");this._pagesPanel.find(".page-block").each(function(o,i){var a=$(i);if(a.data("page")===t){a.toggleClass("g-active",t.hasFlag(IFNode.Flag.Active)),a.toggleClass("g-selected",t.hasFlag(IFNode.Flag.Selected)),a.find(".page-visibility").toggleClass("page-default",e)
/*!!*/.find("> span").toggleClass("fa-eye",e).toggleClass("fa-eye-slash",!e),a.find(".page-lock").toggleClass("page-default",!n)
/*!!*/.find("> span").toggleClass("fa-lock",n).toggleClass("fa-unlock",!n),a.find(".page-name").text(t.getProperty("name"));var r=t.getScene().linkCount(t),s=t.getMasterPage(),p="";return r&&(p="Master of "+r.toString()+" pages:",t.getScene().visitLinks(t,function(t){p+="\n"+t.getLabel()})),s&&(""!==p&&(p+="\n\n"),p+="Slave of "+s.getLabel()),a.find(".page-master").css("display",s||r>0?"":"none")
/*!!*/.find("> span").attr("title",p).toggleClass("fa-link",!!s&&0===r).toggleClass("fa-crosshairs",r>0),!1}})},o.prototype._removePage=function(t){this._pagesPanel.find(".page-block").each(function(e,n){var o=$(n);if(o.data("page")===t)return o.remove(),!1})},o.prototype._clearLayers=function(){if(this._layersTree.tree("loadData",[]),this._layersTree.tree("getTree").is_open=!0,this._layersTreeNodeMap=[],this._document){var t=this._document.getScene().getActivePage();if(t)for(var e=t.getFirstChild();null!==e;e=e.getNext())e instanceof IFLayer&&this._insertLayer(e)}},o.prototype._insertLayer=function(t){var e=ifUtil.uuid(),n=t.getNext()?this._getLayerTreeNode(t.getNext()):null;if(n)this._layersTree.tree("addNodeBefore",{id:e,layerOrItem:t},n);else{var o=t.getParent(),i=!o||o instanceof IFPage?null:this._getLayerTreeNode(o);this._layersTree.tree("appendNode",{id:e,layerOrItem:t},i)}if(this._layersTreeNodeMap.push({node:t,treeId:e}),this._updateLayer(t),t.hasMixin(IFNode.Container))for(var a=t.getFirstChild();null!==a;a=a.getNext())(a instanceof IFLayer||a instanceof IFItem)&&this._insertLayer(a);var r=this._getLayerTreeNode(t);t instanceof IFItem&&t.hasFlag(IFNode.Flag.Selected)&&this._layersTree.tree("selectNode",r),t.hasFlag(IFNode.Flag.Expanded)&&this._layersTree.tree("openNode",r,!1)},o.prototype._updateLayer=function(t){var e=this._getLayerTreeNode(t);if(e){var n=t.getLabel();t instanceof IFLayer&&t.getProperty("tp")===IFLayer.Type.Draft&&(n="*"+n),this._layersTree.tree("updateNode",e,n)}},o.prototype._removeLayer=function(t){var e=this._getLayerTreeNode(t);e&&(this._layersTree.tree("removeNode",e),t.accept(function(t){if(t instanceof IFLayer||t instanceof IFItem)for(var e=0;e<this._layersTreeNodeMap.length;++e)if(this._layersTreeNodeMap[e].node===t){this._layersTreeNodeMap.splice(e,1);break}}.bind(this)))},o.prototype._afterNodeInsert=function(t){if(t.node instanceof IFPage)this._insertPage(t.node);else if(t.node instanceof IFLayer||t.node instanceof IFItem){var e=this._document.getScene().getActivePage();t.node.getPage()===e&&this._insertLayer(t.node)}},o.prototype._beforeNodeRemove=function(t){if(t.node instanceof IFPage)this._removePage(t.node);else if(t.node instanceof IFLayer||t.node instanceof IFItem){this._removeLayer(t.node);var e=t.node.getParent();if(e instanceof IFLayer||e instanceof IFItem){for(var n=!1,o=e.getFirstChild();null!==o;o=o.getNext())if((o instanceof IFLayer||o instanceof IFItem)&&o!==t.node){n=!0;break}n||(e.removeFlag(IFNode.Flag.Expanded),this._updateLayer(e))}}},o.prototype._afterPropertiesChange=function(t){t.node instanceof IFPage?this._updatePage(t.node):(t.node instanceof IFLayer||t.node instanceof IFItem)&&this._updateLayer(t.node)},o.prototype._afterFlagChange=function(t){t.node instanceof IFPage&&(t.flag===IFNode.Flag.Active||t.flag===IFNode.Flag.Selected)?(this._pagesPanel.find(".page-block").each(function(e,n){var o=$(n);o.data("page")===t.node&&o.toggleClass(t.flag===IFNode.Flag.Active?"g-active":"g-selected",t.set)}),t.flag===IFNode.Flag.Active&&this._clearLayers()):t.node instanceof IFLayer&&(t.flag===IFNode.Flag.Active||t.flag===IFNode.Flag.Selected||t.flag===IFNode.Flag.Expanded)||t.node instanceof IFItem&&t.flag===IFNode.Flag.Selected?this._updateLayer(t.node):!(t.node instanceof IFLayer||t.node instanceof IFItem)||t.flag!==IFElement.Flag.Hidden&&t.flag!==IFElement.Flag.Locked||this._updateLayer(t.node)},o.prototype._referenceEvent=function(t){t.reference instanceof IFPage&&this._updatePage(t.reference)},o.prototype._clickLayerTreeNode=function(t){t.node.layerOrItem&&(t.node.layerOrItem instanceof IFLayer?this._document.getScene().setActiveLayer(t.node.layerOrItem):t.node.layerOrItem instanceof IFItem&&(ifPlatform.modifiers.shiftKey||!t.node.layerOrItem.hasFlag(IFNode.Flag.Selected)?this._document.getEditor().updateSelection(ifPlatform.modifiers.shiftKey,[t.node.layerOrItem]):t.node.layerOrItem.hasFlag(IFNode.Flag.Selected)&&this._document.getEditor().clearSelection([t.node.layerOrItem])))},o.prototype._createLayerTreeItem=function(t,e){if(t.layerOrItem){for(var n=t.layerOrItem,o=0,i=!1,a=!1,r=!1,s=n.getParent();null!==s&&!(s instanceof IFPage);s=s.getParent())i=!1===s.getProperty("visible")||i,a=!0===s.getProperty("locked")||a,s instanceof IFLayer&&(r=!0===s.getProperty("otl")||r),o+=1;var p=i||!1===n.getProperty("visible"),l=a||!0===n.getProperty("locked"),c=r||n instanceof IFLayer&&n.getProperty("otl"),d=e.find("div.jqtree-element"),u=d.find("> .jqtree-title");d.toggleClass("g-active",n.hasFlag(IFNode.Flag.Active)).toggleClass("g-selected",n.hasFlag(IFNode.Flag.Selected)).gAutoEdit({selector:"> .jqtree-title"}).on("submitvalue",function(t,e){e&&""!==e.trim()&&IFEditor.tryRunTransaction(n,function(){n.setProperty("name",e)},"Rename Layer/Item")});for(var g=0;g<o;++g)$("<span></span>").addClass("layer-spacer").prependTo(d);var h=null;n instanceof IFLayer?h=n.hasFlag(IFNode.Flag.Expanded)?"folder-open":"folder":n instanceof IFSlice?h="crop":n instanceof IFShape&&(n instanceof IFText?h="font":n instanceof IFImage?h="image":n instanceof IFEllipse?h="circle":n instanceof IFRectangle?h="stop":n instanceof IFPath?h="pencil":n instanceof IFPolygon&&(h="star")),h&&$("<span></span>").addClass("layer-icon fa fa-"+h).insertBefore(u),$("<span></span>").addClass("layer-lock fa fa-fw fa-"+(l?"lock":"unlock")).toggleClass("layer-default",!l).attr("title","Toggle Lock").on("click",function(t){t.stopPropagation(),a||IFEditor.tryRunTransaction(n,function(){n.setProperty("locked",!n.getProperty("locked"))},"Toggle Layer Locked")}).prependTo(d);$("<span></span>").addClass("layer-visibility fa fa-"+(p?"eye-slash":"eye")).toggleClass("layer-default",!p).attr("title","Toggle Visibility").on("click",function(t){if(t.stopPropagation(),!i){var e=!n.getProperty("visible");e||n.removeFlag(IFNode.Flag.Highlighted),IFEditor.tryRunTransaction(n,function(){n.setProperty("visible",e)},"Toggle Layer Visibility"),e&&n.setFlag(IFNode.Flag.Highlighted)}}).on("mouseenter",function(t){n.hasFlag(IFElement.Flag.Hidden)||n.setFlag(IFNode.Flag.Highlighted)}).on("mouseleave",function(t){n.hasFlag(IFElement.Flag.Hidden)||n.removeFlag(IFNode.Flag.Highlighted)}).prependTo(d);n instanceof IFLayer&&(n.getProperty("tp")!==IFLayer.Type.Guide&&$("<span></span>").addClass("layer-outline fa fa-"+(c?"circle-o":"circle")).toggleClass("layer-default",!c).attr("title","Toggle Outline").on("click",function(t){t.stopPropagation(),i||IFEditor.tryRunTransaction(n,function(){n.setProperty("otl",!n.getProperty("otl"))},"Toggle Layer Outline")}).appendTo(d),$("<span></span>").addClass("layer-color").gColorButton({scene:this._document.getScene(),immediateClose:!0}).gColorButton("value",n.getProperty("cls")).removeClass("g-input").on("click",function(t){t.stopPropagation()}).on("colorchange",function(t,e){IFEditor.tryRunTransaction(n,function(){var t=n.getProperty("cls");n.setProperty("cls",e),n.acceptChildren(function(n){if(n instanceof IFLayer){var o=n.getProperty("cls");IFColor.equals(o,t)&&n.setProperty("cls",e)}})},"Change Layer Color")}).appendTo(d))}},o.prototype._canMoveLayerTreeNode=function(t,e,n){return null!==this._getLayerTreeNodeMoveInfo(n,t.layerOrItem,e.layerOrItem)},o.prototype._moveLayerTreeNode=function(t){t.preventDefault();var e=this._getLayerTreeNodeMoveInfo(t.move_info.position,t.move_info.moved_node.layerOrItem,t.move_info.target_node.layerOrItem);e&&IFEditor.tryRunTransaction(this._document.getScene(),function(){e.source.getParent().removeChild(e.source),e.parent.insertChild(e.source,e.before);for(var t=null,n=e.parent;null!==n&&!(n instanceof IFPage);n=n.getParent())n.setFlag(IFNode.Flag.Expanded),t=n;this._updateLayer(t)}.bind(this),"Move Layer/Item")},o.prototype._getLayerTreeNodeMoveInfo=function(t,e,n){if(n=n||this._document.getScene().getActivePage(),e&&n&&"none"!==t){var o=null,i=null;if("inside"===t?(o=n,i=n.getFirstChild()):"before"===t?n instanceof IFPage?(o=n,i=n.getFirstChild()):(o=n.getParent(),i=n):"after"==t&&(n instanceof IFPage?(o=n,i=null):(o=n.getParent(),i=n.getNext())),i===e)return null;if(e.validateInsertion(o,i))return{parent:o,before:i,source:e}}return null},o.prototype._getLayerTreeNodeId=function(t){if(this._layersTreeNodeMap)for(var e=0;e<this._layersTreeNodeMap.length;++e)if(this._layersTreeNodeMap[e].node===t)return this._layersTreeNodeMap[e].treeId},o.prototype._getLayerTreeNode=function(t){return this._layersTree.tree("getNodeById",this._getLayerTreeNodeId(t))},o.prototype.toString=function(){return"[Object GPagesLayersSidebar]"},t.GPagesLayersSidebar=o}(this),function(t){function e(){GSidebar.call(this)}IFObject.inherit(e,GSidebar),e.ID="swatches-layers",e.TITLE=new IFLocale.Key(e,"title"),e.prototype._stylePanel=null,e.prototype._swatchPanel=null,e.prototype._swatchDeleteControl=null,e.prototype.getId=function(){return e.ID},e.prototype.getTitle=function(){return e.TITLE},e.prototype.getIcon=function(){return'<span class="fa fa-fw fa-leaf"></span>'},e.prototype.init=function(t){GSidebar.prototype.init.call(this,t),this._stylePanel=$("<div></div>").addClass("g-style-list").gStylePanel({allowNameEdit:!0,placeholder:"No Shared Styles"}).on("stylechange",function(t,e){this._document.getScene().getStyleCollection().acceptChildren(function(t){t.removeFlag(IFNode.Flag.Selected)}),e&&e.setFlag(IFNode.Flag.Selected),this._updateStyleControls()}.bind(this)),$("<div></div>").gPanel({title:"Shared Styles",content:this._stylePanel}).appendTo(t),this._swatchPanel=$("<div></div>").addClass("g-swatch-list").gSwatchPanel({allowNameEdit:!0,placeholder:"Drop Swatches here"}).on("swatchchange",function(t,e){this._document.getScene().getSwatchCollection().acceptChildren(function(t){t.removeFlag(IFNode.Flag.Selected)}),e&&e.setFlag(IFNode.Flag.Selected),this._updateSwatchControls()}.bind(this)),this._swatchDeleteControl=$("<button></button>").attr("title","Delete Selected Swatch").on("click",function(){var t=this._swatchPanel.gSwatchPanel("value"),e=this._document.getEditor();e.beginTransaction();try{t.getParent().removeChild(t)}finally{e.commitTransaction("Delete Swatch")}}.bind(this)).append($("<span></span>").addClass("fa fa-trash-o")),this._updateStyleControls(),this._updateSwatchControls(),$("<div></div>").gPanel({title:"Swatches",content:this._swatchPanel,controls:[this._swatchDeleteControl]}).appendTo(t)},e.prototype._documentEvent=function(t){if(t.type===GApplication.DocumentEvent.Type.Activated){this._document=t.document;var e=this._document.getScene();this._stylePanel.gStylePanel("attach",e.getStyleCollection()),this._stylePanel.gStylePanel("value",e.getStyleCollection().querySingle("sharedStyle:selected")),this._swatchPanel.gSwatchPanel("attach",e.getSwatchCollection()),this._swatchPanel.gSwatchPanel("value",e.getSwatchCollection().querySingle("swatch:selected")),this._updateStyleControls(),this._updateSwatchControls()}else if(t.type===GApplication.DocumentEvent.Type.Deactivated){e=this._document.getScene();this._document=null,this._stylePanel.gStylePanel("detach"),this._swatchPanel.gSwatchPanel("detach"),this._updateStyleControls(),this._updateSwatchControls()}},e.prototype._updateStyleControls=function(){this._stylePanel.gStylePanel("value")},e.prototype._updateSwatchControls=function(){var t=this._swatchPanel.gSwatchPanel("value");this._swatchDeleteControl.prop("disabled",!t)},e.prototype.toString=function(){return"[Object GStylesSwatchesSidebar]"},t.GStylesSwatchesSidebar=e}(this),function(t){function e(){}IFObject.inherit(e,GStyleEntry);var n=new IFGradient([{position:0,color:IFColor.BLACK},{position:100,color:IFColor.WHITE}]);e.prototype.createContent=function(t,e,n){return $("<div></div>").addClass("g-form").append($("<div></div>").append($("<div></div>").css("width","100%").append($("<select></select>").attr("data-element","type").append($("<option></option>").attr("value",IFPattern.Type.Color).text("Color")).append($("<optgroup></optgroup>").attr("label","Gradient").append($("<option></option>").attr("value",IFPattern.Type.Gradient+"#"+IFGradient.Type.Linear).text("Linear")).append($("<option></option>").attr("value",IFPattern.Type.Gradient+"#"+IFGradient.Type.Radial).text("Radial"))).on("change",function(t){e()})).append($("<button></button>").attr("data-element","color").gColorButton({scene:t}).on("colorchange",function(t){e()}))).append($("<div></div>").append($("<select></select>").attr("data-property","blm").gBlendMode().on("change",function(t){e()})).append($("<input>").attr("data-property","opc").css("width","3em").on("change",function(t){null!==IFLength.parseEquationValue($(t.target).val())?e():n()})))).append($("<div></div>").css("width","100%").attr("data-element","gradient").append($("<div></div>").css("width","100%").css("display","block").append($("<div></div>").css("width","100%").gGradientEditor({scene:t}).on("change",function(t){e()}))))},e.prototype.updateProperties=function(t,e,o){var i=e.getProperty("pat"),a=i?i.getPatternType():null,r=null;a===IFPattern.Type.Gradient&&(r=i.getType()),t.find('[data-element="type"]').val(r?a+"#"+r:a),t.find('[data-element="color"]').gColorButton("value",a===IFPattern.Type.Color?i:IFColor.BLACK).css("display",a===IFPattern.Type.Color?"":"none"),t.find('[data-property="blm"]').val(e.getProperty("blm")),t.find('[data-property="opc"]').val(ifUtil.formatNumber(100*e.getProperty("opc"))),a===IFPattern.Type.Gradient?(t.find('[data-element="gradient"]').css("display",""),t.find(".g-gradient-editor").gGradientEditor("value",i.getStops())):(t.find('[data-element="gradient"]').css("display","none"),t.find(".g-gradient-editor").gGradientEditor("value",n.getStops()))},e.prototype.assignProperties=function(t,e,n){var o=[],i=[];this._getPropertiesToAssign(t,e,n,o,i),e.setProperties(o,i)},e.prototype._getPropertiesToAssign=function(t,e,n,o,i){o.push("pat","blm","opc");var a=IFLength.parseEquationValue(t.find('[data-property="opc"]').val()),r=e.getProperty("pat"),s=r?r.getPatternType():null,p=null,l=t.find('[data-element="type"]').val(),c=null;if(l.indexOf("#")>=0){var d=l.split("#");l=d[0],c=d[1]}l===IFPattern.Type.Color?p=s===IFPattern.Type.Gradient?r.getStops()[0].color:t.find('[data-element="color"]').gColorButton("value"):l===IFPattern.Type.Gradient&&(p=s===IFPattern.Type.Color?new IFGradient([{position:0,color:r},{position:100,color:IFColor.WHITE}],c):new IFGradient(t.find(".g-gradient-editor").gGradientEditor("value"),c)),i.push(p,t.find('[data-property="blm"]').val(),(a<0?0:a>100?100:a)/100)},e.prototype.toString=function(){return"[Object GPatternPaintEntry]"},t.GPatternPaintEntry=e}(this),function(t){function e(){GPatternPaintEntry.call(this)}IFObject.inherit(e,GPatternPaintEntry),e.prototype.createContent=function(t,e,n){var o=GPatternPaintEntry.prototype.createContent.call(this,t,e,n);return $("<div></div>").attr("data-element","transform").append($("<div></div>").append($("<input>").attr("data-property","tx").css("width","3em").on("change",function(t){null!==IFLength.parseEquationValue($(t.target).val())?e():n()})).append($("<label></label>").text("X"))).append($("<div></div>").append($("<input>").attr("data-property","ty").css("width","3em").on("change",function(t){null!==IFLength.parseEquationValue($(t.target).val())?e():n()})).append($("<label></label>").text("Y"))).append($("<div></div>").append($("<input>").css("width","3em").attr("data-property","sx").on("change",function(t){var o=IFLength.parseEquationValue($(t.target).val());null!==o&&0!==o?e():n()})).append($("<label></label>").text("W"))).append($("<div></div>").append($("<input>").attr("data-property","sy").css("width","3em").on("change",function(t){var o=IFLength.parseEquationValue($(t.target).val());null!==o&&0!==o?e():n()})).append($("<label></label>").text("H"))).append($("<div></div>").append($("<input>").attr("data-property","rt").css("width","3em").on("change",function(t){null!==IFLength.parseEquationValue($(t.target).val())?e():n()})).append($("<label></label>").text("Â°"))).appendTo(o),o},e.prototype.updateProperties=function(t,e,n){GPatternPaintEntry.prototype.updateProperties.call(this,t,e,n);var o=e.getProperty("pat"),i=o?o.getPatternType():null,a=t.find('[data-element="transform"]');i!==IFPattern.Type.Color?(a.css("display",""),a.find('[data-property="tx"]').val(ifUtil.formatNumber(100*e.getProperty("tx"))),a.find('[data-property="ty"]').val(ifUtil.formatNumber(100*e.getProperty("ty"))),a.find('[data-property="sx"]').val(ifUtil.formatNumber(100*e.getProperty("sx"))),a.find('[data-property="sy"]').val(ifUtil.formatNumber(100*e.getProperty("sy"))).closest("div").css("display",o.getType()===IFGradient.Type.Linear?"none":""),a.find('[data-property="rt"]').val(ifUtil.formatNumber(ifMath.toDegrees(e.getProperty("rt")),2))):a.css("display","none")},e.prototype._getPropertiesToAssign=function(t,e,n,o,i){GPatternPaintEntry.prototype._getPropertiesToAssign.call(this,t,e,n,o,i),o.push("tx","ty","sx","sy","rt");var a=null!==(a=IFLength.parseEquationValue(t.find('[data-property="tx"]').val()))?a/100:0,r=null!==(r=IFLength.parseEquationValue(t.find('[data-property="ty"]').val()))?r/100:0,s=null!==(s=IFLength.parseEquationValue(t.find('[data-property="sx"]').val()))?s/100:1,p=null!==(p=IFLength.parseEquationValue(t.find('[data-property="sy"]').val()))?p/100:1,l=null!==(l=IFLength.parseEquationValue(t.find('[data-property="rt"]').val()))?ifMath.normalizeAngleRadians(ifMath.toRadians(l)):0,c=e.getProperty("pat"),d=c?c.getPatternType():null,u=t.find('[data-element="type"]').val(),g=null;if(u.indexOf("#")>=0){var h=u.split("#");u=h[0],g=h[1]}if(u===IFPattern.Type.Color)a=0,r=0,s=1,p=1,l=0;else if(u===IFPattern.Type.Gradient){if(d!==IFPattern.Type.Gradient||c.getType()!==g)if(g===IFGradient.Type.Linear)s=1,p=1,a=.5,r=.5,l=ifMath.toRadians(90);else{if(g!==IFGradient.Type.Radial)throw new Error("Unsupported Gradient Type");s=1,p=1,a=.5,r=.5,l=0}d===IFPattern.Type.Color?new IFGradient([{position:0,color:c},{position:100,color:IFColor.WHITE}],g):new IFGradient(t.find(".g-gradient-editor").gGradientEditor("value"),g)}i.push(a,r,s,p,l)},e.prototype.toString=function(){return"[Object GAreaPaintEntry]"},t.GAreaPaintEntry=e}(this),function(t){function e(){GAreaPaintEntry.call(this)}IFObject.inherit(e,GAreaPaintEntry),e.prototype.getEntryClass=function(){return IFFillPaint},e.prototype.getEntryName=function(){return"Fill"},e.prototype.createContent=function(t,e,n){return GAreaPaintEntry.prototype.createContent.call(this,t,e,n)},e.prototype.updateProperties=function(t,e,n){GAreaPaintEntry.prototype.updateProperties.call(this,t,e,n)},e.prototype.toString=function(){return"[Object GFillPaintEntry]"},t.GFillPaintEntry=e}(this),function(t){function e(){GAreaPaintEntry.call(this)}IFObject.inherit(e,GAreaPaintEntry),e.prototype.getEntryClass=function(){return IFStrokePaint},e.prototype.getEntryName=function(){return"Stroke"},e.prototype.createContent=function(t,e,n){var o=GAreaPaintEntry.prototype.createContent.call(this,t,e,n);return $("<div></div>").attr("data-element","stroke-settings").css("display","none").append($("<div></div>").append($("<select></select>").attr("data-property","slc").append($("<option></option>").attr("value",IFPaintCanvas.LineCap.Butt).text("Butt")).append($("<option></option>").attr("value",IFPaintCanvas.LineCap.Round).text("Round")).append($("<option></option>").attr("value",IFPaintCanvas.LineCap.Square).text("Square")).on("change",function(t){e()})).append($("<label></label>").text("Caption"))).append($("<div></div>").append($("<select></select>").attr("data-property","slj").append($("<option></option>").attr("value",IFPaintCanvas.LineJoin.Miter).text("Miter")).append($("<option></option>").attr("value",IFPaintCanvas.LineJoin.Bevel).text("Bevel")).append($("<option></option>").attr("value",IFPaintCanvas.LineJoin.Round).text("Round")).on("change",function(t){e()})).append($("<label></label>").text("Join"))).append($("<div></div>").append($("<input>").css("width","5em").attr("data-property","slm").on("change",function(o){var i=t.stringToPoint($(this).val());null!==i&&"number"==typeof i&&i>=0?e():n()})).append($("<label></label>").text("Miter"))).prependTo(o),$("<div></div>").append($("<div></div>").append($("<input>").attr("data-property","sw").css("width","5em").on("change",function(o){var i=t.stringToPoint($(this).val());null!==i&&"number"==typeof i&&i>0?e():n()})).append($("<label></label>").text("Stroke"))).append($("<div></div>").append($("<select></select>").attr("data-property","sa").append($("<option></option>").attr("value",IFStrokePaint.Alignment.Center).text("Center")).append($("<option></option>").attr("value",IFStrokePaint.Alignment.Inside).text("Inside")).append($("<option></option>").attr("value",IFStrokePaint.Alignment.Outside).text("Outside")).on("change",function(t){e()})).append($("<label></label>").text("Align"))).append($("<div></div>").css("width","100%").css("text-align","right").append($("<button></button>").css("margin-right","0px").attr("data-element","more").on("click",function(t){var e=$(this),n=e.hasClass("g-active");e.toggleClass("g-active",!n),e.closest(".g-form").find('[data-element="stroke-settings"]').css("display",n?"none":"")}).append($("<span></span>").addClass("fa fa-cog"))).append($("<label>&nbsp;</label>"))).prependTo(o),o},e.prototype.updateProperties=function(t,e,n){GAreaPaintEntry.prototype.updateProperties.call(this,t,e,n),t.find('[data-property="sw"]').val(n.pointToString(e.getProperty("sw"))),t.find('[data-property="sa"]').val(e.getProperty("sa")),t.find('[data-property="slc"]').val(e.getProperty("slc")),t.find('[data-property="slj"]').val(e.getProperty("slj")),t.find('[data-property="slm"]').val(n.pointToString(e.getProperty("slm")))},e.prototype._getPropertiesToAssign=function(t,e,n,o,i){GAreaPaintEntry.prototype._getPropertiesToAssign.call(this,t,e,n,o,i),o.push("sw","sa","slc","slj","slm"),i.push(n.stringToPoint(t.find('[data-property="sw"]').val()),t.find('[data-property="sa"]').val(),t.find('[data-property="slc"]').val(),t.find('[data-property="slj"]').val(),n.stringToPoint(t.find('[data-property="slm"]').val()))},e.prototype.toString=function(){return"[Object GStrokePaintEntry]"},t.GStrokePaintEntry=e}(this),function(t){function e(){}IFObject.inherit(e,GStyleEntry),e.prototype.getEntryClass=function(){return IFBlurFilter},e.prototype.getEntryName=function(){return"Blur"},e.prototype.createContent=function(t,e,n){return $("<div></div>").addClass("g-form").append($("<div></div>").append($("<div></div>").text("Blur")).append($("<div></div>").css("width","100%").append($("<input>").css("width","100%").attr("type","range").attr("min","0").attr("max","50").attr("data-property","r").on("input",function(t){var n=$(this);n.parents(".g-form").find('[data-property="r"]:not([type="range"])').val(n.val()),e()}))).append($("<div></div>").append($("<input>").css("width","3em").attr("data-property","r").on("change",function(o){var i=t.stringToPoint($(this).val());null!==i&&"number"==typeof i&&i>=0?e():n()}))))},e.prototype.updateProperties=function(t,e,n){t.find('[data-property="r"]').val(n.pointToString(e.getProperty("r")))},e.prototype.assignProperties=function(t,e,n){e.setProperties(["r"],[n.stringToPoint(t.find('[data-property="r"]:not([type="range"])').val())])},e.prototype.toString=function(){return"[Object GBlurFilterEntry]"},t.GBlurFilterEntry=e}(this),function(t){function e(){}IFObject.inherit(e,GStyleEntry),e.prototype.getEntryClass=function(){return IFOffsetVEffect},e.prototype.getEntryName=function(){return"Offset"},e.prototype.createContent=function(t,e,n){return $("<div></div>").addClass("g-form").append($("<div></div>").append($("<div></div>").text("Offset")).append($("<div></div>").css("width","100%").append($("<input>").css("width","100%").attr("type","range").attr("min","0").attr("max","50").attr("data-property","r").on("input",function(t){var n=$(this);n.parents(".g-form").find('[data-property="r"]:not([type="range"])').val(n.val()),e()}))).append($("<div></div>").append($("<input>").css("width","3em").attr("data-property","r").on("change",function(o){var i=t.stringToPoint($(this).val());null!==i&&"number"==typeof i&&i>=0?e():n()}))).append($("<div></div>").append($("<select></select>").attr("data-property","tp").append($("<option></option>").attr("value",IFOffsetVEffect.OffsetType.Inset).text("Inset")).append($("<option></option>").attr("value",IFOffsetVEffect.OffsetType.Outset).text("Outset")).append($("<option></option>").attr("value",IFOffsetVEffect.OffsetType.Both).text("Both")).on("change",function(t){e()}))))},e.prototype.updateProperties=function(t,e,n){t.find('[data-property="r"]').val(n.pointToString(e.getProperty("r"))),t.find('[data-property="tp"]').val(e.getProperty("tp"))},e.prototype.assignProperties=function(t,e,n){e.setProperties(["r","tp"],[n.stringToPoint(t.find('[data-property="r"]:not([type="range"])').val()),t.find('[data-property="tp"]').val()])},e.prototype.toString=function(){return"[Object GOffsetVEffectEntry]"},t.GOffsetVEffectEntry=e}(this),function(t){function e(){}IFObject.inherit(e,GStyleEntry),e.prototype.getEntryClass=function(){return IFShadowEffect},e.prototype.getEntryName=function(){return"Shadow"},e.prototype.createContent=function(t,e,n){return $("<div></div>").addClass("g-form").append($("<div></div>").append($("<div></div>").append($("<div></div>").css("width","4.5em").addClass("g-switch").append($("<label></label>").append($("<input>").attr("type","checkbox").attr("data-property","in").on("change",function(){e()})).append($("<span></span>").addClass("switch").attr({"data-on":"Inside","data-off":"Outside"})))).append($("<label></label>").text("Shadow"))).append($("<div></div>").append($("<input>").css("width","3em").attr("data-property","x").on("change",function(o){var i=t.stringToPoint($(this).val());null!==i&&"number"==typeof i?e():n()})).append($("<label></label>").text("X"))).append($("<div></div>").append($("<input>").css("width","3em").attr("data-property","y").on("change",function(o){var i=t.stringToPoint($(this).val());null!==i&&"number"==typeof i?e():n()})).append($("<label></label>").text("Y"))).append($("<div></div>").append($("<input>").css("width","3em").attr("data-property","r").on("change",function(o){var i=t.stringToPoint($(this).val());null!==i&&"number"==typeof i&&i>=0?e():n()})).append($("<label></label>").text("Blur"))).append($("<div></div>").append($("<button></button>").attr("data-property","cls").gColorButton({scene:t}).on("colorchange",function(t){e()})).append($("<label></label>").text("Color"))))},e.prototype.updateProperties=function(t,e,n){t.find('[data-property="in"]').prop("checked",e.getProperty("in")),t.find('[data-property="x"]').val(n.pointToString(e.getProperty("x"))),t.find('[data-property="y"]').val(n.pointToString(e.getProperty("y"))),t.find('[data-property="r"]').val(n.pointToString(e.getProperty("r"))),t.find('[data-property="cls"]').gColorButton("value",e.getProperty("cls"))},e.prototype.assignProperties=function(t,e,n){e.setProperties(["in","x","y","r","cls"],[t.find('[data-property="in"]').is(":checked"),n.stringToPoint(t.find('[data-property="x"]').val()),n.stringToPoint(t.find('[data-property="y"]').val()),n.stringToPoint(t.find('[data-property="r"]').val()),t.find('[data-property="cls"]').gColorButton("value")])},e.prototype.toString=function(){return"[Object GShadowEffectEntry]"},t.GShadowEffectEntry=e}(this),function(t){function e(){this._elements=[]}IFObject.inherit(e,GTransformer),e._AlignTo={Selection:"selection",Layer:"layer",Page:"page",PageMargins:"page-margins",FirstElement:"first-element",LastElement:"last-element"},e.prototype._panel=null,e.prototype._document=null,e.prototype._elements=null,e.prototype._savedAlignTo=e._AlignTo.Selection,e.prototype.getCategory=function(){return"Align"},e.prototype.init=function(t){this._panel=t,t.css("width","182px").append($("<div></div>").css({position:"absolute",top:"5px",left:"5px"}).append($("<button></button>").attr("title","Align Left").attr("data-align",GAlignAction.Type.AlignLeft).append($("<span></span>").addClass("fa fa-align-left"))).append($("<button></button>").attr("title","Align Center").attr("data-align",GAlignAction.Type.AlignCenter).append($("<span></span>").addClass("fa fa-align-center"))).append($("<button></button>").attr("title","Align Right").attr("data-align",GAlignAction.Type.AlignRight).append($("<span></span>").addClass("fa fa-align-right"))).append($("<button></button>").attr("title","Justify Horizontal").attr("data-align",GAlignAction.Type.AlignJustifyHorizontal).append($("<span></span>").addClass("fa fa-align-justify fa-rotate-270"))).append($("<button></button>").css("margin-left","10px").attr("title","Distribute Horizontal").attr("data-dist",GDistributeAction.Type.Horizontal).append($("<span></span>").addClass("fa fa-reorder fa-rotate-270"))).append($("<input>").attr("title","Horizontal Spacing, zero will auto-space").attr("data-dist",GDistributeAction.Type.Horizontal).css("width","38px").val("0"))).append($("<div></div>").css({position:"absolute",top:"30px",left:"5px"}).append($("<button></button>").attr("title","Align Top").attr("data-align",GAlignAction.Type.AlignTop).append($("<span></span>").addClass("fa fa-align-right fa-rotate-270"))).append($("<button></button>").attr("title","Align Middle").attr("data-align",GAlignAction.Type.AlignMiddle).append($("<span></span>").addClass("fa fa-align-center fa-rotate-270"))).append($("<button></button>").attr("title","Align Bottom").attr("data-align",GAlignAction.Type.AlignBottom).append($("<span></span>").addClass("fa fa-align-left fa-rotate-270"))).append($("<button></button>").attr("title","Justify Vertical").attr("data-align",GAlignAction.Type.AlignJustifyVertical).append($("<span></span>").addClass("fa fa-align-justify"))).append($("<button></button>").css("margin-left","10px").attr("title","Distribute Vertical").attr("data-dist",GDistributeAction.Type.Vertical).append($("<span></span>").addClass("fa fa-reorder"))).append($("<input>").attr("title","Vertical Spacing, zero will auto-space").attr("data-dist",GDistributeAction.Type.Vertical).css("width","38px").val("0"))).append($("<hr>").css({position:"absolute",left:"0px",right:"0px",top:"50px"})).append($("<label></label>").css({position:"absolute",top:"65px",left:"5px"}).text("Align To:").append($("<select></select>").css({"margin-left":"3px",width:"100px"}).attr("data-option","align-to").append($("<option></option>").attr("value",e._AlignTo.Selection).text("Selection")).append($("<option></option>").attr("value",e._AlignTo.Layer).text("Active Layer")).append($("<option></option>").attr("value",e._AlignTo.Page).text("Active Page")).append($("<option></option>").attr("value",e._AlignTo.PageMargins).text("Active Page Margins")).append($("<option></option>").attr("value",e._AlignTo.FirstElement).text("First Selected Element")).append($("<option></option>").attr("value",e._AlignTo.LastElement).text("Last Selected Element")).on("change",function(t){this._savedAlignTo=$(t.target).val(),this._updateStates()}.bind(this)))).append($("<label></label>").css({position:"absolute",top:"89px",left:"5px"}).append($("<input>").attr("type","checkbox").attr("data-align-geometry","").prop("checked",!0)).append($("<span></span>").text(" Geometry"))).append($("<label></label>").css({position:"absolute",top:"89px",left:"80px"}).append($("<input>").attr("type","checkbox").attr("data-align-selection","").prop("checked",!0)).append($("<span></span>").text(" Selection")));var n=function(t){this._executeAction($(t.target).closest("button").attr("data-align"),"align")}.bind(this),o=function(t){this._executeAction($(t.target).closest("button").attr("data-dist"),"dist")}.bind(this);this._panel.find("button[data-align]").each(function(t,e){$(e).on("click",n)}),this._panel.find("button[data-dist]").each(function(t,e){$(e).on("click",o)}),this._panel.find("input[data-dist]").each(function(t,e){$(e).on("keyup",function(t){13===t.keyCode&&o.call(this,t)})})},e.prototype.update=function(t,n){return this._document=t,this._elements=n,this._elements&&1===this._elements.length?this._panel.find('select[data-option="align-to"]').val(e._AlignTo.Page):this._panel.find('select[data-option="align-to"]').val(this._savedAlignTo),this._updateStates(),!0},e.prototype._getActionArgs=function(t,n){var o=null,i=this._elements.slice(),a=this._document.getScene(),r=a.getActivePage(),s=a.getActiveLayer(),p=this._panel.find('select[data-option="align-to"]').val();switch(p){case e._AlignTo.Layer:o=s.getPaintBBox();break;case e._AlignTo.Page:o=r.getGeometryBBox();break;case e._AlignTo.PageMargins:o=r.getGeometryBBox().expanded(-r.getProperty("ml"),-r.getProperty("mt"),-r.getProperty("mr"),-r.getProperty("mb"));break;case e._AlignTo.FirstElement:o=i[0],i.splice(0);break;case e._AlignTo.LastElement:o=i[i.length-1],i.splice(i.length-1)}if(i.length>0){var l=this._panel.find("input[data-align-geometry]").is(":checked");if("align"===n){var c=p!==e._AlignTo.Selection&&this._panel.find("input[data-align-selection]").is(":checked");return{actionId:GAlignAction.ID+"."+t,actionParams:[i,c,l,o]}}if("dist"===n){var d=a.stringToPoint(this._panel.find('input[data-dist="'+t+'"]').val())||0;return{actionId:GDistributeAction.ID+"."+t,actionParams:[i,l,o,d]}}throw new Error("Unknown align mode: "+n)}},e.prototype._executeAction=function(t,e){var n=this._getActionArgs(t,e);n&&gApp.executeAction(n.actionId,n.actionParams)},e.prototype._isActionEnabled=function(t,e){var n=this._getActionArgs(t,e);return!!n&&gApp.canExecuteAction(n.actionId,n.actionParams)},e.prototype._updateStates=function(){var t=this._panel.find('select[data-option="align-to"]').val()!==e._AlignTo.Selection&&this._elements.length>1;this._panel.find("input[data-align-selection]").prop("disabled",!t),this._panel.find("[data-align]").each(function(t,e){var n=$(e);n.prop("disabled",!this._isActionEnabled(n.attr("data-align"),"align"))}.bind(this)),this._panel.find("[data-dist]").each(function(t,e){var n=$(e);n.prop("disabled",!this._isActionEnabled(n.attr("data-dist"),"dist"))}.bind(this))},e.prototype.toString=function(){return"[Object GAlignTransformer]"},t.GAlignTransformer=e}(this),function(t){function e(){this._elements=[],this._savedValues={Move:[0,0],Scale:[100,100],Rotate:[0],Skew:[0,0],Reflect:[0]}}IFObject.inherit(e,GTransformer),e._TransformMode={Move:{label1:{prefix:"X"},label2:{prefix:"Y"},pivot:!1,transformFunc:function(t,e,n){var o=n.stringToPoint(t)||0,i=n.stringToPoint(e)||0;return 0!==o||0!==i?function(t,e,n){e.transform(new IFTransform(1,0,0,1,o*t,i*t))}:null}},Scale:{label1:{prefix:"W",postfix:"%"},label2:{prefix:"H",postfix:"%"},pivot:!0,transformFunc:function(t,e,n){var o=parseFloat(t)/100||1,i=parseFloat(e)/100||1;return 1!==o||1!==i?function(t,e,n){e.transform((new IFTransform).translated(-n.getX(),-n.getY()).scaled(o+(o-1)*(t-1),i+(i-1)*(t-1)).translated(n.getX(),n.getY()))}:null}},Rotate:{label1:{prefix:"Angle",postfix:"Â°"},pivot:!0,transformFunc:function(t,e,n){var o=ifMath.toRadians(parseFloat(t))||0;return 0!==o?function(t,e,n){e.transform((new IFTransform).translated(-n.getX(),-n.getY()).rotated(-o*t).translated(n.getX(),n.getY()))}:null}},Skew:{label1:{prefix:"X",postfix:"Â°"},label2:{prefix:"Y",postfix:"Â°"},pivot:!0,transformFunc:function(t,e,n){var o=ifMath.toRadians(parseFloat(t))||0,i=ifMath.toRadians(parseFloat(e))||0;return(0!==o||0!==i)&&o>-ifMath.PIHALF&&i>-ifMath.PIHALF&&o<ifMath.PIHALF&&i<ifMath.PIHALF?function(t,e,n){e.transform((new IFTransform).translated(-n.getX(),-n.getY()).skewed(o*t,i*t).translated(n.getX(),n.getY()))}:null}},Reflect:{label1:{prefix:"Axis",postfix:"Â°"},pivot:!0,transformFunc:function(t,e,n){var o=parseFloat(t)||0;o=ifMath.toRadians(-o);var i=Math.cos(o),a=Math.sin(o);return function(t,e,n){t%2&&e.transform((new IFTransform).translated(-n.getX(),-n.getY()).multiplied(new IFTransform(i,-a,a,i,0,0)).multiplied(new IFTransform(1,0,0,-1,0,0)).multiplied(new IFTransform(i,a,-a,i,0,0)).translated(n.getX(),n.getY()))}}}},e.prototype._panel=null,e.prototype._document=null,e.prototype._elements=null,e.prototype._transformMode=null,e.prototype._savedValues=null,e.prototype.getCategory=function(){return"Adjust"},e.prototype.init=function(t){this._panel=t,t.css("width","166px").append($("<div></div>").css({position:"absolute",top:"5px",left:"5px"}).append($("<button></button>").addClass("g-flat").attr("title","Move").attr("data-mode","Move").append($("<span></span>").addClass("fa fa-arrows"))).append($("<button></button>").addClass("g-flat").attr("title","Scale").attr("data-mode","Scale").append($("<span></span>").addClass("fa fa-expand"))).append($("<button></button>").addClass("g-flat").attr("title","Rotate").attr("data-mode","Rotate").append($("<span></span>").addClass("fa fa-rotate-right"))).append($("<button></button>").addClass("g-flat").attr("title","Skew").attr("data-mode","Skew").append($("<span></span>").addClass("fa fa-eraser"))).append($("<button></button>").addClass("g-flat").attr("title","Reflect").attr("data-mode","Reflect").append($("<span></span>").addClass("fa fa-star-half-o"))).append($("<button></button>").css("margin-left","7px").text("Apply").on("click",this._apply.bind(this)))).append($("<label></label>").attr("data-value","1").css({position:"absolute",left:"5px",top:"30px"}).append($("<span></span>").attr("data-prefix","")).append($("<input>").css({"margin-left":"3px",width:"48px"}).val("0").on("keyup",function(t){13==t.keyCode&&this._apply()}.bind(this))).append($("<span></span>").attr("data-postfix",""))).append($("<label></label>").attr("data-value","2").css({position:"absolute",left:"90px",top:"30px"}).append($("<span></span>").attr("data-prefix","")).append($("<input>").css({"margin-left":"3px",width:"48px"}).val("0").on("keyup",function(t){13==t.keyCode&&this._apply()}.bind(this))).append($("<span></span>").attr("data-postfix",""))).append($("<hr>").css({position:"absolute",left:"0px",right:"0px",top:"50px"})).append($("<div></div>").attr("data-property","pivot").css({position:"absolute",top:"65px",left:"5px"}).gPivot()).append($("<label></label>").css({position:"absolute",top:"65px",right:"5px"}).text("Copies:").append($("<input>").css({"margin-left":"3px",width:"38px"}).attr("data-property","copies").val("0"))),t.find("button[data-mode]").each(function(t,e){var n=$(e);n.on("click",function(){this._setTransformMode(n.attr("data-mode"))}.bind(this))}.bind(this)),this._setTransformMode("Move")},e.prototype.update=function(t,e){return this._document=t,this._elements=e,this._panel.find('[data-property="pivot"]').gPivot("value",IFRect.Side.CENTER),!0},e.prototype._setTransformMode=function(t){this._transformMode&&(this._savedValues[this._transformMode]=[this._panel.find('label[data-value="1"] input').val(),this._panel.find('label[data-value="2"] input').val()]),this._transformMode=t,this._panel.find("button[data-mode]").each(function(e,n){var o=$(n);o.toggleClass("g-active",o.attr("data-mode")===t)}.bind(this));var n=function(e,n){var o=this._panel.find('label[data-value="'+n.toString()+'"]');e?(o.css("display",""),o.find("span[data-prefix]").text(e.prefix?e.prefix+":":""),o.find("span[data-postfix]").text(e.postfix?e.postfix:""),o.find("input").val(this._savedValues[t][n-1])):o.css("display","none")}.bind(this),o=e._TransformMode[t];n(o.label1,1),n(o.label2,2),this._panel.find('[data-property="pivot"]').css("display",o.pivot?"":"none")},e.prototype._apply=function(){var t=this._document.getScene(),n=parseInt(this._panel.find('[data-property="copies"]').val()),o=this._panel.find('[data-property="pivot"]').gPivot("value"),i=this._panel.find('label[data-value="1"] input').val(),a=this._panel.find('label[data-value="2"] input').val(),r=e._TransformMode[this._transformMode].transformFunc(i,a,t);r&&IFEditor.tryRunTransaction(t,function(){for(var t=[],e=null,i=0;i<this._elements.length;++i){var a=this._elements[i];o&&(e=e?e.united(a.getGeometryBBox()):a.getGeometryBBox());var s=[a];if(n>0)for(var p=a.getParent(),l=a.getNext()?a.getNext():null,c=0;c<n;++c){var d=a.clone();c==n-1&&(d.setFlag(IFNode.Flag.Selected),a.removeFlag(IFNode.Flag.Selected)),p.insertChild(d,l),s.push(d)}t.push(s)}var u=null;e&&!e.isEmpty()&&(u=e.getSide(o));for(i=0;i<t.length;++i){if((s=t[i]).length>1)for(var g=0;g<s.length;++g)r(g,s[g],u);else 1==s.length&&r(1,s[0],u)}}.bind(this),"Adjust Transformation")},e.prototype.toString=function(){return"[Object GAdjustTransformer]"},t.GAdjustTransformer=e}(this),ifLocale.setValues(GAddLayerAction,IFLocale.Language.English,["title"],["Add Layer"]),ifLocale.setValues(GAddPageAction,IFLocale.Language.English,["title"],["Add Page"]),ifLocale.setValues(GAlignAction,IFLocale.Language.English,["title.align-left","title.align-center","title.align-right","title.align-top","title.align-middle","title.align-bottom","title.align-justify-horizontal","title.align-justify-vertical"],["Align Left","Align Center","Align Right","Align Top","Align Middle","Align Bottom","Justify Horizontal","Justify Vertical"]),ifLocale.setValues(GCloneAction,IFLocale.Language.English,["title"],["Clone"]),ifLocale.setValues(GCloseAction,IFLocale.Language.English,["title"],["Close"]),ifLocale.setValues(GCloseAllAction,IFLocale.Language.English,["title"],["Close All"]),ifLocale.setValues(GCopyAction,IFLocale.Language.English,["title"],["Copy"]),ifLocale.setValues(GCopyAttributesAction,IFLocale.Language.English,["title"],["Copy Attributes"]),ifLocale.setValues(GCutAction,IFLocale.Language.English,["title"],["Cut"]),ifLocale.setValues(GDeleteAction,IFLocale.Language.English,["title"],["Delete"]),ifLocale.setValues(GDeleteLayerAction,IFLocale.Language.English,["title"],["Delete Layer"]),ifLocale.setValues(GDeletePageAction,IFLocale.Language.English,["title"],["Delete Page"]),ifLocale.setValues(GDistributeAction,IFLocale.Language.English,["title.horizontal","title.vertical"],["Distribute Horizontally","Distribute Vertically"]),ifLocale.setValues(GDuplicateAction,IFLocale.Language.English,["title"],["Duplicate"]),ifLocale.setValues(GFitAllAction,IFLocale.Language.English,["title"],["Fit All"]),ifLocale.setValues(GFitCurrentLayerAction,IFLocale.Language.English,["title"],["Fit Layer"]),ifLocale.setValues(GFitCurrentPageAction,IFLocale.Language.English,["title"],["Fit Page"]),ifLocale.setValues(GFitSelectionAction,IFLocale.Language.English,["title"],["Fit Selection"]),ifLocale.setValues(GGroupAction,IFLocale.Language.English,["title"],["Group Selection"]),ifLocale.setValues(GPlaceImageAction,IFLocale.Language.English,["title"],["Place Image..."]),ifLocale.setValues(GInvertSelectionAction,IFLocale.Language.English,["title"],["Invert Selection"]),ifLocale.setValues(GLayerTypeAction,IFLocale.Language.English,["title"],["%name% Layer"]),ifLocale.setValues(GNewAction,IFLocale.Language.English,["title"],["New..."]),ifLocale.setValues(GNewWindowAction,IFLocale.Language.English,["title"],["New Window"]),ifLocale.setValues(GOpenAction,IFLocale.Language.English,["title"],["Open..."]),ifLocale.setValues(GArrangeAction,IFLocale.Language.English,["title.send-front","title.bring-forward","title.send-backward","title.send-back"],["Send To Front","Bring Forward","Send Backward","Send To Back"]),ifLocale.setValues(GOriginalViewAction,IFLocale.Language.English,["title"],["Original-View"]),ifLocale.setValues(GPaintModeAction,IFLocale.Language.English,["title"],["%name% View"]),ifLocale.setValues(GPasteAction,IFLocale.Language.English,["title"],["Paste"]),ifLocale.setValues(GPasteInPlaceAction,IFLocale.Language.English,["title"],["Paste In Place"]),ifLocale.setValues(GPasteInsideAction,IFLocale.Language.English,["title"],["Paste Inside Selection"]),ifLocale.setValues(GPasteAttributesAction,IFLocale.Language.English,["title"],["Paste Attributes"]),ifLocale.setValues(GPixelPreviewAction,IFLocale.Language.English,["title"],["Pixel Preview"]),ifLocale.setValues(GRedoAction,IFLocale.Language.English,["title"],["Redo"]),ifLocale.setValues(GSaveAction,IFLocale.Language.English,["title"],["Save"]),ifLocale.setValues(GSaveAllAction,IFLocale.Language.English,["title"],["Save All"]),ifLocale.setValues(GSaveAsAction,IFLocale.Language.English,["title"],["Save As..."]),ifLocale.setValues(GShowRulersAction,IFLocale.Language.English,["title"],["Show Rulers"]),ifLocale.setValues(GSelectAllAction,IFLocale.Language.English,["title"],["Select All"]),ifLocale.setValues(GShowAllPagesAction,IFLocale.Language.English,["title"],["All Pages visible"]),ifLocale.setValues(GShowGridAction,IFLocale.Language.English,["title"],["Show Grid"]),ifLocale.setValues(GSliceFromSelectionAction,IFLocale.Language.English,["title"],["Create Slice from Selection"]),ifLocale.setValues(GSnapUnitAction,IFLocale.Language.English,["title.full","title.half"],["Snap to full units","Snap to half units"]),ifLocale.setValues(GTransformAction,IFLocale.Language.English,["title.rotate-45-left","title.rotate-90-left","title.rotate-180-left","title.rotate-45-right","title.rotate-90-right","title.rotate-180-right","title.flip-vertical","title.flip-horizontal"],["Rotate 45Â° Left","Rotate 90Â° Left","Rotate 180Â° Left","Rotate 45Â° Right","Rotate 90Â° Right","Rotate 180Â° Right","Flip Vertical","Flip Horizontal"]),ifLocale.setValues(GUndoAction,IFLocale.Language.English,["title"],["Undo"]),ifLocale.setValues(GUngroupAction,IFLocale.Language.English,["title"],["Ungroup Selection"]),ifLocale.setValues(GZoomInAction,IFLocale.Language.English,["title"],["Zoom in"]),ifLocale.setValues(GZoomOutAction,IFLocale.Language.English,["title"],["Zoom out"]),ifLocale.setValues(GAnalogousMatcher,IFLocale.Language.English,["title"],["Analogous"]),ifLocale.setValues(GComplementaryMatcher,IFLocale.Language.English,["title"],["Complementary"]),ifLocale.setValues(GExportPalette,IFLocale.Language.English,["title"],["Export"]),ifLocale.setValues(GStylePalette,IFLocale.Language.English,["title"],["Style"]),ifLocale.setValues(GPropertiesPanel,IFLocale.Language.English,["title"],["Properties"]),ifLocale.setValues(GTransformPanel,IFLocale.Language.English,["title"],["Transform"]),ifLocale.setValues(GStylesSwatchesSidebar,IFLocale.Language.English,["title"],["Styles & Swatches"]),ifLocale.setValues(GPagesLayersSidebar,IFLocale.Language.English,["title"],["Pages & Layers"]),function(){function t(){}IFObject.inherit(t,GModule),t.prototype.init=function(){gravitrdr.exporters.push(new GImageExporter),gravitrdr.palettes.push(new GExportPalette,new GStylePalette),gravitrdr.panels.push(new GPropertiesPanel,new GTransformPanel),gravitrdr.sidebars.push(new GPagesLayersSidebar,new GStylesSwatchesSidebar),gravitrdr.tools.push({instance:new IFPointerTool,title:"Pointer",category:GApplication.TOOL_CATEGORY_SELECT,group:"select",keys:["V","0"],icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0.5 18.5 18 18">\n<path stroke="none" d="M3.5,18.5v18l5-7h9L3.5,18.5z"/>\n</svg>'},{instance:new IFLassoTool,title:"Lasso",category:GApplication.TOOL_CATEGORY_SELECT,group:"select",icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0.5 18.5 18 18">\n<path stroke="none" d="M18.5,27c-3.7,0-4.7,2.9-5.5,5.2c-0.7,2-1.2,3.2-2.5,3.2c-0.8,0-1.5-0.3-2.1-0.8\n\tc-0.4-0.4-0.7-0.9-0.9-1.5c0.6-0.4,1-1,1-1.7c0-0.2,0-0.4-0.1-0.6c0.8-0.5,1.7-1.2,2.5-2c3.5-3.5,4.6-7.6,2.7-9.5\n\tc-0.6-0.6-1.5-0.9-2.4-0.9c-2.1,0-4.7,1.3-7,3.6c-3.5,3.5-4.6,7.6-2.7,9.5c0.6,0.6,1.5,0.9,2.4,0.9c0.3,0,0.6,0,0.9-0.1\n\tc0.3,0.6,1,1.1,1.8,1.1c0,0,0,0,0,0c0.3,0.7,0.6,1.4,1.2,1.9c0.7,0.7,1.7,1.1,2.8,1.1c2.2,0,2.8-2,3.5-4c0.8-2.3,1.6-4.6,4.5-4.6\n\tC18.5,28,18.5,27,18.5,27z M2.1,30.9c-0.9-0.9-0.6-2.4-0.4-3.2c0.5-1.6,1.5-3.4,3.1-4.9c2-2,4.5-3.3,6.3-3.3c0.7,0,1.3,0.2,1.7,0.6\n\tc0.4,0.4,0.6,1,0.6,1.7c0,1.9-1.3,4.3-3.3,6.3c-0.7,0.7-1.5,1.4-2.3,1.9c-0.4-0.3-0.8-0.5-1.4-0.5c-1.1,0-2,0.9-2,1.9\n\tc-0.2,0-0.4,0.1-0.7,0.1C3.1,31.5,2.5,31.3,2.1,30.9z"/>\n</svg>'},{instance:new IFSubSelectTool,title:"Subselect",category:GApplication.TOOL_CATEGORY_SELECT,group:"select2",keys:["A","1"],icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0.5 18.5 18 18">\n<path stroke="none" d="M3.5,18.5v18l5-7h9L3.5,18.5z M7.5,27.5l-3,4.5V20.5l9,7H7.5z"/>\n</svg>'},{instance:new IFPageTool,title:"Page",category:GApplication.TOOL_CATEGORY_SELECT,group:"select3",keys:["D"],icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0.5 18.5 18 18">\n<path stroke="none" d="M15.5,18.5v10h-1v-9h-7v3h-3v10h3v1h-4v-12l3-3H15.5z M8.5,25.5v11l3.5-4h5.5L8.5,25.5z"/>\n</svg>'},{instance:new IFLayerTool,title:"Layer",category:GApplication.TOOL_CATEGORY_SELECT,group:"select3",keys:["L"],icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="-2.5 -.5 18 18" width="18px" height="18px">\n<path stroke="none" d="M0.5,8.5 L0.5,10.5 L4.5,10.5 L4.5,8.5 L0.5,8.5 Z M10.5,8.5 L10.5,10.5 L12.5,10.5 L12.5,8.5 L10.5,8.5 Z M9.5,8.5 L9.5,9.5 L10.5,9.5 L10.5,8.5 L9.5,8.5 Z M0.5,0.5 L0.5,2.5 L12.5,2.5 L12.5,0.5 L0.5,0.5 Z M0.5,4.5 L0.5,6.5 L12.5,6.5 L12.5,4.5 L0.5,4.5 Z M5.5,7.5 L5.5,18.5 L9,14.5 L14.5,14.5 L5.5,7.5 Z"></path>\n</svg>'},{instance:new IFTransformTool,title:"Transform",category:GApplication.TOOL_CATEGORY_SELECT,group:"transform",keys:["Q"],icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0.5 18.5 18 18">\n<path stroke="none" d="M17.5,32.5H12l-3.5,4v-11L17.5,32.5z M3.5,18.5h-3v3h1v-2h2V18.5z M15.5,18.5v1h2v2h1v-3H15.5z M1.5,35.5v-2h-1v3h3v-1H1.5z M6.4,33.5H3.5v-12h12v7h1v-8h-14v14h3.9V33.5z"/>\n</svg>'},{instance:new IFLineTool,title:"Line",category:GApplication.TOOL_CATEGORY_VECTOR,group:"line",keys:["N"],icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0.5 18.5 18 18">\n<rect stroke="none" x="9" y="15.3" transform="matrix(0.7069 0.7074 -0.7074 0.7069 22.2372 1.3418)" width="1" height="24.5"/>\n</svg>'},{instance:new IFPenTool,title:"Pen",category:GApplication.TOOL_CATEGORY_VECTOR,group:"path",keys:["P"],icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0.5 18.5 18 18">\n<path stroke="none" d="M9.2,21.3l0.7,0.7l-6.5,3.6c0,0-0.5,3.1-1.4,5.7c-0.8,2.2-2.1,3.6-1.4,4.3c0,0,0,0,0.7,0.7\n\tc0.7,0.7,2.1-0.6,4.3-1.4c2.5-0.9,5.6-1.4,5.6-1.4l3.7-6.4l0.7,0.7l2.9-2.1l-7.1-7.1L9.2,21.3z M4.2,26.4l6.5-3.6l3.6,3.6l-3.7,6.4\n\tc-4.8,0.5-8.5,2.8-8.5,2.8l3.2-3.2c0.8,0.5,1.8,0.3,2.4-0.3c0.8-0.8,0.8-2,0-2.8c-0.8-0.8-2-0.8-2.8,0c-0.7,0.7-0.8,1.7-0.4,2.5\n\tl-3.2,3.2C1.4,34.9,3.7,31.2,4.2,26.4z"/>\n</svg>'},{instance:new IFBezigonTool,title:"Bezigon",category:GApplication.TOOL_CATEGORY_VECTOR,group:"path",keys:["B","8"],icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0.5 18.5 18 18">\n<path d="M7.8,29.3c-1.8-1.7,4.4-10.8,4.4-10.8l1.3,1.2c-1.3,1.5-2.5,3.6-3.1,4.7c-1,1.8-1.1,2.7-1.1,2.7l6-5.7l3.1,3\n\tC18.5,24.5,9.5,30.7,7.8,29.3z M18.5,33c0,0.8-0.7,1.5-1.5,1.5c-0.7,0-1.2-0.4-1.4-1H7.5v3h-7v-7h3v-8.1c-0.6-0.2-1-0.8-1-1.4\n\tc0-0.8,0.7-1.5,1.5-1.5s1.5,0.7,1.5,1.5c0,0.7-0.4,1.2-1,1.4v8.1h3v3h8.1c0.2-0.6,0.8-1,1.4-1C17.8,31.5,18.5,32.2,18.5,33z\n\t M6.5,30.5h-5v5h5V30.5z" stroke="none"/>\n</svg>'},{instance:new IFRectangleTool,title:"Rectangle",category:GApplication.TOOL_CATEGORY_VECTOR,group:"shape",keys:["R"],icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0.5 18.5 18 18">\n<path stroke="none" d="M17.5,20.5v14h-16v-14H17.5 M18.5,19.5h-18v16h18v-15V19.5L18.5,19.5z"/>\n</svg>'},{instance:new IFEllipseTool,title:"Ellipse",category:GApplication.TOOL_CATEGORY_VECTOR,group:"shape2",keys:["E","3"],icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0.5 18.5 18 18">\n<ellipse style="fill:none; stroke: inherit" cx="9.5" cy="27.5" rx="8.5" ry="7.5"/>\n</svg>'},{instance:new IFPolygonTool,title:"Polygon",category:GApplication.TOOL_CATEGORY_VECTOR,group:"shape2",keys:["G"],icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0.5 18.5 18 18">\n<path stroke="none" d="M13.4,20.5l3.9,7l-3.9,7H5.6l-3.9-7l3.9-7H13.4 M14,19.5H5l-4.5,8l4.5,8h9l4.5-8L14,19.5L14,19.5z"/>\n</svg>'},{instance:new IFTextTool,title:"Text",category:GApplication.TOOL_CATEGORY_OTHER,group:"text",keys:["T"],icon:'<svg xmlns="http://www.w3.org/2000/svg">\n<text style="stroke:none; fill: inherit; font-family: Arial; font-size: 18px; text-anchor: middle" x="9" y="15">T</text>\n</svg>'},{instance:new IFSliceTool,title:"Slice",category:GApplication.TOOL_CATEGORY_OTHER,group:"slice",keys:["K"],icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0.5 18.5 18 18">\n<path stroke="none" d="M14.8,19.3L2.6,33.4c-0.2,0.3-0.1,0.7,0.1,0.9c0.2,0.2,0.6,0.3,0.9,0.1c0,0,7.9-4.9,8-5.1l6.4-7.4l0,0 c0.8-0.9,0.5-2.2-0.3-2.9C16.9,18.3,15.6,18.3,14.8,19.3z M17,21l-6.3,7.4l-1.1-0.9l6.4-7.4c0.4-0.5,1-0.2,1-0.1 C17.2,20.2,17.2,20.7,17,21z M15.5,27.5v9h-15v-13v0h8v1h-7v11h13v-8H15.5z"/>\n</svg>'},{instance:new IFZoomTool,title:"Zoom",category:GApplication.TOOL_CATEGORY_VIEW,group:"zoom",keys:["Z"],icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0.5 18.5 18 18">\n<path stroke="none" d="M17.9,34L15,31.2c1-1.3,1.5-2.9,1.5-4.7c0-4.4-3.6-8.1-8-8.1c-4.4,0-8.1,3.6-8.1,8.1c0,4.4,3.6,8,8.1,8\n\tc1.8,0,3.4-0.6,4.7-1.5l2.8,2.8c0.7,0.7,1.7,0.8,2.2,0.3C18.7,35.7,18.6,34.7,17.9,34z M1.6,26.5c0-3.8,3.1-6.9,6.9-6.9s7,3.1,7,6.9\n\ts-3.1,7-7,7S1.6,30.3,1.6,26.5z"/>\n</svg>'},{instance:new IFHandTool,title:"Hand",category:GApplication.TOOL_CATEGORY_VIEW,group:"hand",keys:["H"],icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0.5 18.5 18 18">\n<path stroke="none" d="M13.7,22.6C10.3,19,7.9,19,7,19.2l-0.4-0.4c-0.1,0-0.5-0.3-1.1-0.3c-0.4,0-0.7,0.1-1,0.4\n\tC4.2,19,4.1,19.2,4,19.4c-0.6-0.3-1.3-0.3-1.8,0.2c-0.3,0.3-0.5,0.7-0.5,1.1c0,0.1,0,0.3,0.1,0.4c-0.2,0.1-0.5,0.2-0.7,0.4\n\tc-0.9,0.7-0.5,1.7-0.2,2.3c2.7,2.6,5.6,5.8,6.1,7c-0.5-0.2-1.4-0.9-1.9-1.4c-1.7-1.4-2.8-2.2-3.6-1.7c-0.6,0.3-0.7,0.8-0.8,1.1\n\tc-0.4,1.5,3.4,5.2,3.6,5.4c1.2,1.3,8.9,2.4,8.9,2.4c0.1,0,0.2,0,0.3-0.1l4.8-3.3c0.1-0.1,0.2-0.2,0.2-0.4\n\tC18.5,32.5,18.7,27.8,13.7,22.6z M13.1,35.5L13.1,35.5c-2.9-0.4-7.4-1.3-8.1-2.1c0,0-0.1-0.1-0.2-0.2c-2.6-2.7-3.6-4.1-3.1-4.6\n\tc0.1-0.1,0.2-0.1,0.4-0.1c0.5,0,1.4,0.7,2.1,1.3L4.4,30c1,0.8,2.1,1.6,2.8,1.6c0.2,0,0.4-0.1,0.5-0.2c0.1-0.1,0.1-0.2,0.1-0.3\n\tc0-1.3-3.2-5.1-6.3-8c-0.2-0.3-0.3-0.7,0-1C1.8,22,2,21.9,2.2,21.9c0.2,0,0.3,0.1,0.4,0.1l4.5,4.3c0.2,0.1,0.4,0.1,0.6,0\n\tc0.1-0.1,0.1-0.1,0.1-0.2c0-0.1-0.1-0.3-0.1-0.3l-4.5-4.3c0,0-0.5-0.4-0.5-0.9c0-0.2,0.1-0.3,0.2-0.4c0.1-0.1,0.3-0.2,0.4-0.2\n\tc0.4,0,0.9,0.4,1.1,0.7L9,25.2c0.2,0.1,0.4,0.1,0.6,0c0.1-0.1,0.1-0.1,0.1-0.2c0-0.1-0.1-0.3-0.1-0.3l-4.6-4.4\n\tc-0.1-0.1-0.1-0.4,0.1-0.6c0.1-0.1,0.3-0.2,0.5-0.2c0.2,0,0.4,0.1,0.4,0.2h0l5,4.3c0.2,0.1,0.4,0.1,0.6,0c0.1-0.1,0.1-0.2,0.1-0.3\n\tc0-0.1-0.1-0.2-0.1-0.3L7.8,20l0.5,0.1c1,0.2,2.6,0.9,4.7,3.1c4,4.2,4.5,8.1,4.5,9.2l0,0.1L13.1,35.5z"/>\n</svg>'}),gravitrdr.colorMatchers.push(new GAnalogousMatcher,new GComplementaryMatcher),gravitrdr.properties.push(new GInfoProperties,new GDocumentProperties,new GPolygonProperties,new GPathProperties,new GRectangleProperties,new GEllipseProperties,new GTextProperties,new GImageProperties,new GSliceProperties,new GPageProperties),gravitrdr.styleEntries.push(new GFillPaintEntry,new GStrokePaintEntry,new GBlurFilterEntry,new GOffsetVEffectEntry,new GShadowEffectEntry),gravitrdr.transformers.push(new GAlignTransformer,new GAdjustTransformer),gravitrdr.actions.push(new GNewAction,new GOpenAction,new GSaveAction,new GSaveAsAction,new GSaveAllAction,new GPlaceImageAction,new GCloseAction,new GCloseAllAction,new GUndoAction,new GRedoAction,new GCutAction,new GCopyAction,new GPasteAction,new GPasteInPlaceAction,new GPasteInsideAction,new GDeleteAction,new GCopyAttributesAction,new GPasteAttributesAction,new GDuplicateAction,new GCloneAction,new GSelectAllAction,new GInvertSelectionAction,new GArrangeAction(GArrangeAction.Type.SendToFront),new GArrangeAction(GArrangeAction.Type.BringForward),new GArrangeAction(GArrangeAction.Type.SendBackward),new GArrangeAction(GArrangeAction.Type.SendToBack),new GAlignAction(GAlignAction.Type.AlignLeft),new GAlignAction(GAlignAction.Type.AlignCenter),new GAlignAction(GAlignAction.Type.AlignRight),new GAlignAction(GAlignAction.Type.AlignJustifyHorizontal),new GAlignAction(GAlignAction.Type.AlignTop),new GAlignAction(GAlignAction.Type.AlignMiddle),new GAlignAction(GAlignAction.Type.AlignBottom),new GAlignAction(GAlignAction.Type.AlignJustifyVertical),new GDistributeAction(GDistributeAction.Type.Horizontal),new GDistributeAction(GDistributeAction.Type.Vertical),new GSnapUnitAction(GSnapUnitAction.Type.FullUnit),new GSnapUnitAction(GSnapUnitAction.Type.HalfUnit),new GTransformAction(GTransformAction.Type.Rotate45Left),new GTransformAction(GTransformAction.Type.Rotate90Left),new GTransformAction(GTransformAction.Type.Rotate180Left),new GTransformAction(GTransformAction.Type.Rotate45Right),new GTransformAction(GTransformAction.Type.Rotate90Right),new GTransformAction(GTransformAction.Type.Rotate180Right),new GTransformAction(GTransformAction.Type.FlipVertical),new GTransformAction(GTransformAction.Type.FlipHorizontal),new GGroupAction,new GUngroupAction,new GSliceFromSelectionAction,new GAddPageAction,new GDeletePageAction,new GAddLayerAction,new GDeleteLayerAction,new GLayerTypeAction(IFLayer.Type.Output),new GLayerTypeAction(IFLayer.Type.Draft),new GLayerTypeAction(IFLayer.Type.Guide),new GOriginalViewAction,new GFitSelectionAction,new GFitCurrentPageAction,new GFitCurrentLayerAction,new GFitAllAction,new GMagnificationAction(6,null),new GMagnificationAction(12,null),new GMagnificationAction(25,null),new GMagnificationAction(50,[IFKey.Constant.META,"5"]),new GMagnificationAction(100,[IFKey.Constant.META,"1"]),new GMagnificationAction(200,[IFKey.Constant.META,"2"]),new GMagnificationAction(400,[IFKey.Constant.META,"4"]),new GMagnificationAction(800,[IFKey.Constant.META,"8"]),new GZoomInAction,new GZoomOutAction,new GPaintModeAction(IFScenePaintConfiguration.PaintMode.Full),new GPaintModeAction(IFScenePaintConfiguration.PaintMode.Fast),new GPaintModeAction(IFScenePaintConfiguration.PaintMode.Outline),new GPaintModeAction(IFScenePaintConfiguration.PaintMode.Output),new GPixelPreviewAction,new GShowAllPagesAction,new GShowGridAction,new GShowRulersAction,new GNewWindowAction)},t.prototype.toString=function(){return"[Module GravitRDR]"},gravitrdr.modules.push(new t)}();