!function(t){function e(){}e.getTypeId=function(t){return"number"==typeof t?t:"function"==typeof t&&t.prototype.hasOwnProperty("__gtype_id__")?t.prototype.__gtype_id__:t&&"number"==typeof t.__gtype_id__?t.__gtype_id__:null},e.getName=function(t){if(t){if("object"==typeof t&&(t=t.constructor),t&&"function"==typeof t){var e=/function (.{1,})\(/.exec(t.toString());return e&&e.length>1?e[1]:"anonymous"}return t.toString()}return"<null>"},e.inherit=function(t,n){if(t.prototype=Object.create(n.prototype),t.prototype.__gtype_id__=e._internalTypeIdCounter++,t.prototype.constructor=t,delete t.prototype.__gmixins__,n.prototype.__gmixins__)for(var i in t.prototype.__gmixins__={},n.prototype.__gmixins__)t.prototype.__gmixins__[i]=!0;if(n!=e)for(var r in n)r&&r.length>0&&"constructor"!==r&&"__gmixins__"!=r&&"toString"!=r&&"_"!=r.charAt(0)&&!t[r]&&(t[r]=n[r])},e.mix=function(t,n){e.inheritAndMix(t,null,n)},e.inheritAndMix=function(t,n,i){if(n&&this.inherit(t,n),i){t.prototype.__gmixins__||(t.prototype.__gmixins__={});for(var r=0;r<i.length;++r){var o=i[r].prototype;for(var s in o)if(s&&"constructor"!==s&&"toString"!=s&&"__gmixins__"!=s&&"__gtype_id__"!=s&&"hasMixin"!=s){if(s in t.prototype)throw new Error("Mixin "+o+" may not override "+s+" in "+t.prototype);t.prototype[s]=o[s]}if(o.__gtype_id__||(o.__gtype_id__=e._internalTypeIdCounter++),t.prototype.__gmixins__[o.__gtype_id__]=!0,o.__gmixins__)for(var a in o.__gmixins__)t.prototype.__gmixins__[a]=!0}}},e._internalTypeIdCounter=0,e.prototype.__gtype_id__=-1,e.prototype.__gmixins__=null,e.prototype.hasMixin=function(t){return!(!this.__gmixins__||!this.__gmixins__[t.prototype.__gtype_id__])},e.prototype.toString=function(){var t=this.constructor.toString().match(/^function ([^\(]*)/);return"[Object "+(t?t[1]:"object")+"]"},t.IFObject=e}(this),function(t){function e(){var t,n,i,r;this.littleEndian=(t=new ArrayBuffer(8),new Uint32Array(t)[1]=168496141,!(10===t[4]&&11===t[5]&&12===t[6]&&13===t[7])),this.hardware=(n=!!navigator.userAgent.match(/(iPad|SCH-I800|xoom|kindle)/i),i=!!navigator.userAgent.match(/(iPhone|iPod|blackberry|android 0.5|htc|lg|midp|mmp|mobile|nokia|opera mini|palm|pocket|psp|sgh|smartphone|symbian|treo mini|Playstation Portable|SonyEricsson|Samsung|MobileExplorer|PalmSource|Benq|Windows Phone|Windows Mobile|IEMobile|Windows CE|Nintendo Wii)/i),n?e.Hardware.Tablet:i?e.Hardware.Phone:e.Hardware.Desktop),this.operatingSystem=function(){for(var t=[{string:navigator.platform,subString:"Win",identity:e.OperatingSystem.Windows},{string:navigator.platform,subString:"Mac",identity:e.OperatingSystem.OSX_IOS},{string:navigator.userAgent,subString:"iPhone",identity:e.OperatingSystem.OSX_IOS},{string:navigator.userAgent,subString:"iPad",identity:e.OperatingSystem.OSX_IOS},{string:navigator.userAgent,subString:"Android",identity:e.OperatingSystem.Unix},{string:navigator.platform,subString:"Linux",identity:e.OperatingSystem.Unix}],n=0;n<t.length;n++){if(-1!=t[n].string.indexOf(t[n].subString))return t[n].identity}return e.OperatingSystem.Windows}(),this.language=2==(r=(navigator.language||navigator.browserLanguage||navigator.systemLanguage||navigator.userLanguage||"").split("-")).length||r?r[0].toLowerCase():null,console.log("HW="+this.hardware+"; OS="+this.operatingSystem+"; LANG="+this.language)}e.OperatingSystem={Unix:0,Windows:1,OSX_IOS:2},e.Hardware={Desktop:0,Tablet:1,Phone:2},e.prototype.littleEndian=!0,e.prototype.operatingSystem=null,e.prototype.hardware=null,e.prototype.language=null,t.IFSystem=e,t.ifSystem=new e}(this),function(t){t.IFCursor={Default:null,Select:"select",SelectInverse:"select-inverse",SelectDot:"select-dot",SelectDotInverse:"select-dot-inverse",SelectArrowOnly:"select-arrow-only",SelectCross:"select-cross",SelectResizeVert:"select-resize-vert",SelectResizeHoriz:"select-resize-horiz",SelectResizeUpLeftDownRight:"select-upleft-downright",SelectResizeUpRightDownLeft:"select-upright-downleft",SelectSkewVert:"select-skew-vert",SelectSkewHoriz:"select-skew-horiz",SelectRotate:["select-rot-tl","select-rot-tc","select-rot-tr","select-rot-rc","select-rot-br","select-rot-bc","select-rot-bl","select-rot-lc"],ZoomPlus:"zoom-plus",ZoomMinus:"zoom-minus",ZoomNone:"zoom-none",HandOpen:"hand-open",HandClosed:"hand-closed",Cross:"cross",Pen:"pen",PenStart:"pen-start",PenEnd:"pen-end",PenPlus:"pen-plus",PenMinus:"pen-minus",PenModify:"pen-modify",PenDrag:"pen-drag",Lasso:"lasso",Pipette:"pipette",Text:"text"}}(this),function(t){function e(){}e.Constant={CHARACTER:0,SPACE:1,ENTER:2,TAB:3,BACKSPACE:4,CONTROL:5,SHIFT:6,ALT:7,LEFT:8,UP:9,RIGHT:10,DOWN:11,PAGE_UP:12,PAGE_DOWN:13,HOME:14,END:15,INSERT:16,DELETE:17,COMMAND:19,F1:30,F2:31,F3:32,F4:33,F5:34,F6:35,F7:36,F8:37,F9:38,F10:39,F11:40,F12:41,META:100,OPTION:101,REMOVE:102},e.prototype.translateKey=function(t){var n=null;switch(t){case 32:n=e.Constant.SPACE;break;case 13:n=e.Constant.ENTER;break;case 9:n=e.Constant.TAB;break;case 8:n=e.Constant.BACKSPACE;break;case 16:n=e.Constant.SHIFT;break;case 17:n=e.Constant.CONTROL;break;case 18:n=e.Constant.ALT;break;case 37:n=e.Constant.LEFT;break;case 38:n=e.Constant.UP;break;case 39:n=e.Constant.RIGHT;break;case 40:n=e.Constant.DOWN;break;case 33:n=e.Constant.PAGE_UP;break;case 34:n=e.Constant.PAGE_DOWN;break;case 36:n=e.Constant.HOME;break;case 35:n=e.Constant.END;break;case 45:n=e.Constant.INSERT;break;case 46:n=e.Constant.DELETE;break;case 112:n=e.Constant.F1;break;case 113:n=e.Constant.F2;break;case 114:n=e.Constant.F3;break;case 115:n=e.Constant.F4;break;case 116:n=e.Constant.F5;break;case 117:n=e.Constant.F6;break;case 118:n=e.Constant.F7;break;case 119:n=e.Constant.F8;break;case 120:n=e.Constant.F9;break;case 121:n=e.Constant.F10;break;case 122:n=e.Constant.F11;break;case 123:n=e.Constant.F12}return null==n&&(n=String.fromCharCode(t)),n},e.prototype.transformKey=function(t){return t===e.Constant.META||t===e.Constant.COMMAND?ifSystem.operatingSystem===IFSystem.OperatingSystem.OSX_IOS&&ifSystem.hardware===IFSystem.Hardware.Desktop?e.Constant.COMMAND:e.Constant.CONTROL:t===e.Constant.OPTION?e.Constant.ALT:t===e.Constant.REMOVE?ifSystem.operatingSystem===IFSystem.OperatingSystem.OSX_IOS?e.Constant.BACKSPACE:e.Constant.DELETE:t},e.prototype.toLocalizedName=function(t){return t=this.transformKey(t),ifLocale.getValue(e,"key."+t.toString())},e.prototype.toLocalizedShort=function(t){if(ifSystem.operatingSystem===IFSystem.OperatingSystem.OSX_IOS&&ifSystem.hardware===IFSystem.Hardware.Desktop){if(t==e.Constant.TAB)return"⇥";if(t==e.Constant.OPTION||t==e.Constant.ALT)return"⌥";if(t==e.Constant.META||t==e.Constant.COMMAND)return"⌘";if(t==e.Constant.SHIFT)return"⇧";if(t==e.Constant.CONTROL)return"⌃";if(t==e.Constant.SPACE)return"␣";if(t==e.Constant.ENTER)return"⏎";if(t==e.Constant.REMOVE)return"⌫";if(t==e.Constant.UP)return"↑";if(t==e.Constant.DOWN)return"↓";if(t==e.Constant.LEFT)return"←";if(t==e.Constant.RIGHT)return"→"}t=this.transformKey(t);var n=ifLocale.getValue(e,"key."+t.toString()+".short",null);return n||ifLocale.getValue(e,"key."+t.toString())},e.prototype.toSystemShortcut=function(t){if(ifSystem.operatingSystem===IFSystem.OperatingSystem.OSX_IOS&&ifSystem.hardware===IFSystem.Hardware.Desktop){if("-"===t)return"−";if("+"===t)return"+"}return t.toUpperCase()},e.prototype.shortcutToString=function(t){for(var e="",n=0;n<t.length;++n)n>0&&ifSystem.operatingSystem!=IFSystem.OperatingSystem.OSX_IOS&&(e+="+"),"number"==typeof t[n]?e+=this.toLocalizedShort(t[n]):e+=this.toSystemShortcut(t[n]);return e},t.IFKey=e,t.ifKey=new e}(this),function(t){function e(){this._values={},this._functions={},"en"===ifSystem.language?this.setLanguage(e.Language.English):"de"===ifSystem.language&&this.setLanguage(e.Language.German)}IFObject.inheritAndMix(e,IFObject),e.Language={English:0,German:1,Default:0},e.Key=function(t,e){this._type_id=IFObject.getTypeId(t),this._key=e},e.Constant={Create:new e.Key(e,"create"),Add:new e.Key(e,"add"),Edit:new e.Key(e,"edit"),Remove:new e.Key(e,"remove"),Delete:new e.Key(e,"delete"),Open:new e.Key(e,"open"),Save:new e.Key(e,"save"),Cancel:new e.Key(e,"cancel"),Ok:new e.Key(e,"ok"),Close:new e.Key(e,"close"),Loading:new e.Key(e,"loading"),LoadingOf:new e.Key(e,"loading_of"),Saving:new e.Key(e,"saving"),SavingOf:new e.Key(e,"saving_of"),Success:new e.Key(e,"success"),Failure:new e.Key(e,"failure"),Waiting:new e.Key(e,"waiting")},e.prototype._language=0,e.prototype._values=null,e.prototype._functions=null,e.prototype.getLanguage=function(){return this._language},e.prototype.setLanguage=function(t){t!=this._language&&(this._language=t)},e.prototype.get=function(t){return null!=t&&t instanceof e.Key?this.getValueByKey(t):t},e.prototype.getValue=function(t,n,i){var r=IFObject.getTypeId(t),o=this._getValue(this._language,r,n);if(o||this._language==e.Language.Default||(o=this._getValue(e.Language.Default,r,n)),!o&&void 0===i)throw new Error("No value found for "+IFObject.getName(t)+" and key "+n);return o||i},e.prototype.getValueByKey=function(t){return this.getValue(t._type_id,t._key)},e.prototype.setValues=function(t,e,n,i){var r=IFObject.getTypeId(t),o=this._values[e];o||(o=this._values[e]={});var s=o[r];s||(s=o[r]={});for(var a=0;a<n.length;++a)s[n[a]]=i[a]},e.prototype._getValue=function(t,e,n){var i=this._values[t];if(i){var r=i[e];if(r)return r[n]}},e.prototype.setFunction=function(t,e,n){var i=this._functions[t];i||(i=this._functions[t]={}),i[e]=n},e.prototype.getFunction=function(t){var n;if((n=this._functions[this._language])&&n.hasOwnProperty(t))return n[t];if(this._language!=e.Language.Default&&((n=this._functions[e.Language.Default])&&n.hasOwnProperty(t)))return n[t];return null},e.prototype.toString=function(){return"[Object IFLocale]"},t.IFLocale=e,t.ifLocale=new e}(this),function(t){function e(){}e.prototype.PI2=2*Math.PI,e.prototype.PIHALF=.5*Math.PI,e.prototype.defaultEps=1e-14,e.prototype.toRadians=function(t){return t*Math.PI/180},e.prototype.toDegrees=function(t){return 180*t/Math.PI},e.prototype.normalizeAngleRadians=function(t){return t>=0?this.mod(t,this.PI2):t+this.PI2*Math.floor(-t/this.PI2+1)},e.prototype.normalizeAngleDegrees=function(t){return t>=0?this.mod(t,360):t+360*Math.floor(-t/360+1)},e.prototype.normalizeValue=function(t,e,n){return t<e?e:t>n?n:t},e.prototype.isEqualEps=function(t,e,n){return n||(n=this.defaultEps),Math.abs(t-e)<=n},e.prototype.round=function(t,e,n){var i=(n=Math.abs(n)||0)?Math.pow(10,n):1;return e?Math.ceil(t*i-.5)/i:Math.round(t*i)/i},e.prototype.mod=function(t,e){return t<0?-this.mod(-t,e):t-Math.floor(t/e)*e},e.prototype.div=function(t,e){return t<0?-Math.floor(-t/e):Math.floor(t/e)},e.prototype.getIntersectionPoint=function(t,e,n,i,r,o,s,a,h){var l=(t-n)*(a-o)-(e-i)*(s-r),p=(t-r)*(a-o)-(e-o)*(s-r),u=(t-n)*(e-o)-(e-i)*(t-r);if(Math.abs(l)<this.defaultEps)return null;var c=p/l,g=u/l;return!h&&0<=c&&c<=1&&0<=g&&g<=1||h?(h&&(h[0]=c,h[1]=g),new IFPoint(t+c*(n-t),e+c*(i-e))):null},e.prototype.circleLineIntersection=function(t,e,n,i,r,o,s,a){var h=s*s,l=n*n+i*i;if(!this.isEqualEps(l,0)){var p=n*(o-e)-i*(r-t),u=h*l-p*p;this.isEqualEps(u,0)?a[0]=(n*(r-t)+i*(o-e))/l:u>0&&(p=n*(r-t)+i*(o-e),a[0]=(p-Math.sqrt(u))/l,a[1]=(p+Math.sqrt(u))/l)}},e.prototype.circleCircleIntersection=function(t,e,n,i,r,o,s){var a=this.ptSqrDist(t,e,i,r),h=Math.abs(n-o),l=h*h,p=n+o,u=p*p;if(!this.isEqualEps(a,0)){var c=(n*n-o*o)/(2*a),g=(t+i)/2+(i-t)*c,f=(e+r)/2+(r-e)*c;if(this.isEqualEps(a,u)||!this.isEqualEps(a,0)&&this.isEqualEps(a,l))s[0]=new IFPoint(g,f);else if(l<a&&a<u){var y=(r-e)*(c=Math.sqrt((u-a)*(a-l))/(2*a)),d=(t-i)*c;s[0]=new IFPoint(g+y,f+d),s[1]=new IFPoint(g-y,f-d)}}},e.prototype.getLinesIntersection=function(t,e,n,i,r,o){var s=t*r-i*e;return this.isEqualEps(s,0)?null:new IFPoint((e*o-r*n)/s,(n*i-o*t)/s)},e.prototype.getCircumcircleCenter=function(t,e,n,i,r,o){var s=t-n,a=e-i,h=n-r,l=i-o;return this.getLinesIntersection(s,a,-s*(t+n)/2-a*(e+i)/2,h,l,-h*(n+r)/2-l*(i+o)/2)},e.prototype.getPointAtLength=function(t,e,n,i,r){var o,s;return r<=0?new IFPoint(t,e):r>=(o=Math.sqrt((n-t)*(n-t)+(i-e)*(i-e)))?new IFPoint(n,i):(s=r/o,new IFPoint(t+s*(n-t),e+s*(i-e)))},e.prototype.getCurveAtT=function(t,e,n,i){var r=t+i*(n-t);return r+i*(n+i*(e-n)-r)},e.prototype.getCubicCurveAtT=function(t,e,n,i,r){var o=t+r*(n-t),s=n+r*(i-n),a=o+r*(s-o);return a+r*(s+r*(i+r*(e-i)-s)-a)},e.prototype.vDotProduct=function(t,e,n,i){return null==t||null==e||null==n||null==i?0:t*n+e*i},e.prototype.ptSqrDist=function(t,e,n,i){var r,o;return null==t||null==e||null==n||null==i?0:(r=t-n)*r+(o=e-i)*o},e.prototype.ptDist=function(t,e,n,i){return Math.sqrt(this.ptSqrDist(t,e,n,i))},e.prototype.segmentSide=function(t,e,n,i,r,o){var s=(o-e)*(n-t)+(r-t)*(e-i);return this.isEqualEps(s,0)?0:s>0?1:-1},e.prototype.sqrSegmentDist=function(t,e,n,i,r,o,s,a){if(this.isEqualEps(t,n)&&this.isEqualEps(e,i))return this.ptSqrDist(t,e,r,o);var h,l,p,u,c,g,f=0,y=0;return h=r-t,l=o-e,t==n&&e==i?(y=this.vDotProduct(h,l,h,l),s&&(s[0]=0)):s&&a&&this.vDotProduct(h,l,h,l)<=a?(s[0]=0,y=0):s&&a&&this.ptSqrDist(r,o,n,i)<=a?(s[0]=1,y=0):(p=n-t,u=i-e,(f=this.vDotProduct(h,l,p,u)/this.vDotProduct(p,u,p,u))<=0?(y=this.vDotProduct(h,l,h,l),s&&(s[0]=0)):f>=1?(y=this.vDotProduct(r-n,o-i,r-n,o-i),s&&(s[0]=1)):(c=h-p*f,g=l-u*f,y=this.vDotProduct(c,g,c,g),s&&(s[0]=f))),y},e.prototype.getSegmToSegmSqrDist=function(t,e,n,i){var r=this.sqrSegmentDist(t.getX(),t.getY(),e.getX(),e.getY(),n.getX(),n.getY()),o=r;return o>0&&((r=this.sqrSegmentDist(t.getX(),t.getY(),e.getX(),e.getY(),i.getX(),i.getY()))<o&&(o=r),o>0&&((r=this.sqrSegmentDist(n.getX(),n.getY(),i.getX(),i.getY(),t.getX(),t.getY()))<o&&(o=r),o>0&&(r=this.sqrSegmentDist(n.getX(),n.getY(),i.getX(),i.getY(),e.getX(),e.getY()))<o&&(o=r))),o},e.prototype.getVectorProjection=function(t,e,n,i,r,o,s){var a,h=r-t,l=o-e,p=n-t,u=i-e,c=this.vDotProduct(p,u,p,u);if(this.isEqualEps(c,0))a=new IFPoint(r,o);else{var g=this.vDotProduct(h,l,p,u)/c;a=g<=0&&s?new IFPoint(t,e):new IFPoint(p*g+t,u*g+e)}return a},e.prototype.solveLinear2Pseudo=function(t,e,n,i,r,o){var s,a,h=this.getLinesIntersection(t,e,-n,i,r,-o);null==h&&(this.isEqualEps(t+e,0)||this.isEqualEps(n,0)&&!this.isEqualEps(o,0)?this.isEqualEps(i+r,0)||this.isEqualEps(o,0)&&!this.isEqualEps(n,0)?this.isEqualEps(e,0)&&this.isEqualEps(r,0)?this.isEqualEps(t,0)&&this.isEqualEps(i,0)?(s=0,a=0):(a=0,s=this.isEqualEps(t,0)?o/i:n/t):(s=0,a=ifMath.isEqualEps(e,0)?o/r:n/e):a=s=o/(i+r):a=s=n/(t+e),this.isEqualEps(t*s+e*a,n)&&this.isEqualEps(i*s+r*a,o)&&(h=new IFPoint(s,a)));return h},e.prototype.divideQuadraticCurve=function(t,e,n,i,r,o){var s=t+i*(e-t),a=e+i*(n-e),h=s+i*(a-s);r[0]=t,r[1]=s,r[2]=h,o[0]=h,o[1]=a,o[2]=n},e.prototype.evalCubic=function(t,e,n,i,r){return 0==r?i:1==r?t+e+n+i:((r*t+e)*r+n)*r+i},e.prototype.getCubicCurveSplits=function(t,e,n,i,r,o,s){var a=[0,1];ifMath.getQuadraticRoots(t,e,n,a),ifMath.getQuadraticRoots(i,r,o,a);var h=e*i-r*t,l=2*(n*i-o*t),p=n*r-o*e;return ifMath.getQuadraticRoots(h,l,p,a),ifUtil.uSortSegment(0,1,a,s)},e.prototype.getCtrlPtsCasteljau=function(t,e,n,i,r,o,s,a){var h=t+r*(e-t),l=e+r*(n-e),p=n+r*(i-n),u=h+r*(l-h),c=l+r*(p-l),g=u+r*(c-u);if(null!=o&&1!=o||(s[0]=t,s[1]=h,s[2]=u,s[3]=g),null==o||2==o){if(2==o)a=s;a[0]=g,a[1]=c,a[2]=p,a[3]=i}},e.prototype.getCtrlPts=function(t,e,n,i,r,o,s){var a;0!=r?1!=o?(this.getCtrlPtsCasteljau(t,n,i,e,r,2,s),a=(o-r)/(1-r),this.getCtrlPtsCasteljau(s[0],s[1],s[2],s[3],a,1,s)):this.getCtrlPtsCasteljau(t,n,i,e,r,2,s):this.getCtrlPtsCasteljau(t,n,i,e,o,1,s)},e.prototype.evalPoly=function(t,e,n){var i=0,r=null;if(e<0)return null;if(e>0)if(0!=n)if(r=t[0],1==n)for(i=1;i<=e;++i)r+=t[i];else for(i=1;i<=e;++i)r=r*n+t[i];else r=t[e];else r=t[e];return r},e.prototype.getCoeffPolyDeriv=function(t,e,n){var i=0,r=!1;if(e>=1){for(i=0;i<e;++i)n[i]=t[i]*(e-i);r=!0}return r},e.prototype.getCubicRoots=function(t,e,n,i,r,o){var s,a,h,l,p,u,c,g,f,y,d,_,v,m,I,P=0,C=new Float64Array(4),F=new Float64Array(4),x=new Float64Array(3),S=new Float64Array(2),E=-o;if(e>=n)return 0;if(t[0]<0)for(I=0;I<4;++I)C[I]=-t[I];else for(I=0;I<4;++I)C[I]=t[I];return u=C[0],c=C[1],g=C[2],f=C[3],0==e&&1==n?this.inversePolyUnaryInterval(C,3,F):this.inversePolyInterval(C,3,e,n,F),0==this.estimPositiveRootsDescartes(F,3)?0:(this.getCoeffPolyDeriv(C,3,x),S[0]=6*u,S[1]=2*c,p=0,0==(h=c*c-x[0]*g)?(p=1,a=s=-c/x[0]):h>0&&(p=2,s=(-c-(l=Math.sqrt(h)))/x[0],a=(-c+l)/x[0]),y=this.evalCubic(u,c,g,f,e),d=this.evalCubic(u,c,g,f,n),0==p||s>=n||a<=e?E<=y&&y<=o?r&&(i[P]=e,P+=1):E<=d&&d<=o?r&&(i[P]=n,P+=1):y<0&&d>0&&(m=this.locateByNewton(e,n,y,d,C,3,x,S,o),i[P]=null!=m?m:(n+e)/2,P+=1):s<=e&&a>=n?E<=y&&y<=o?r&&(i[P]=e,P+=1):E<=d&&d<=o?r&&(i[P]=n,P+=1):y>0&&d<0&&(m=this.locateByNewton(e,n,y,d,C,3,x,S,o),i[P]=null!=m?m:(n+e)/2,P+=1):s>e&&a>=n?E<=(_=this.evalCubic(u,c,g,f,s))&&_<=o?(i[P]=s,P+=1):_>0&&(E<=y&&y<=o?r&&(i[P]=e,P+=1):y<0&&(m=this.locateByNewton(e,s,y,_,C,3,x,S,o),i[P]=null!=m?m:(e+s)/2,P+=1),E<=d&&d<=o?r&&(i[P]=n,P+=1):d<0&&(m=this.locateByNewton(s,n,_,d,C,3,x,S,o),i[P]=null!=m?m:(s+n)/2,P+=1)):s<=e&&a<n?E<=(v=this.evalCubic(u,c,g,f,a))&&v<=o?(i[P]=a,P+=1):v<0&&(E<=y&&y<=o?r&&(i[P]=e,P+=1):y>0&&(m=this.locateByNewton(e,a,y,v,C,3,x,S,o),i[P]=null!=m?m:(e+a)/2,P+=1),E<=d&&d<=o?r&&(i[P]=n,P+=1):d>0&&(m=this.locateByNewton(a,n,v,d,C,3,x,S,o),i[P]=null!=m?m:(a+n)/2,P+=1)):s==a?E<=(_=this.evalCubic(u,c,g,f,s))&&_<=o?(i[P]=s,P+=1):E<=y&&y<=o?r&&(i[P]=e,P+=1):E<=d&&d<=o?r&&(i[P]=n,P+=1):_<0&&d>0?(m=this.locateByNewton(s,n,_,d,C,3,x,S,o),i[P]=null!=m?m:(s+n)/2,P+=1):y<0&&_>0&&(m=this.locateByNewton(e,s,y,_,C,3,x,S,o),i[P]=null!=m?m:(e+s)/2,P+=1):(_=this.evalCubic(u,c,g,f,s),v=this.evalCubic(c,c,g,f,a),_<=0||v>=0?(E<=_&&_<=o&&(i[P]=s,P+=1),_<=0&&(E<=d&&d<=o?r&&(i[P]=n,P+=1):v<0&&d>0&&(m=this.locateByNewton(a,n,v,d,C,3,x,S,o),i[P]=null!=m?m:(a+n)/2,P+=1)),E<=v&&v<=o&&(i[P]=a,P+=1),v>=0&&(E<=y&&y<=o?r&&(i[P]=e,P+=1):y<0&&_>0&&(m=this.locateByNewton(e,s,y,_,C,3,x,S,o),i[P]=null!=m?m:(e+s)/2,P+=1))):(m=this.locateByNewton(s,a,_,v,C,3,x,S,o),i[P]=null!=m?m:(s+a)/2,P+=1,E<=y&&y<=o?r&&(i[P]=e,P+=1):y<0&&_>0&&(m=this.locateByNewton(e,s,y,_,C,3,x,S,o),i[P]=null!=m?m:(e+s)/2,P+=1),E<=d&&d<=o?(i[P]=n,P+=1):v<0&&d>0&&(m=this.locateByNewton(a,n,v,d,C,3,x,S,o),i[P]=null!=m?m:(a+n)/2,P+=1))),P)},e.prototype._maxIter=100,e.prototype.locateByNewton=function(t,e,n,i,r,o,s,a,h,l,p){var u,c,g,f,y,d,_,v,m,I,P,C=null,F=o-1,x=-h,S=-this.defaultEps,E=0,w=h+1,T=[],M=[],b=[],A=[],$=[];if(x<=n&&n<=h)return t;if(x<=i&&i<=h)return e;if(f=t,y=e,3==o)(g=-a[1]/a[0])<t||g>e?(c=a[0]*t+a[1])>0&&n>0||c<0&&n<0?(C=t,w=n):(c=a[0]*e+a[1])>0&&i>0||c<0&&i<0?(C=e,w=i):C=null:x<=(w=this.evalPoly(r,o,g))&&w<=h?C=g:w>0&&n>0||w<0&&n<0?(f=g+h,w=this.evalPoly(r,o,f),(c=a[0]*f+a[1])>0&&w>0||c<0&&w<0?C=f:(c=a[0]*e+a[1])>0&&i>0||c<0&&i<0?(C=e,w=i):C=null):w>0&&i>0||w<0&&i<0?(y=g-h,w=this.evalPoly(r,o,y),(c=a[0]*y+a[1])>0&&w>0||c<0&&w<0?C=y:(c=a[0]*t+a[1])>0&&n>0||c<0&&n<0?(C=t,w=n):C=null):C=null;else{if(5!=o)throw new Error("Unsupported polynomial degree.");if(I=!1,P=!1,n<0&&i>0||n>0&&i<0?P=!0:l&&p&&(I=!0),v=!0,this.getCubicRoots(a,t,e,$,false,h),E=0,0==$.length)f=t,b[0]=n,y=e,b[1]=i,I&&(M[0]=p[0],M[1]=p[1]);else for(ifUtil.uSortSegment(t,e,$,A),f=t,b[0]=n,I&&(M[0]=p[0]);E<=A.length&&(E>0&&(f=y,b[0]=b[1],I&&(M[0]=M[1])),E<A.length?(y=A[E],b[1]=null,I&&(M[1]=null)):(y=e,b[1]=i,I&&(M[1]=p[1])),!(P&&(null==b[1]&&(b[1]=this.evalPoly(r,o,y)),this.isEqualEps(b[1],0,h)&&(C=y,w=b[1],v=!1),b[0]>0&&b[1]<0||b[0]<0&&b[1]>0)))&&(!I||0==this.countRootsNSturm(r,o,s,f,y,l,M,b));)++E;if(v&&0==E&&((c=this.evalPoly(a,a.length-1,t))>0&&n>0||c<0&&n<0)&&(C=t,w=n,v=!1),v&&E==A.length&&((c=this.evalPoly(a,a.length-1,e))>0&&i>0||c<0&&i<0)&&(C=e,w=i,v=!1),v){for(d=b[0],_=b[1],I&&(T=M),C=(f+y)/2,c=this.evalPoly(a,a.length-1,C);y-f>h&&v;)C=(f+y)/2,x<=(w=this.evalPoly(r,o,C))&&w<=h||c>0&&w>0||c<0&&w<0?v=!1:w>0&&d<0||w<0&&d>0?(y=C,_=w,I&&(T[1]=null)):w>0&&_<0||w<0&&_>0?(f=C,d=w,I&&(T[0]=null)):P||!I?(v=!1,C=null):(b=[d,w],M=[T[0],null],this.countRootsNSturm(r,o,s,f,C,l,M,b)>0?(y=C,_=w,T[0]=M[0],T[1]=M[1]):null!=T[1]&&M[1]==T[1]?v=!1:(f=C,d=w,T[0]=M[0]));v&&(C=(f+y)/2,w=this.evalPoly(r,o,C))}}for(E=1;null!=C&&(w<x||h<w)&&E<this._maxIter;)S<(u=this.evalPoly(s,F,C))&&u<this.defaultEps?((w=this.evalPoly(r,o,C))<x||h<w)&&(C=null):(m=C,((C-=u=(w=this.evalPoly(r,o,C))/u)<=f||C>=y)&&(C=null),u>0?y=m:u<0&&(f=m)),++E;return E==this._maxIter&&(C=null),C},e.prototype.getQuadraticRoots=function(t,e,n,i){var r,o;0==t?0!=e&&i.push(-n/e):0==(r=e*e-4*t*n)?i.push(-e/(2*t)):r>0&&(o=Math.sqrt(r),i.push((-e+o)/(2*t)),i.push((-e-o)/(2*t)))},e.prototype._pseudoRem=function(t,e,n){var i,r,o,s,a,h=[],l=[],p=!0,u=e[0];if(e.length>t.length)return n=t,1;for(s=2;s<=t.length-e.length+1;++s)u*=e[0];for(s=0;s<t.length;++s)h[s]=t[s]*u;for(;p;){for(r=h[0]/e[0],o=!1,i=1;i<e.length;++i)(0!=(a=h[i]-r*e[i])||o)&&(l.push(a),0!=a&&(o=!0));for(i=e.length;i<h.length;++i)l.push(h[i]);l.length>=e.length?(h=l,l=[]):p=!1}if(l.length>0)for(s=0;s<l.length;++s)n[s]=l[s];return u},e.prototype.getSturmPRS=function(t,e,n,i){var r,o,s,a,h,l,p,u=[],c=[],g=[],f=[],y=[],d=[];for(c[0]=null,i[0]=t,i[1]=n,u[0]=t[0],u[1]=n[0],g[0]=1,c[1]=1,f[0]=1,f[1]=u[1],d[0]=1,d[1]=1,r=1;r<e&&(y=[],p=this._pseudoRem(i[r-1],i[r],y),0!=y.length);++r){for(i[r+1]=[],o=0;o<y.length;++o)i[r+1][o]=y[o]/c[r];for(g[r]=i[r+1].length-i[r].length,u[r+1]=i[r+1][0],a=1,h=1,l=u[r+1],s=2;s<=g[r];++s)a*=f[r],h=-h,l*=u[r+1];c[r+1]=h*a*f[r]*u[r],f[r+1]=l/a,c[r]>0&&p>0||c[r]<0&&p<0?d[r+1]=-d[r-1]:d[r+1]=d[r-1]}for(r=2;r<i.length;++r)if(d[r]<0)for(o=0;o<i[r].length;++o)i[r][o]=-i[r][o]},e.prototype.countRootsNSturm=function(t,e,n,i,r,o,s,a){var h,l,p,u=0,c=0;if(null==s[0]){for(null==a[0]&&(a[0]=this.evalPoly(o[0],o[0].length-1,i)),h=a[0],p=1;p<o.length;++p)0!=(l=this.evalPoly(o[p],o[p].length-1,i))&&(h<0&&l>0||h>0&&l<0)&&(++u,h=l);s[0]=u}else u=s[0];if(null==s[1]){for(null==a[1]&&(a[1]=this.evalPoly(o[0],o[0].length-1,r)),h=a[1],p=1;p<o.length;++p)0!=(l=this.evalPoly(o[p],o[p].length-1,r))&&(h<0&&l>0||h>0&&l<0)&&(++c,h=l);s[1]=c}else c=s[1];return u>c?u-c:c-u},e.prototype.locRootsSturm=function(t,e,n,i,r,o,s,a,h,l){var p,u,c,g,f;if(!(s<=1)&&(p=(i+r)/2,u=[a[0],null],c=[h[0],null],f=s-(g=this.countRootsNSturm(t,e,n,i,p,o,u,c)),1==g&&l.push([i,p,c[0],c[1]]),g>1&&this.locRootsSturm(t,e,n,i,p,o,g,u,c,l),1==f&&l.push([p,r,c[1],h[1]]),f>1)){var y=[u[1],a[1]],d=[c[1],h[1]];this.locRootsSturm(t,e,n,p,r,o,f,y,d,l)}},e.prototype.shiftPoly=function(t,e,n,i){var r,o,s=[];for(s[0]=1,r=1;r<=e;++r)s.push(n*s[r-1]);for(i[0]=t[0],r=1;r<=e;++r)for(i[r]=t[r],o=0;o<r;++o)i[r]+=this.combNK(e-o,r-o)*t[o]*s[r-o]},e.prototype._numComb5=[1,5,10,10,5,1],e.prototype._numComb4=[1,4,6,4,1],e.prototype._numComb3=[1,3,3,1],e.prototype._numComb2=[1,2,1],e.prototype._numComb1=[1,1],e.prototype.combNK=function(t,e){if(!(t<=5&&e<=t))throw new Error("Combinations calculation not implemented");return 5==t?this._numComb5[e]:4==t?this._numComb4[e]:3==t?this._numComb3[e]:2==t?this._numComb2[e]:1==t?this._numComb1[e]:0},e.prototype.shiftPolyOne=function(t,e,n){var i,r;for(n[0]=t[0],i=1;i<=e;++i)for(n[i]=t[i],r=0;r<i;++r)n[i]+=this.combNK(e-r,i-r)*t[r]},e.prototype.inversePolyInterval=function(t,e,n,i,r){var o,s,a,h=new Float32Array(e+1);for(o=0;o<=e;++o)h[o]=t[o];if(this.shiftPoly(t,e,n,h),0!=(s=i-n))for(a=1,o=1;o<=e;++o)a/=s,h[e-o]*=a;this.inversePolyUnaryInterval(h,e,r)},e.prototype.inversePolyUnaryInterval=function(t,e,n){var i,r=new Float32Array(e+1);for(i=0;i<=e;++i)r[i]=t[e-i];this.shiftPolyOne(r,e,n)},e.prototype.estimPositiveRootsDescartes=function(t,e){var n,i=[],r=0,o=0;for(n=0;n<=e;++n)0!=t[n]&&(i.push(t[n]),++r);for(n=0;n<r-1;++n)(i[n]>0&&i[n+1]<0||i[n]<0&&i[n+1]>0)&&(o+=1);return o},e.prototype.convertToConstrain=function(t,e,n,i,r){var o,s,a,h,l=.4142,p=new IFTransform(1,0,0,1,0,0);r&&(p=p.rotated(r));var u=(p=p.translated(t,e)).inverted().mapPoint(new IFPoint(n,i)),c=u.getX(),g=u.getY();return o=Math.abs(c),s=Math.abs(g),this.isEqualEps(o,0)||this.isEqualEps(s,0)||this.isEqualEps(o-s,0)?(h=c,a=g):o>s?(h=c,a=s/o<l?0:0>g?-o:o):(a=g,h=o/s<l?0:0>c?-s:s),p.mapPoint(new IFPoint(h,a))},t.ifMath=new e}(this),function(t){function e(){}e.prototype.indexOfEquals=function(t,e,n){for(var i=0;i<t.length;++i)if(this.equals(t[i],e,n))return i;return-1},e.prototype.equals=function(t,e,n){if(t||t!==e){if(t&&e){if(t.constructor.equals||e.constructor.equals)return t.constructor===e.constructor&&t.constructor.equals(t,e);if(t instanceof Date||e instanceof Date)return t instanceof Date&&e instanceof Date&&+t==+e;if(t instanceof Array||e instanceof Array){if(t instanceof Array&&e instanceof Array){if(t.length!==e.length)return!1;for(var i=0;i<t.length;++i)if(!this.equals(t[i],e[i],n))return!1;return!0}return!1}var r=typeof t;if(r!==typeof e)return!1;if("number"===r)return isNaN(t)||isNaN(e)?isNaN(t)&&isNaN(e):ifMath.isEqualEps(t,e);if("string"===r)return 0===t.localeCompare(e);if("boolean"===r)return+t==+e;if("object"===r){if(n){var o=Object.keys(t),s=Object.keys(e);if(!this.equals(o,s,n))return!1;for(i=0;i<o.length;++i)if(this.equals(t[o[i]],e[o[i]]),n)return!1;return!0}return t===e}return!1}return!1}return!0},e.prototype.containsObjectKey=function(t,e){for(var n in e)if(t.indexOf(n)>=0)return!0;return!1};var n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");e.prototype.uuid=function(t){var e,i=n,r=[],o=i.length;t=t||32;for(e=0;e<t;e++)r[e]=i[0|Math.random()*o];return r.join("")},e.prototype.replaceAll=function(t,e,n){for(var i=t;i.indexOf(e)>=0;)i=i.replace(e,n);return i},e.prototype.uSortSegment=function(t,e,n,i){var r=0;if(n.sort(function(t,e){return t-e}),n[0]>=t&&n[0]<=e&&(i[0]=n[0],r=1,1==n.length))return r;for(var o=1;o<n.length;o++)n[o]!=n[o-1]&&n[o]>=t&&n[o]<=e&&(i.push(n[o]),++r);return r},e.prototype.escape=function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},e.prototype.unescape=function(t){var e=ifUtil.replaceAll(t,"&lt;","<");return e=ifUtil.replaceAll(e,"&gt;",">"),e=ifUtil.replaceAll(e,"&quot;",'"'),e=ifUtil.replaceAll(e,"&#039;","'"),e=ifUtil.replaceAll(e,"&amp;","&")},e.prototype.isNumeric=function(t){return t-parseFloat(t)>=0},e.prototype.formatNumber=function(t,e,n){return n=n||",",e="number"==typeof e?e:3,ifMath.round(t,!1,e).toString().replace(".",n)},e.prototype.parseNumber=function(t){for(var e="",n=t.length;n>=0;--n){var i=t.charAt(n);","===i?e="."+e:this.isNumeric(i)&&(e=i+e)}return parseFloat(e)},e.prototype.blendRGBColors=function(t,e,n){return n=Math.min(Math.max(n,0),1),[t[0]*(1-n)+e[0]*n,t[1]*(1-n)+e[1]*n,t[2]*(1-n)+e[2]*n]},e.prototype.rgbToHtmlHex=function(t){var e,n=t[0]<<16|t[1]<<8|t[2];return"#"+(e=n.toString(16).toUpperCase(),new Array(7-e.length).join("0")+e)},t.ifUtil=new e}(this),function(t){function e(){}IFObject.inherit(e,IFObject),e.prototype._paramsToString=function(){return""},t.GEvent=e}(this),function(t){function e(){}e.prototype._listeners=null,e.prototype.addEventListener=function(t,e,n,i){var r=IFObject.getTypeId(t);this._listeners||(this._listeners={});var o=e;if(n||i){var s=i?i.slice():[];s.unshift(n||e),e=Function.prototype.bind.apply(e,s)}r in this._listeners||(this._listeners[r]={eventClass:t,listeners:[]}),this._listeners[r].listeners.push({listener:e,sourceListener:o,target:n})},e.prototype.removeEventListener=function(t,e,n){var i=IFObject.getTypeId(t);if(this._listeners&&i in this._listeners){for(var r=this._listeners[i].listeners,o=0;o<r.length;++o)r[o].sourceListener!=e||n&&r[o].target!==n||r.splice(o,1);0==r.length&&delete this._listeners[i]}},e.prototype.hasEventListeners=function(t){var e=IFObject.getTypeId(t);return!(!this._listeners||!(e in this._listeners))},e.prototype.trigger=function(t){if(this._listeners){var e=IFObject.getTypeId(t);if(e in this._listeners)for(var n=this._listeners[e].listeners,i=0;i<n.length;++i){n[i].listener.call(this,t)}}},t.GEventTarget=e}(this),function(t){function e(){}IFObject.inherit(e,GEvent),e.prototype.toString=function(){return"[Object GUIInputEvent("+this._paramsToString()+")]"},e.prototype._paramsToString=function(){return""},t.GUIInputEvent=e}(this),function(t){function e(){}IFObject.inherit(e,GUIInputEvent),e.prototype.key=null,e.prototype.toString=function(){return"[Object GUIKeyEvent("+this._paramsToString()+")]"},e.prototype.GUIKeyEvent=function(){return"key="+this.key},t.GUIKeyEvent=e,e.Down=function(){},IFObject.inherit(e.Down,e),e.Down.prototype.toString=function(){return"[Object GUIKeyEvent.Down("+this._paramsToString()+")]"},e.Release=function(){},IFObject.inherit(e.Release,e),e.Release.prototype.toString=function(){return"[Object GUIKeyEvent.Release("+this._paramsToString()+")]"},e.Press=function(){},IFObject.inherit(e.Press,e),e.Press.prototype.toString=function(){return"[Object GUIKeyEvent.Press("+this._paramsToString()+")]"}}(this),function(t){function e(){}IFObject.inherit(e,GUIInputEvent),e.BUTTON_LEFT=0,e.BUTTON_MIDDLE=1,e.BUTTON_RIGHT=2,e.isDragEvent=function(t){return t instanceof e&&(t instanceof e.DragStart||t instanceof e.Drag||t instanceof e.DragEnd)||t==e.DragStart||t==e.Drag||t==e.DragEnd},e.prototype.client=0,e.prototype.button=0,e.prototype.toString=function(){return"[Object GUIMouseEvent("+this._paramsToString()+")]"},e.prototype._paramsToString=function(){return"client="+this.client.toString()+", "+GUIInputEvent.prototype._paramsToString.call(this)},t.GUIMouseEvent=e,e.Move=function(){},IFObject.inherit(e.Move,e),e.Move.prototype.toString=function(){return"[Object GUIMouseEvent.Move("+this._paramsToString()+")]"},e.Enter=function(){},IFObject.inherit(e.Enter,e),e.Enter.prototype.toString=function(){return"[Object GUIMouseEvent.Enter("+this._paramsToString()+")]"},e.Leave=function(){},IFObject.inherit(e.Leave,e),e.Leave.prototype.toString=function(){return"[Object GUIMouseEvent.Leave("+this._paramsToString()+")]"},e.Down=function(){},IFObject.inherit(e.Down,e),e.Down.prototype.toString=function(){return"[Object GUIMouseEvent.Down("+this._paramsToString()+")]"},e.Release=function(){},IFObject.inherit(e.Release,e),e.Release.prototype.toString=function(){return"[Object GUIMouseEvent.Release("+this._paramsToString()+")]"},e.Click=function(){},IFObject.inherit(e.Click,e),e.Click.prototype.toString=function(){return"[Object GUIMouseEvent.Click("+this._paramsToString()+")]"},e.DblClick=function(){},IFObject.inherit(e.DblClick,e),e.DblClick.prototype.toString=function(){return"[Object GUIMouseEvent.DblClick("+this._paramsToString()+")]"},e.DragStart=function(){},IFObject.inherit(e.DragStart,e),e.DragStart.prototype.toString=function(){return"[Object GUIMouseEvent.DragStart("+this._paramsToString()+")]"},e.Drag=function(){},IFObject.inherit(e.Drag,e),e.prototype.clientStart=0,e.prototype.clientDelta=0,e.Drag.prototype.toString=function(){return"[Object GUIMouseEvent.Drag("+this._paramsToString()+")]"},e.DragEnd=function(){},IFObject.inherit(e.DragEnd,e.Drag),e.DragEnd.prototype.toString=function(){return"[Object GUIMouseEvent.DragEnd("+this._paramsToString()+")]"}}(this),function(t){function e(t,n){this._value=t,this._unit=n||e.Unit.PT}e.Unit={PT:"t",PX:"x",PC:"p",IN:"i",MM:"m",CM:"c"};var n={t:1,x:1,p:12,i:72,m:72/25.4,c:72/2.54};e.parseLength=function(t,n){if(!t)return null;if(0==(t=t.trim()).length)return null;var i=ifUtil.parseNumber(t);if("number"!=typeof i)return null;var r=n||e.Unit.PT,o=t.substr(i.toString().length);return o&&o.length>0&&((o=o.trim().toLowerCase()).length>=2&&"p"==o.charAt(0)&&"t"==o.charAt(1)?r=e.Unit.PT:o.length>=2&&"p"==o.charAt(0)&&"x"==o.charAt(1)?r=e.Unit.PX:o.length>=2&&"p"==o.charAt(0)&&"c"==o.charAt(1)?r=e.Unit.PC:o.length>=2&&"i"==o.charAt(0)&&"n"==o.charAt(1)?r=e.Unit.IN:o.length>=2&&"m"==o.charAt(0)&&"m"==o.charAt(1)?r=e.Unit.MM:o.length>=2&&"c"==o.charAt(0)&&"m"==o.charAt(1)?r=e.Unit.CM:o.length>=1&&"m"==o.charAt(0)&&(r=e.Unit.M)),new e(i,r)},e.parseEquation=function(t,n){n=n||e.Unit.PT;var r=new i.Context(n),o=new i.Evaluator(r);try{return result=o.evaluate(t),new e(result,n)}catch(t){return null}},e.parseEquationValue=function(t){var n=e.parseEquation(t);return n?n.getValue():null},e.prototype._value=null,e.prototype._unit=e.Unit.PT,e.prototype.getValue=function(){return this._value},e.prototype.getUnit=function(){return this._unit},e.prototype.toPoint=function(){return this._unit!=e.Unit.PT?n[this._unit]*this._value:this._value},e.prototype.toUnit=function(t){return this._unit!=t?this.toPoint()/n[t]:this._value},e.prototype.convert=function(t){return this._unit!=t?new e(this.toPoint()/n[t],t):new e(this._value,t)},e.prototype.toString=function(t){var n=ifUtil.formatNumber(this._value,t);switch(this._unit){case e.Unit.PT:n+="pt";break;case e.Unit.PX:n+="px";break;case e.Unit.PC:n+="pc";break;case e.Unit.IN:n+="in";break;case e.Unit.MM:n+="mm";break;case e.Unit.CM:n+="cm"}return n};var i={Token:{Operator:"Operator",Identifier:"Identifier",Number:"Number"}};i.Lexer=function(){var t="",e=0,n=0,r=0,o=i.Token;function s(){var i=n;return i<e?t.charAt(i):"\0"}function a(){var i="\0",r=n;return r<e&&(i=t.charAt(r),n+=1),i}function h(t){return"\t"===t||" "===t||" "===t}function l(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"}function p(t){return t>="0"&&t<="9"}function u(t,e){return{unit:t,value:e,start:r,end:n-1}}function c(t){return"_"===t||l(t)}function g(t){return c(t)||p(t)}function f(){var t;if(function(){for(;n<e&&h(s());)a()}(),!(n>=e)){if(r=n,void 0!==(t=function(){var t,i;if(p(t=s())||"."===t){if(i="","."!==t)for(i=a();p(t=s());)i+=a();if("."===t||","===t)for(i+=a();p(t=s());)i+=a();if("e"===t||"E"===t){if(i+=a(),"+"!==(t=s())&&"-"!==t&&!p(t))throw t="character "+t,n>=e&&(t="<end>"),new SyntaxError("Unexpected "+t+" after the exponent sign");for(i+=a();p(t=s());)i+=a()}if(l(t))for(i+=a();l(t=s());)i+=a();if("."===i)throw new SyntaxError("Expecting decimal digits after the dot sign");return u(o.Number,i)}}()))return t;if(void 0!==(t=function(){var t=s();if("+-*/()^%=;,".indexOf(t)>=0)return u(o.Operator,a())}()))return t;if(void 0!==(t=function(){var t;if(c(s())){for(t=a();g(s());)t+=a();return u(o.Identifier,t)}}()))return t;throw new SyntaxError("Unknown token from character "+s())}}return{reset:function(i){t=i,e=i.length,n=0},next:f,peek:function(){var t,e;e=n;try{delete(t=f()).start,delete t.end}catch(e){t=void 0}return n=e,t}}},i.Parser=function(){var t=new i.Lexer,e=i.Token;function n(t,n){return void 0!==t&&t.unit===e.Operator&&t.value===n}function r(e){var i=[];if(!n(t.next(),"("))throw new SyntaxError('Expecting ( in a function call "'+e+'"');if(n(t.peek(),")")||(i=function(){for(var e,i=[];void 0!==(e=h())&&(i.push(e),n(t.peek(),","));)t.next();return i}()),!n(t.next(),")"))throw new SyntaxError('Expecting ) in a function call "'+e+'"');return{FunctionCall:{name:e,args:i}}}function o(){var i,s;return n(i=t.peek(),"-")||n(i,"+")?(i=t.next(),s=o(),{Unary:{operator:i.value,expression:s}}):function(){var i,o;if(void 0===(i=t.peek()))throw new SyntaxError("Unexpected termination of expression");if(i.unit===e.Identifier)return i=t.next(),n(t.peek(),"(")?r(i.value):{Identifier:i.value};if(i.unit===e.Number)return{Number:(i=t.next()).value};if(n(i,"(")){if(t.next(),o=a(),!n(i=t.next(),")"))throw new SyntaxError("Expecting )");return{Expression:o}}throw new SyntaxError("Parse error, can not process token "+i.value)}()}function s(){var e,i;for(e=o(),i=t.peek();n(i,"*")||n(i,"/");)e={Binary:{operator:(i=t.next()).value,left:e,right:o()}},i=t.peek();return e}function a(){var e;return e=function(){var e,i;for(e=s(),i=t.peek();n(i,"+")||n(i,"-");)e={Binary:{operator:(i=t.next()).value,left:e,right:s()}},i=t.peek();return e}(),void 0!==e&&e.Identifier&&n(t.peek(),"=")?(t.next(),{Assignment:{name:e,value:a()}}):e}function h(){return a()}return{parse:function(e){var n,i;if(t.reset(e),n=h(),void 0!==(i=t.next()))throw new SyntaxError("Unexpected token "+i.value);return{Expression:n}}}},i.Context=function(t){return{Unit:t,Constants:{pi:3.141592653589793,phi:1.618033988749895},Functions:{abs:Math.abs,acos:Math.acos,asin:Math.asin,atan:Math.atan,ceil:Math.ceil,cos:Math.cos,exp:Math.exp,floor:Math.floor,ln:Math.ln,random:Math.random,sin:Math.sin,sqrt:Math.sqrt,tan:Math.tan},Variables:{}}},i.Evaluator=function(t){var n=new i.Parser,r=arguments.length<1?new i.Context(e.Unit.PT):t;function o(n){var i,s,a,h,l;if(n.hasOwnProperty("Expression"))return o(n.Expression);if(n.hasOwnProperty("Number")){var p=e.parseLength(n.Number,t.Unit);if(!p)throw new SyntaxError("Invalid length "+n.Number);return p.toUnit(t.Unit)}if(n.hasOwnProperty("Binary"))switch(i=o((n=n.Binary).left),s=o(n.right),n.operator){case"+":return i+s;case"-":return i-s;case"*":return i*s;case"/":return i/s;default:throw new SyntaxError("Unknown operator "+n.operator)}if(n.hasOwnProperty("Unary"))switch(a=o((n=n.Unary).expression),n.operator){case"+":return a;case"-":return-a;default:throw new SyntaxError("Unknown operator "+n.operator)}if(n.hasOwnProperty("Identifier")){if(r.Constants.hasOwnProperty(n.Identifier))return r.Constants[n.Identifier];if(r.Variables.hasOwnProperty(n.Identifier))return r.Variables[n.Identifier];throw new SyntaxError("Unknown identifier")}if(n.hasOwnProperty("Assignment"))return s=o(n.Assignment.value),r.Variables[n.Assignment.name.Identifier]=s,s;if(n.hasOwnProperty("FunctionCall")){if(a=n.FunctionCall,r.Functions.hasOwnProperty(a.name)){for(h=[],l=0;l<a.args.length;l+=1)h.push(o(a.args[l]));return r.Functions[a.name].apply(null,h)}throw new SyntaxError("Unknown function "+a.name)}throw new SyntaxError("Unknown syntax node")}return{evaluate:function(t){return o(n.parse(t))}}},t.IFLength=e}(this),function(t){function e(t,e){this._x=t,this._y=e}e.equals=function(t,e){return!(!t||t!=e)||!(!t||!e)&&(ifMath.isEqualEps(t._x,e._x)&&ifMath.isEqualEps(t._y,e._y))},e.min=function(){for(var t=new e(null,null),n=0;n<arguments.length;++n)(null==t._x||arguments[n]._x<t._x)&&(t._x=arguments[n]._x),(null==t._y||arguments[n]._y<t._y)&&(t._y=arguments[n]._y);return t},e.max=function(){for(var t=new e(null,null),n=0;n<arguments.length;++n)(null==t._x||arguments[n]._x>t._x)&&(t._x=arguments[n]._x),(null==t._y||arguments[n]._y>t._y)&&(t._y=arguments[n]._y);return t},e.prototype._x=0,e.prototype._y=0,e.prototype.getX=function(){return this._x},e.prototype.getY=function(){return this._y},e.prototype.subtract=function(t){return new e(this._x-t._x,this._y-t._y)},e.prototype.add=function(t){return new e(this._x+t._x,this._y+t._y)},e.prototype.translated=function(t,n){return new e(this._x+t,this._y+n)},e.prototype.rotated=function(t){var n=Math.cos(t),i=Math.sin(t);return new e(n*this._x-i*this._y,i*this._x+n*this._y)},e.prototype.rotatedAt=function(t,n){if(!n)return this.rotated(t);var i=Math.cos(t),r=Math.sin(t);return new e(i*(this._x-n._x)-r*(this._y-n._y)+n._x,r*(this._x-n._x)+i*(this._y-n._y)+n._y)},e.prototype.toString=function(){return"[Object IFPoint(x="+this._x+", y="+this._y+"]"},t.IFPoint=e}(this),function(t){function e(t,e,n,i){this._x=t||0,this._y=e||0,this._width=n||0,this._height=i||0}e.Side={TOP_LEFT:"tl",TOP_CENTER:"tc",TOP_RIGHT:"tr",RIGHT_CENTER:"rc",BOTTOM_RIGHT:"br",BOTTOM_CENTER:"bc",BOTTOM_LEFT:"bl",LEFT_CENTER:"lc",CENTER:"cc"},e.UNIT_RECT=new e(0,0,1,1),e.fromPoints=function(){var t=IFPoint.min.apply(null,arguments),n=IFPoint.max.apply(null,arguments);return new e(t.getX(),t.getY(),n.getX()-t.getX(),n.getY()-t.getY())},e.equals=function(t,e){return!t&&t===e||!(!t||!e)&&(ifMath.isEqualEps(t._x,e._x)&&ifMath.isEqualEps(t._y,e._y)&&ifMath.isEqualEps(t._width,e._width)&&ifMath.isEqualEps(t._height,e._height))},e.prototype._x=0,e.prototype._y=0,e.prototype._width=0,e.prototype._height=0,e.prototype.getX=function(){return this._x},e.prototype.getY=function(){return this._y},e.prototype.getWidth=function(){return this._width},e.prototype.getHeight=function(){return this._height},e.prototype.isEmpty=function(){return this._width<=0&&this._height<=0},e.prototype.containsPoint=function(t){return this.containsPointXY(t.getX(),t.getY())},e.prototype.containsPointXY=function(t,e){var n=this._x,i=this._x;if(this._width<0?n+=this._width:i+=this._width,n==i)return!1;if(t<n||t>i)return!1;var r=this._y,o=this._y;return this._height<0?r+=this._height:o+=this._height,r!=o&&!(e<r||e>o)},e.prototype.containsRect=function(t){var e=this._x,n=this._x;if(this._width<0?e+=this._width:n+=this._width,e==n)return!1;var i=t._x,r=t._x;if(t._width<0?i+=t._width:r+=t._width,i==r)return!1;if(i<e||r>n)return!1;var o=this._y,s=this._y;if(this._height<0?o+=this._height:s+=this._height,o==s)return!1;var a=t._y,h=t._y;return t._height<0?a+=t._height:h+=t._height,a!=h&&!(a<o||h>s)},e.prototype.intersectsRect=function(t){return this.intersectsRectXYWH(t._x,t._y,t._width,t._height)},e.prototype.intersectsRectXYWH=function(t,e,n,i){var r=this._x,o=this._x;if(this._width<0?r+=this._width:o+=this._width,r==o)return!1;var s=t,a=t;if(n<0?s+=n:a+=n,s==a)return!1;if(r>=a||s>=o)return!1;var h=this._y,l=this._y;if(this._height<0?h+=this._height:l+=this._height,h==l)return!1;var p=e,u=e;return i<0?p+=i:u+=i,p!=u&&!(h>=u||p>=l)},e.prototype.expanded=function(t,n,i,r){return new e(this._x-t,this._y-n,this._width+t+i,this._height+n+r)},e.prototype.translated=function(t,n){return new e(this._x+t,this._y+n,this._width,this._height)},e.prototype.scaled=function(t,n){return new e(this._x*t,this._y*n,this._width*t,this._height*n)},e.prototype.scaledAt=function(t,n,i){return i?new e((this._x-i.getX())*t+i.getX(),(this._y-i.getY())*n+i.getY(),this._width*t,this._height*n):this.scaled(t,n)},e.prototype.united=function(t){var n=this._x,i=this._x;if(this._width<0?n+=this._width:i+=this._width,n==i)return t;var r=t._x,o=t._x;if(t._width<0?r+=t._width:o+=t._width,r==o)return this;var s=this._y,a=this._y;if(this._height<0?s+=this._height:a+=this._height,s==a)return t;var h=t._y,l=t._y;if(t._height<0?h+=t._height:l+=t._height,h==l)return this;var p=new e;return p._x=Math.min(n,r),p._y=Math.min(s,h),p._width=Math.max(i,o)-p._x,p._height=Math.max(a,l)-p._y,p},e.prototype.intersected=function(t){var n=this._x,i=this._x;if(this._width<0?n+=this._width:i+=this._width,n==i)return new e(0,0,0,0);var r=t._x,o=t._x;if(t._width<0?r+=t._width:o+=t._width,r==o)return new e(0,0,0,0);if(n>=o||r>=i)return new e(0,0,0,0);var s=this._y,a=this._y;if(this._height<0?s+=this._height:a+=this._height,s==a)return new e(0,0,0,0);var h=t._y,l=t._y;if(t._height<0?h+=t._height:l+=t._height,h==l)return new e(0,0,0,0);if(s>=l||h>=a)return new e(0,0,0,0);var p=new e;return p._x=Math.max(n,r),p._y=Math.max(s,h),p._width=Math.min(i,o)-p._x,p._height=Math.min(a,l)-p._y,p},e.prototype.toAlignedRect=function(){var t=Math.floor(this._x),n=Math.ceil(this._x+this._width),i=Math.floor(this._y);return new e(t,i,n-t,Math.ceil(this._y+this._height)-i)},e.prototype.getSide=function(t){switch(t){case e.Side.TOP_LEFT:return new IFPoint(this._x,this._y);case e.Side.TOP_CENTER:return new IFPoint(this._x+this._width/2,this._y);case e.Side.TOP_RIGHT:return new IFPoint(this._x+this._width,this._y);case e.Side.RIGHT_CENTER:return new IFPoint(this._x+this._width,this._y+this._height/2);case e.Side.BOTTOM_RIGHT:return new IFPoint(this._x+this._width,this._y+this._height);case e.Side.BOTTOM_CENTER:return new IFPoint(this._x+this._width/2,this._y+this._height);case e.Side.BOTTOM_LEFT:return new IFPoint(this._x,this._y+this._height);case e.Side.LEFT_CENTER:return new IFPoint(this._x,this._y+this._height/2);case e.Side.CENTER:return new IFPoint(this._x+this._width/2,this._y+this._height/2);default:throw new Error("Illegal Argument: "+t)}},e.prototype.getClosestSideName=function(t){var n=[e.Side.TOP_LEFT,e.Side.TOP_CENTER,e.Side.TOP_RIGHT,e.Side.LEFT_CENTER,e.Side.CENTER,e.Side.RIGHT_CENTER,e.Side.BOTTOM_LEFT,e.Side.BOTTOM_CENTER,e.Side.BOTTOM_RIGHT],i=1,r=1;return t.getX()<=this._x+this._width/3?i=0:t.getX()>=this._x+2*this._width/3&&(i=2),t.getY()<=this._y+this._height/3?r=0:t.getY()>=this._y+2*this._height/3&&(r=2),n[3*r+i]},e.prototype.getResizeTransform=function(t,n,i,r,o){var s=1,a=1,h=this._x+this._width/2,l=this._y+this._height/2;switch(t){case e.Side.TOP_LEFT:case e.Side.LEFT_CENTER:case e.Side.BOTTOM_LEFT:s=(this._width-n)/this._width,o?s+=s-1:h=this._x+this._width;break;case e.Side.TOP_RIGHT:case e.Side.RIGHT_CENTER:case e.Side.BOTTOM_RIGHT:s=(this._width+n)/this._width,o?s+=s-1:h=this._x}switch(t){case e.Side.TOP_LEFT:case e.Side.TOP_CENTER:case e.Side.TOP_RIGHT:a=(this._height-i)/this._height,o?a+=a-1:l=this._y+this._height;break;case e.Side.BOTTOM_LEFT:case e.Side.BOTTOM_CENTER:case e.Side.BOTTOM_RIGHT:a=(this._height+i)/this._height,o?a+=a-1:l=this._y}if(r)switch(t){case e.Side.TOP_CENTER:case e.Side.BOTTOM_CENTER:s=Math.abs(a);break;case e.Side.LEFT_CENTER:case e.Side.RIGHT_CENTER:a=Math.abs(s);break;default:Math.abs(s)>Math.abs(a)?a=ifMath.isEqualEps(a,0)?s:a*Math.abs(s)/Math.abs(a):s=ifMath.isEqualEps(s,0)?a:s*Math.abs(a)/Math.abs(s)}return new IFTransform(1,0,0,1,-h,-l).multiplied(new IFTransform(s,0,0,a,0,0)).multiplied(new IFTransform(1,0,0,1,h,l))},e.prototype.toString=function(){return"[Object IFRect(x="+this._x+", y="+this._y+", width="+this._width+", height="+this._height+")]"},t.IFRect=e}(this),function(t){function e(t,e,n,i,r,o){this._sx="number"==typeof t?t:1,this._shy="number"==typeof e?e:0,this._shx="number"==typeof n?n:0,this._sy="number"==typeof i?i:1,this._tx="number"==typeof r?r:0,this._ty="number"==typeof o?o:0}e.serialize=function(t){return t.isIdentity()?[]:t.getMatrix()},e.deserialize=function(t){return t&&t.length>=6?new e(t[0],t[1],t[2],t[3],t[4],t[5]):new e},e.equals=function(t,e){return!(!t||t!=e)||!(!t||!e)&&(ifMath.isEqualEps(t._sx,e._sx)&&ifMath.isEqualEps(t._shy,e._shy)&&ifMath.isEqualEps(t._shx,e._shx)&&ifMath.isEqualEps(t._sy,e._sy)&&ifMath.isEqualEps(t._tx,e._tx)&&ifMath.isEqualEps(t._ty,e._ty))},e.prototype._sx,e.prototype._shy,e.prototype._shx,e.prototype._sy,e.prototype._tx,e.prototype._ty,e.prototype.isIdentity=function(){return ifMath.isEqualEps(this._sx,1)&&ifMath.isEqualEps(this._shy,0)&&ifMath.isEqualEps(this._shx,0)&&ifMath.isEqualEps(this._sy,1)&&ifMath.isEqualEps(this._tx,0)&&ifMath.isEqualEps(this._ty,0)},e.prototype.isValid=function(){return Math.abs(this._sx)>ifMath.defaultEps&&Math.abs(this._sy)>ifMath.defaultEps},e.prototype.getMatrix=function(){return[this._sx,this._shy,this._shx,this._sy,this._tx,this._ty]},e.prototype.getDeterminant=function(){return this._sx*this._sy-this._shy*this._shx},e.prototype.getDeterminantReciprocal=function(){return 1/(this._sx*this._sy-this._shy*this._shx)},e.prototype.getTranslation=function(){return new IFPoint(this._tx,this._ty)},e.prototype.getScaleFactor=function(){var t=.707106781*this._sx+.707106781*this._shx,e=.707106781*this._shy+.707106781*this._sy;return Math.sqrt(t*t+e*e)},e.prototype.getRotationFactor=function(){return Math.atan2(this._shx,this._sx)},e.prototype.multiplied=function(t){var n=this._sx,i=this._shy,r=this._shx,o=this._sy,s=this._tx,a=this._ty,h=n*t._sx+i*t._shx,l=r*t._sx+o*t._shx,p=s*t._sx+a*t._shx+t._tx;return i=n*t._shy+i*t._sy,o=r*t._shy+o*t._sy,a=s*t._shy+a*t._sy+t._ty,new e(n=h,i,r=l,o,s=p,a)},e.prototype.preMultiplied=function(t){var n=t._sx*this._sx+t._shy*this._shx,i=t._sx*this._shy+t._shy*this._sy,r=t._shx*this._shy+t._sy*this._sy;return new e(n,i,t._shx*this._sx+t._sy*this._shx,r,t._tx*this._sx+t._ty*this._shx+this._tx,t._tx*this._shy+t._ty*this._sy+this._ty)},e.prototype.inverted=function(){var t=this._sx,n=this._sy,i=this._shx,r=this._shy,o=this._tx,s=this._ty,a=1/(t*n-r*i),h=n*a,l=-o*h-s*(i=-i*a);return s=-o*(r=-r*a)-s*(n=t*a),new e(t=h,r,i,n,o=l,s)},e.prototype.rotated=function(t){return this.multiplied(new e(Math.cos(t),Math.sin(t),-Math.sin(t),Math.cos(t),0,0))},e.prototype.translated=function(t,n){return this.multiplied(new e(1,0,0,1,t,n))},e.prototype.scaled=function(t,n){return n||(n=t),this.multiplied(new e(t,0,0,n,0,0))},e.prototype.skewed=function(t,n){return this.multiplied(new e(1,Math.tan(n),Math.tan(t),1,0,0))},e.prototype.map=function(t){if(!this.isIdentity()){var e=t.x;t.x=e*this._sx+t.y*this._shx+this._tx,t.y=e*this._shy+t.y*this._sy+this._ty}},e.prototype.mapPoint=function(t){if(this.isIdentity())return t;var e=t.getX(),n=t.getY(),i=e*this._sx+n*this._shx+this._tx,r=e*this._shy+n*this._sy+this._ty;return new IFPoint(i,r)},e.prototype.mapRect=function(t){if(this.isIdentity()||null==t)return t;var e=t.getSide(IFRect.Side.TOP_LEFT),n=t.getSide(IFRect.Side.TOP_RIGHT),i=t.getSide(IFRect.Side.BOTTOM_RIGHT),r=t.getSide(IFRect.Side.BOTTOM_LEFT);return IFRect.fromPoints(this.mapPoint(e),this.mapPoint(n),this.mapPoint(i),this.mapPoint(r))},e.prototype.toString=function(){return"[Object IFTransform(sx="+this._sx.toString()+", shy="+this._shy.toString()+", shx="+this._shx.toString()+", sx="+this._sx.toString()+", tx="+this._tx.toString()+", ty="+this._ty.toString()+")]"},t.IFTransform=e}(this),function(t){function e(){}e.Command={Move:1,Line:2,Curve:3,Curve2:4,Close:5},e.prototype.command=null,e.prototype.x=null,e.prototype.y=null,t.IFVertex=e}(this),function(t){function e(){}e.prototype.rewindVertices=function(t){return!1},e.prototype.readVertex=function(t){return!1},e.prototype.toString=function(){return"[Object IFVertexSource]"},t.IFVertexSource=e}(this),function(t){function e(){}e.prototype.addVertex=function(t,e,n){throw new Error("Not Supported")},e.prototype.appendVertices=function(t,e){if(t.rewindVertices(e||0))for(var n=new IFVertex;t.readVertex(n);)this.addVertex(n.command,n.x,n.y)},e.prototype.clearVertices=function(){throw new Error("Not Supported.")},e.prototype.toString=function(){return"[Object IFVertexTarget]"},t.IFVertexTarget=e}(this),function(t){function e(){this._vertices=[]}IFObject.mix(e,[IFVertexSource,IFVertexTarget]),e.prototype._index=0,e.prototype._vertices=null,e.prototype.addVertex=function(t,e,n){this._vertices.push({c:t,x:e,y:n}),this._index=this._vertices.length+1},e.prototype.clearVertices=function(){this._vertices=[]},e.prototype.transformVertices=function(t){for(var e=0;e<this._vertices.length;++e)t.map(this._vertices[e])},e.prototype.getCount=function(){return this._vertices.length},e.prototype.rewindVertices=function(t){return t>=0&&t<=this._vertices.length&&(this._index=t,!0)},e.prototype.readVertex=function(t){if(this._index>=0&&this._index<this._vertices.length){var e=this._vertices[this._index];return t.command=e.c,t.x=e.x,t.y=e.y,this._index++,!0}return!1},e.prototype.toString=function(){return"[Object IFVertexContainer]"},t.IFVertexContainer=e}(this),function(t){function e(){}e.HitResult=function(){},e.HitResult.prototype.segment=null,e.HitResult.prototype.x=null,e.HitResult.prototype.y=null,e.HitResult.prototype.slope=null,e.HitResult.prototype.outline=null,e.prototype._hitTestSegment=function(t,e,n,i,r,o,s,a,h){var l=[];return ifMath.sqrSegmentDist(t,e,n,i,r,o,l,s)<=s&&(h&&(h.segment=a,h.x=t+l[0]*(n-t),h.y=e+l[0]*(i-e),h.slope=l[0],h.outline=!0),!0)},e.prototype._hitTestCurve=function(t,e,n,i,r,o,s,a,h,l,p){var u,c,g,f,y,d,_,v,m,I,P,C,F,x,S=[],E=new Float64Array(5),w=new Float64Array(4),T=[],M=!1,b=!0;if(P=(t+n+r)/3,C=(e+i+o)/3,ifMath.sqrSegmentDist(t,e,n,i,s,a,S,h)<=h?M=!0:ifMath.segmentSide(t,e,n,i,s,a)*ifMath.segmentSide(t,e,n,i,P,C)<0&&(b=!1),M&&(0==S[0]||1==S[0]))return p&&(p.segment=l,p.outline=!0,p.slope=S[0],0==S[0]?(p.x=t,p.y=e):(p.x=n,p.y=i)),!0;if(ifMath.sqrSegmentDist(t,e,r,o,s,a)<=h?M=!0:ifMath.segmentSide(t,e,r,o,s,a)*ifMath.segmentSide(t,e,r,o,P,C)<0&&(b=!1),ifMath.sqrSegmentDist(r,o,n,i,s,a)<=h?M=!0:ifMath.segmentSide(r,o,n,i,s,a)*ifMath.segmentSide(r,o,n,i,P,C)<0&&(b=!1),!M&&!b)return!1;if(c=i-2*o+e,0==(u=n-2*r+t)&&0==c)return this._hitTestSegment(t,e,n,i,s,a,h,l,p);if(g=2*(r-t),f=2*(o-e),E[0]=u*u+c*c,E[1]=2*(u*g+c*f),E[2]=g*g+f*f+2*u*(t-s)+2*c*(e-a),E[3]=2*(g*(t-s)+f*(e-a)),E[4]=(t-s)*(t-s)+(e-a)*(e-a),F=2*E[0],y=3*E[1]/(2*F),d=E[2]/F,_=E[3]/(2*F),w[0]=1,w[1]=y,w[2]=d,w[3]=_,0==(v=ifMath.getCubicRoots(w,0,1,T,false,1e-6)))return!1;for(m=h+1,I=v+1,x=0;x<v;++x)m>(F=ifMath.evalPoly(E,4,T[x]))&&(m=F,I=x);return m<=h&&(p&&(p.segment=l,p.x=(T[I]*u+g)*T[I]+t,p.y=(T[I]*c+f)*T[I]+e,p.outline=!0,p.slope=T[I]),!0)},e.prototype._hitTestCurve2=function(t,e,n,i,r,o,s,a,h,l,p,u,c){var g,f,y,d,_,v,m,I,P,C,F,x,S,E,w,T,M,b,A,$,O,B,R,N,V,L,k,G,Y,X,D,q,U,H,j,K,W=[],z=new Float64Array(7),J=new Float64Array(6),Q=new Float64Array(6),Z=new Float64Array(4),tt=new Float64Array(4),et=null,nt=null,it=!1,rt=!0,ot=[];if(C=3*(v=r-t),F=3*(m=o-e),I=3*(E=s-r-v),d=2*E,P=3*(E=a-o-m),f=n-s-v-d,y=i-a-m-(_=2*E),w=t-h,T=e-l,z[0]=f*f+y*y,z[1]=2*(f*I+y*P),z[2]=I*I+P*P+2*(f*C+y*F),z[3]=2*(f*w+I*C+y*T+P*F),z[4]=C*C+F*F+2*(I*w+P*T),z[5]=2*(C*w+F*T),z[6]=w*w+T*T,ifMath.getCoeffPolyDeriv(z,6,J),ifMath.inversePolyUnaryInterval(J,5,Q),0==ifMath.estimPositiveRootsDescartes(Q,5))return x=ifMath.ptSqrDist(t,e,h,l),S=ifMath.ptSqrDist(n,i,h,l),(x<=p||S<=p)&&(c&&(c.segment=u,c.outline=!0,x<S?(c.x=t,c.y=e,c.slope=0):(c.x=n,c.y=i,c.slope=1)),!0);g=ifMath.getCubicCurveSplits(f,d,v,y,_,m,W);for(var st=0;st<g-1;++st){if(0==st){if(M=W[st],A=ifMath.evalCubic(f,I,C,t,M),$=ifMath.evalCubic(y,P,F,e,M),ifMath.ptSqrDist(A,$,h,l)<=p)return c&&(c.segment=u,c.outline=!0,c.x=A,c.y=$,c.slope=M),!0}else M=b,A=O,$=B;if(b=W[st+1],O=ifMath.evalCubic(f,I,C,t,b),B=ifMath.evalCubic(y,P,F,e,b),(R=ifMath.ptSqrDist(O,B,h,l))<=p)return c&&(c.segment=u,c.outline=!0,c.x=O,c.y=B,c.slope=b),!0;for(ifMath.getCtrlPts(t,n,r,s,M,b,Z),ifMath.getCtrlPts(e,i,o,a,M,b,tt),it=!1,rt=!0,U=(Z[0]+Z[1]+Z[2]+Z[3])/4,H=(tt[0]+tt[1]+tt[2]+tt[3])/4,D=0;D<4;++D){if(q=3==D?0:D+1,ifMath.sqrSegmentDist(Z[D],tt[D],Z[q],tt[q],h,l)<=p){it=!0;break}ifMath.segmentSide(Z[D],tt[D],Z[q],tt[q],h,l)*ifMath.segmentSide(Z[D],tt[D],Z[q],tt[q],U,H)<0&&(rt=!1)}if((it||rt)&&(N=ifMath.evalPoly(J,5,M),ifMath.isEqualEps(N,0)&&(M+=.005,N=ifMath.evalPoly(J,5,M)),V=ifMath.evalPoly(J,5,b),ifMath.isEqualEps(V,0)&&(b-=.005,V=ifMath.evalPoly(J,5,b)),ifMath.inversePolyInterval(J,5,M,b,Q),0!=(L=ifMath.estimPositiveRootsDescartes(Q,5)))){if(et||(et=new Float64Array(5),ifMath.getCoeffPolyDeriv(J,5,et)),nt||(nt=new Float64Array(4),ifMath.getCoeffPolyDeriv(et,4,nt)),1==L&&(null==(G=ifMath.locateByNewton(M,b,N,V,J,5,et,nt,.005))&&(G=(M+b)/2),Y=ifMath.evalCubic(f,I,C,t,G),X=ifMath.evalCubic(y,P,F,e,G),ifMath.ptSqrDist(Y,X,h,l)<=p))return c&&(c.segment=u,c.outline=!0,c.x=Y,c.y=X,c.slope=G),!0;if(L>1){if(0==ot.length&&ifMath.getSturmPRS(J,5,et,ot),j=[],K=[N,V],0==(k=ifMath.countRootsNSturm(J,5,et,M,b,ot,j,K)))continue;if(1==k&&(null==(G=ifMath.locateByNewton(M,b,N,V,J,5,et,nt,.005,ot,j))&&(G=(M+b)/2),Y=ifMath.evalCubic(f,I,C,t,G),X=ifMath.evalCubic(y,P,F,e,G),ifMath.ptSqrDist(Y,X,h,l)<=p))return c&&(c.segment=u,c.outline=!0,c.x=Y,c.y=X,c.slope=G),!0;if(k>1){var at=[];ifMath.locRootsSturm(J,5,et,M,b,ot,k,j,K,at);for(var ht=0;ht<at.length;++ht)if(null==(G=ifMath.locateByNewton(at[ht][0],at[ht][1],at[ht][2],at[ht][3],J,5,et,nt,.005,ot))&&(G=(at[ht][0]+at[ht][1])/2),Y=ifMath.evalCubic(f,I,C,t,G),X=ifMath.evalCubic(y,P,F,e,G),ifMath.ptSqrDist(Y,X,h,l)<=p)return c&&(c.segment=u,c.outline=!0,c.x=Y,c.y=X,c.slope=G),!0}}}}return!1},e.prototype._hitUnderSegment=function(t,e,n,i,r,o,s){var a,h,l;return a=ifMath.segmentSide(0,0,t,e,r,o),h=ifMath.segmentSide(t,e,n,i,r,o),l=ifMath.segmentSide(n,i,0,0,r,o),a>0&&h>0&&l>0?2:a<0&&h<0&&l<0?-2:0==a?h>0&&l>0?1:h<0&&l<0?-1:0:0==l?a>0&&h>0?1:a<0&&h<0?-1:0:s&&0==h?a>0&&l>0?1:a<0&&l<0?-1:0:0},e.prototype._evalConicReg=function(t,e,n,i,r,o,s,a,h,l){var p,u,c,g,f=-ifMath.segmentSide(t,e,n,i,r,o);return 0==f?this._hitUnderSegment(t,e,n,i,h,l):(p=this._hitUnderSegment(t,e,n,i,h,l,!0),(u=s(h,l))<0?p:0==u?f+p:(c=-a(r,o),(g=-a(h,l))>0&&c<0||g<0&&c>0?f+f+p:p))},e.prototype._hitUnderCurve=function(t,e,n,i,r,o,s,a){return this._evalConicReg(t,e,n,i,r,o,function(s,a){var h,l,p,u=(t+r+n)/3,c=(e+o+i)/3;return 0==(p=ifMath.segmentSide(n,i,t,e,s,a))?0:(h=ifMath.segmentSide(t,e,r,o,s,a),l=ifMath.segmentSide(r,o,n,i,s,a),h!=ifMath.segmentSide(t,e,r,o,u,c)||l!=ifMath.segmentSide(r,o,n,i,u,c)||p!=ifMath.segmentSide(n,i,t,e,u,c)?-1:1)},function(s,a){var h=(t-r)*(i-o)+(r-n)*(e-o),l=s-r,p=a-o,u=l*(e-2*o+i)-p*(t-2*r+n);return u*u+(2*(l*(e-i)+p*(n-t))+h)*h},s,a)},e.prototype._hitUnderCurve2=function(t,e,n,i,r,o,s,a,h,l){var p,u,c,g,f,y,d,_,v,m,I,P,C,F,x,S,E,w,T,M,b,A,$,O,B,R,N,V,L,k,G,Y,X,D=0,q=[];v=3*(f=r-t),m=3*(y=o-e),d=3*(w=s-r-f),c=2*w,_=3*(w=a-o-y),x=c*(u=i-a-y-(g=2*w))-g*(p=n-s-f-c),S=2*(f*u-y*p),E=f*g-y*c,ifMath.getQuadraticRoots(x,S,E,q),0==q.length&&(I=new Float64Array(4),P=new Float64Array(4),C=new Float64Array(4),F=new Float64Array(4),I[0]=p,I[1]=d,I[2]=v,I[3]=t,P[0]=u,P[1]=_,P[2]=m,P[3]=e,ifMath.shiftPoly(I,3,.5,C),ifMath.shiftPoly(P,3,.5,F),T=-C[0],M=C[1]/3,b=-C[2]/3,A=-F[0],(w=12*(R=T*($=F[1]/3)-M*A)*(M*(O=-F[2]/3)-b*$)-3*(B=T*O-b*A)*B)>0&&(L=(B+(N=Math.sqrt(w)))/(2*R),-.5<(V=(B-N)/(2*R))&&V<.5&&(q.push(V+.5),-.5<L&&L<.5&&(q.push(L+.5),q.push((V+L)/2+.5))),-.5<L&&L<.5&&q.push(L+.5))),q.push(0),q.push(1);var U=[],H=ifUtil.uSortSegment(0,1,q,U);k=new Float64Array(4),G=new Float64Array(4);for(var j=0;j<H-1;++j){function K(t,e){var n=k[0]-3*k[1]+3*k[2]-k[3],i=(k[0]-k[1]-k[2]+k[3])/2,r=(k[0]+k[1]-k[2]-k[3])/4,o=(k[0]+3*k[1]+3*k[2]+k[3])/8,s=G[0]-3*G[1]+3*G[2]-G[3],a=(G[0]-G[1]-G[2]+G[3])/2,h=(G[0]+G[1]-G[2]-G[3])/4,l=(G[0]+3*G[1]+3*G[2]+G[3])/8,p=n*h-r*s,u=n*a-i*s,c=i*h-r*a,g=n*l-o*s,f=i*l-o*a,y=r*l-o*h,d=n*n,_=s*s,v=p*p,m=g*g,I=u*f,P=u*p,C=3*I-p*g,F=3*v-u*(4*g+9*c);return(_*s*t-3*(n*_)*e+3*(g*_-3*s*(2*u*h+p*a)+9*u*(a*a)))*(t*t)+(3*(d*s)*t-d*n*e+3*(g*d-3*(2*u*r+p*i)*n+9*u*(i*i)))*(e*e)+3*((m*s+6*C*a+3*F*h+9*P*l-((2*g+3*c)*n*s+9*(2*u*i*a+i*r*_-d*a*h))*e)*t-(m*n+6*C*i+3*F*r+9*P*o)*e)+(g*(m-9*(p*f+2*u*y))+27*(I*f+v*y)-81*(u*c)*y)}function W(t,e){var n,i,r,o=(k[0]+k[1]+k[2]+k[3])/4,s=(G[0]+G[1]+G[2]+G[3])/4;for(i=0;i<4;++i){if(r=3==i?0:i+1,n=ifMath.segmentSide(k[i],G[i],k[r],G[r],t,e),3==i&&0==n)return 0;if(n*ifMath.segmentSide(k[i],G[i],k[r],G[r],o,s)<0)return-1}return 1}Y=0==j?U[j]:X,X=U[j+1],0==Y&&1==X?(k[0]=t,k[1]=r,k[2]=s,k[3]=n,G[0]=e,G[1]=o,G[2]=a,G[3]=i):(ifMath.getCtrlPts(t,n,r,s,Y,X,k),ifMath.getCtrlPts(e,i,o,a,Y,X,G)),ifMath.isEqualEps(k[0],k[1])&&ifMath.isEqualEps(G[0],G[1])?D+=this._evalConicReg(k[0],G[0],k[3],G[3],k[2],G[2],W,K,h,l):D+=this._evalConicReg(k[0],G[0],k[3],G[3],k[1],G[1],W,K,h,l)}return D},e.prototype.hitTest=function(t,e,n,i,r,o,s){var a,h,l,p,u,c,g,f,y=0,d=!1,_=new IFVertex,v=i?i/2*(i/2):ifMath.defaultEps,m=0,I=0;if(g=null,f=null,ifMath.isEqualEps(t,0)&&ifMath.isEqualEps(e,0)&&(I=1),n.rewindVertices(0)){for(;n.readVertex(_);)switch(_.command){case IFVertex.Command.Move:g=a=_.x,f=h=_.y;break;case IFVertex.Command.Line:if(++y,d=this._hitTestSegment(a,h,_.x,_.y,t,e,v,y,o))return d;r&&(m+=this._hitUnderSegment(a+I,h,_.x+I,_.y,t+I,e)),a=_.x,h=_.y;break;case IFVertex.Command.Curve:if(++y,l=_.x,p=_.y,n.readVertex(_)){if(d=this._hitTestCurve(a,h,l,p,_.x,_.y,t,e,v,y,o))return d;r&&(m+=this._hitUnderCurve(a+I,h,l+I,p,_.x+I,_.y,t+I,e)),a=l,h=p}break;case IFVertex.Command.Curve2:if(++y,l=_.x,p=_.y,n.readVertex(_)&&(u=_.x,c=_.y,n.readVertex(_))){if(d=this._hitTestCurve2(a,h,l,p,u,c,_.x,_.y,t,e,v,y,o))return d;r&&(m+=this._hitUnderCurve2(a+I,h,l+I,p,u+I,c,_.x+I,_.y,t+I,e)),a=l,h=p}break;case IFVertex.Command.Close:if(g!=a||f!=h){if(++y,d=this._hitTestSegment(a,h,g,f,t,e,v,y,o))return d;r&&(m+=this._hitUnderSegment(a+I,h,g+I,f,t+I,e))}g=a,f=h;break;default:throw new Error("Unknown vertex command: "+_.command.toString())}r&&(null==s&&(2==m||-2==m)||2==m&&!s||-2==m&&s)&&(o&&(o.outline=!1),d=!0)}return d},e.prototype.calculateBounds=function(t,e){if(t.rewindVertices(0)){var n=null,i=null,r=null,o=null;function s(t,e){(null==n||t<n)&&(n=t),(null==r||t>r)&&(r=t),(null==i||e<i)&&(i=e),(null==o||e>o)&&(o=e)}function a(t,e,n,i,r,o){var a=0,h=0,l=0;s(n,i),0!=(h=n-2*r+t)&&(a=(t-r)/h)>0&&a<1&&s((t*n-r*r)/(n-2*r+t),l=ifMath.getCurveAtT(e,i,o,a)),0!=(h=i-2*o+e)&&(a=(e-o)/h)>0&&a<1&&(l=(e*i-o*o)/(i-2*o+e),s(ifMath.getCurveAtT(t,n,r,a),l))}function h(t,e,n,i,r,o,a,h){s(n,i);var l=r-t,p=o-e,u=2*(a-r-l),c=2*(h-o-p),g=i-h-p-c;function f(l){l>0&&l<1&&s(ifMath.getCubicCurveAtT(t,n,r,a,l),ifMath.getCubicCurveAtT(e,i,o,h,l))}function y(t,e,n){var i=0,r=0;0==t?0!=e&&f(-n/e):0==(i=e*e-4*t*n)?f(-e/(2*t)):i>0&&(r=Math.sqrt(i),f((-e+r)/(2*t)),f((-e-r)/(2*t)))}y(n-a-l-u,u,l),y(g,c,p)}for(var l,p,u,c,g,f,y=new IFVertex;t.readVertex(y);)switch(y.command){case IFVertex.Command.Move:case IFVertex.Command.Line:s(y.x,y.y),l=y.x,p=y.y;break;case IFVertex.Command.Curve:u=y.x,c=y.y,t.readVertex(y)&&(e?a(l,p,u,c,y.x,y.y):(s(u,c),s(y.x,y.y)),l=u,p=c);break;case IFVertex.Command.Curve2:u=y.x,c=y.y,t.readVertex(y)&&(g=y.x,f=y.y,t.readVertex(y)&&(e?h(l,p,u,c,g,f,y.x,y.y):(s(u,c),s(g,f),s(y.x,y.y)),l=u,p=c));break;case IFVertex.Command.Close:break;default:throw new Error("Unknown vertex command: "+y.command.toString())}if(null!=n&&null!=i)return new IFRect(n,i,null!=r?r-n:0,null!=o?o-i:0)}return null},e.prototype.toString=function(){return"[Object IFVertexInfo]"},t.IFVertexInfo=e,t.ifVertexInfo=new e}(this),function(t){function e(t){this._source=t}IFObject.inherit(e,IFVertexSource),e.prototype._source=null,e.prototype.rewindVertices=function(t){return this._source.rewindVertices(t)},e.prototype.readVertex=function(t){return!!this._source.readVertex(t)&&(t.command>=IFVertex.Command.Move&&t.command<IFVertex.Command.Close&&(t.x=Math.floor(t.x)+.5,t.y=Math.floor(t.y)+.5),!0)},e.prototype.toString=function(){return"[Object IFVertexPixelAligner]"},t.IFVertexPixelAligner=e}(this),function(t){function e(t,e){this._source=t,this._transform=e}IFObject.inherit(e,IFVertexSource),e.transformVertex=function(t,e){if(e)switch(t.command){case IFVertex.Command.Move:case IFVertex.Command.Line:case IFVertex.Command.Curve:case IFVertex.Command.Curve2:e.map(t);break;case IFVertex.Command.Close:break;default:throw new Error("Unknown vertex command: "+t.command.toString())}},e.prototype._source=null,e.prototype._transform=null,e.prototype.getTransform=function(){return this._transform},e.prototype.setTransform=function(t){this._transform=t},e.prototype.rewindVertices=function(t){return this._source.rewindVertices(t)},e.prototype.readVertex=function(t){return!!this._source.readVertex(t)&&(e.transformVertex(t,this._transform),!0)},e.prototype.toString=function(){return"[Object IFVertexTransformer]"},t.IFVertexTransformer=e}(this),function(t){function e(t,e,n,i,r){this._tolerance=r?r/3:.03,this._source=t,this._offset=e,this._makeInset=n,this._makeOutset=i,this._startVertex=null;for(var o=1,s=(r=this._tolerance,0);r<1;++s)r*=10,o*=10;this._tolRange=o}IFObject.inherit(e,IFVertexSource),e.MAX_RECURS=100,e.PolySegment=function(t,e,n,i){if(this.point=t,null!=e&&(this.bulge=e,e)){if(!n||!i||i<0)return;this.center=n,this.radius=i}},e.PolySegment.prototype.point=null,e.PolySegment.prototype.bulge=null,e.PolySegment.prototype.center=null,e.PolySegment.prototype.radius=null,e.PolySegment.prototype.next=null,e.PolySegment.prototype.previous=null,e.PolyOffsetSegment=function(t,n,i,r,o,s){e.PolySegment.call(this,n,r,o,s),this.basepoint=t,i&&(this.point2=i)},IFObject.inherit(e.PolyOffsetSegment,e.PolySegment),e.PolyOffsetSegment.prototype.basepoint=null,e.PolyOffsetSegment.prototype.point2=null,e.IntersectionType=function(){},e.IntersectionType.prototype.TIP=!1,e.IntersectionType.prototype.FIP=!1,e.IntersectionType.prototype.PFIP=!1,e.IntersectionResult=function(){this.intTypes=[new e.IntersectionType,new e.IntersectionType]},e.IntersectionResult.prototype.point=null,e.IntersectionResult.prototype.intTypes=null,e.IntersectionResult.prototype.clear=function(){this.point=null,this.intTypes[0].TIP=!1,this.intTypes[0].FIP=!1,this.intTypes[0].PFIP=!1,this.intTypes[1].TIP=!1,this.intTypes[1].FIP=!1,this.intTypes[1].PFIP=!1},e.PolySegmentContainer=function(){this.count=0},e.PolySegmentContainer.prototype.head=null,e.PolySegmentContainer.prototype.end=null,e.PolySegmentContainer.prototype.closed=null,e.PolySegmentContainer.prototype.count=0,e.PolySegmentContainer.prototype.insertSegment=function(t,e){t.next=null,t.previous=null,this.head?e?(this.head==e?this.head=t:(t.previous=e.previous,e.previous.next=t),t.next=e,e.previous=t):(this.end.next=t,t.previous=this.end,this.end=t):(this.head=t,this.end=t),++this.count},e.PolySegmentContainer.prototype.deleteSegment=function(t){t.previous&&(t.previous.next=t.next),t.next&&(t.next.previous=t.previous),this.head==t&&(this.head=t.next),this.end==t&&(this.end=t.previous),--this.count},e.IntersectionPt=function(t,e,n,i,r){this.x=t,this.y=e,this.slope=n,this.segm=i,this.segmIdx=r},e.IntersectionPt.prototype.x=null,e.IntersectionPt.prototype.y=null,e.IntersectionPt.prototype.slope=null,e.IntersectionPt.prototype.segm=null,e.IntersectionPt.prototype.segmIdx=null,e.prototype._source=null,e.prototype._offset=null,e.prototype._makeInset=!1,e.prototype._makeOutset=!1,e.prototype._tolerance=null,e.prototype._tolRange=1,e.prototype._polyline=null,e.prototype._polyinset=null,e.prototype._polyoutset=null,e.prototype._pieces=null,e.prototype._pieceIdx=0,e.prototype._startVertex=null,e.prototype.rewindVertices=function(t){return 0==t&&(this._pieces=null,this._pieceIdx=0,this._startVertex=null,this._source.rewindVertices(0))},e.prototype.readVertex=function(t){return!!(this._pieces&&this._pieces.length&&this._readVertex(t))||(this._polyline=new e.PolySegmentContainer,this._polyoutset=[],this._polyinset=[],this._pieces=[],this._pieceIdx=0,this._startVertex=this.generatePolyLine(this._tolerance,this._startVertex),!!(this._polyline.count&&(this.generatePolyOffset(Math.abs(this._offset),this._makeInset,this._makeOutset,this._tolerance),this.generateOffset(this._makeInset,this._makeOutset,this._tolerance),this._pieces.length&&(this._rewindVertices(),this._pieceIdx=0),this._pieces&&this._pieces.length&&this._readVertex(t))))},e.prototype.addCurveToPolyline=function(t,n,i,r,o){if(++o,this._isQudraticCurveFlat(t,n,i,r)){var s=new e.PolySegment(t,0);this._polyline.insertSegment(s)}else{var a=ifMath.ptDist(t.getX(),t.getY(),n.getX(),n.getY()),h=ifMath.ptDist(n.getX(),n.getY(),i.getX(),i.getY()),l=ifMath.ptDist(t.getX(),t.getY(),i.getX(),i.getY()),p=new IFPoint((n.getX()-t.getX())/a,(n.getY()-t.getY())/a),u=new IFPoint((i.getX()-n.getX())/h,(i.getY()-n.getY())/h),c=new IFPoint((i.getX()-t.getX())/l,(i.getY()-t.getY())/l),g=ifMath.vDotProduct(p.getX(),p.getY(),u.getX(),u.getY()),f=new IFPoint(a*(u.getX()-p.getX()*g),a*(u.getY()-p.getY()*g)),y=a*g-h,d=h*g-a,_=new IFPoint(f.getX()+y*p.getX()+d*u.getX(),f.getY()+y*p.getY()+d*u.getY());y=Math.sqrt(ifMath.vDotProduct(f.getX(),f.getY(),f.getX(),f.getY())),d=Math.sqrt(ifMath.vDotProduct(_.getX(),_.getY(),_.getX(),_.getY()));var v=new IFPoint(f.getX()/y,f.getY()/y),m=new IFPoint(_.getX()/d,_.getY()/d),I=1-g,P=ifMath.vDotProduct(u.getX(),u.getY(),v.getX(),v.getY()),C=ifMath.vDotProduct(c.getX(),c.getY(),p.getX(),p.getY()),F=ifMath.vDotProduct(c.getX(),c.getY(),v.getX(),v.getY()),x=ifMath.vDotProduct(p.getX(),p.getY(),m.getX(),m.getY()),S=ifMath.vDotProduct(c.getX(),c.getY(),u.getX(),u.getY()),E=ifMath.vDotProduct(c.getX(),c.getY(),m.getX(),m.getY()),w=P*C/F+x*S/E,T=-P*x/(F*E*2),M=[];ifMath.getQuadraticRoots(I,w,T,M);var b=null;null!=M[0]&&M[0]<1&&M[0]>0?b=M[0]:null!=M[1]&&M[1]<1&&M[1]>0&&(b=M[1]);var A=b*l*E/x,$=b*l*F/P,O=Math.sqrt((1-C)/2),B=Math.sqrt((1+C)/2),R=A*B/O,N=Math.sqrt((1-S)/2),V=Math.sqrt((1+S)/2),L=$*V/N,k=new IFPoint(t.getX()+R*v.getX(),t.getY()+R*v.getY()),G=new IFPoint(i.getX()+L*m.getX(),i.getY()+L*m.getY());y=2*a*C,M=[],ifMath.getQuadraticRoots(l-y,y,-A*(1+C),M);var Y=.5;null!=M[0]&&M[0]<1&&M[0]>0?Y=M[0]:null!=M[1]&&M[1]<1&&M[1]>0&&(Y=M[1]);var X=Math.sqrt(1-C*C),D=Math.abs((2*a*Y*(1-Y)-A)*X),q=a*a,U=h*h,H=a*h*g;y=q+U-H;var j=Math.sqrt(1-g*g),K=D,W=Y;if(M=[],ifMath.getQuadraticRoots(y,3*(H-q),2*q-R*h*j,M),null!=M[0]&&M[0]<Y&&M[0]>0){var z=new IFPoint(ifMath.getCurveAtT(t.getX(),i.getX(),n.getX(),M[0]),ifMath.getCurveAtT(t.getY(),i.getY(),n.getY(),M[0])),J=Math.abs(R-ifMath.ptDist(z.getX(),z.getY(),k.getX(),k.getY()));K<J&&(K=J,W=M[0])}if(null!=M[1]&&M[1]<Y&&M[1]>0){var Q=new IFPoint(ifMath.getCurveAtT(t.getX(),i.getX(),n.getX(),M[1]),ifMath.getCurveAtT(t.getY(),i.getY(),n.getY(),M[1])),Z=Math.abs(R-ifMath.ptDist(Q.getX(),Q.getY(),k.getX(),k.getY()));K<Z&&(K=Z,W=M[1])}if(M=[],ifMath.getQuadraticRoots(y,-2*q+U+H,q+H-L*a*j,M),null!=M[0]&&M[0]<1&&M[0]>Y){var tt=new IFPoint(ifMath.getCurveAtT(t.getX(),i.getX(),n.getX(),M[0]),ifMath.getCurveAtT(t.getY(),i.getY(),n.getY(),M[0])),et=Math.abs(L-ifMath.ptDist(tt.getX(),tt.getY(),G.getX(),G.getY()));K<et&&(K=et,W=M[0])}if(null!=M[1]&&M[1]<1&&M[1]>Y){var nt=new IFPoint(ifMath.getCurveAtT(t.getX(),i.getX(),n.getX(),M[1]),ifMath.getCurveAtT(t.getY(),i.getY(),n.getY(),M[1])),it=Math.abs(L-ifMath.ptDist(nt.getX(),nt.getY(),G.getX(),G.getY()));K<it&&(K=it,W=M[1])}if(K>r&&o<e.MAX_RECURS){var rt=new Float64Array(3),ot=new Float64Array(3),st=new Float64Array(3),at=new Float64Array(3);ifMath.divideQuadraticCurve(t.getX(),n.getX(),i.getX(),W,rt,st),ifMath.divideQuadraticCurve(t.getY(),n.getY(),i.getY(),W,ot,at),this.addCurveToPolyline(t,new IFPoint(rt[1],ot[1]),new IFPoint(rt[2],ot[2]),r,o),this.addCurveToPolyline(new IFPoint(st[0],at[0]),new IFPoint(st[1],at[1]),i,r,o)}else{var ht=new IFPoint(t.getX()+A*(p.getX()+c.getX()),t.getY()+A*(p.getY()+c.getY())),lt=O/(B+1);ifMath.segmentSide(t.getX(),t.getY(),ht.getX(),ht.getY(),k.getX(),k.getY())>0&&(lt=-lt);s=new e.PolySegment(t,lt,k,R);this._polyline.insertSegment(s);var pt=N/(V+1);lt<0&&(pt=-pt),s=new e.PolySegment(ht,pt,G,L),this._polyline.insertSegment(s)}}},e.prototype.addCubicCurveToPolyline=function(t,e,n,i,r){for(var o,s,a=e.getX()-t.getX(),h=e.getY()-t.getY(),l=2*(n.getX()-e.getX()-a),p=2*(n.getY()-e.getY()-h),u=i.getX()-n.getX()-a-l,c=i.getY()-n.getY()-h-p,g=[],f=ifMath.getCubicCurveSplits(u,l,a,c,p,h,g),y=new Float64Array(4),d=new Float64Array(4),_=0;_<f-1;++_){o=g[_],s=g[_+1],ifMath.getCtrlPts(t.getX(),i.getX(),e.getX(),n.getX(),o,s,y),ifMath.getCtrlPts(t.getY(),i.getY(),e.getY(),n.getY(),o,s,d);this._addCubicSegmToPolyline(y,d,r,0)}},e.prototype._isQudraticCurveFlat=function(t,e,n,i){var r=ifMath.getCurveAtT(t.getX(),n.getX(),e.getX(),.5),o=ifMath.getCurveAtT(t.getY(),n.getY(),e.getY(),.5);return ifMath.ptSqrDist(r,o,(t.getX()+n.getX())/2,(t.getY()+n.getY())/2)<=i*i},e.prototype._isCubicCurveFlat=function(t,e,n){var i=3*t[1]-2*t[0]-t[3];i*=i;var r=3*e[1]-2*e[0]-e[3];r*=r;var o=3*t[2]-2*t[3]-t[0];o*=o;var s=3*e[2]-2*e[3]-e[0];return i<o&&(i=o),r<(s*=s)&&(r=s),i+r<=16*n*n},e.prototype._addCubicSegmToPolyline=function(t,n,i,r){++r;var o=t[0],s=n[0],a=t[3],h=n[3];if(this._isCubicCurveFlat(t,n,i)){var l=new e.PolySegment(new IFPoint(o,s),0);this._polyline.insertSegment(l)}else{var p,u=!ifMath.isEqualEps(o,t[1])||!ifMath.isEqualEps(s,n[1]),c=!ifMath.isEqualEps(a,t[2])||!ifMath.isEqualEps(h,n[2]);if(u&&c){p=ifMath.getIntersectionPoint(o,s,t[1],n[1],t[2],n[2],a,h,[])}else if(u)p=new IFPoint(t[1],n[1]);else{if(!c)return void this._polyline.insertSegment(new e.PolySegment(new IFPoint(o,s),0));p=new IFPoint(t[2],n[2])}var g=ifMath.ptDist(o,s,a,h),f=ifMath.ptDist(o,s,p.getX(),p.getY()),y=ifMath.ptDist(a,h,p.getX(),p.getY()),d=g+f+y,_=(o*y+a*f+p.getX()*g)/d,v=(s*y+h*f+p.getY()*g)/d;if(ifMath.isEqualEps(o,_)||ifMath.isEqualEps(s,v)||ifMath.isEqualEps(a,_)||ifMath.isEqualEps(h,v)){l=new e.PolySegment(new IFPoint(o,s),0);this._polyline.insertSegment(l)}else{var m=(s-v)/(o-_),I=(h-v)/(a-_),P=(m*I*(s-h)+I*(o+_)-m*(_+a))/2/(I-m),C=-1/m*(P-(o+_)/2)+(s+v)/2,F=ifMath.ptDist(o,s,P,C),x=t[1]-o,S=3*x,E=n[1]-s,w=3*E,T=t[2]-t[1]-x,M=3*T,b=2*T,A=3*(T=n[2]-n[1]-E),$=2*T,O=a-t[2]-x-b,B=h-n[2]-E-$,R=o-P,N=s-C,V=new Float64Array(7);V[0]=O*O+B*B,V[1]=2*(O*M+B*A),V[2]=M*M+A*A+2*(O*S+B*w),V[3]=2*(O*R+M*S+B*N+A*w),V[4]=S*S+w*w+2*(M*R+A*N),V[5]=2*(S*R+w*N),V[6]=R*R+N*N;var L=new Float64Array(6);ifMath.getCoeffPolyDeriv(V,6,L);var k=new Float64Array(5);ifMath.getCoeffPolyDeriv(L,5,k);var G=new Float64Array(4);ifMath.getCoeffPolyDeriv(k,4,G);var Y=new Float64Array(6);ifMath.inversePolyUnaryInterval(L,5,Y);var X,D,q,U,H=ifMath.estimPositiveRootsDescartes(Y,5),j=0,K=[];if(H>0){var W=0,z=1;X=ifMath.evalPoly(L,5,W),ifMath.isEqualEps(X,0)&&(W+=.005,X=ifMath.evalPoly(L,5,W)),D=ifMath.evalPoly(L,5,z),ifMath.isEqualEps(D,0)&&(z-=.005,D=ifMath.evalPoly(L,5,z)),H>1&&(ifMath.getSturmPRS(L,5,k,K),q=[],U=[X,D],H=ifMath.countRootsNSturm(L,5,k,W,z,K,q,U))}if(0==H);else if(1==H){var J=ifMath.locateByNewton(W,z,X,D,L,5,k,G,.005);null==J&&(J=(W+z)/2);var Q=ifMath.evalCubic(O,M,S,o,J),Z=ifMath.evalCubic(B,A,w,s,J);j=Math.abs(ifMath.ptDist(Q,Z,P,C)-F)}else{var tt=[];ifMath.locRootsSturm(L,5,k,W,z,K,H,q,U,tt);for(var et=0;et<tt.length;++et){null==(J=ifMath.locateByNewton(tt[et][0],tt[et][1],tt[et][2],tt[et][3],L,5,k,G,.005,K))&&(J=(tt[et][0]+tt[et][1])/2),Q=ifMath.evalCubic(O,M,S,o,J),Z=ifMath.evalCubic(B,A,w,s,J);var nt=Math.abs(ifMath.ptDist(Q,Z,P,C)-F);nt>j&&(j=nt)}}if(j>i&&r<e.MAX_RECURS){var it=new Float64Array(4),rt=new Float64Array(4),ot=new Float64Array(4),st=new Float64Array(4);ifMath.getCtrlPtsCasteljau(t[0],t[1],t[2],t[3],.5,null,it,ot),ifMath.getCtrlPtsCasteljau(n[0],n[1],n[2],n[3],.5,null,rt,st),this._addCubicSegmToPolyline(it,rt,i,r),this._addCubicSegmToPolyline(ot,st,i,r)}else{var at=g/2/F,ht=at/(Math.sqrt(1-at*at)+1);ifMath.segmentSide(o,s,a,h,P,C)>0&&(ht=-ht);var lt=new e.PolySegment(new IFPoint(o,s),ht,new IFPoint(P,C),F);this._polyline.insertSegment(lt)}}}},e.prototype.generatePolyLine=function(t,n){for(var i,r=null,o=n,s=o,a=new IFVertex,h=!0;h&&this._source.readVertex(a);)switch(a.command){case IFVertex.Command.Move:o&&this._polyline.count?(r=a,h=!1):(o=s=a,a=new IFVertex);break;case IFVertex.Command.Line:s?(i=new e.PolySegment(new IFPoint(s.x,s.y),0),this._polyline.insertSegment(i),s=a,a=new IFVertex):(s=a,a=new IFVertex);break;case IFVertex.Command.Curve:if(s){var l=new IFPoint(s.x,s.y);if(s=a,a=new IFVertex,this._source.readVertex(a)){this.addCurveToPolyline(l,new IFPoint(a.x,a.y),new IFPoint(s.x,s.y),t,0),a=new IFVertex}}else s=a,a=new IFVertex;break;case IFVertex.Command.Curve2:if(s){l=new IFPoint(s.x,s.y);var p=new IFPoint(a.x,a.y);s=a,a=new IFVertex;var u=new IFVertex;this._source.readVertex(a)&&this._source.readVertex(u)&&(this.addCubicCurveToPolyline(l,new IFPoint(a.x,a.y),new IFPoint(u.x,u.y),p,t),a=new IFVertex)}else s=a,a=new IFVertex;break;case IFVertex.Command.Close:this._polyline&&(s&&(i=new e.PolySegment(new IFPoint(s.x,s.y),0),this._polyline.insertSegment(i),s=null),this._polyline.closed=!0,i=new e.PolySegment(this._polyline.head.point,0),this._polyline.insertSegment(i),(r=new IFVertex).command=IFVertex.Command.Move,r.x=this._polyline.head.point.getX(),r.y=this._polyline.head.point.getY(),h=!1);break;default:throw new Error("Unknown vertex command: "+vertex.command.toString())}return s&&this._polyline.count&&(i=new e.PolySegment(new IFPoint(s.x,s.y),0),this._polyline.insertSegment(i),ifMath.isEqualEps(s.x,this._polyline.head.point.getX())&&ifMath.isEqualEps(s.y,this._polyline.head.point.getY())&&(this._polyline.closed=!0)),r},e.prototype.generatePolyOffset=function(t,n,i,r){var o,s=null,a=null;i&&(s=new e.PolySegmentContainer),n&&(a=new e.PolySegmentContainer);for(var h=0,l=this._polyline.head;h<this._polyline.count;++h)i&&(o=this._offsetPolySegment(l,-t,r))&&s.insertSegment(o),n&&(o=this._offsetPolySegment(l,t,r))&&a.insertSegment(o),l=l.next;var p=new e.PolySegmentContainer,u=new e.PolySegmentContainer;i&&this._trimOffsetPoly(s,-t,p),n&&this._trimOffsetPoly(a,t,u);var c=[],g=[];n&&i&&this._calcIntersectionPoints(p,u,c,g),i&&this._calcSelfIntersectionPoints(p,c),n&&this._calcSelfIntersectionPoints(u,g),c.length>0&&this._sortInsertsectionPoints(c),g.length>0&&this._sortInsertsectionPoints(g);var f=[],y=[],d=[],_=[];if(i)if(c.length>0){d=this._splitForClipping(p,c);for(h=0;h<d.length;++h){var v=[],m=[];if(this._calcIntersectionPoints(d[h],this._polyline,v,m),0==v.length)f.push(d[h]);else if(!this._polyline.closed){for(var I=!1,P=0;P<m.length;++P)if(0==m[P].segmIdx||m[P].segmIdx==this._polyline.count-1){I=!0;break}I&&this._excludeCircleInside(d[h],v,m,t,f)}}}else f[0]=p;if(n)if(g.length>0){_=this._splitForClipping(u,g);for(h=0;h<_.length;++h){v=[],m=[];if(this._calcIntersectionPoints(_[h],this._polyline,v,m),0==v.length)y.push(_[h]);else if(!this._polyline.closed){for(I=!1,P=0;P<m.count;++P)if(0==m[P].segmIdx||m[P].segmIdx==this._polyline.count-1){I=!0;break}I&&this._excludeCircleInside(_[h],v,m,t,y)}}}else y[0]=u;n&&i?(this._gcppFilter(f,this._polyline,t,3*r,this._polyoutset),this._gcppFilter(y,this._polyline,t,3*r,this._polyinset)):(this._gcppClipping(f,this._polyline,t,this._polyoutset),this._gcppClipping(y,this._polyline,t,this._polyinset))},e.prototype.generateOffset=function(t,e,n){var i=[];e&&t&&!this._polyline.closed?(this._genCurves(this._polyoutset,i,n),this._genCurves(this._polyinset,i,n)):(e&&this._genCurves(this._polyoutset,i,n),t&&this._genCurves(this._polyinset,i,n)),this._pieces=this._mergePieces(i)},e.prototype._mergePieces=function(t){for(var e=[];t.length>0;){var n=t[0];t.splice(0,1);for(var i=n.stPt.getX()!=n.endPt.getX()||n.stPt.getY()!=n.endPt.getY();i;){i=!1;for(var r=null,o=t.length-1;o>=0;--o)(r=t[o]).stPt.getX()==n.endPt.getX()&&r.stPt.getY()==n.endPt.getY()?(n.endPt=r.endPt,n.vrt.push.apply(n.vrt,r.vrt),i=!0,t.splice(o,1)):n.stPt.getX()==r.endPt.getX()&&n.stPt.getY()==r.endPt.getY()&&(r.endPt=n.endPt,r.vrt.push.apply(r.vrt,n.vrt),n=r,i=!0,t.splice(o,1))}var s=new IFVertexContainer;s.addVertex(IFVertex.Command.Move,n.stPt.getX(),n.stPt.getY());for(o=0;o<n.vrt.length;++o){var a=n.vrt[o];s.addVertex(a.c,a.x,a.y)}e.push(s)}return e},e.prototype._offsetPolySegment=function(t,n,i){var r=null,o=Math.abs(n),s=t.point.getX(),a=t.point.getY();if(t.bulge){if(t.radius){var h=t.radius,l=null;if(n*t.bulge>0?l=(h+=o)/t.radius:ifMath.isEqualEps(t.radius,o,i)||(t.radius>o?l=(h-=o)/t.radius:(h=o-t.radius,l=o/t.radius)),null!=l){var p=t.center.getX(),u=t.center.getY();t.next?(c=t.next.point.getX(),g=t.next.point.getY()):(c=this._polyline.head.point.getX(),g=this._polyline.head.point.getY());d=new IFPoint(p+l*(s-p),u+l*(a-u)),_=new IFPoint(p+l*(c-p),u+l*(g-u));r=new e.PolyOffsetSegment(t.point,d,_,t.bulge,t.center,h)}}}else if(t.next||this._polyline.closed){var c,g;t.next?(c=t.next.point.getX(),g=t.next.point.getY()):(c=this._polyline.head.point.getX(),g=this._polyline.head.point.getY());var f=ifMath.ptDist(s,a,c,g);if(!ifMath.isEqualEps(f,0)){var y=new IFPoint(-n*(g-a)/f,-n*(s-c)/f),d=new IFPoint(s+y.getX(),a+y.getY()),_=new IFPoint(c+y.getX(),g+y.getY());r=new e.PolyOffsetSegment(t.point,d,_,0)}}return r},e.prototype._insersectOffsetSegments=function(t,e,n){if(0==t.bulge&&0==e.bulge){var i=[null,null],r=ifMath.getIntersectionPoint(t.point.getX(),t.point.getY(),t.point2.getX(),t.point2.getY(),e.point.getX(),e.point.getY(),e.point2.getX(),e.point2.getY(),i);n.point=r,r&&(this._fillLineIntType(i[0],n.intTypes[0]),this._fillLineIntType(i[1],n.intTypes[1]))}else if(0!=t.bulge&&0==e.bulge||0==t.bulge&&0!=e.bulge){i=[null,null];var o=null,s=null,a=null;if(0==t.bulge){var h=t.point.getX(),l=t.point.getY(),p=t.point2.getX()-t.point.getX(),u=t.point2.getY()-t.point.getY();if(ifMath.circleLineIntersection(h,l,p,u,e.center.getX(),e.center.getY(),e.radius,i),null!=i[0]&&(o=h+p*i[0],s=l+u*i[0],a=i[0]),null!=i[0]&&null!=i[1]){var c=h+p*i[1],g=l+u*i[1],f=ifMath.ptSqrDist(o,s,e.basepoint.getX(),e.basepoint.getY());ifMath.ptSqrDist(c,g,e.basepoint.getX(),e.basepoint.getY())<f&&(o=c,s=g,a=i[1])}null!=a&&(n.point=new IFPoint(o,s),this._fillLineIntType(a,n.intTypes[0]),this._fillArcIntType(e,o,s,n.intTypes[1]))}else{h=e.point.getX(),l=e.point.getY(),p=e.point2.getX()-e.point.getX(),u=e.point2.getY()-e.point.getY();if(ifMath.circleLineIntersection(h,l,p,u,t.center.getX(),t.center.getY(),t.radius,i),null!=i[0]&&(o=h+p*i[0],s=l+u*i[0],a=i[0]),null!=i[0]&&null!=i[1]){c=h+p*i[1],g=l+u*i[1],f=ifMath.ptSqrDist(o,s,e.basepoint.getX(),e.basepoint.getY());ifMath.ptSqrDist(c,g,e.basepoint.getX(),e.basepoint.getY())<f&&(o=c,s=g,a=i[1])}null!=a&&(n.point=new IFPoint(o,s),this._fillLineIntType(a,n.intTypes[1]),this._fillArcIntType(t,o,s,n.intTypes[0]))}}else{i=[null,null];ifMath.circleCircleIntersection(t.center.getX(),t.center.getY(),t.radius,e.center.getX(),e.center.getY(),e.radius,i);var y=null;if(null!=i[0]&&(y=0),null!=i[0]&&null!=i[1]){f=ifMath.ptSqrDist(i[0].getX(),i[0].getY(),e.basepoint.getX(),e.basepoint.getY());ifMath.ptSqrDist(i[1].getX(),i[1].getY(),e.basepoint.getX(),e.basepoint.getY())<f&&(y=1)}null!==y&&(n.point=i[y],this._fillArcIntType(t,i[y].getX(),i[y].getY(),n.intTypes[0]),this._fillArcIntType(e,i[y].getX(),i[y].getY(),n.intTypes[1]))}},e.prototype._fillArcIntType=function(t,e,n,i){var r=t.point.getX(),o=t.point.getY(),s=t.point2.getX(),a=t.point2.getY(),h=t.center.getX(),l=t.center.getY();if(ifMath.segmentSide(r,o,s,a,e,n)==ifMath.segmentSide(r,o,s,a,h,l)){var p=(r+s)/2,u=(o+a)/2,c=t.radius/ifMath.ptDist(p,u,h,l),g=h+(h-p)*c,f=l+(l-u)*c;ifMath.segmentSide(r,o,g,f,e,n)==ifMath.segmentSide(r,o,g,f,h,l)?(i.FIP=!0,i.PFIP=!0):i.FIP=!0}else i.TIP=!0},e.prototype._fillLineIntType=function(t,e){t<0?e.FIP=!0:t>1?(e.FIP=!0,e.PFIP=!0):e.TIP=!0},e.prototype._trimOffsetPoly=function(t,n,i){var r=1e-6,o=null,s=t.head;if(s){i.insertSegment(new e.PolySegment(s.point,s.bulge,s.center,s.radius));for(var a=new e.IntersectionResult,h=0;h<t.count-1;++h)if(o=new e.PolyOffsetSegment(s.basepoint,i.end.point,s.point2,i.end.bulge,s.center,s.radius),s=s.next,ifMath.isEqualEps(o.point2.getX(),s.point.getX(),r)&&ifMath.isEqualEps(o.point2.getY(),s.point.getY(),r))i.insertSegment(new e.PolySegment(s.point,s.bulge,s.center,s.radius));else if(a.clear(),this._insersectOffsetSegments(o,s,a),0==o.bulge&&0==s.bulge)a.point?a.intTypes[0].TIP&&a.intTypes[1].TIP||a.intTypes[0].FIP&&a.intTypes[1].FIP&&a.intTypes[0].PFIP?i.insertSegment(new e.PolySegment(a.point,0)):(i.insertSegment(new e.PolySegment(o.point2,0)),i.insertSegment(new e.PolySegment(s.point,0))):i.insertSegment(new e.PolySegment(o.point2,0));else if(0==o.bulge&&0!=s.bulge)if(a.point)if(a.intTypes[0].TIP&&a.intTypes[1].TIP||a.intTypes[0].TIP&&a.intTypes[1].FIP&&!a.intTypes[1].PFIP||a.intTypes[0].PFIP&&a.intTypes[1].TIP){a.point.getX(),s.point2.getX(),a.point.getY(),s.point2.getY();var l=this._calculateBulge(a.point.getX(),a.point.getY(),s.point2.getX(),s.point2.getY(),s.center.getX(),s.center.getY(),s.bulge);i.insertSegment(new e.PolySegment(a.point,l,s.center,s.radius))}else if(a.intTypes[0].PFIP&&a.intTypes[1].FIP){var p=this._constructJoinArc(o,s,!0);i.insertSegment(p),i.insertSegment(new e.PolySegment(s.point,s.bulge,s.center,s.radius))}else i.insertSegment(new e.PolySegment(o.point2,0)),i.insertSegment(new e.PolySegment(s.point,s.bulge,s.center,s.radius));else{p=this._constructJoinArc(o,s,!0);i.insertSegment(p),i.insertSegment(new e.PolySegment(s.point,s.bulge,s.center,s.radius))}else if(0!=o.bulge&&0==s.bulge)if(a.point)if(a.intTypes[0].TIP&&a.intTypes[1].TIP){var u=this._calculateBulge(o.point.getX(),o.point.getY(),a.point.getX(),a.point.getY(),o.center.getX(),o.center.getY(),o.bulge);i.end.bulge=u,i.insertSegment(new e.PolySegment(a.point,0))}else if(a.intTypes[0].FIP&&a.intTypes[1].FIP&&!a.intTypes[1].PFIP){p=this._constructJoinArc(o,s,!0);i.insertSegment(p),i.insertSegment(new e.PolySegment(s.point,0))}else i.insertSegment(new e.PolySegment(o.point2,0)),i.insertSegment(new e.PolySegment(s.point,0));else{p=this._constructJoinArc(o,s,!0);i.insertSegment(p),i.insertSegment(new e.PolySegment(s.point,0))}else if(a.point)if(a.intTypes[0].FIP&&!a.intTypes[0].PFIP||a.intTypes[1].PFIP){p=this._constructJoinArc(o,s,!1);i.insertSegment(p),i.insertSegment(new e.PolySegment(s.point,s.bulge,s.center,s.radius))}else{u=this._calculateBulge(o.point.getX(),o.point.getY(),a.point.getX(),a.point.getY(),o.center.getX(),o.center.getY(),o.bulge);i.end.bulge=u,u=this._calculateBulge(a.point.getX(),a.point.getY(),s.point2.getX(),s.point2.getY(),s.center.getX(),s.center.getY(),s.bulge),i.insertSegment(new e.PolySegment(a.point,u,s.center,s.radius))}else{p=this._constructJoinArc(o,s,!0);i.insertSegment(p),i.insertSegment(new e.PolySegment(s.point,s.bulge,s.center,s.radius))}if(this._polyline.closed)if(o=new e.PolyOffsetSegment(s.basepoint,i.end.point,s.point2,i.end.bulge,s.center,s.radius),s=t.head,ifMath.isEqualEps(o.point2.getX(),s.point.getX(),r)&&ifMath.isEqualEps(o.point2.getY(),s.point.getY(),r))i.insertSegment(new e.PolySegment(s.point,0));else if(a.clear(),this._insersectOffsetSegments(o,s,a),0==o.bulge&&0==s.bulge)a.point?a.intTypes[0].TIP&&a.intTypes[1].TIP||a.intTypes[0].FIP&&a.intTypes[1].FIP&&a.intTypes[0].PFIP?(i.insertSegment(new e.PolySegment(a.point,0)),i.head.point=a.point):(i.insertSegment(new e.PolySegment(o.point2,0)),i.insertSegment(new e.PolySegment(s.point,0))):i.insertSegment(new e.PolySegment(o.point2,0));else if(0==o.bulge&&0!=s.bulge)if(a.point)if(a.intTypes[0].TIP&&a.intTypes[1].TIP||a.intTypes[0].TIP&&a.intTypes[1].FIP&&!a.intTypes[1].PFIP||a.intTypes[0].PFIP&&a.intTypes[1].TIP){l=this._calculateBulge(a.point.getX(),a.point.getY(),s.point2.getX(),s.point2.getY(),s.center.getX(),s.center.getY(),s.bulge);i.insertSegment(new e.PolySegment(a.point,0)),i.head.point=a.point,i.head.bulge=l}else if(a.intTypes[0].PFIP&&a.intTypes[1].FIP){p=this._constructJoinArc(o,s,!0);i.insertSegment(p),i.insertSegment(new e.PolySegment(s.point,0))}else i.insertSegment(new e.PolySegment(o.point2,0)),i.insertSegment(new e.PolySegment(s.point,0));else{p=this._constructJoinArc(o,s,!0);i.insertSegment(p),i.insertSegment(new e.PolySegment(s.point,0))}else if(0!=o.bulge&&0==s.bulge)if(a.point)if(a.intTypes[0].TIP&&a.intTypes[1].TIP){u=this._calculateBulge(o.point.getX(),o.point.getY(),a.point.getX(),a.point.getY(),o.center.getX(),o.center.getY(),o.bulge);i.end.bulge=u,i.insertSegment(new e.PolySegment(a.point,0)),i.head.point=a.point}else if(a.intTypes[0].FIP&&a.intTypes[1].FIP&&!a.intTypes[1].PFIP){p=this._constructJoinArc(o,s,!0);i.insertSegment(p),i.insertSegment(new e.PolySegment(s.point,0))}else i.insertSegment(new e.PolySegment(o.point2,0)),i.insertSegment(new e.PolySegment(s.point,0));else{p=this._constructJoinArc(o,s,!0);i.insertSegment(p),i.insertSegment(new e.PolySegment(s.point,0))}else if(a.point)if(a.intTypes[0].FIP&&!a.intTypes[0].PFIP||a.intTypes[1].PFIP){p=this._constructJoinArc(o,s,!1);i.insertSegment(p),i.insertSegment(new e.PolySegment(s.point,0))}else{u=this._calculateBulge(o.point.getX(),o.point.getY(),a.point.getX(),a.point.getY(),o.center.getX(),o.center.getY(),o.bulge);i.end.bulge=u,i.insertSegment(new e.PolySegment(a.point,0)),u=this._calculateBulge(a.point.getX(),a.point.getY(),s.point2.getX(),s.point2.getY(),s.center.getX(),s.center.getY(),s.bulge),i.head.point=a.point,i.head.bulge=u}else{p=this._constructJoinArc(o,s,!0);i.insertSegment(p),i.insertSegment(new e.PolySegment(s.point,0))}else i.insertSegment(new e.PolySegment(s.point2,0))}},e.prototype._constructJoinArc=function(t,n,i){var r=0;if(t.bulge){var o=t.bulge>0?1:-1,s=(t.point2.getY()-t.center.getY())*o,a=(t.center.getX()-t.point2.getX())*o;r=-ifMath.segmentSide(t.point2.getX(),t.point2.getY(),t.point2.getX()+s,t.point2.getY()+a,n.point.getX(),n.point.getY())}else r=-ifMath.segmentSide(t.point.getX(),t.point.getY(),t.point2.getX(),t.point2.getY(),n.point.getX(),n.point.getY());i||(r=-r);var h=0;return r&&(h=this._calculateBulge(t.point2.getX(),t.point2.getY(),n.point.getX(),n.point.getY(),n.basepoint.getX(),n.basepoint.getY(),r)),h?new e.PolySegment(t.point2,h,n.basepoint,ifMath.ptDist(t.point2.getX(),t.point2.getY(),n.basepoint.getX(),n.basepoint.getY())):new e.PolySegment(t.point2,0)},e.prototype._calculateBulge=function(t,e,n,i,r,o,s){var a=ifMath.ptSqrDist(t,e,r,o),h=ifMath.ptSqrDist(n,i,r,o),l=0;if(ifMath.isEqualEps(a,h,1e-8)){var p=ifMath.ptSqrDist((t+n)/2,(e+i)/2,r,o);if(ifMath.isEqualEps(p,0,1e-8))l=1;else{var u=Math.sqrt(p/a);l=Math.sqrt((1-u)/(1+u))}var c=Math.sqrt(a);l=(e-o)/c*((n-r)/c)-(t-r)/c*((i-o)/c)<0?-l:l,s&&(s<0&&l>0||s>0&&l<0)&&(l=-1/l)}return l},e.prototype._calcIntersectionPoints=function(t,e,n,i){for(var r,o=t.head,s=0;s<t.count-1;++s){r=e.head;for(var a=0;a<e.count-1;++a)this._calcSegmIntersectionPoints(o,r,s,a,n,i),r=r.next;o=o.next}},e.prototype._calcSelfIntersectionPoints=function(t,e){for(var n,i=t.head,r=0;r<t.count-2;++r){n=i.next;for(var o=r+1;o<t.count-1;++o)this._calcSegmIntersectionPoints(i,n,r,o,e,e,o==r+1),n=n.next;i=i.next}},e.prototype._calcSegmIntersectionPoints=function(t,n,i,r,o,s,a){if(t.bulge||n.bulge)if(!t.bulge&&n.bulge){_=[null,null];var h=t.next.point.getX()-t.point.getX(),l=t.next.point.getY()-t.point.getY();if(ifMath.circleLineIntersection(t.point.getX(),t.point.getY(),h,l,n.center.getX(),n.center.getY(),n.radius,_),null!=_[0]&&_[0]>=0&&_[0]<=1&&(!a||!ifMath.isEqualEps(_[0],1))){var p=t.point.getX()+h*_[0],u=t.point.getY()+l*_[0];((c=this._calculateBulge(n.point.getX(),n.point.getY(),p,u,n.center.getX(),n.center.getY(),n.bulge))<0&&c>=n.bulge||c>0&&c<=n.bulge)&&(o.push(new e.IntersectionPt(p,u,_[0],t,i)),s.push(new e.IntersectionPt(p,u,c,n,r)))}if(null!=_[1]&&_[1]>=0&&_[1]<=1&&(!a||!ifMath.isEqualEps(_[1],1))){p=t.point.getX()+h*_[1],u=t.point.getY()+l*_[1];((c=this._calculateBulge(n.point.getX(),n.point.getY(),p,u,n.center.getX(),n.center.getY(),n.bulge))<0&&c>=n.bulge||c>0&&c<=n.bulge)&&(o.push(new e.IntersectionPt(p,u,_[1],t,i)),s.push(new e.IntersectionPt(p,u,c,n,r)))}}else if(t.bulge&&!n.bulge){_=[null,null],h=n.next.point.getX()-n.point.getX(),l=n.next.point.getY()-n.point.getY();if(ifMath.circleLineIntersection(n.point.getX(),n.point.getY(),h,l,t.center.getX(),t.center.getY(),t.radius,_),null!=_[0]&&_[0]>=0&&_[0]<=1&&(!a||!ifMath.isEqualEps(_[0],0))){p=n.point.getX()+h*_[0],u=n.point.getY()+l*_[0];((c=this._calculateBulge(t.point.getX(),t.point.getY(),p,u,t.center.getX(),t.center.getY(),t.bulge))<0&&c>=t.bulge||c>0&&c<=t.bulge)&&(o.push(new e.IntersectionPt(p,u,c,t,i)),s.push(new e.IntersectionPt(p,u,_[0],n,r)))}if(null!=_[1]&&_[1]>=0&&_[1]<=1&&(!a||!ifMath.isEqualEps(_[1],0))){var c;p=n.point.getX()+h*_[1],u=n.point.getY()+l*_[1];((c=this._calculateBulge(t.point.getX(),t.point.getY(),p,u,t.center.getX(),t.center.getY(),t.bulge))<0&&c>=t.bulge||c>0&&c<=t.bulge)&&(o.push(new e.IntersectionPt(p,u,c,t,i)),s.push(new e.IntersectionPt(p,u,_[1],n,r)))}}else{_=[null,null];if(ifMath.circleCircleIntersection(t.center.getX(),t.center.getY(),t.radius,n.center.getX(),n.center.getY(),n.radius,_),_[0]&&(!a||!ifMath.isEqualEps(_[0].getX(),n.point.getX())&&!ifMath.isEqualEps(_[0].getY(),n.point.getY()))){var g=this._calculateBulge(t.point.getX(),t.point.getY(),_[0].getX(),_[0].getY(),t.center.getX(),t.center.getY(),t.bulge);if(g<0&&g>=t.bulge||g>0&&g<=t.bulge){var f=this._calculateBulge(n.point.getX(),n.point.getY(),_[0].getX(),_[0].getY(),n.center.getX(),n.center.getY(),n.bulge);(f<0&&f>=n.bulge||f>0&&f<=n.bulge)&&(o.push(new e.IntersectionPt(_[0].getX(),_[0].getY(),g,t,i)),s.push(new e.IntersectionPt(_[0].getX(),_[0].getY(),f,n,r)))}}if(_[1]&&(!a||!ifMath.isEqualEps(_[1].getX(),n.point.getX())&&!ifMath.isEqualEps(_[1].getY(),n.point.getY()))){var y=this._calculateBulge(t.point.getX(),t.point.getY(),_[1].getX(),_[1].getY(),t.center.getX(),t.center.getY(),t.bulge);if(y<0&&y>=t.bulge||y>0&&y<=t.bulge){var d=this._calculateBulge(n.point.getX(),n.point.getY(),_[1].getX(),_[1].getY(),n.center.getX(),n.center.getY(),n.bulge);(d<0&&d>=n.bulge||d>0&&d<=n.bulge)&&(o.push(new e.IntersectionPt(_[1].getX(),_[1].getY(),y,t,i)),s.push(new e.IntersectionPt(_[1].getX(),_[1].getY(),d,n,r)))}}}else if(!a){var _=[null,null],v=ifMath.getIntersectionPoint(t.point.getX(),t.point.getY(),t.next.point.getX(),t.next.point.getY(),n.point.getX(),n.point.getY(),n.next.point.getX(),n.next.point.getY(),_);v&&0<=_[0]&&_[0]<=1&&0<=_[1]&&_[1]<=1&&(o.push(new e.IntersectionPt(v.getX(),v.getY(),_[0],t,i)),s.push(new e.IntersectionPt(v.getX(),v.getY(),_[1],n,r)))}},e.prototype._sortInsertsectionPoints=function(t){t.sort(function(t,e){return t.segmIdx!=e.segmIdx?t.segmIdx-e.segmIdx:t.slope>0?t.slope-e.slope:e.slope-t.slope})},e.prototype._splitForClipping=function(t,n){for(var i,r=1e-6,o=0,s=t.head,a=s,h=[],l=0;l<n.length;++l){h[l]=new e.PolySegmentContainer;for(var p=o;p<n[l].segmIdx;++p)h[l].insertSegment(new e.PolySegment(s.point,s.bulge,s.center,s.radius)),a=s=a.next;s.bulge?ifMath.isEqualEps(n[l].x,s.point.getX(),r)&&ifMath.isEqualEps(n[l].y,s.point.getY(),r)?h[l].insertSegment(new e.PolySegment(s.point,0)):(s==a?h[l].insertSegment(new e.PolySegment(s.point,n[l].slope,s.center,s.radius)):(i=(n[l].slope-n[l-1].slope)/(1+n[l].slope*n[l-1].slope),h[l].insertSegment(new e.PolySegment(s.point,i,s.center,s.radius))),h[l].insertSegment(new e.PolySegment(new IFPoint(n[l].x,n[l].y),0)),i=(a.bulge-n[l].slope)/(1+a.bulge*n[l].slope),s=new e.PolySegment(new IFPoint(n[l].x,n[l].y),i,s.center,s.radius)):(h[l].insertSegment(new e.PolySegment(s.point,0)),ifMath.isEqualEps(n[l].x,s.point.getX(),r)&&ifMath.isEqualEps(n[l].y,s.point.getY(),r)||(s=new e.PolySegment(new IFPoint(n[l].x,n[l].y),0),h[l].insertSegment(s))),o=p,ifMath.isEqualEps(n[l].x,a.next.point.getX(),r)&&ifMath.isEqualEps(n[l].y,a.next.point.getY(),r)&&(++o,a=s=a.next)}var u=this._polyline.closed;if(o!=t.count-1){h[l]=new e.PolySegmentContainer;for(p=o;p<t.count;++p)h[l].insertSegment(new e.PolySegment(s.point,s.bulge,s.center,s.radius)),a=s=a.next}else u=!1;if(1==h[0].count&&(h=h.slice(1),u=!1),u){var c=h.length,g=h[c-1],f=g.end.point,y=h[0].head.point;if(c>1&&ifMath.isEqualEps(f.getX(),y.getX(),r)&&ifMath.isEqualEps(f.getY(),y.getY(),r)){g.deleteSegment(g.end),s=h[0].head;for(l=0;l<h[0].count;++l)g.insertSegment(new e.PolySegment(s.point,s.bulge,s.center,s.radius)),s=s.next;h=h.slice(1)}else h[0].closed=!0}var d=[];for(l=0;l<h.length;++l)1!=h[l].count&&d.push(h[l]);return d},e.prototype._excludeCircleInside=function(t,n,i,r,o){for(var s=0,a=new e.PolySegment(t.head.point,t.head.bulge,t.head.center,t.head.radius),h=t.head,l=new e.PolySegmentContainer,p=0;p<n.length;++p){for(var u=s;u<n[p].segmIdx-1;++u)l.insertSegment(a),h=h.next,a=new e.PolySegment(h.point,h.bulge,h.center,h.radius);if(a.bulge){y=[null,null];if(ifMath.circleCircleIntersection(h.center.getX(),h.center.getY(),h.radius,i[p].x,i[p].y,r,y),null!=y[0]){var c=this._calculateBulge(a.point.getX(),a.point.getY(),y[0].getX(),y[0].getY(),h.center.getX(),h.center.getY(),a.bulge);c<0&&c>a.bulge||c>0&&c<a.bulge?(l.insertSegment(new e.PolySegment(a.point,c,h.center,h.radius)),l.insertSegment(new e.PolySegment(y[0],0)),o.push(l)):(l.insertSegment(new e.PolySegment(a.point,0)),o.push(l))}if(null!=y[1]){var g=this._calculateBulge(a.point.getX(),a.point.getY(),y[1].getX(),y[1].getY(),h.center.getX(),h.center.getY(),a.bulge);if(g<0&&g>a.bulge&&g<c||g>0&&g<a.bulge&&g>c){l=new e.PolySegmentContainer;var f=(a.bulge-g)/(1+a.bulge*g);a=new e.PolySegment(new IFPoint(v,m),f,h.center,h.radius)}else l=new e.PolySegmentContainer}else l=new e.PolySegmentContainer}else{var y=[null,null],d=h.next.point.getX()-a.point.getX(),_=h.next.point.getY()-a.point.getY();if(ifMath.circleLineIntersection(a.point.getX(),a.point.getY(),d,_,i[p].x,i[p].y,r,y),null!=y[0])if(y[0]<=0)l.insertSegment(new e.PolySegment(a.point,0)),o.push(l);else if(y[0]>0&&y[0]<1){var v=a.point.getX()+d*y[0],m=a.point.getY()+_*y[0];l.insertSegment(new e.PolySegment(a.point,0)),l.insertSegment(new e.PolySegment(new IFPoint(v,m),0)),o.push(l)}else l.insertSegment(new e.PolySegment(a.point,0)),l.insertSegment(new e.PolySegment(h.next.point,0)),o.push(l);null!=y[1]&&y[1]>y[0]&&y[1]<1?(l=new e.PolySegmentContainer,v=a.point.getX()+d*y[1],m=a.point.getY()+_*y[1],a=new e.PolySegment(new IFPoint(v,m),0)):l=new e.PolySegmentContainer}s=n[p].segmIdx}for(u=s;u<t.count;++u)a&&(l.insertSegment(a),a=(h=h.next)?new e.PolySegment(h.point,h.bulge,h.center,h.radius):null)},e.prototype._gcppClipping=function(t,e,n,i){for(var r,o=0;o<t.length;++o){r=t[o];for(var s=e.head,a=0;a<e.count-1;++a){for(var h=r.head,l=0;l<r.count-1;++l)h=h.next;s=s.next}i.push(r)}},e.prototype._gcppFilter=function(t,e,n,i,r){for(var o,s,a=(n-i)*(n-i),h=n+i,l=h*h,p=0;p<t.length;++p){o=t[p];var u=e.head;s=l;for(var c=0;c<e.count-1&&s>=a;++c){for(var g=o.head,f=0;f<o.count-1&&s>=a;++f)s=this._getPlSegmSqrDist(u,u.next.point,g,g.next.point,h),g=g.next;u=u.next}s>=a&&r.push(o)}},e.prototype._getPlSegmSqrDist=function(t,e,n,i,r){return t.bulge||n.bulge?n.bulge?t.bulge?this._getArcToArcSqrDist(t,e,n,i,r):this._getSegmToArcSqrDist(n.point,n.bulge,n.center,n.radius,i,t.point,e,r*r):this._getSegmToArcSqrDist(t.point,t.bulge,t.center,t.radius,e,n.point,i,r*r):ifMath.getSegmToSegmSqrDist(t.point,e,n.point,i)},e.prototype._getSegmToArcSqrDist=function(t,e,n,i,r,o,s,a){if(ifMath.isEqualEps(o.getX(),s.getX())&&ifMath.isEqualEps(o.getY(),s.getY()))return this._getPtToArcSqrDist(t,e,n,i,r,o);var h,l=a,p=[null,null],u=s.getX()-o.getX(),c=s.getY()-o.getY();if(ifMath.circleLineIntersection(o.getX(),o.getY(),u,c,n.getX(),n.getY(),i,p),null!=p[0]&&null==p[1]){var g=this._calculateBulge(t.getX(),t.getY(),p[0].getX(),p[0].getY(),n.getX(),n.getY(),e),f=p[1].getX()-o.getX(),y=p[1].getY()-o.getY();(f<0&&u<=f||f>=0&&u>=f)&&(y<0&&c<=y||y>=0&&c>=y)?g<0&&e<=g||g>=0&&e>=g?l=0:(l=ifMath.sqrSegmentDist(o.getX(),o.getY(),s.getX(),s.getY(),t.getX(),t.getY()),(h=ifMath.sqrSegmentDist(o.getX(),o.getY(),s.getX(),s.getY(),r.getX(),r.getY()))<l&&(l=h)):(l=this._getPtToArcSqrDist(t,e,n,i,r,o),(h=this._getPtToArcSqrDist(t,e,n,i,r,s))<l&&(l=h))}else{if(null==p[0]){var d=[null];if(h=ifMath.sqrSegmentDist(o.getX(),o.getY(),s.getX(),s.getY(),n.getX(),n.getY(),d),d[0]>0&&d<1){var _=o.getX()+d[0]*(s.getX()-o.getX()),v=o.getY()+d[0]*(s.getY()-o.getY()),m=i/Math.sqrt(h),I=n.getX()+m*(_-n.getX()),P=n.getY()+m*(v-n.getY()),C=this._calculateBulge(t.getX(),t.getY(),I,P,n.getX(),n.getY(),e);(C<0&&e<=C||C>=0&&e>=C)&&(l=ifMath.sqrSegmentDist(o.getX(),o.getY(),s.getX(),s.getY(),I,P))}}(h=ifMath.sqrSegmentDist(o.getX(),o.getY(),s.getX(),s.getY(),t.getX(),t.getY()))<l&&(l=h),l>0&&((h=ifMath.sqrSegmentDist(o.getX(),o.getY(),s.getX(),s.getY(),r.getX(),r.getY()))<l&&(l=h),l>0&&((h=this._getPtToArcSqrDist(t,e,n,i,r,o))<l&&(l=h),l>0&&(h=this._getPtToArcSqrDist(t,e,n,i,r,s))<l&&(l=h)))}return l},e.prototype._getPtToArcSqrDist=function(t,e,n,i,r,o){var s,a=ifMath.ptSqrDist(o.getX(),o.getY(),n.getX(),n.getY());if(ifMath.isEqualEps(a,0))s=i*i;else{var h=i/Math.sqrt(a),l=n.getX()+h*(o.getX()-n.getX()),p=n.getY()+h*(o.getY()-n.getY()),u=this._calculateBulge(t.getX(),t.getY(),l,p,n.getX(),n.getY(),e);u<0&&e<=u||u>=0&&e>=u?s=ifMath.ptSqrDist(o.getX(),o.getY(),l,p):(s=ifMath.ptSqrDist(o.getX(),o.getY(),t.getX(),t.getY()),(a=ifMath.ptSqrDist(o.getX(),o.getY(),r.getX(),r.getY()))<s&&(s=a))}return s},e.prototype._getArcToArcSqrDist=function(t,e,n,i,r){var o=t.center.getX(),s=t.center.getY(),a=n.center.getX(),h=n.center.getY(),l=t.radius+n.radius+r,p=r*r;if(ifMath.ptSqrDist(o,s,a,h)>l*l)return p;var u,c,g,f=null,y=[t.point,e],d=[n.point,i],_=[null,null];ifMath.circleCircleIntersection(o,s,t.radius,a,h,n.radius,_);for(var v=0;v<2&&null!=_[v]&&null===f;++v)c=(u=this._calculateBulge(t.point.getX(),t.point.getY(),_[v].getX(),_[v].getY(),t.center.getX(),t.center.getY(),t.bulge))<0&&t.bulge<=u||u>=0&&t.bulge>=u,g=(u=this._calculateBulge(n.point.getX(),n.point.getY(),_[v].getX(),_[v].getY(),n.center.getX(),n.center.getY(),n.bulge))<0&&n.bulge<=u||u>=0&&n.bulge>=u,c&&g?f=0:c?y.push(_[v]):g&&d.push(_[v]);if(!(_[0]||ifMath.isEqualEps(o,a)&&ifMath.isEqualEps(s,h))){var m,I,P=a-o,C=h-s,F=[null,null];ifMath.circleLineIntersection(o,s,P,C,a,h,n.radius,F);for(v=0;v<2&&null!=F[v];++v)m=o+P*F[v],I=s+C*F[v],(g=(u=this._calculateBulge(n.point.getX(),n.point.getY(),m,I,n.center.getX(),n.center.getY(),n.bulge))<0&&n.bulge<=u||u>=0&&n.bulge>=u)&&d.push(new IFPoint(m,I));P=-P,C=-C,F=[null,null],ifMath.circleLineIntersection(a,h,P,C,o,s,t.radius,F);for(v=0;v<2&&null!=F[v];++v)m=a+P*F[v],I=h+C*F[v],(c=(u=this._calculateBulge(t.point.getX(),t.point.getY(),m,I,t.center.getX(),t.center.getY(),t.bulge))<0&&t.bulge<=u||u>=0&&t.bulge>=u)&&y.push(new IFPoint(m,I))}if(0!==f){var x;f=p;for(v=0;v<y.length&&f>0;++v)(x=this._getPtToArcSqrDist(n.point,n.bulge,n.center,n.radius,i,y[v]))<f&&(f=x);for(v=0;v<d.length&&f>0;++v)(x=this._getPtToArcSqrDist(t.point,t.bulge,t.center,t.radius,e,d[v]))<f&&(f=x)}return f},e.prototype._roundOut=function(t){return Math.round(t*this._tolRange)/this._tolRange},e.prototype._genCurves=function(t,e,n){for(var i,r=0;r<t.length;++r){for(var o=(i=t[r]).head,s=[],a=new IFPoint(this._roundOut(o.point.getX()),this._roundOut(o.point.getY())),h=a,l=0;l<i.count-1;++l){if(o.bulge){if(this._genBeziers(o.point,o.next.point,o.bulge,o.center,o.radius,n,s),l==i.count-2){var p=s[s.length-3];h=new IFPoint(p.x,p.y)}}else s.push({c:IFVertex.Command.Line,x:this._roundOut(o.next.point.getX()),y:this._roundOut(o.next.point.getY())}),l==i.count-2&&(h=new IFPoint(this._roundOut(o.next.point.getX()),this._roundOut(o.next.point.getY())));o=o.next}var u={stPt:a,endPt:h,vrt:s};e.push(u)}},e.prototype._genBeziers=function(t,e,n,i,r,o,s){var a=Math.abs(4*Math.atan(n)),h=Math.ceil(2*a/Math.PI);for(a/=h;h<=32&&this._getCubicBezierArcError(a,r)>o;)a/=2,h*=2;n>0&&(a=-a);for(var l,p,u,c,g,f,y=Math.cos(a),d=Math.sin(a),_=(1-y)/(1+y),v=r*d*(Math.sqrt(4+3*_)-1)/3,m=(t.getX()-i.getX())/r,I=(t.getY()-i.getY())/r,P=t.getX(),C=t.getY(),F=0;F<h;++F)m=(l=m)*y-(p=I)*d,I=p*y+l*d,u=P-v*p,c=C+v*l,g=(P=i.getX()+r*m)+v*I,f=(C=i.getY()+r*I)-v*m,s.push({c:IFVertex.Command.Curve2,x:this._roundOut(P),y:this._roundOut(C)}),s.push({c:IFVertex.Command.Curve2,x:this._roundOut(u),y:this._roundOut(c)}),s.push({c:IFVertex.Command.Curve2,x:this._roundOut(g),y:this._roundOut(f)})},e.prototype._getCubicBezierArcError=function(t,e){var n=5.15347174*e,i=Math.cos(t),r=i*i,o=2*r-1,s=(4*r-3)*i,a=22979e-8*i-19.65763511+42715e-8*o+.00103256*s,h=9.92683097+45907e-8*i+.00174813*o-34153e-8*s;return n*Math.exp(a+h*t)},e.prototype._rewindVertices=function(){for(var t=0;t<this._pieces.length;++t)this._pieces[t].rewindVertices(0)},e.prototype._readVertex=function(t){return!(!this._pieces[this._pieceIdx]||!this._pieces[this._pieceIdx].readVertex(t))||(++this._pieceIdx,this._pieces[this._pieceIdx]&&this._pieces[this._pieceIdx].readVertex(t))},e.prototype.toString=function(){return"[Object IFVertexOffsetter]"},t.IFVertexOffsetter=e}(this),function(t){var e='url("data:image/svg+xml;base64,'+btoa('<svg xmlns="http://www.w3.org/2000/svg" width="8" height="8"><rect width="8" height="8" fill="white"/><rect width="4" height="4" fill="#CDCDCD"/><rect x="4" y="4" width="4" height="4" fill="#CDCDCD"/></svg>')+'")';function n(){}IFObject.inherit(n,IFObject),n.Type={Color:"C",Gradient:"G",Texture:"T",Noise:"N"},n.MIME_TYPE="application/infinity+pattern",n.equals=function(t,e){if(!t&&t===e)return!0;if(t&&e){if(t instanceof IFColor&&e instanceof IFColor)return IFColor.equals(t,e);if(t instanceof IFGradient&&e instanceof IFGradient)return IFGradient.equals(t,e)}return!1},n.parsePattern=function(t){if(t&&t.length>0){var e=t.charAt(0);if(t=t.substring(1),e===n.Type.Color)return IFColor.parseColor(t);if(e===n.Type.Gradient)return IFGradient.parseGradient(t)}return null},n.asString=function(t){return t?t.getPatternType()+t.asString():null},n.asCSSBackground=function(t){var i=e;if(t)switch(t.getPatternType()){case n.Type.Color:i="linear-gradient("+t.asCSSString()+", "+t.asCSSString()+"), "+i;break;case n.Type.Gradient:i=t.asCSSBackgroundString()+", "+i}return i},n.prototype.getPatternType=function(){throw new Error("Not supported")},t.IFPattern=n}(this),function(t){function e(){}e.prototype.AnnotType={Rectangle:0,Circle:1,Diamond:2};var n={};e.prototype.paintAnnotation=function(t,e,n,i,r,o,s,a){var h=this._getAnnotationTemplate(i);e&&(n=e.mapPoint(n));var l=a||t.selectionOutlineColor,p=s||null;r&&(p=l,l=IFColor.WHITE);var u=Math.floor(n.getX())+(p?.5:0),c=Math.floor(n.getY())+(p?.5:0),g=o/2/h.scaleFactor,f=o/2/h.scaleFactor,y=t.canvas,d=new IFVertexTransformer(h.vertices,new IFTransform(g,0,0,f,u,c));y.putVertices(d),y.fillVertices(l),p&&y.strokeVertices(p,1)},e.prototype.getAnnotationBBox=function(t,e,n){t&&(e=t.mapPoint(e));var i=Math.floor(e.getX())+.5,r=Math.floor(e.getY())+.5;return new IFRect(i-n/2-1,r-n/2-1,n+2,n+2)},e.prototype._getAnnotationTemplate=function(t){var e=n[t];if(!e){var i=new IFVertexContainer,r=1;switch(t){case this.AnnotType.Rectangle:i.addVertex(IFVertex.Command.Move,-1,-1),i.addVertex(IFVertex.Command.Line,1,-1),i.addVertex(IFVertex.Command.Line,1,1),i.addVertex(IFVertex.Command.Line,-1,1),i.addVertex(IFVertex.Command.Close);break;case this.AnnotType.Circle:i.addVertex(IFVertex.Command.Move,-1,0),i.addVertex(IFVertex.Command.Curve,0,-1),i.addVertex(IFVertex.Command.Curve,-1,-1),i.addVertex(IFVertex.Command.Curve,1,0),i.addVertex(IFVertex.Command.Curve,1,-1),i.addVertex(IFVertex.Command.Curve,0,1),i.addVertex(IFVertex.Command.Curve,1,1),i.addVertex(IFVertex.Command.Curve,-1,0),i.addVertex(IFVertex.Command.Curve,-1,1);break;case this.AnnotType.Diamond:i.addVertex(IFVertex.Command.Move,-1,0),i.addVertex(IFVertex.Command.Line,0,-1),i.addVertex(IFVertex.Command.Line,1,0),i.addVertex(IFVertex.Command.Line,0,1),i.addVertex(IFVertex.Command.Close),r=Math.cos(Math.PI/4)}e={vertices:i,scaleFactor:r},n[t]=e}return e},t.ifAnnotation=new e}(this),function(t){function e(t,e){var n=0,i=0,r=null,o=null;if("number"==typeof t?(n=t,i=e):t instanceof Image||t instanceof HTMLImageElement?(n=t.naturalWidth,i=t.naturalHeight,o=t):t instanceof IFPaintCanvas?r=t._canvasContext.canvas:t instanceof HTMLCanvasElement?r=t:t instanceof CanvasRenderingContext2D&&(r=t.canvas),r)this._canvas=r;else{if(n<=0||i<=0)throw new Error("Invalid bitmap size");this._canvas=document.createElement("canvas"),this._canvas.width=n,this._canvas.height=i}this._canvasContext=this._canvas.getContext("2d"),o&&this._canvasContext.drawImage(o)}e.COLOR_MATRIX_IDENTITY=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],e.COLOR_MATRIX_INVERT=[-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0],e.COLOR_MATRIX_GRAYSCALE=[.33,.33,.33,0,0,.33,.33,.33,0,0,.33,.33,.33,0,0,0,0,0,1,0],e.ImageType={PNG:"image/png",JPEG:"image/jpeg"},e.prototype._canvas=null,e.prototype._canvasContext=null,e.prototype.getWidth=function(){return this._canvas.width},e.prototype.getHeight=function(){return this._canvas.height},e.prototype.toImageDataUrl=function(t,e){var n=[t];return e&&(n=n.concat(e)),this._canvas.toDataURL.apply(this._canvas,n)},e.prototype.toImageBuffer=function(t,e,n){var i=[function(t){var n=new FileReader;n.onload=function(t){e(t.target.result)},n.readAsArrayBuffer(t)},t];n&&(i=i.concat(n)),this._canvas.toBlob.apply(this._canvas,i)},e.prototype.clone=function(t){if((t=t||new IFRect(0,0,this.getWidth(),this.getHeight())).isEmpty())return null;var n=new e(t.getWidth(),t.getHeight()),i=this._canvasContext.getImageData(t.getX(),t.getY(),t.getWidth(),t.getHeight());return n._canvasContext.putImageData(i,0,0),n},e.prototype.resize=function(t,e,n){if(t=t||0,e=e||0,n=n||IFRect.Side.TOP_LEFT,t||e){var i=t-this.getWidth(),r=e-this.getHeight(),o=0,s=0,a=0,h=0;if(i!==this.getWidth())switch(n){case IFRect.Side.TOP_LEFT:case IFRect.Side.LEFT_CENTER:case IFRect.Side.BOTTOM_LEFT:a=i;break;case IFRect.Side.TOP_CENTER:case IFRect.Side.CENTER:case IFRect.Side.BOTTOM_CENTER:o=-i/2,a=i/2;break;case IFRect.Side.TOP_RIGHT:case IFRect.Side.RIGHT_CENTER:case IFRect.Side.BOTTOM_RIGHT:o=-i}if(r!==this.getHeight())switch(n){case IFRect.Side.TOP_LEFT:case IFRect.Side.TOP_CENTER:case IFRect.Side.TOP_RIGHT:h=r;break;case IFRect.Side.LEFT_CENTER:case IFRect.Side.CENTER:case IFRect.Side.RIGHT_CENTER:s=-r/2,h=r/2;break;case IFRect.Side.BOTTOM_LEFT:case IFRect.Side.BOTTOM_CENTER:case IFRect.Side.BOTTOM_RIGHT:s=-r}var l=this._canvasContext.getImageData(0,0,this.getWidth(),this.getHeight());this._canvas.width=this.getWidth()-o+a,this._canvas.height=this.getHeight()-s+h,this._canvasContext.clearRect(0,0,this.getWidth(),this.getHeight()),this._canvasContext.putImageData(l,-o,-s)}},e.prototype.crop=function(t,e,n,i){t=t||0,e=e||0,n=n||0,i=i||0;var r=this.getWidth()-n,o=this.getHeight()-i,s=this._canvasContext.getImageData(t,e,r,o);this._canvas.width=r,this._canvas.height=o,this._canvasContext.clearRect(0,0,r,o),this._canvasContext.putImageData(s,0,0)},e.prototype.trim=function(){for(var t,e=this._canvasContext.getImageData(0,0,this.getWidth(),this.getHeight()),n=e.data.length,i={top:null,left:null,right:null,bottom:null},r=this.getWidth(),o=this.getHeight(),s=null,a=0;a<n;a+=4)0!==e.data[a+3]&&(t=a/4%r,s=~~(a/4/r),null===i.top&&(i.top=s),(null===i.left||t<i.left)&&(i.left=t),(null===i.right||i.right<t)&&(i.right=t),(null===i.bottom||i.bottom<s)&&(i.bottom=s));this.crop(i.left,i.top,r-(i.right-i.left),o-(i.bottom-i.top))},e.prototype.modifyPixels=function(t,e){if(!(e=e||new IFRect(0,0,this.getWidth(),this.getHeight())).isEmpty()){var n=this._canvasContext.getImageData(e.getX(),e.getY(),e.getWidth(),e.getHeight());t(n.data,e.getWidth(),e.getHeight()),this._canvasContext.putImageData(n,e.getX(),e.getY())}},e.prototype.colorTransform=function(t,e,n){this.modifyPixels(function(n,i,r){for(var o=0;o<r;++o)for(var s=0;s<i;++s){var a=4*(o*i+s);n[a]=n[a]*t[0]+e[0],n[a+1]=n[a+1]*t[1]+e[1],n[a+2]=n[a+2]*t[2]+e[2],n[a+3]=n[a+3]*t[3]+e[3]}},n)},e.prototype.colorMatrix=function(t,e){this.modifyPixels(function(e,n,i){for(var r=0;r<i;++r)for(var o=0;o<n;++o){var s=4*(r*n+o),a=e[s],h=e[s+1],l=e[s+2],p=e[s+3];e[s]=t[0]*a+t[1]*h+t[2]*l+t[3]*p+t[4],e[s+1]=t[5]*a+t[6]*h+t[7]*l+t[8]*p+t[9],e[s+2]=t[10]*a+t[11]*h+t[12]*l+t[13]*p+t[14],e[s+3]=t[15]*a+t[16]*h+t[17]*l+t[18]*p+t[19]}},e)},e.prototype.blur=function(t,e){this.modifyPixels(function(e,o,s){if(!(isNaN(t)||t<1)){var a,h,l,p,u,c,g,f,y,d,_,v,m,I,P,C,F,x,S,E,w,T,M,b,A=(t|=0)+t+1,$=o-1,O=s-1,B=t+1,R=B*(B+1)/2,N=new r,V=N;for(l=1;l<A;l++)if(V=V.next=new r,l==B)var L=V;V.next=N;var k=null,G=null;g=c=0;var Y=n[t],X=i[t];for(h=0;h<s;h++){for(C=F=x=S=f=y=d=_=0,v=B*(E=e[c]),m=B*(w=e[c+1]),I=B*(T=e[c+2]),P=B*(M=e[c+3]),f+=R*E,y+=R*w,d+=R*T,_+=R*M,V=N,l=0;l<B;l++)V.r=E,V.g=w,V.b=T,V.a=M,V=V.next;for(l=1;l<B;l++)p=c+(($<l?$:l)<<2),f+=(V.r=E=e[p])*(b=B-l),y+=(V.g=w=e[p+1])*b,d+=(V.b=T=e[p+2])*b,_+=(V.a=M=e[p+3])*b,C+=E,F+=w,x+=T,S+=M,V=V.next;for(k=N,G=L,a=0;a<o;a++)e[c]=f*Y>>X,e[c+1]=y*Y>>X,e[c+2]=d*Y>>X,e[c+3]=_*Y>>X,f-=v,y-=m,d-=I,_-=P,v-=k.r,m-=k.g,I-=k.b,P-=k.a,p=g+((p=a+t+1)<$?p:$)<<2,f+=C+=k.r=e[p],y+=F+=k.g=e[p+1],d+=x+=k.b=e[p+2],_+=S+=k.a=e[p+3],k=k.next,v+=E=G.r,m+=w=G.g,I+=T=G.b,P+=M=G.a,C-=E,F-=w,x-=T,S-=M,G=G.next,c+=4;g+=o}for(a=0;a<o;a++){for(F=x=S=C=y=d=_=f=0,v=B*(E=e[c=a<<2]),m=B*(w=e[c+1]),I=B*(T=e[c+2]),P=B*(M=e[c+3]),f+=R*E,y+=R*w,d+=R*T,_+=R*M,V=N,l=0;l<B;l++)V.r=E,V.g=w,V.b=T,V.a=M,V=V.next;for(u=o,l=1;l<=t;l++)c=u+a<<2,f+=(V.r=E=e[c])*(b=B-l),y+=(V.g=w=e[c+1])*b,d+=(V.b=T=e[c+2])*b,_+=(V.a=M=e[c+3])*b,C+=E,F+=w,x+=T,S+=M,V=V.next,l<O&&(u+=o);for(c=a,k=N,G=L,h=0;h<s;h++)e[(p=c<<2)+3]=M=_*Y>>X,M>0?(M=255/M,e[p]=(f*Y>>X)*M,e[p+1]=(y*Y>>X)*M,e[p+2]=(d*Y>>X)*M):e[p]=e[p+1]=e[p+2]=0,f-=v,y-=m,d-=I,_-=P,v-=k.r,m-=k.g,I-=k.b,P-=k.a,p=a+((p=h+B)<O?p:O)*o<<2,f+=C+=k.r=e[p],y+=F+=k.g=e[p+1],d+=x+=k.b=e[p+2],_+=S+=k.a=e[p+3],k=k.next,v+=E=G.r,m+=w=G.g,I+=T=G.b,P+=M=G.a,C-=E,F-=w,x-=T,S-=M,G=G.next,c+=o}}},e)},e.prototype.toString=function(){return"[Object IFBitmap]"};var n=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],i=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function r(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}t.IFBitmap=e}(this),function(t){function e(){this._types={}}e.Style={Normal:"N",Italic:"I"},e.Weight={Thin:100,ExtraLight:200,Light:300,Regular:400,Medium:500,SemiBold:600,Bold:700,ExtraBold:800,Heavy:900},e.WeightName={100:new IFLocale.Key(e,"weight.thin"),200:new IFLocale.Key(e,"weight.extra-light"),300:new IFLocale.Key(e,"weight.light"),400:new IFLocale.Key(e,"weight.regular"),500:new IFLocale.Key(e,"weight.medium"),600:new IFLocale.Key(e,"weight.semi-bold"),700:new IFLocale.Key(e,"weight.bold"),800:new IFLocale.Key(e,"weight.extra-bold"),900:new IFLocale.Key(e,"weight.heavy")},e.Category={Other:0,Serif:100,Monospace:200,Iconic:300},e.CategoryName={0:new IFLocale.Key(e,"category.other"),100:new IFLocale.Key(e,"category.serif"),200:new IFLocale.Key(e,"category.monospace"),300:new IFLocale.Key(e,"category.iconic")},e.prototype._types=null,e.prototype.addType=function(t,n,i,r,o){var s=this._types[t];s||(s={styles:{},weights:{},variants:{},category:o||e.Category.Other},this._types[t]=s);var a=n+i.toString();s.styles[n]=!0,s.weights[i]=!0;var h=function(t){switch(t){case e.Style.Normal:return"normal";case e.Style.Italic:return"italic";default:throw new Error("Unknown style")}},l=new XMLHttpRequest;l.open("get",r),l.responseType="arraybuffer",l.onload=function(){if(l.response&&l.response instanceof ArrayBuffer){var e=opentype.parse(l.response);e&&e.supported&&(s.variants[a]={url:r,font:e,outlines:{}},$("<style></style>").attr("type","text/css").text('@font-face {font-family: "'+t+'";src: url("'+r+'");font-weight: '+i.toString()+";font-style: "+h(n)+";} ").appendTo($("body")),$("<span></span>").css({position:"absolute",opacity:"0","font-family":t,"font-weight":i.toString(),"font-style":h(n)}).text(".").appendTo($("body")))}},l.send()},e.prototype.getFamilies=function(){var t=Object.keys(this._types);return t.sort(),t},e.prototype.getCategory=function(t){var n=this._types[t];return n?n.category:e.Category.Other},e.prototype.getStyles=function(t){var e=this._types[t];return e?Object.keys(e.styles):null},e.prototype.getWeights=function(t){var e=this._types[t];if(e){for(var n=Object.keys(e.weights),i=[],r=0;r<n.length;++r)i.push(parseInt(n[r]));return i.sort(),i}return null},e.prototype.getVariant=function(t,n,i,r){var o=this._types[t];if(o){if(o.styles.hasOwnProperty(n)||r||(n=e.Style.Normal),i="number"==typeof i?i:parseInt(i),!r){for(;!o.weights.hasOwnProperty(i)&&i>=100;)i-=100;for(;!o.weights.hasOwnProperty(i)&&i<=900;)i+=100}var s=n+i.toString();if(o.variants.hasOwnProperty(s))return s}return null},e.prototype.getGlyphBaseline=function(t,e,n,i){var r=this._types[t].variants[e].font,o=r.charToGlyph(i),s=1/r.unitsPerEm*n,a=(o.yMax-o.yMin)*s;return a+(r.ascender*s-a)},e.prototype.getGlyphOutline=function(t,e,n,i,r,o){var s=this._types[t].variants[e],a=s.font,h=s.outlines[o],l=1/a.unitsPerEm*n;if(!h){var p=a.charToGlyph(o).getPath(0,0,a.unitsPerEm);h=new IFVertexContainer,s.outlines[o]=h;for(var u=0;u<p.commands.length;u+=1){var c=p.commands[u];"M"===c.type?h.addVertex(IFVertex.Command.Move,c.x,c.y):"L"===c.type?h.addVertex(IFVertex.Command.Line,c.x,c.y):"C"===c.type?(h.addVertex(IFVertex.Command.Curve2,c.x,c.y),h.addVertex(IFVertex.Command.Curve2,c.x1,c.y1),h.addVertex(IFVertex.Command.Curve2,c.x2,c.y2)):"Q"===c.type?(h.addVertex(IFVertex.Command.Curve,c.x,c.y),h.addVertex(IFVertex.Command.Curve,c.x1,c.y1)):"Z"===c.type&&h.addVertex(IFVertex.Command.Close)}}return new IFVertexTransformer(h,new IFTransform(l,0,0,l,i,r))},t.IFFont=e,t.ifFont=new e}(this),function(t){t.IFColorSpace={None:"n",RGB:"rgb",CMYK:"cmyk",LAB:"lab",XYZ:"xyz"}}(this),function(t){function e(t,e){this._type=t,this._value=e&&e instanceof Array?e.slice():e}IFObject.inherit(e,IFPattern),e.Type={RGB:{key:"rgb",space:IFColorSpace.RGB,fromString:function(t){var e=[0,0,0,0],n=t.split(",");if(4!==n.length)e=null;else for(var i=0;i<4;++i){var r=parseInt(n[i]);if(isNaN(r)||r<0||3===i&&r>100||i<3&&r>255){e=null;break}e[i]=r}return e},toString:function(t){return t.join(",")}},HSL:{key:"hsl",space:IFColorSpace.RGB,fromString:function(t){var e=[0,0,0,0],n=t.split(",");if(4!==n.length)e=null;else for(var i=0;i<4;++i){var r=parseInt(n[i]);if(isNaN(r)||r<0||0===i&&r>360||i>0&&r>100){e=null;break}e[i]=r}return e},toString:function(t){return t.join(",")}},Tone:{key:"tone",space:IFColorSpace.RGB,fromString:function(t){var e=[0,0],n=t.split(",");if(2!==n.length)e=null;else for(var i=0;i<2;++i){var r=parseInt(n[i]);if(isNaN(r)||r<0||r>100){e=null;break}e[i]=r}return e},toString:function(t){return t.join(",")}},CMYK:{key:"cmyk",space:IFColorSpace.CMYK,fromString:function(t){var e=[0,0,0,0],n=t.split(",");if(4!==n.length)e=null;else for(var i=0;i<4;++i){var r=parseInt(n[i]);if(isNaN(r)||r<0||r>100){e=null;break}e[i]=r}return e},toString:function(t){return t.join(",")}},Reference:{key:"#",space:IFColorSpace.None,fromString:function(t){return t},toString:function(t){return t}},White:{key:"white",space:IFColorSpace.None},Black:{key:"black",space:IFColorSpace.None},Registration:{key:"registration",space:IFColorSpace.None}},e.BLACK=new e(e.Type.Black),e.WHITE=new e(e.Type.White),e.TRANSPARENT_WHITE=new e(e.Type.RGB,[255,255,255,0]),e.SELECTION_OUTLINE=new e(e.Type.RGB,[0,168,255,100]),e.HIGHLIGHT_OUTLINE=new e(e.Type.RGB,[255,0,0,100]),e.GUIDE_OUTLINE=new e(e.Type.RGB,[46,204,64,100]),e.MARGIN_OUTLINE=new e(e.Type.RGB,[255,0,255,100]),e.parseColor=function(t){if(!t||""===t)return null;for(var n in e.Type){var i=e.Type[n];if(0===t.indexOf(i.key)){if(!i.fromString)return new e(i);var r=i.fromString(t.substring(i.key.length));if(r)return new e(i,r)}}return null},e.parseCSSColor=function(t){var n={transparent:[0,0,0,0],aliceblue:[240,248,255,100],antiquewhite:[250,235,215,100],aqua:[0,255,255,100],aquamarine:[127,255,212,100],azure:[240,255,255,100],beige:[245,245,220,100],bisque:[255,228,196,100],black:[0,0,0,100],blanchedalmond:[255,235,205,100],blue:[0,0,255,100],blueviolet:[138,43,226,100],brown:[165,42,42,100],burlywood:[222,184,135,100],cadetblue:[95,158,160,100],chartreuse:[127,255,0,100],chocolate:[210,105,30,100],coral:[255,127,80,100],cornflowerblue:[100,149,237,100],cornsilk:[255,248,220,100],crimson:[220,20,60,100],cyan:[0,255,255,100],darkblue:[0,0,139,100],darkcyan:[0,139,139,100],darkgoldenrod:[184,134,11,100],darkgray:[169,169,169,100],darkgreen:[0,100,0,100],darkgrey:[169,169,169,100],darkkhaki:[189,183,107,100],darkmagenta:[139,0,139,100],darkolivegreen:[85,107,47,100],darkorange:[255,140,0,100],darkorchid:[153,50,204,100],darkred:[139,0,0,100],darksalmon:[233,150,122,100],darkseagreen:[143,188,143,100],darkslateblue:[72,61,139,100],darkslategray:[47,79,79,100],darkslategrey:[47,79,79,100],darkturquoise:[0,206,209,100],darkviolet:[148,0,211,100],deeppink:[255,20,147,100],deepskyblue:[0,191,255,100],dimgray:[105,105,105,100],dimgrey:[105,105,105,100],dodgerblue:[30,144,255,100],firebrick:[178,34,34,100],floralwhite:[255,250,240,100],forestgreen:[34,139,34,100],fuchsia:[255,0,255,100],gainsboro:[220,220,220,100],ghostwhite:[248,248,255,100],gold:[255,215,0,100],goldenrod:[218,165,32,100],gray:[128,128,128,100],green:[0,128,0,100],greenyellow:[173,255,47,100],grey:[128,128,128,100],honeydew:[240,255,240,100],hotpink:[255,105,180,100],indianred:[205,92,92,100],indigo:[75,0,130,100],ivory:[255,255,240,100],khaki:[240,230,140,100],lavender:[230,230,250,100],lavenderblush:[255,240,245,100],lawngreen:[124,252,0,100],lemonchiffon:[255,250,205,100],lightblue:[173,216,230,100],lightcoral:[240,128,128,100],lightcyan:[224,255,255,100],lightgoldenrodyellow:[250,250,210,100],lightgray:[211,211,211,100],lightgreen:[144,238,144,100],lightgrey:[211,211,211,100],lightpink:[255,182,193,100],lightsalmon:[255,160,122,100],lightseagreen:[32,178,170,100],lightskyblue:[135,206,250,100],lightslategray:[119,136,153,100],lightslategrey:[119,136,153,100],lightsteelblue:[176,196,222,100],lightyellow:[255,255,224,100],lime:[0,255,0,100],limegreen:[50,205,50,100],linen:[250,240,230,100],magenta:[255,0,255,100],maroon:[128,0,0,100],mediumaquamarine:[102,205,170,100],mediumblue:[0,0,205,100],mediumorchid:[186,85,211,100],mediumpurple:[147,112,219,100],mediumseagreen:[60,179,113,100],mediumslateblue:[123,104,238,100],mediumspringgreen:[0,250,154,100],mediumturquoise:[72,209,204,100],mediumvioletred:[199,21,133,100],midnightblue:[25,25,112,100],mintcream:[245,255,250,100],mistyrose:[255,228,225,100],moccasin:[255,228,181,100],navajowhite:[255,222,173,100],navy:[0,0,128,100],oldlace:[253,245,230,100],olive:[128,128,0,100],olivedrab:[107,142,35,100],orange:[255,165,0,100],orangered:[255,69,0,100],orchid:[218,112,214,100],palegoldenrod:[238,232,170,100],palegreen:[152,251,152,100],paleturquoise:[175,238,238,100],palevioletred:[219,112,147,100],papayawhip:[255,239,213,100],peachpuff:[255,218,185,100],peru:[205,133,63,100],pink:[255,192,203,100],plum:[221,160,221,100],powderblue:[176,224,230,100],purple:[128,0,128,100],red:[255,0,0,100],rosybrown:[188,143,143,100],royalblue:[65,105,225,100],saddlebrown:[139,69,19,100],salmon:[250,128,114,100],sandybrown:[244,164,96,100],seagreen:[46,139,87,100],seashell:[255,245,238,100],sienna:[160,82,45,100],silver:[192,192,192,100],skyblue:[135,206,235,100],slateblue:[106,90,205,100],slategray:[112,128,144,100],slategrey:[112,128,144,100],snow:[255,250,250,100],springgreen:[0,255,127,100],steelblue:[70,130,180,100],tan:[210,180,140,100],teal:[0,128,128,100],thistle:[216,191,216,100],tomato:[255,99,71,100],turquoise:[64,224,208,100],violet:[238,130,238,100],wheat:[245,222,179,100],white:[255,255,255,100],whitesmoke:[245,245,245,100],yellow:[255,255,0,100],yellowgreen:[154,205,50,100]};function i(t){return(t=Math.round(t))<0?0:t>255?255:t}function r(t){return t<0?0:t>1?1:t}function o(t){return"%"===t[t.length-1]?i(parseFloat(t)/100*255):i(parseInt(t))}function s(t){return"%"===t[t.length-1]?r(parseFloat(t)/100):r(parseFloat(t))}function a(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}var h,l=t.replace(/ /g,"").toLowerCase();if(l in n)return new e(e.Type.RGB,n[l].slice());if("#"===l[0])return 4===l.length?(h=parseInt(l.substr(1),16))>=0&&h<=4095?new e(e.Type.RGB,[(3840&h)>>4|(3840&h)>>8,240&h|(240&h)>>4,15&h|(15&h)<<4,100]):null:7===l.length&&(h=parseInt(l.substr(1),16))>=0&&h<=16777215?new e(e.Type.RGB,[(16711680&h)>>16,(65280&h)>>8,255&h,100]):null;var p=l.indexOf("("),u=l.indexOf(")");if(-1!==p&&u+1===l.length){var c=l.substr(0,p),g=l.substr(p+1,u-(p+1)).split(","),f=100;switch(c){case"rgba":if(4!==g.length)return null;f=Math.round(100*s(g.pop()));case"rgb":return 3!==g.length?null:new e(e.Type.RGB,[o(g[0]),o(g[1]),o(g[2]),f]);case"hsla":if(4!==g.length)return null;f=Math.round(100*s(g.pop()));case"hsl":if(3!==g.length)return null;var y=(parseFloat(g[0])%360+360)%360/360,d=s(g[1]),_=s(g[2]),v=_<=.5?_*(d+1):_+d-_*d,m=2*_-v;return new e(e.Type.RGB,[i(255*a(m,v,y+1/3)),i(255*a(m,v,y)),i(255*a(m,v,y-1/3)),f]);default:return null}}return null},e.equals=function(t,e){if(!t&&t===e)return!0;if(t&&e&&t._type===e._type){var n=t._value,i=e._value;if(!n&&n===i)return!0;if(n instanceof Array&&i instanceof Array){if(n.length!==i.length)return!1;for(var r=0;r<n.length;++r)if(n[r]!==i[r])return!1;return!0}return n===i}return!1},e.prototype._type=null,e.prototype._value=null,e.prototype.getPatternType=function(){return IFPattern.Type.Color},e.prototype.getType=function(){return this._type},e.prototype.getValue=function(){return this._value},e.prototype.getSpace=function(){return this._type.space},e.prototype.difference=function(t){var e=this.asLAB(),n=t.asLAB();return ciede2000({L:e[0],a:e[1],b:e[2]},{L:n[0],a:n[1],b:n[2]})},e.prototype.toRGB=function(){return new e(e.Type.RGB,this.asRGB())},e.prototype.toHSL=function(){return new e(e.Type.HSL,this.asHSL())},e.prototype.toTone=function(){return new e(e.Type.Tone,this.asTone())},e.prototype.toCMYK=function(){return new e(e.Type.CMYK,this.asCMYK())},e.prototype.toType=function(t){switch(t){case e.Type.HSL:return this.toHSL();case e.Type.CMYK:return this.toCMYK();case e.Type.Tone:return this.toTone();default:return this.toRGB()}},e.prototype.asRGB=function(){if(this._type===e.Type.RGB)return this._value.slice();if(this._type===e.Type.HSL){var t,n,i,r,o,s,a=this._value[0]/360,h=this._value[1]/100,l=this._value[2]/100;return 0===h?t=n=i=l:(r=2*l-(o=l<.5?l*(1+h):l+h-h*l),(s=a+1/3)<0&&(s+=1),s>1&&(s-=1),t=6*s<1?r+6*(o-r)*s:2*s<1?o:3*s<2?r+(o-r)*(2/3-s)*6:r,(s=a)<0&&(s+=1),s>1&&(s-=1),n=6*s<1?r+6*(o-r)*s:2*s<1?o:3*s<2?r+(o-r)*(2/3-s)*6:r,(s=a-1/3)<0&&(s+=1),s>1&&(s-=1),i=6*s<1?r+6*(o-r)*s:2*s<1?o:3*s<2?r+(o-r)*(2/3-s)*6:r),[Math.min(255,Math.max(0,Math.round(255*t))),Math.min(255,Math.max(0,Math.round(255*n))),Math.min(255,Math.max(0,Math.round(255*i))),this._value[3]]}if(this._type===e.Type.Tone){var p=255-Math.min(255,Math.max(0,Math.round(this._value[0]/100*255)));return[p,p,p,this._value[1]]}if(this._type===e.Type.CMYK){var u=this._value[0]/100,c=this._value[1]/100,g=this._value[2]/100,f=this._value[3]/100,y=u*(1-f)+f,d=c*(1-f)+f,_=g*(1-f)+f;return[Math.min(255,Math.max(0,Math.round(255*(1-y)))),Math.min(255,Math.max(0,Math.round(255*(1-d)))),Math.min(255,Math.max(0,Math.round(255*(1-_)))),100]}if(this._type===e.Type.White)return[255,255,255,100];if(this._type===e.Type.Black)return[0,0,0,100];if(this._type===e.Type.Registration)return[0,0,0,100];throw new Error("Unable to convert to rgb from color type.")},e.prototype.asRGBInt=function(){var t=this.asRGB(),e=t[0],n=t[1],i=t[2],r=Math.round(2.55*t[3]);return ifSystem.littleEndian?r<<24|i<<16|n<<8|e:e<<24|n<<16|i<<8|r},e.prototype.asHSL=function(){if(this._type===e.Type.HSL)return this._value.slice();var t,n,i=this.asRGB(),r=i[0]/255,o=i[1]/255,s=i[2]/255,a=i[3],h=Math.min(r,o,s),l=Math.max(r,o,s),p=l-h,u=(l+h)/2;if(0===p)t=0,n=0;else{n=u<.5?p/(l+h):p/(2-l-h);var c=((l-r)/6+p/2)/p,g=((l-o)/6+p/2)/p,f=((l-s)/6+p/2)/p;r===l?t=f-g:o===l?t=1/3+c-f:s===l&&(t=2/3+g-c),t<0&&(t+=1),t>1&&(t-=1)}return[Math.min(360,Math.max(0,Math.round(360*t))),Math.min(100,Math.max(0,Math.round(100*n))),Math.min(100,Math.max(0,Math.round(100*u))),a]},e.prototype.asTone=function(){if(this._type===e.Type.Tone)return this._value.slice();var t=this.asRGB(),n=t[0]/255,i=t[1]/255,r=t[2]/255,o=t[3],s=.299*n+.587*i+.114*r;return[100-Math.min(100,Math.max(0,Math.round(100*s))),o]},e.prototype.asCMYK=function(){if(this._type===e.Type.CMYK)return this._value.slice();var t=this.asRGB(),n=1-t[0]/255,i=1-t[1]/255,r=1-t[2]/255,o=Math.min(r,Math.min(i,Math.min(n,1))),s=t[3]/100;return[Math.round((n-o)/(1-o)*100*s),Math.round((i-o)/(1-o)*100*s),Math.round((r-o)/(1-o)*100*s),100*o*s]},e.prototype.asXYZ=function(t){var e=this.asRGB(),n=function(t){return t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92},i=100*n(e[0]/255),r=100*n(e[1]/255),o=100*n(e[2]/255);return[.4124*i+.3576*r+.1805*o,.2126*i+.7152*r+.0722*o,.0193*i+.1192*r+.9505*o]},e.prototype.asLAB=function(t){var e=this.asXYZ(t),n=function(t){return t>.008856?Math.pow(t,1/3):7.787037*t+4/29},i=n(e[0]/95.047),r=n(e[1]/100);return[116*r-16,500*(i-r),200*(r-n(e[2]/108.883))]},e.prototype.asString=function(){var t=this._type.key;return this._type.toString&&(t+=this._type.toString(this._value)),t},e.prototype.asCSSString=function(){var t=this.asRGB();return 100===t[3]?this.asHTMLHexString():"rgba("+t[0].toString()+","+t[1].toString()+","+t[2].toString()+","+(t[3]/100).toString()+")"},e.prototype.asHTMLHexString=function(){var t,e=this.asRGB(),n=e[0]<<16|e[1]<<8|e[2];return"#"+(t=n.toString(16).toUpperCase(),new Array(7-t.length).join("0")+t)},e.prototype.withTint=function(t){if(this._type===e.Type.CMYK){for(var n=t/100,i=this._value.slice(),r=0;r<4;++r)i[r]=Math.round(i[r]*n);return new e(e.Type.CMYK,i)}n=1-t/100;var o=this.asRGB();return o[0]=Math.round((255-o[0])*n+o[0]),o[1]=Math.round((255-o[1])*n+o[1]),o[2]=Math.round((255-o[2])*n+o[2]),new e(e.Type.RGB,o).toType(this._type)},e.prototype.withShade=function(t){if(this._type===e.Type.CMYK){var n=this.asCMYK();return n[3]=t,new e(e.Type.CMYK,n).toType(this._type)}var i=1-t/100,r=this.asRGB();return r[0]=Math.round(r[0]*i),r[1]=Math.round(r[1]*i),r[2]=Math.round(r[2]*i),new e(e.Type.RGB,r).toType(this._type)},e.prototype.withTone=function(t){return this.withTint(t).withShade(t)},e.prototype.toString=function(){return"[Object IFColor]"},t.IFColor=e}(this),function(t){function e(){}e.prototype._colorSpace=null,e.prototype._pcsSpace=null,e.prototype._illumination=null,e.convertColor=function(t){if(t.getType()===IFColor.Type.White);else if(t.getType()===IFColor.Type.Black);else{if(t.getSpace()!==this._colorSpace)throw new Error("Color space is different than profile color space.");var n=null;switch(this._pcsSpace){case e.Space.RGB:(n=t.asRGB())[0]=n[0]/255,n[1]=n[1]/255,n[2]=n[2]/255;break;case e.Space.CMYK:(n=t.asCMYK())[0]=n[0]/100,n[1]=n[1]/100,n[2]=n[2]/100,n[3]=n[3]/100;break;case e.Space.LAB:n=t.asLAB(this._illumination);break;case e.Space.XYZ:n=t.asXYZ(this._illumination);break;default:throw new Error("Unable to convert.")}}},e.prototype.toString=function(){return"[Object IFColorProfile]"},t.IFColorProfile=e}(this),function(t){function e(){}e.options={epsilon:2500,bufferSize:10},e.Matcher=function(){},e.Matcher.prototype._unitedArea=null,e.Matcher.prototype._rects=null,e.Matcher.prototype.isDirty=function(t){if(this._unitedArea&&!this._unitedArea.intersectsRect(t))return!1;if(this._rects&&this._rects.length>0)for(var e=0;e<this._rects.length;++e){if(this._rects[e].intersectsRect(t))return!0}return!1},e.Matcher.prototype.transform=function(t){if(this._unitedArea&&(this._unitedArea=t.mapRect(this._unitedArea)),this._rects&&this._rects.length>0)for(var e=0;e<this._rects.length;++e)this._rects[e]=t.mapRect(this._rects[e])},e.Matcher.prototype.clip=function(t){if(this._rects&&this._rects.length>0){this._unitedArea&&(this._unitedArea=t.intersected(this._unitedArea));for(var e=0;e<this._rects.length;++e)this._rects[e]=t.intersected(this._rects[e])}else this._unitedArea=t,this._rects=[t]},e.Matcher.prototype.getDirtyRectangles=function(){return this._rects},e.prototype._area=null,e.prototype._dirties=null,e.prototype._numDirties=0,e.prototype.setArea=function(t){this._area=t},e.prototype.getArea=function(){return this._area},e.prototype.dirty=function(t,n,i,r){var o=Math.floor(t),s=Math.floor(n);if(i=Math.ceil(t+i)-o,r=Math.ceil(n+r)-s,t=o,n=s,this._area){if(!this._area.intersectsRectXYWH(t,n,i,r))return!1;t<this._area.getX()&&(t=this._area.getX()),n<this._area.getY()&&(n=this._area.getY()),t+i>this._area.getX()+this._area.getWidth()&&(i=this._area.getX()+this._area.getWidth()-t),n+r>this._area.getY()+this._area.getHeight()&&(r=this._area.getY()+this._area.getHeight()-n)}null==this._dirties?this._dirties=new Array(e.options.bufferSize):this._numDirties==this._dirties.length&&(this._dirties.length+=e.options.bufferSize);for(var a=0;a<this._numDirties;a++){if(t>=(h=this._dirties[a])[0]&&n>=h[1]&&t+i<=h[0]+h[2]&&n+r<=h[1]+h[3])return!1;if(t<=h[0]&&n<=h[1]&&t+i>=h[0]+h[2]&&n+r>=h[1]+h[3])this._dirties[a][2]=0,this._dirties[a][3]=0;else{if(t>=h[0]&&t<h[0]+h[2]&&n>=h[1]&&n+r<=h[1]+h[3]){i=t+i-(h[0]+h[2]),t=h[0]+h[2],a=-1;continue}if(t+i>h[0]&&t+i<=h[0]+h[2]&&n>=h[1]&&n+r<=h[1]+h[3]){i=h[0]-t,a=-1;continue}if(t>=h[0]&&t+i<=h[0]+h[2]&&n>=h[1]&&n<h[1]+h[3]){r=n+r-(h[1]+h[3]),n=h[1]+h[3],a=-1;continue}if(t>=h[0]&&t+i<=h[0]+h[2]&&n+r>h[1]&&n+r<=h[1]+h[3]){r=h[1]-n,a=-1;continue}if(this._dirties[a][0]>=t&&this._dirties[a][0]<t+i&&this._dirties[a][1]>=n&&this._dirties[a][1]+this._dirties[a][3]<=n+r){this._dirties[a][2]=this._dirties[a][2]-(t+i-this._dirties[a][0]),this._dirties[a][0]=t+i,a=-1;continue}if(this._dirties[a][0]+this._dirties[a][2]>t&&this._dirties[a][0]+this._dirties[a][2]<=t+i&&this._dirties[a][1]>=n&&this._dirties[a][1]+this._dirties[a][3]<=n+r){this._dirties[a][2]=t-this._dirties[a][0],a=-1;continue}if(this._dirties[a][0]>=t&&this._dirties[a][0]+this._dirties[a][2]<=t+i&&this._dirties[a][1]>=n&&this._dirties[a][1]<n+r){this._dirties[a][3]=this._dirties[a][3]-(n+r-this._dirties[a][1]),this._dirties[a][1]=n+r,a=-1;continue}if(this._dirties[a][0]>=t&&this._dirties[a][0]+this._dirties[a][2]<=t+i&&this._dirties[a][1]+this._dirties[a][3]>n&&this._dirties[a][1]+this._dirties[a][3]<=n+r){this._dirties[a][3]=n-this._dirties[a][1],a=-1;continue}}}for(a=0;a<this._numDirties;a++){var h=this._dirties[a];if(i>0&&r>0&&h[2]>0&&h[3]>0&&(Math.max(t+i,h[0]+h[2])-Math.min(t,h[0]))*(Math.max(n+r,h[1]+h[3])-Math.min(n,h[1]))<i*r+h[2]*h[3]+e.options.epsilon){var l=Math.min(h[0],t),p=Math.min(h[1],n),u=Math.max(t+i,h[0]+h[2])-Math.min(h[0],t),c=Math.max(n+r,h[1]+h[3])-Math.min(h[1],n);return this._dirties[a][2]=0,this._dirties[a][3]=0,this.dirty(l,p,u,c)}}return this._dirties[this._numDirties++]=[t,n,i,r],!0},e.prototype.flush=function(){var t=null;if(this._numDirties>0){(t=new e.Matcher)._rects=new Array(this._numDirties);for(var n=0,i=0;i<this._numDirties;++i){var r=this._dirties[i];if(r&&r[2]>0&&r[3]>0){var o=new IFRect(r[0],r[1],r[2],r[3]);t._rects[n++]=o,null==t._unitedArea?t._unitedArea=o:t._unitedArea=t._unitedArea.united(o)}}t._rects.length=n,0==t._rects.length&&(t=null)}return this.reset(),t},e.prototype.reset=function(){this._numDirties>0&&(this._dirties.length=e.options.bufferSize,this._numDirties=0)},e.prototype.toString=function(){return"[Object IFDirtyList]"},t.IFDirtyList=e}(this),function(t){function e(t,n){if(t){this._stops=[];for(var i=0;i<t.length;++i)this._stops.push({position:t[i].position<0?0:t[i].position>100?100:t[i].position,color:t[i].color})}else this._stops=[new IFColor(IFColor.Type.Black),new IFColor(IFColor.Type.White)];this._type=n||e.Type.Linear}IFObject.inherit(e,IFPattern),e.Type={Linear:"L",Radial:"R"},e.parseGradient=function(t){if(!t||""===t)return null;var n=JSON.parse(t);if(n){var i=new e;i._type=n.t,i._stops=[];for(var r=0;r<n.s.length;++r){var o=n.s[r];i._stops.push({position:o.p,color:IFColor.parseColor(o.c)})}return i}return null},e.equals=function(t,e,n){if(!t&&t===e)return!0;if(t&&e){if(!n&&t._type!==e._type)return!1;if(t._stops.length!==e._stops.length)return!1;for(var i=t._stops,r=e._stops,o=0;o<i.length;++o){if(i[o].position!==r[o].position)return!1;if(!IFColor.equals(i[o].color,r[o].color))return!1}}return!1},e.prototype._stops=null,e.prototype.getPatternType=function(){return IFPattern.Type.Gradient},e.prototype.getType=function(){return this._type},e.prototype.getStops=function(){return this._stops},e.prototype.asString=function(){for(var t=[],e=0;e<this._stops.length;++e)t.push({p:this._stops[e].position,c:this._stops[e].color.asString()});var n={t:this._type,s:t};return JSON.stringify(n)},e.prototype.asCSSString=function(){for(var t=[],e=0;e<this._stops.length;++e){var n=this._stops[e];t.push(n.color.asCSSString()+" "+n.position+"%")}return t.join(", ")},e.prototype.asCSSBackgroundString=function(){var t=this.asCSSString();return this._type===e.Type.Radial?"radial-gradient(ellipse at center, "+t+")":"linear-gradient(90deg, "+t+")"},e.prototype.toString=function(){return"[Object IFGradient]"},t.IFGradient=e}(this),function(t){function e(){var t=document.createElement("canvas");this._canvasContext=t.getContext("2d")}IFObject.inherit(e,IFObject),e.LineCap={Butt:"butt",Round:"round",Square:"square"},e.LineJoin={Miter:"miter",Bevel:"bevel",Round:"round"},e.BlendMode={Normal:"normal",Multiply:"multiply",Screen:"screen",Overlay:"overlay",Darken:"darken",Lighten:"lighten",ColorDodge:"color-dodge",ColorBurn:"color-burn",HardLight:"hard-light",SoftLight:"soft-light",Difference:"difference",Exclusion:"exclusion",Hue:"hue",Saturation:"saturation",Color:"color",Luminosity:"luminosity"},e.CompositeOperator={SourceOver:"source-over",SourceAtTop:"source-atop",SourceIn:"source-in",SourceOut:"source-out",DestinationOver:"destination-over",DestinationAtTop:"destination-atop",DestinationIn:"destination-in",DestinationOut:"destination-out",Copy:"copy",Xor:"xor",Lighter:"lighter",Darker:"darker"},e.RepeatMode={Both:"repeat",Horizontal:"repeat-x",Vertical:"repeat-y",None:"no-repeat"},e.createChessboard=function(t,e,n){var i=document.createElement("canvas");i.width=2*t,i.height=2*t;var r=i.getContext("2d");return r.fillStyle=e,r.fillRect(0,0,i.width,i.height),r.fillStyle=n,r.fillRect(0,0,t,t),r.fillRect(t,t,t,t),i},e.prototype._canvasContext=null,e.prototype._bitmap=null,e.prototype._transform=null,e.prototype._offset=null,e.prototype._origin=null,e.prototype._scale=null,e.prototype._areas=null,e.prototype.getWidth=function(){return this._canvasContext.canvas.width},e.prototype.getHeight=function(){return this._canvasContext.canvas.height},e.prototype.getBitmap=function(){return this._bitmap||(this._bitmap=new IFBitmap(this)),this._bitmap},e.prototype.asPNGImage=function(){return this._canvasContext.canvas.toDataURL("image/png")},e.prototype.asJPEGImage=function(t){return t=t||1,this._canvasContext.canvas.toDataURL("image/jpeg",t)},e.prototype.asPNGImageBuffer=function(t){this._canvasContext.canvas.toBlob(function(e){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.readAsArrayBuffer(e)},"image/png")},e.prototype.asJPEGImageBuffer=function(t,e){e=e||1,this._canvasContext.canvas.toBlob(function(e){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.readAsArrayBuffer(e)},"image/jpeg",e)},e.prototype.resize=function(t,e){t==this._canvasContext.canvas.width&&e==this._canvasContext.canvas.height||(this._canvasContext.canvas.width=t,this._canvasContext.canvas.height=e)},e.prototype.getOffset=function(){return this._offset},e.prototype.setOffset=function(t){this._offset=t},e.prototype.getOrigin=function(){return this._origin},e.prototype.setOrigin=function(t){IFPoint.equals(t,this._origin)||(this._origin=t,this._updateTransform())},e.prototype.getScale=function(){return this._scale},e.prototype.setScale=function(t){t!==this._scale&&(this._scale=t,this._updateTransform())},e.prototype.getTransform=function(t){var e=this._transform;if(!t){var n=this._origin.getX(),i=this._origin.getY(),r=this._scale;e=e.multiplied((new IFTransform).scaled(r,r).translated(-n,-i))}return e},e.prototype.setTransform=function(t){null==t&&(t=new IFTransform);var e=this._transform;return this._transform=t,this._updateTransform(),e},e.prototype.resetTransform=function(){return this.setTransform(null)},e.prototype.prepare=function(t){if(this._canvasContext.save(),this._transform=new IFTransform,this._origin=new IFPoint(0,0),this._scale=1,this._areas=t?t.slice():null,this._updateTransform(),t&&t.length>0){this._canvasContext.beginPath();for(var e=0;e<t.length;++e){var n=t[e],i=n.getX(),r=i+n.getWidth(),o=n.getY(),s=o+n.getHeight();i=Math.max(0,i),r=Math.min(this.getWidth(),r),o=Math.max(0,o),s=Math.min(this.getHeight(),s),this._canvasContext.moveTo(i,o),this._canvasContext.lineTo(r,o),this._canvasContext.lineTo(r,s),this._canvasContext.lineTo(i,s),this._canvasContext.lineTo(i,o),this._canvasContext.clearRect(i,o,r-i,s-o)}this._canvasContext.clip()}else this._canvasContext.clearRect(0,0,this.getWidth(),this.getHeight())},e.prototype.finish=function(){this._canvasContext.restore(),this._transform=null,this._origin=null,this._scale=null,this._areas=null},e.prototype.trim=function(t){alert("todo: trim_canvas")},e.prototype.createCanvas=function(t,n){var i=new e,r=this.getTransform(!1).mapRect(t),o=r.getX(),s=r.getY(),a=r.getWidth(),h=r.getHeight();s<0&&(h+=s,s=0),o<0&&(a+=o,o=0),o+a>this.getWidth()&&(a=this.getWidth()-o),s+h>this.getHeight()&&(h=this.getHeight()-s);var l=this.getTransform(!1).inverted().mapRect(new IFRect(o,s,a,h)),p=new IFRect(l.getX()*this._scale,l.getY()*this._scale,l.getWidth()*this._scale,l.getHeight()*this._scale);i.resize(p.getWidth(),p.getHeight());var u=null;if(n&&this._areas){u=[];for(var c=0;c<this._areas.length;++c)u.push(this._areas[c].translated(-o,-s))}i.prepare(u);var g=p.getSide(IFRect.Side.TOP_LEFT);return i.setOrigin(g),i.setOffset(g),i.setScale(this._scale),i},e.prototype.clear=function(){var t=this.getTransform(!1).inverted().mapRect(new IFRect(0,0,this.getWidth(),this.getHeight()));this._canvasContext.clearRect(t.getX(),t.getY(),t.getWidth(),t.getHeight())},e.prototype.drawCanvas=function(t,n,i,r,o,s){var a=this._getImageSmoothingEnabled(),h=this._scale;this._setImageSmoothingEnabled(h<1),1!==t.getScale()&&this.setScale(1);var l=this.resetTransform(),p=l?l.getTranslation():new IFPoint(0,0);n|=0,i|=0;var u=t.getOffset(),c=u?u.getX():0,g=u?u.getY():0,f=t.getWidth(),y=t.getHeight(),d=t.getScale();d=d||1,c+=n+p.getX()*d,g+=i+p.getY()*d,s&&this._canvasContext.clearRect(c,g,f,y),this._canvasContext.globalAlpha="number"==typeof r?r:1,this._canvasContext.globalCompositeOperation=o||e.CompositeOperator.SourceOver,this._canvasContext.drawImage(t._canvasContext.canvas,0,0,f,y,c,g,f,y),this.setTransform(l),this.setScale(h),this._setImageSmoothingEnabled(a)},e.prototype.createTexture=function(t,n){return n=n||e.RepeatMode.Both,t=this._convertImage(t),this._canvasContext.createPattern(t,n)},e.prototype.createLinearGradient=function(t,e,n,i,r){for(var o=this._canvasContext.createLinearGradient(t,e,n,i),s=r.getStops(),a=0;a<s.length;++a)o.addColorStop(s[a].position/100,s[a].color.asCSSString());return o},e.prototype.createRadialGradient=function(t,e,n,i){for(var r=this._canvasContext.createRadialGradient(t,e,0,t,e,n),o=i.getStops(),s=0;s<o.length;++s)r.addColorStop(o[s].position/100,o[s].color.asCSSString());return r},e.prototype.clipRect=function(t,e,n,i){this._canvasContext.save(),this._canvasContext.beginPath(),this._canvasContext.moveTo(t,e),this._canvasContext.lineTo(t+n,e),this._canvasContext.lineTo(t+n,e+i),this._canvasContext.lineTo(t,e+i),this._canvasContext.lineTo(t,e),this._canvasContext.clip()},e.prototype.resetClip=function(){this._canvasContext.restore()},e.prototype.putVertices=function(t){if(t.rewindVertices(0)){this._canvasContext.beginPath();for(var e=new IFVertex;t.readVertex(e);)switch(e.command){case IFVertex.Command.Move:this._canvasContext.moveTo(e.x,e.y);break;case IFVertex.Command.Line:this._canvasContext.lineTo(e.x,e.y);break;case IFVertex.Command.Curve:var n=e.x,i=e.y;t.readVertex(e)&&this._canvasContext.quadraticCurveTo(e.x,e.y,n,i);break;case IFVertex.Command.Curve2:n=e.x,i=e.y;if(t.readVertex(e)){var r=e.x,o=e.y;t.readVertex(e)&&this._canvasContext.bezierCurveTo(r,o,e.x,e.y,n,i)}break;case IFVertex.Command.Close:this._canvasContext.closePath();break;default:throw new Error("Unknown Command Type - "+e.command)}}},e.prototype.strokeVertices=function(t,n,i,r,o,s,a){this._canvasContext.strokeStyle=this._convertStyle(t),this._canvasContext.lineWidth="number"==typeof n?n:1,this._canvasContext.lineCap=i||"butt",this._canvasContext.lineJoin=r||"miter",this._canvasContext.miterLimit="number"==typeof o?o:10,this._canvasContext.globalAlpha="number"==typeof s?s:1,this._canvasContext.globalCompositeOperation=a||e.CompositeOperator.SourceOver,this._canvasContext.stroke()},e.prototype.fillVertices=function(t,n,i){this._canvasContext.fillStyle=this._convertStyle(t),this._canvasContext.globalAlpha="number"==typeof n?n:1,this._canvasContext.globalCompositeOperation=i||e.CompositeOperator.SourceOver,this._canvasContext.fill()},e.prototype.fillCanvas=function(t){var e=this.getTransform(!1).inverted().mapRect(new IFRect(0,0,this.getWidth(),this.getHeight()));this.fillRect(e.getX(),e.getY(),e.getWidth(),e.getHeight(),t)},e.prototype.fillRect=function(t,n,i,r,o,s){o=this._convertStyle(o||IFColor.BLACK),this._canvasContext.globalCompositeOperation=e.CompositeOperator.SourceOver,this._canvasContext.globalAlpha="number"==typeof s?s:1,this._canvasContext.fillStyle=o,this._canvasContext.fillRect(t,n,i,r)},e.prototype.strokeRect=function(t,n,i,r,o,s,a){s=this._convertStyle(s||IFColor.BLACK),o=o||1,this._canvasContext.globalCompositeOperation=e.CompositeOperator.SourceOver,this._canvasContext.globalAlpha="number"==typeof a?a:1,this._canvasContext.strokeStyle=s,this._canvasContext.lineWidth=o,this._canvasContext.strokeRect(t,n,i,r)},e.prototype.strokeLine=function(t,n,i,r,o,s){s=this._convertStyle(s||IFColor.BLACK),o=o||1,this._canvasContext.globalCompositeOperation=e.CompositeOperator.SourceOver,this._canvasContext.globalAlpha=1,this._canvasContext.strokeStyle=s,this._canvasContext.lineWidth=o,this._canvasContext.beginPath(),this._canvasContext.moveTo(t,n),this._canvasContext.lineTo(i,r),this._canvasContext.stroke()},e.prototype.drawImage=function(t,n,i,r,o,s){n=n||0,i=i||0,t=this._convertImage(t),this._canvasContext.globalAlpha="number"==typeof o?o:1,this._canvasContext.globalCompositeOperation=s||e.CompositeOperator.SourceOver;var a=this._getImageSmoothingEnabled();this._setImageSmoothingEnabled(!r),this._canvasContext.drawImage(t,n||0,i||0),this._setImageSmoothingEnabled(a)},e.prototype._updateTransform=function(){var t=this.getTransform(!1).getMatrix();this._canvasContext.setTransform(t[0],t[1],t[2],t[3],t[4],t[5])},e.prototype._convertStyle=function(t){if(t instanceof CanvasPattern||t instanceof CanvasGradient)return t;if(t instanceof IFColor)return t.asCSSString();throw new Error("Not Supported.")},e.prototype._convertImage=function(t){if(t instanceof HTMLImageElement||t instanceof Image||t instanceof HTMLCanvasElement)return t;if(t instanceof e)return t._canvasContext.canvas;throw new Error("Not Supported.")};var n=["imageSmoothingEnabled","webkitImageSmoothingEnabled","mozImageSmoothingEnabled"];e.prototype._getImageSmoothingEnabled=function(){for(var t=0;t<n.length;++t)if(this._canvasContext.hasOwnProperty(n[t]))return this._canvasContext[n[t]]},e.prototype._setImageSmoothingEnabled=function(t){for(var e=0;e<n.length;++e)if(this._canvasContext.hasOwnProperty(n[e]))return void(this._canvasContext[n[e]]=t)},t.IFPaintCanvas=e}(this),function(t){function e(){}e.prototype.toString=function(){return"[Object IFPaintConfiguration]"},t.IFPaintConfiguration=e}(this),function(t){function e(){this.outlineColors=[]}e.prototype.configuration=null,e.prototype.canvas=null,e.prototype.dirtyMatcher=null,e.prototype.outlineColors=null,e.prototype.selectionOutlineColor=IFColor.SELECTION_OUTLINE,e.prototype.highlightOutlineColor=IFColor.HIGHLIGHT_OUTLINE,e.prototype.guideOutlineColor=IFColor.GUIDE_OUTLINE,e.prototype.isOutline=function(){return this.outlineColors&&this.outlineColors.length>0},e.prototype.getOutlineColor=function(){return this.outlineColors&&this.outlineColors.length>0?this.outlineColors[this.outlineColors.length-1]:IFColor.BLACK},e.prototype.toString=function(){return"[Object IFPaintContext]"},t.IFPaintContext=e}(this),function(t){function e(){}IFObject.inherit(e,IFObject),e.MIME_TYPE="application/infinity+node",e.inherit=function(t,n,i){IFObject.inherit(n,i),e._registerNodeClass(t,n)},e.inheritAndMix=function(t,n,i,r){IFObject.inheritAndMix(n,i,r),e._registerNodeClass(t,n)},e.getName=function(t){return e._nodeClassToNameMap[IFObject.getTypeId(t)]},e.store=function(t){if(t.hasMixin(e.Store)){var n={"@":e._nodeClassToNameMap[IFObject.getTypeId(t)]};if(t.store(n))return n}return null},e.restore=function(t){if(!t||!t.hasOwnProperty("@"))return null;var n=e._nameToNodeClassMap[t["@"]];if(!n)return null;var i=new n;return i&&i.restore(t)?i:null},e.serialize=function(t,n){if(t instanceof Array){for(var i=[],r=0;r<t.length;++r){(o=e.store(t[r]))&&i.push(o)}if(i.length>0)return JSON.stringify(i,null,n?4:null)}else{var o;if(o=e.store(t))return JSON.stringify(o,null,n?4:null)}return null},e.deserialize=function(t){if(t){var n=JSON.parse(t);if(n&&n instanceof Array){for(var i=[],r=0;r<n.length;++r){var o=e.restore(n[r]);o&&i.push(o)}return i&&i.length>0?i:null}return e.restore(n)}return null},e.order=function(t,e){return t.slice()},e._nodeClassToNameMap={},e._nameToNodeClassMap={},e._registerNodeClass=function(t,n){e._nodeClassToNameMap[IFObject.getTypeId(n)]=t,e._nameToNodeClassMap[t]=n},e.Flag={Shadow:1,Selected:2,Highlighted:4,Active:8,Expanded:16},e._Change={BeforeChildInsert:1,AfterChildInsert:2,BeforeChildRemove:10,AfterChildRemove:11,BeforePropertiesChange:20,AfterPropertiesChange:21,BeforeFlagChange:30,AfterFlagChange:31},e.BeforeInsertEvent=function(t){this.node=t},IFObject.inherit(e.BeforeInsertEvent,GEvent),e.BeforeInsertEvent.prototype.node=null,e.BeforeInsertEvent.prototype.toString=function(){return"[Event IFNode.BeforeInsertEvent]"},e.AfterInsertEvent=function(t){this.node=t},IFObject.inherit(e.AfterInsertEvent,GEvent),e.AfterInsertEvent.prototype.node=null,e.AfterInsertEvent.prototype.toString=function(){return"[Event IFNode.AfterInsertEvent]"},e.BeforeRemoveEvent=function(t){this.node=t},IFObject.inherit(e.BeforeRemoveEvent,GEvent),e.BeforeRemoveEvent.prototype.node=null,e.BeforeRemoveEvent.prototype.toString=function(){return"[Event IFNode.BeforeRemoveEvent]"},e.AfterRemoveEvent=function(t){this.node=t},IFObject.inherit(e.AfterRemoveEvent,GEvent),e.AfterRemoveEvent.prototype.node=null,e.AfterRemoveEvent.prototype.toString=function(){return"[Event IFNode.AfterRemoveEvent]"},e.BeforePropertiesChangeEvent=function(t,e,n){this.node=t,this.properties=e,this.values=n},IFObject.inherit(e.BeforePropertiesChangeEvent,GEvent),e.BeforePropertiesChangeEvent.prototype.node=null,e.BeforePropertiesChangeEvent.prototype.properties=null,e.BeforePropertiesChangeEvent.prototype.values=null,e.BeforePropertiesChangeEvent.prototype.toString=function(){return"[Event IFNode.BeforePropertiesChangeEvent]"},e.AfterPropertiesChangeEvent=function(t,e,n){this.node=t,this.properties=e,this.values=n},IFObject.inherit(e.AfterPropertiesChangeEvent,GEvent),e.AfterPropertiesChangeEvent.prototype.node=null,e.AfterPropertiesChangeEvent.prototype.properties=null,e.AfterPropertiesChangeEvent.prototype.values=null,e.AfterPropertiesChangeEvent.prototype.toString=function(){return"[Event IFNode.AfterPropertiesChangeEvent]"},e.BeforeFlagChangeEvent=function(t,e,n){this.node=t,this.flag=e,this.set=n},IFObject.inherit(e.BeforeFlagChangeEvent,GEvent),e.BeforeFlagChangeEvent.prototype.node=null,e.BeforeFlagChangeEvent.prototype.flag=null,e.BeforeFlagChangeEvent.prototype.set=null,e.BeforeFlagChangeEvent.prototype.toString=function(){return"[Event IFNode.BeforeFlagChangeEvent]"},e.AfterFlagChangeEvent=function(t,e,n){this.node=t,this.flag=e,this.set=n},IFObject.inherit(e.AfterFlagChangeEvent,GEvent),e.AfterFlagChangeEvent.prototype.node=null,e.AfterFlagChangeEvent.prototype.flag=null,e.AfterFlagChangeEvent.prototype.set=null,e.AfterFlagChangeEvent.prototype.toString=function(){return"[Event IFNode.AfterFlagChangeEvent]"},e.Properties=function(){},e.Properties.prototype.hasProperty=function(t,e){var n=(e?"@":"$")+t;return this.hasOwnProperty(n)},e.Properties.prototype.getProperty=function(t,e,n){var i=(e?"@":"$")+t;return this.hasOwnProperty(i)?this[i]:n},e.Properties.prototype.getProperties=function(t,e,n){for(var i=[],r=0;r<t.length;++r){var o=n&&n.length>r?n[r]:null;i.push(this.getProperty(t[r],e,o))}return i},e.Properties.prototype.setProperty=function(t,e,n){return this.setProperties([t],[e],n)},e.Properties.prototype.setProperties=function(t,n,i){if(t.length!==n.length)throw new Error("Properties length does not match values length");for(var r=[],o=[],s=0;s<t.length;++s){var a=n[s],h=this[u=(i?"@":"$")+t[s]];ifUtil.equals(a,h,!1)||(r.push(t[s]),o.push(n[s]))}if(0===r.length)return!1;var l={properties:r,values:o};this._notifyChange(e._Change.BeforePropertiesChange,l);var p=[];for(s=0;s<r.length;++s){var u=(i?"@":"$")+r[s];p.push(this[u]),this[u]=o[s]}return this._notifyChange(e._Change.AfterPropertiesChange,l),!0},e.Properties.prototype.storeProperties=function(t,e,n){for(var i in n=n||function(t,e){return e},e){var r=e[i],o=this["$"+i];if(!ifUtil.equals(o,r,!0)){var s=n(i,o);t[i]=s}}},e.Properties.prototype.restoreProperties=function(t,e,n){n=n||function(t,e){return e};var i=[],r=[];for(var o in e)i.push(o),t.hasOwnProperty(o)?r.push(n(o,t[o])):r.push(e[o]);this.setProperties(i,r,!1)},e.Properties.prototype.transferProperties=function(t,e){for(var n=[],i=[],r=0;r<e.length;++r)for(var o in e[r])n.push(o),t.hasProperty(o)?i.push(t.getProperty(o)):i.push(e[r][o]);this.setProperties(n,i,!1)},e.Properties.prototype._setDefaultProperties=function(){for(var t=0;t<arguments.length;++t){var e=arguments[t];for(var n in e)this["$"+n]=e[n]}},e.Identity=function(){},e.Identity.prototype.getId=function(){throw new Error("Not Supported.")},e.Tag=function(){},e.Tag.prototype.getTags=function(){throw new Error("Not Supported.")},e.Reference=function(){},e.Reference.prototype._referenceId=null,e.Reference.prototype.getReferenceId=function(){return this._referenceId||(this._referenceId=ifUtil.uuid()),this._referenceId},e.Container=function(){},e.Container.prototype._firstChild=null,e.Container.prototype._lastChild=null,e.Container.prototype.getChildren=function(t){for(var e=[],n=this.getFirstChild(t);null!==n;n=n.getNext(t))e.push(n);return e},e.Container.prototype.getFirstChild=function(t){if(t||!this._firstChild)return this._firstChild;for(var n=this._firstChild;null!=n;n=n._next)if(!n.hasFlag(e.Flag.Shadow))return n;return null},e.Container.prototype.getLastChild=function(t){if(t||!this._lastChild)return this._lastChild;for(var n=this._lastChild;null!=n;n=n._previous)if(!n.hasFlag(e.Flag.Shadow))return n;return null},e.Container.prototype.appendChild=function(t){this.insertChild(t,null)},e.Container.prototype.insertChild=function(t,n){if(null!=t._scene)throw new Error("Child is already appended somewhere else");if(null!=n&&n.getParent()!=this)throw new Error("Reference is not a child of this node");if(!t.validateInsertion(this,n))throw new Error("Child insertion validation failed.");if(this._notifyChange(e._Change.BeforeChildInsert,t),t._setParent(this),null!=n?(t._setNext(n),t._setPrevious(n._previous),n._setPrevious(t),null==t._previous?this._firstChild=t:t._previous._setNext(t)):(null!=this._lastChild&&(t._setPrevious(this._lastChild),this._lastChild._setNext(t),this._lastChild=t),t._setNext(null)),null==this._firstChild&&(this._firstChild=t,t._setPrevious(null),t._setNext(null)),null==t._next&&(this._lastChild=t),this.isAttached()){var i=this;t.accept&&t.accept(function(t){t._setScene(i._scene)},!0)}this._notifyChange(e._Change.AfterChildInsert,t)},e.Container.prototype.removeChild=function(t){if(t._parent!=this)throw new Error("Child is not a child of this node");if(!t.validateRemoval())throw new Error("Child removal validation failed.");this._notifyChange(e._Change.BeforeChildRemove,t),this._firstChild==t&&(this._firstChild=t._next),this._lastChild==t&&(this._lastChild=t._previous),null!=t._previous&&t._previous._setNext(t._next),null!=t._next&&t._next._setPrevious(t._previous),t._setParent(null),t._setPrevious(null),t._setNext(null),this.isAttached()&&t.accept&&t.accept(function(t){t._setScene(null)},!0),this._notifyChange(e._Change.AfterChildRemove,t)},e.Container.prototype.clearChildren=function(t){for(;this.getFirstChild(t);)this.removeChild(this.getFirstChild(t))},e.Container.prototype.getIndexOfChild=function(t,e){if(t._parent===this)for(var n=0,i=this.getFirstChild(e);null!==i;i=i.getNext(e)){if(i===t)return n;n++}return-1},e.Container.prototype.getChildByIndex=function(t,e){for(var n=0,i=this.getFirstChild(e);null!==i;i=i.getNext(e)){if(n===t)return i;n++}return null},e.Container.prototype.acceptChildren=function(t,e){for(var n=this.getFirstChild(e);null!=n;n=n.getNext(e))if(!1===n.accept(t,e))return!1;return!0},e.Container.prototype.toString=function(){return"[Mixin IFNode.Container]"},e.Store=function(){},e.Store.prototype.store=function(t){if(this.hasMixin(e.Container))for(var n=this.getFirstChild(!0);null!==n;n=n.getNext(!0)){var i=e.store(n);i&&(t.hasOwnProperty("$")?t.$.push(i):t.$=[i])}if(this.hasMixin(e.Properties))for(var r in this)this.hasOwnProperty(r)&&r.length>1&&"@"===r.charAt(0)&&(t[r]=this[r]);return this.hasMixin(e.Reference)&&this._referenceId&&(t["#"]=this._referenceId),!0},e.Store.prototype.restore=function(t){if(t.hasOwnProperty("$")&&this.hasMixin(e.Container)){var n=t.$;if(n.length>0)for(var i=0;i<n.length;++i){var r=e.restore(n[i]);r&&this.appendChild(r)}}if(this.hasMixin(e.Properties))for(var o in t)t.hasOwnProperty(o)&&o.length>1&&"@"===o.charAt(0)&&(this[o]=t[o]);return this.hasMixin(e.Reference)&&t.hasOwnProperty("#")&&(this._referenceId=t["#"]),!0},e.Store.prototype.clone=function(){var t=e.serialize(this);if(t){var n=e.deserialize(t);return n.hasMixin(e.Reference)&&(n._referenceId=null),n}return null},e.prototype._scene=null,e.prototype._parent=null,e.prototype._previous=null,e.prototype._next=null,e.prototype._flags=0,e.prototype.getNodeName=function(){return e.getName(this)},e.prototype.getNodeNameTranslated=function(){return ifLocale.getValue(this,"name",this.getNodeName())},e.prototype.isAttached=function(){return null!=this._scene},e.prototype.getScene=function(){return this._scene},e.prototype.getParent=function(){return this._parent},e.prototype.getPrevious=function(t){if(t||!this._previous)return this._previous;for(var n=this._previous;null!=n;n=n._previous)if(!n.hasFlag(e.Flag.Shadow))return n;return null},e.prototype.getNext=function(t){if(t||!this._next)return this._next;for(var n=this._next;null!=n;n=n._next)if(!n.hasFlag(e.Flag.Shadow))return n;return null},e.prototype.getNodesByName=function(t,e){var n=[];return this.accept(function(e){t&&"*"!=t&&t!==e.getNodeName()||e!==this&&n.push(e)}.bind(this)),n},e.prototype.queryCount=function(t){var e=IFSelector.queryAll(t,this);return e?e.length:0},e.prototype.queryAll=function(t){return IFSelector.queryAll(t,this)},e.prototype.querySingle=function(t){var e=IFSelector.querySingle(t,this);return e||null},e.prototype.matches=function(t){return IFSelector.match(t,this)},e.prototype.filtered=function(t){return 1===IFSelector.filter(t,[this]).length},e.prototype.accept=function(t,n){return!((n||!this.hasFlag(e.Flag.Shadow))&&!1===t.call(null,this))&&(!this.hasMixin(e.Container)||this.acceptChildren(t,n))},e.prototype.hasFlag=function(t){return 0!=(this._flags&t)},e.prototype.setFlag=function(t){this._canModifyFlag(t,!0)&&0==(this._flags&t)&&(this._notifyChange(e._Change.BeforeFlagChange,{flag:t,set:!0}),this._flags=this._flags|t,this._notifyChange(e._Change.AfterFlagChange,{flag:t,set:!0}))},e.prototype.removeFlag=function(t){this._canModifyFlag(t,!1)&&0!=(this._flags&t)&&(this._notifyChange(e._Change.BeforeFlagChange,{flag:t,set:!1}),this._flags=this._flags&~t,this._notifyChange(e._Change.AfterFlagChange,{flag:t,set:!1}))},e.prototype.validateInsertion=function(t,e){return!1},e.prototype.validateRemoval=function(){return!0},e.prototype._canModifyFlag=function(t,e){return!0},e.prototype._beginBlockChanges=function(t){this._blockedChanges||(this._blockedChanges={},this._blockedChanges._counter=0);for(var e=0;e<t.length;++e){var n=t[e];n in this._blockedChanges?this._blockedChanges[n]++:this._blockedChanges[n]=1,this._blockedChanges._counter++}},e.prototype._endBlockChanges=function(t){if(this._blockedChanges)for(var e=0;e<t.length;++e){var n=t[e];n in this._blockedChanges&&0==--this._blockedChanges[n]&&0==--this._blockedChanges._counter&&delete this._blockedChanges}},e.prototype._beginBlockEvents=function(t){this._blockedEvents||(this._blockedEvents={},this._blockedEvents._counter=0);for(var e=0;e<t.length;++e){var n=IFObject.getTypeId(t[e]);n in this._blockedEvents?this._blockedEvents[n]++:this._blockedEvents[n]=1,this._blockedEvents._counter++}},e.prototype._endBlockEvents=function(t){if(this._blockedEvents)for(var e=0;e<t.length;++e){var n=IFObject.getTypeId(t[e]);n in this._blockedEvents&&0==--this._blockedEvents[n]&&0==--this._blockedEvents._counter&&delete this._blockedEvents}},e.prototype._getCompositeEvents=function(t,n,i){var r=[];return t&&(r=r.concat([e.BeforeInsertEvent,e.AfterInsertEvent,e.BeforeRemoveEvent,e.AfterRemoveEvent])),n&&(r=r.concat([e.BeforePropertiesChangeEvent,e.AfterPropertiesChangeEvent])),i&&(r=r.concat([e.BeforeFlagChangeEvent,e.AfterFlagChangeEvent])),r},e.prototype._beginBlockCompositeEvents=function(t,e,n){this._beginBlockEvents(this._getCompositeEvents(t,e,n))},e.prototype._endBlockCompositeEvents=function(t,e,n){this._endBlockEvents(this._getCompositeEvents(t,e,n))},e.prototype._notifyChange=function(t,e){this._blockedChanges&&this._blockedChanges[t]||this._handleChange(t,e)},e.prototype._canEventBeSend=function(t){if(!this.isAttached())return!1;if(!this._scene.hasEventListeners(t))return!1;var e=IFObject.getTypeId(t);return!this._blockedEvents||!this._blockedEvents[e]},e.prototype._setScene=function(t){t!==this._scene&&(this.hasMixin(e.Reference)&&(t?t.addReference(this):this._scene.removeReference(this)),this._scene=t)},e.prototype._setParent=function(t){this._parent=t},e.prototype._setPrevious=function(t){this._previous=t},e.prototype._setNext=function(t){this._next=t},e.prototype._handleChange=function(t,n){if(t==e._Change.BeforeChildInsert){var i=n;this._canEventBeSend(e.BeforeInsertEvent)&&this._scene.trigger(new e.BeforeInsertEvent(i))}else if(t==e._Change.AfterChildInsert){i=n;this._canEventBeSend(e.AfterInsertEvent)&&this._scene.trigger(new e.AfterInsertEvent(i))}else if(t==e._Change.BeforeChildRemove){i=n;this._canEventBeSend(e.BeforeRemoveEvent)&&this._scene.trigger(new e.BeforeRemoveEvent(i))}else if(t==e._Change.AfterChildRemove){i=n;this._canEventBeSend(e.AfterRemoveEvent)&&this._scene.trigger(new e.AfterRemoveEvent(i))}else if(t==e._Change.BeforePropertiesChange){var r=n;this._canEventBeSend(e.BeforePropertiesChangeEvent)&&this._scene.trigger(new e.BeforePropertiesChangeEvent(this,r.properties,r.values))}else if(t==e._Change.AfterPropertiesChange){r=n;this._canEventBeSend(e.AfterPropertiesChangeEvent)&&this._scene.trigger(new e.AfterPropertiesChangeEvent(this,r.properties,r.values))}else if(t==e._Change.BeforeFlagChange){var o=n;this._canEventBeSend(e.BeforeFlagChangeEvent)&&this._scene.trigger(new e.BeforeFlagChangeEvent(this,o.flag,o.set))}else if(t==e._Change.AfterFlagChange){o=n;this._canEventBeSend(e.AfterFlagChangeEvent)&&this._scene.trigger(new e.AfterFlagChangeEvent(this,o.flag,o.set))}},t.IFNode=e}(this),function(t){function e(){}IFObject.inherit(e,IFNode),e.Flag={Hidden:1<<21,Locked:1<<22,NoPaint:1<<23},e.CollisionFlag={Partial:1,GeometryBBox:1024,PaintBBox:2048},e._Change={ChildGeometryUpdate:200,PrepareGeometryUpdate:220,FinishGeometryUpdate:221,InvalidationRequest:230,InvalidationRequested:231},e.GeometryChangeEvent=function(t,e){this.element=t,this.type=e},IFObject.inherit(e.GeometryChangeEvent,GEvent),e.GeometryChangeEvent.Type={Before:0,After:1,Child:2},e.GeometryChangeEvent.prototype.element=null,e.GeometryChangeEvent.prototype.type=null,e.GeometryChangeEvent.prototype.toString=function(){return"[Event IFElement.GeometryChangeEvent]"},e.HitResult=function(t,e){this.element=t,this.data=e},e.HitResult.prototype.element=null,e.HitResult.prototype.data=null,e.Transform=function(){},e.Transform.prototype.getTransform=function(){return null},e.Transform.prototype.setTransform=function(t){throw new Error("Not Supported.")},e.Transform.prototype.transform=function(t){this._transformChildren(t)},e.Transform.prototype._transformChildren=function(t){if(this.hasMixin(IFNode.Container))for(var n=this.getFirstChild(!0);null!=n;n=n.getNext(!0))n instanceof e&&n.hasMixin(e.Transform)&&n.transform(t)},e.Transform.prototype.toString=function(){return"[Mixin IFElement.Transform]"},e.Style=function(){},e.Style._styleSet=null,e.Style.prototype.getStyleSet=function(){if(this._styleSet&&this._styleSet.getParent()!==this&&(this._styleSet=null),!this._styleSet)for(var t=this.getFirstChild(!0);null!==t;t=t.getNext(!0))if(t instanceof IFStyleSet){this._styleSet=t;break}return this._styleSet},e.Style.prototype.renderStyle=function(t,e,n){if(t.configuration.isOutline(t))this._paint(t,e,n);else{var i=!1,r=!1,o=!1,s=1,a=IFPaintCanvas.BlendMode.Normal;if(e instanceof IFAppliedStyle){switch(e.getProperty("tp")){case IFAppliedStyle.Type.Content:break;case IFAppliedStyle.Type.Mask:i=!0;break;case IFAppliedStyle.Type.Knockout:o=!0;break;case IFAppliedStyle.Type.Background:r=!0}s=e.getProperty("opc"),a=e.getProperty("blm")}for(var h=1!==s||a!==IFPaintCanvas.BlendMode.Normal||!0===i||!0===r,l=[],p=[],u=e.getActualStyle().getFirstChild();null!==u;u=u.getNext())if(u instanceof IFStyleEntry&&!0===u.getProperty("vs"))if(u instanceof IFEffectEntry)l.push(u),h=!0;else if(u instanceof IFFilterEntry)p.push(u),h=!0;else if(u instanceof IFPaintEntry&&this.hasMixin(IFVertexSource)){var c=u.getPaintCmpOrBlend();null!==c&&c!==IFPaintCanvas.CompositeOperator.SourceOver&&c!==IFPaintCanvas.BlendMode.Normal&&(h=!0)}if(h){var g=t.canvas,f=e.getBBox(this.getGeometryBBox()),y=null;if(t.configuration.paintMode===IFScenePaintConfiguration.PaintMode.Fast){(y=new IFPaintCanvas).resize(f.getWidth(),f.getHeight()),y.prepare();var d=f.getSide(IFRect.Side.TOP_LEFT);y.setOrigin(d),y.setOffset(d)}else y=g.createCanvas(f,!1);var _=y.createCanvas(f);t.canvas=_;try{this._paint(t,e,n)}finally{t.canvas=g,_.finish()}var v=o;if(l.length>0){l.sort(function(t,e){return t.isPost()===e.isPost()?0:e.isPost()?-1:1});for(var m=y.createCanvas(f),I=0;I<l.length;++I){var P=l[I];I>0&&m.clear(),P.isPost()&&(v||(y.drawCanvas(_),v=!0)),P.render(m,_,m.getScale()),y.drawCanvas(m)}m.finish()}v||y.drawCanvas(_);for(I=0;I<p.length;++I)p[I].apply(y,y.getScale());g.drawCanvas(y,0,0,s,a),y.finish()}else this._paint(t,e,n)}},e.Style.prototype.toString=function(){return"[Mixin IFElement.Style]"},e.prototype._geometryBBbox=null,e.prototype._paintBBox=null,e.prototype.getGeometryBBox=function(){return this.isVisible()?(null==this._geometryBBbox&&(this._geometryBBbox=this._calculateGeometryBBox()),this._geometryBBbox):null},e.prototype.getGroupGeometryBBox=function(t){var n=null;if(t&&t.length)for(var i=0;i<t.length;++i)if(t[i]instanceof e){var r=t[i].getGeometryBBox();r&&!r.isEmpty()&&(n=n?n.united(r):r)}return n},e.prototype.getChildrenGeometryBBox=function(){if(!this.isVisible())return null;if(this.hasMixin(IFNode.Container)){for(var t=null,n=this.getFirstChild();null!=n;n=n.getNext())if(n instanceof e){var i=n.getGeometryBBox();i&&!i.isEmpty()&&(t=t?t.united(i):i)}return t||null}return null},e.prototype.getPaintBBox=function(){return this.isVisible()?(null==this._paintBBox&&(this._paintBBox=this._calculatePaintBBox()),this._paintBBox):null},e.prototype.getChildrenPaintBBox=function(){if(!this.isVisible())return null;if(this.hasMixin(IFNode.Container)){for(var t=null,n=this.getFirstChild();null!=n;n=n.getNext())if(n instanceof e){var i=n.getPaintBBox();i&&!i.isEmpty()&&(t=t?t.united(i):i)}return t||new IFRect(0,0,0,0)}return null},e.prototype.isVisible=function(){return 0==(this._flags&e.Flag.Hidden)},e.prototype.hitTest=function(t,n,i,r,o,s,a){"number"!=typeof o&&(o=-1),s=s||0;var h=this.getPaintBBox();if(!h||h.isEmpty())return null;if(n&&(h=n.mapRect(h)),!h.expanded(s,s,s,s).containsPoint(t))return null;var l=null;if(0!==o&&this.hasMixin(IFNode.Container))for(var p=this.getLastChild();null!=p;p=p.getPrevious())if(p instanceof e){var u=p.hitTest(t,n,i,r,o-1,s,a);if(u){if(!r)return u;l?Array.prototype.push.apply(l,u):l=u}}if(i&&1==i.call(null,this)||!i){var c=this._detailHitTest(t,n,s,a);c&&(r&&l?l.push(c):l=[c])}return l},e.prototype.getCollisions=function(t,n,i){var r=[],o=function(t){(i&&1==i.call(null,t)||!i)&&r.push(t)};if(0!=(n&e.CollisionFlag.GeometryBBox)||0!=(n&e.CollisionFlag.PaintBBox)){var s=this.getPaintBBox();if(s&&!s.isEmpty()){var a=ifVertexInfo.calculateBounds(t,!0);0!=(n&e.CollisionFlag.Partial)?a.intersectsRect(s)&&o(this):a.containsRect(s)&&o(this)}}if(this.hasMixin(IFNode.Container))for(var h=this.getFirstChild();null!=h;h=h.getNext())if(h instanceof e){var l=h.getCollisions(t,n);if(l&&l.length)for(var p=0;p<l.length;++p)o(l[p])}return r},e.prototype.beginUpdate=function(){this._updateCounter?this._updateCounter++:(this._updateCounter=1,this._notifyChange(e._Change.PrepareGeometryUpdate),this._blockUpdateChanges())},e.prototype.endUpdate=function(t){null!=this._updateCounter&&0==--this._updateCounter&&(this._releaseUpdateChanges(),this._notifyChange(e._Change.FinishGeometryUpdate,!t),delete this._updateCounter)},e.prototype.isRenderable=function(t){if(!this.isVisible())return!1;if(!t)return this.isAttached()&&this.getParent()||this instanceof IFScene;var e=this.getPaintBBox();if(null==e||e.isEmpty())return!1;if(t){if(t.dirtyMatcher&&!t.dirtyMatcher.isDirty(e))return!1;if(t.configuration&&t.configuration.clipArea&&!t.configuration.clipArea.intersectsRect(e))return!1}return!0},e.prototype.render=function(t){if(this._preparePaint(t)){var n=!0;if(this.hasMixin(e.Style))for(var i=0,r=this.getStyleSet().getFirstChild();null!==r;r=r.getNext())r instanceof IFStyle&&!0===r.getProperty("vs")&&(n=!1,this.renderStyle(t,r,i),i++);n&&this._paint(t,null,null),this._finishPaint(t)}},e.prototype.toBitmap=function(t,e,n){var i=this._getBitmapPaintArea();n=n||0;var r=1,o=1,s=1,a=0,h=0;t&&("number"==typeof t?r=t:t instanceof IFLength&&(r=t.toPoint()/i.getWidth())),e&&("number"==typeof e?o=e:e instanceof IFLength&&(o=e.toPoint()/i.getHeight()));var l=i.getWidth()*r,p=i.getHeight()*o;if(r!==o)switch(n){case 0:r<o?(s=r,p=l):(s=o,l=p);break;case 1:r>o?(p=r,o=l):(s=o,l=p);break;case 2:r<o?(s=r,h=(p-i.getHeight()*s)/2):(s=o,a=(l-i.getWidth()*s)/2)}else s=r;var u=new IFPaintCanvas;u.resize(l,p);var c=new IFPaintContext;c.canvas=u;var g=new IFScenePaintConfiguration;g.paintMode=IFScenePaintConfiguration.PaintMode.Full,g.annotations=!1,c.configuration=g,g.clipArea=i,u.prepare(),u.setOrigin(new IFPoint(i.getX()*s-a,i.getY()*s-h)),u.setScale(s);try{return this._renderToBitmap(c)}finally{u.finish()}},e.prototype._getBitmapPaintArea=function(){return this.getPaintBBox()},e.prototype._renderToBitmap=function(t){return this.render(t),t.canvas.getBitmap()},e.prototype._paint=function(t,e,n){this._renderChildren(t)},e.prototype._preparePaint=function(t){return!this.hasFlag(e.Flag.NoPaint)&&this.isRenderable(t)},e.prototype._finishPaint=function(t){},e.prototype._renderChildren=function(t){if(this.hasMixin(IFNode.Container))for(var n=this.getFirstChild();null!=n;n=n.getNext())n instanceof e&&n.render(t)},e.prototype._calculateGeometryBBox=function(){return this.getChildrenGeometryBBox()},e.prototype._calculatePaintBBox=function(){var t=this.getChildrenPaintBBox();return t&&this.hasMixin(e.Style)&&(t=this.getStyleSet().getBBox(t)),t},e.prototype._detailHitTest=function(t,e,n,i){return null},e.prototype._blockUpdateChanges=function(){this._beginBlockChanges([e._Change.InvalidationRequest,e._Change.PrepareGeometryUpdate,e._Change.FinishGeometryUpdate,e._Change.ChildGeometryUpdate])},e.prototype._releaseUpdateChanges=function(){this._endBlockChanges([e._Change.InvalidationRequest,e._Change.PrepareGeometryUpdate,e._Change.FinishGeometryUpdate,e._Change.ChildGeometryUpdate])},e.prototype._requestInvalidateNode=function(t){if(t.isRenderable()){var e=t.getPaintBBox();e&&this._requestInvalidationArea(e.expanded(2,2,2,2))}},e.prototype._requestInvalidationArea=function(t){this.isAttached()&&(this._scene._invalidateArea(t),this._handleChange(e._Change.InvalidationRequested,t))},e.prototype._requestInvalidation=function(){this._requestInvalidateNode(this)},e.prototype._invalidateGeometry=function(){this._geometryBBbox=null,this._paintBBox=null},e.prototype._handleChange=function(t,n){if(t==e._Change.InvalidationRequest)this.isRenderable()&&this._requestInvalidation();else if(t===e._Change.InvalidationRequested)this.getParent()&&this.getParent()._notifyChange(e._Change.InvalidationRequested,n);else if(t==e._Change.PrepareGeometryUpdate){if(this.isRenderable()){var i=this.getPaintBBox();i&&!i.isEmpty()&&(this._savedPaintBBox=i)}this.isVisible()&&this._canEventBeSend(e.GeometryChangeEvent)&&this._scene.trigger(new e.GeometryChangeEvent(this,e.GeometryChangeEvent.Type.Before))}else if(t==e._Change.FinishGeometryUpdate){if(this.isVisible()){if(!1!==n&&this._invalidateGeometry(),this.isRenderable()){var r=this.getPaintBBox();IFRect.equals(r,this._savedPaintBBox)?this._requestInvalidation():(this.getParent()&&this.getParent()._notifyChange(e._Change.ChildGeometryUpdate,this),this._savedPaintBBox&&this._requestInvalidationArea(this._savedPaintBBox),this._handleChange(e._Change.InvalidationRequest))}this._canEventBeSend(e.GeometryChangeEvent)&&this._scene.trigger(new e.GeometryChangeEvent(this,e.GeometryChangeEvent.Type.After)),this._savedPaintBBox&&delete this._savedPaintBBox}}else if(t==e._Change.ChildGeometryUpdate)this.isVisible()&&(this._invalidateGeometry(),this._canEventBeSend(e.GeometryChangeEvent)&&this._scene.trigger(new e.GeometryChangeEvent(this,e.GeometryChangeEvent.Type.Child)),this.getParent()&&this.getParent()._notifyChange(t,n));else if(t==IFNode._Change.AfterChildInsert)n instanceof e&&(this._notifyChange(e._Change.ChildGeometryUpdate,n),n._handleChange(e._Change.InvalidationRequest)),IFNode.prototype._handleChange.call(this,t,n);else if(t==IFNode._Change.BeforeChildRemove)n instanceof e&&this._requestInvalidateNode(n),IFNode.prototype._handleChange.call(this,t,n);else if(t==IFNode._Change.AfterChildRemove)n instanceof e&&this._notifyChange(e._Change.ChildGeometryUpdate,n),IFNode.prototype._handleChange.call(this,t,n);else if(t==IFNode._Change.AfterFlagChange){if(n.flag===e.Flag.NoPaint)this._requestInvalidation();IFNode.prototype._handleChange.call(this,t,n)}else IFNode.prototype._handleChange.call(this,t,n)},e.prototype._handleGeometryChangeForProperties=function(t,n,i){if((t==IFNode._Change.BeforePropertiesChange||t==IFNode._Change.AfterPropertiesChange)&&ifUtil.containsObjectKey(n.properties,i)){switch(t){case IFNode._Change.BeforePropertiesChange:this._notifyChange(e._Change.PrepareGeometryUpdate);break;case IFNode._Change.AfterPropertiesChange:this._notifyChange(e._Change.FinishGeometryUpdate)}return!0}return!1},e.prototype._handleVisualChangeForProperties=function(t,n,i){return!(t!=IFNode._Change.AfterPropertiesChange||!ifUtil.containsObjectKey(n.properties,i))&&(this._notifyChange(e._Change.InvalidationRequest),!0)},t.IFElement=e}(this),function(t){function e(){IFElement.call(this),this._setDefaultProperties(e.VisualProperties,e.MetaProperties)}IFObject.inheritAndMix(e,IFElement,[IFNode.Properties,IFNode.Store]),e.VisualProperties={visible:!0},e.MetaProperties={name:null,locked:!1},e.prototype._ownerLayer=null,e.prototype._rootLayer=null,e.prototype._page=null,e.prototype.getLabel=function(){return this.$name&&""!==this.$name?this.$name:this.getNodeNameTranslated()},e.prototype.getOwnerLayer=function(){return this._ownerLayer},e.prototype.getRootLayer=function(){return this._rootLayer},e.prototype.getPage=function(){return this._page},e.prototype.store=function(t){return!!IFNode.Store.prototype.store.call(this,t)&&(this.storeProperties(t,e.VisualProperties),this.storeProperties(t,e.MetaProperties),!0)},e.prototype.restore=function(t){return!!IFNode.Store.prototype.restore.call(this,t)&&(this.restoreProperties(t,e.VisualProperties),this.restoreProperties(t,e.MetaProperties),!0)},e.prototype._setParent=function(t){IFElement.prototype._setParent.call(this,t),t?(this._ownerLayer=t instanceof IFLayer?t:t instanceof e?t.getOwnerLayer():null,this._rootLayer=t instanceof IFLayer&&!t.getOwnerLayer()?t:t instanceof e?t.getRootLayer():null,this._page=t instanceof IFPage?t:t instanceof e?t.getPage():null):(this._ownerLayer=null,this._rootLayer=null,this._page=null)},e.prototype._handleChange=function(t,e){if(t==IFNode._Change.AfterPropertiesChange){var n=e;if(n.properties.indexOf("visible")>=0){var i=this.getProperty("visible"),r=i?null:this.getPaintBBox();this.accept(function(t){t instanceof IFElement&&(i?t.removeFlag(IFElement.Flag.Hidden):t.setFlag(IFElement.Flag.Hidden),t._invalidateGeometry())}),this.getParent()&&this.getParent()._notifyChange(IFElement._Change.ChildGeometryUpdate,this),i?this._handleChange(IFElement._Change.InvalidationRequest):this._requestInvalidationArea(r)}else if(n.properties.indexOf("locked")>=0){var o=this.getProperty("locked");this.accept(function(t){t instanceof IFElement&&(o?t.setFlag(IFElement.Flag.Locked):t.removeFlag(IFElement.Flag.Locked))})}IFElement.prototype._handleChange.call(this,t,e)}else IFElement.prototype._handleChange.call(this,t,e)},t.IFBlock=e}(this),function(t){function e(){IFBlock.call(this)}IFObject.inherit(e,IFBlock),t.IFItem=e}(this),function(t){function e(){IFElement.call(this),this._scene=this,this._references={},this._links={},this._setDefaultProperties(e.MetaProperties)}IFNode.inheritAndMix("scene",e,IFElement,[IFNode.Container,IFNode.Properties,IFNode.Store,GEventTarget]),e.UnitSnap={None:"N",Full:"F",Half:"H"},e.PAGE_SPACING=10,e.VERSION=1,e.MetaProperties={version:e.VERSION,clspace:IFColorSpace.RGB,unit:IFLength.Unit.PT,unitSnap:e.UnitSnap.Full,snapDist:5,pickDist:3,crDistSmall:1,crDistBig:10,crConstraint:0,gridSizeX:10,gridSizeY:10,gridActive:!1,singlePage:!0,pathImage:"images",pathFont:"fonts",pathExport:"export"},e.InvalidationRequestEvent=function(t){this.area=t||null},IFObject.inherit(e.InvalidationRequestEvent,GEvent),e.InvalidationRequestEvent.prototype.area=null,e.InvalidationRequestEvent.prototype.toString=function(){return"[Event IFScene.InvalidationRequestEvent]"},e.ReferenceEvent=function(t,e,n){this.reference=t,this.target=e,this.linked=n},IFObject.inherit(e.ReferenceEvent,GEvent),e.ReferenceEvent.prototype.reference=null,e.ReferenceEvent.prototype.target=null,e.ReferenceEvent.prototype.linked=null,e.ReferenceEvent.prototype.toString=function(){return"[Event IFScene.ReferenceEvent]"},e.ResolveUrlEvent=function(t,e){this.url=t,this.resolved=e},IFObject.inherit(e.ResolveUrlEvent,GEvent),e.ResolveUrlEvent.prototype.url=null,e.ResolveUrlEvent.prototype.resolved=null,e.ResolveUrlEvent.prototype.toString=function(){return"[Event IFScene.ResolveUrlEvent]"},e.StyleCollection=function(){IFNode.call(this)},IFNode.inheritAndMix("styleCollection",e.StyleCollection,IFNode,[IFNode.Container,IFNode.Store]),e.StyleCollection.prototype.validateInsertion=function(t,n){return t instanceof e},e.SwatchCollection=function(){IFNode.call(this)},IFNode.inheritAndMix("swatchCollection",e.SwatchCollection,IFNode,[IFNode.Container,IFNode.Store]),e.SwatchCollection.prototype.validateInsertion=function(t,n){return t instanceof e},e.prototype._references=null,e.prototype._links=null,e.prototype._styleCollection=null,e.prototype._swatchCollection=null,e.prototype.getStyleCollection=function(){if(this._styleCollection&&this._styleCollection.getParent()!==this&&(this._styleCollection=null),!this._styleCollection)for(var t=this.getFirstChild(!0);null!==t;t=t.getNext(!0))if(t instanceof e.StyleCollection){this._styleCollection=t;break}return this._styleCollection||(this._styleCollection=new e.StyleCollection,this.appendChild(this._styleCollection)),this._styleCollection},e.prototype.getSwatchCollection=function(){if(this._swatchCollection&&this._swatchCollection.getParent()!==this&&(this._swatchCollection=null),!this._swatchCollection)for(var t=this.getFirstChild(!0);null!==t;t=t.getNext(!0))if(t instanceof e.SwatchCollection){this._swatchCollection=t;break}return this._swatchCollection||(this._swatchCollection=new e.SwatchCollection,this.appendChild(this._swatchCollection)),this._swatchCollection},e.prototype.store=function(t){return!!IFNode.Store.prototype.store.call(this,t)&&(this.storeProperties(t,e.MetaProperties),!0)},e.prototype.restore=function(t){return!!IFNode.Store.prototype.restore.call(this,t)&&(this.restoreProperties(t,e.MetaProperties),!0)},e.prototype.stringToLength=function(t){return IFLength.parseEquation(t,this.$unit)},e.prototype.stringToPoint=function(t){var e=this.stringToLength(t);return e?e.toPoint():null},e.prototype.lengthToString=function(t){return ifUtil.formatNumber(t.toUnit(this.$unit))},e.prototype.pointToString=function(t){return this.lengthToString(new IFLength(t))},e.prototype.getElementsByBBox=function(t,e){var n=[];return this.acceptChildren(function(i){if(i instanceof IFElement){var r=i.getPaintBBox();r&&!r.isEmpty()&&(e&&t.intersectsRect(r)||!e&&t.containsRect(r))&&n.push(i)}}),n},e.prototype.getActivePage=function(){return this.querySingle("page:active")},e.prototype.setActivePage=function(t){if(!t.isAttached())throw new Error("Page needs to be attached to be made active.");for(var e=this.getFirstChild();null!==e;e=e.getNext())e instanceof IFPage&&e!==t&&e.removeFlag(IFNode.Flag.Active);t.setFlag(IFNode.Flag.Active)},e.prototype.getActiveLayer=function(){return this.querySingle("page:active layer:active")},e.prototype.setActiveLayer=function(t){if(!t.isAttached())throw new Error("Layer needs to be attached to be made active.");var e=t.getPage();this.setActivePage(e),e.acceptChildren(function(e){e instanceof IFLayer&&e!==t&&e.removeFlag(IFNode.Flag.Active)}),t.setFlag(IFNode.Flag.Active)},e.prototype.getPageInsertPosition=function(){for(var t=this.getLastChild();null!==t;t=t.getPrevious())if(t instanceof IFPage)return new IFPoint(t.getProperty("x")+t.getProperty("w")+e.PAGE_SPACING,t.getProperty("y"));return new IFPoint(0,0)},e.prototype.willPageIntersectWithOthers=function(t,n){n=n.expanded(e.PAGE_SPACING,e.PAGE_SPACING,e.PAGE_SPACING,e.PAGE_SPACING);for(var i=this.getLastChild();null!==i;i=i.getPrevious())if(i instanceof IFPage&&i!==t){var r=i.getGeometryBBox();if(r&&r.intersectsRect(n))return!0}return!1},e.prototype.link=function(t,n){var i=t.getReferenceId();this._links.hasOwnProperty(i)||(this._links[i]=[]),this._links[i].push(n),this.hasEventListeners(e.ReferenceEvent)&&this.trigger(new e.ReferenceEvent(t,n,!0))},e.prototype.unlink=function(t,n){var i=t.getReferenceId();if(this._links.hasOwnProperty(i)){var r=this._links[i],o=r.indexOf(n);o>=0&&(r.splice(o,1),0===r.length&&delete this._links[i],this.hasEventListeners(e.ReferenceEvent)&&this.trigger(new e.ReferenceEvent(t,n,!1)))}},e.prototype.visitLinks=function(t,e){var n=this._links[t.getReferenceId()];if(n)for(var i=0;i<n.length;++i)e(n[i])},e.prototype.hasLinks=function(t){return this._links.hasOwnProperty(t.getReferenceId())},e.prototype.linkCount=function(t){var e=this._links[t.getReferenceId()];return e?e.length:0},e.prototype.addReference=function(t){var e=t.getReferenceId();if(this._references.hasOwnProperty(e))throw new Error("Reference already added.");this._references[e]=t},e.prototype.removeReference=function(t){var e=t.getReferenceId();if(!this._references.hasOwnProperty(e))throw new Error("Reference not yet added.");delete this._references[e]},e.prototype.getReference=function(t){return this._references.hasOwnProperty(t)?this._references[t]:null},e.prototype.resolveUrl=function(t,n){t&&0!==t.indexOf("data:")?this.hasEventListeners(e.ResolveUrlEvent)&&this.trigger(new e.ResolveUrlEvent(t,n)):n(t)},e.prototype.hitTest=function(t,e,n,i,r,o,s){if(this.$singlePage){var a=this.getActivePage();if(a)return a.hitTest(t,e,n,i,r,o,s)}return IFElement.prototype.hitTest.call(this,t,e,n,i,r,o,s)},e.prototype._invalidateArea=function(t){this.hasEventListeners(e.InvalidationRequestEvent)&&this.trigger(new e.InvalidationRequestEvent(t))},e.prototype._renderChildren=function(t){if(t.configuration.clipArea){var e=t.configuration.clipArea;t.canvas.clipRect(e.getX(),e.getY(),e.getWidth(),e.getHeight())}for(var n=this.getFirstChild();null!=n;n=n.getNext())n instanceof IFPage?this.$singlePage&&!n.hasFlag(IFNode.Flag.Active)||n.render(t):n instanceof IFElement&&n.render(t);t.configuration.clipArea&&t.canvas.resetClip()},e.prototype._calculatePaintBBox=function(){var t=IFElement.prototype._calculatePaintBBox.call(this);if(this.__editor__&&this.__editor__.isTransformBoxActive()){var e=this.__editor__.getTransformBox()._calculatePaintBBox();e&&!e.isEmpty()&&(t=t?t.united(e):e)}return t},e.prototype._calculateGeometryBBox=function(){var t=IFElement.prototype._calculateGeometryBBox.call(this);if(this.__editor__&&this.__editor__.isTransformBoxActive()){var e=this.__editor__.getTransformBox()._calculatePaintBBox();e&&!e.isEmpty()&&(t=t?t.united(e):e)}return t},e.prototype._handleChange=function(t,e){IFElement.prototype._handleChange.call(this,t,e)},t.IFScene=e}(this),function(t){function e(){}IFObject.inherit(e,IFPaintConfiguration),e.PaintMode={Full:"F",Fast:"S",Outline:"L",Output:"O"},e.PaintModeName={F:new IFLocale.Key(e,"paint.full"),S:new IFLocale.Key(e,"paint.fast"),L:new IFLocale.Key(e,"paint.outline"),O:new IFLocale.Key(e,"paint.output")},e.prototype.paintMode=e.PaintMode.Fast,e.prototype.pixelMode=!1,e.prototype.pagesClip=!1,e.prototype.guides=!0,e.prototype.slices=!0,e.prototype.annotations=!0,e.prototype.clipArea=null,e.prototype.isOutline=function(t){return this.paintMode===e.PaintMode.Outline||!(!t||!t.isOutline())&&t.isOutline()},e.prototype.isRasterEffects=function(t){return!this.isOutline(t)&&this.paintMode!==e.PaintMode.Fast},e.prototype.isAnnotationsVisible=function(t){return!(!this.annotations||this.paintMode===e.PaintMode.Output)},e.prototype.isGuidesVisible=function(t){return!(!this.guides||!this.isAnnotationsVisible())},e.prototype.isSlicesVisible=function(t){return!(!this.slices||!this.isAnnotationsVisible())},e.prototype.isPagesClip=function(t){return this.pagesClip||this.paintMode===e.PaintMode.Output},e.prototype.toString=function(){return"[Object IFScenePaintConfiguration]"},t.IFScenePaintConfiguration=e}(this);var IFSelector=function(){var t={},e=function(n,i,r,o){n="string"==typeof n?n.replace(/^\s+|\s+$/g,""):"";var s=t[n]||(t[n]=new e.initialize(n));return null==i?s:s.search(i,r,o)};e.initialize=function(t){this.text=t};var n,i=e.initialize.prototype=e.prototype,r=function(){return!0};i.queryAll=function(t,n,i){var o,s;if(i=i||{},!(t&&t instanceof IFNode))throw new Error("Missing context or invalid context");if(!(t instanceof IFNode))if("string"==typeof t)t=e.queryAll(t),o=!0;else if("[object Array]"==Object.prototype.toString.call(t)||"number"==typeof t.length&&t.item){var a=[];for(_=0;s=t[_];_++)s instanceof IFNode&&a.push(s);t=(o=a.length>1)?a:a[0]}var h,l,p={},u={},c=p,g=e.getUid,f=function(t){var e=g(t);return c[e]?null:c[e]=!0};if(n&&n.length)for(_=0;s=n[_];_++)f(s);var y=this.parse();if(!y.length)return[];for(var d,_=0;d=y[_];_++){var v=f;if(d.first&&(n?!0:v=r,o?l=t:d.combinator&&(l=[t])),d.last&&n?(c=p,h=n):(c={},h=[]),d.combinator||o)for(var m=0,I=l.length;m<I;m++)h=d.combine(h,l[m],d,u,v);else h=d.combine(h,t,d,u,v,!h.length);d.last?h.length&&(n=h):l=h}return n||[]},i.querySingle=function(t,e,n){return this.queryAll(t,e,n)[0]},i.match=function(t,e){if(1==this.parse().length)return!!this.parse()[0].match(t,{});if(!e)for(e=t;e.getParent();)e=e.getParent();for(var n=this.queryAll(e),i=n.length;i--;)if(n[i]==t)return!0;return!1},i.filter=function(t){for(var e,n=[],i=this.parse(),r=0;e=t[r];r++)for(var o=0;o<i.length;++o){(0,i[o].match)(e)&&n.push(e)}return n},e.recompile=function(){var t,i=[","],r=["!"];for(t in y)" "!=t&&i[t.length>1?"unshift":"push"](e.escapeRegExp(t));for(t in _)r.push(t);n=new RegExp("[\\w\\u00a1-\\uFFFF][\\w\\u00a1-\\uFFFF-]*|[#.](?:[\\w\\u00a1-\\uFFFF-]|\\\\:|\\\\.)+|[ \\t\\r\\n\\f](?=[\\w\\u00a1-\\uFFFF*#.[:])|[ \\t\\r\\n\\f]*("+i.join("|")+")[ \\t\\r\\n\\f]*|\\[([\\w\\u00a1-\\uFFFF-]+)[ \\t\\r\\n\\f]*(?:(["+r.join("")+"]?=)[ \\t\\r\\n\\f]*(?:\"([^\"]*)\"|'([^']*)'|([^\\]]*)))?]|:([-\\w\\u00a1-\\uFFFF]+)(?:\\((?:\"([^\"]*)\"|'([^']*)'|([^)]*))\\))?|\\*|(.+)","g")};var o=function(t){return{ident:[],tags:[],properties:[],pseudos:[],combinator:t}},s=function(t){return t};function a(t,e,n,i){return t?i?function(i,r){return e(i,n,r)&&t(i,r)}:function(i,r){return t(i,r)&&e(i,n,r)}:function(t,i){return e(t,n,i)}}i.parse=function(t){var i=t?"plain":"parsed";if(this[i])return this[i];var r=this.text,a=t?s:this.compute,h=[],l=o(null);l.first=!0;var p,u,c=function(t){h.push(a(l)),l=o(t)};for(n.lastIndex=0;p=n.exec(r);){if(p[11]){if(e.verbose)throw SyntaxError('Syntax error, "'+u+'" unexpected at #'+n.lastIndex+' in "'+r+'"');return this[i]=[]}switch((u=p[0]).charAt(0)){case".":l.tags.push(u.slice(1).replace(/\\/g,""));break;case"#":l.id=u.slice(1).replace(/\\/g,"");break;case"[":l.properties.push({name:p[2],operator:p[3]||null,value:p[4]||p[5]||p[6]||null});break;case":":l.pseudos.push({name:p[7],value:p[8]||p[9]||p[10]||null});break;case" ":case"\t":case"\r":case"\n":case"\f":p[1]=p[1]||" ";default:var g=p[1];if(g){if(","==g){l.last=!0,c(null),l.first=!0;continue}l.first&&!l.ident.length?l.combinator=g:c(g)}else"*"!=u&&(l.nodeName=u)}l.ident.push(u)}return l.last=!0,h.push(a(l)),this[i]=h};var h=function(){return!0},l=function(t,e){return!!t.hasMixin(IFNode.Identity)&&e===t.getId()},p=function(t,e){return t.getNodeName().toUpperCase()==e.toUpperCase()},u=function(t){return new RegExp("(?:^|[ \\t\\r\\n\\f])"+t+"(?:$|[ \\t\\r\\n\\f])")},c=function(t,e){if(t.hasMixin(IFNode.Tag)){var n=t.getTags();return n&&e.test(n)}return!1},g=function(t){if(!t.operator||!t.value)return t;var n=_[t.operator];return n&&(t.escaped=e.escapeRegExp(t.value),t.pattern=new RegExp(n(t.value,t.escaped,t))),t},f=function(t,e){var n=t.hasMixin(IFNode.Properties)?t.getProperty(e.name):null;switch(e.operator){case null:return n;case"=":return n==e.value;case"!=":return n!=e.value}return!(!n&&e.value)&&e.pattern.test(n)};i.compute=function(t){var n,i,r,o,s,y,_=t.nodeName,v=t.id,m=t.tags;if(v&&(y=!0,s=a(null,l,v),o=function(t){var e=t._scene.getById(v);return!e||_&&!p(e,_)?[]:[e]}),m.length>0)if(o||1!=m.length)for(n=0;i=m[n];n++)r=a(r,c,u(i));else{y=!0;var I=u(m[0]);s=a(s,c,I),o=function(t){for(var e,n=t.getNodesByName(_||"*"),i=[],r=0;e=n[r];r++)c(e,m[0])&&i.push(e);return i}}for(_?o?y||(r=a(r,p,_)):(s=a(s,p,_),o=function(t){return t.getNodesByName(_)}):o||(o=function(t){return t.getNodesByName("*")}),n=0;i=t.pseudos[n];n++)if("not"==i.name){var P=e(i.value);r=a(r,function(t,e){return!e.match(t)},1==P.parse().length?P.parsed[0]:P)}else{var C=d[i.name];C&&(r=a(r,C,i.value))}for(n=0;i=t.properties[n];n++)r=a(r,f,g(i));return(t.simple=!r)?t.matchAux=h:(t.matchAux=r,s=a(s,r)),t.match=s||h,t.combine=e.combinators[t.combinator||" "],t.search=o,t};var y=e.combinators={" ":function(t,n,i,r,o,s){var a=i.search(n);if(s&&i.simple)return e.toArray(a);for(var h,l=0,p=i.matchAux;h=a[l];l++)o(h)&&p(h,r)&&t.push(h);return t},">":function(t,e,n,i,r){for(var o,s=n.search(e),a=0;o=s[a];a++)o.getParent()==e&&r(o)&&n.matchAux(o,i)&&t.push(o);return t},"+":function(t,e,n,i,r){for(;e=e.getNext();){r(e)&&n.match(e,i)&&t.push(e);break}return t},"~":function(t,e,n,i,r){for(;(e=e.getNext())&&r(e);)n.match(e,i)&&t.push(e);return t},"<":function(t,e,n,i,r){for(;(e=e.getParent())&&!(e instanceof IFScene);)r(e)&&n.match(e,i)&&t.push(e);return t},"^":function(t,n,i,r,o){return(n=n.getFirstChild())&&(o(n)&&i.match(n,r)?t.push(n):t=e.combinators["+"](t,n,i,n,r)),t},"++":function(t,e,n,i,r){for(;e=e.getNext();)r(e)&&this.match(e,i)&&t.push(e);return t},"--":function(t,e,n,i,r){for(;e=e.getPrevious();)r(e)&&this.match(e,i)&&t.push(e);return t}},d=e.pseudos={"first-child":function(t){return d.index(t,0)},"last-child":function(t){return null==t.getNext()},"only-child":function(t){return null==t.getPrevious()&&null==t.getNext()},"nth-child":function(t,n,i){var r=e.parseNth(n||"n");if("n"!=r.special)return d[r.special](t,r.a,i);(i=i||{}).positions=i.positions||{};var o=e.getUid(t);if(!i.positions[o]){for(var s=0;t=t.getPrevious();){s++;var a=i.positions[e.getUid(t)];if(null!=a){s=a+s;break}}i.positions[o]=s}return i.positions[o]%r.a==r.b},empty:function(t){return!1},contains:function(t,e){return!1},index:function(t,e){for(var n=1;t=t.getPrevious();)if(++n>e)return!1;return n==e},even:function(t,e,n){return d["nth-child"](t,"2n+1",n)},odd:function(t,e,n){return d["nth-child"](t,"2n",n)},has:function(t,n){return e.querySingle(n,t)},active:function(t){return t.hasFlag(IFNode.Flag.Active)},selected:function(t){return t.hasFlag(IFNode.Flag.Selected)},hidden:function(t){return t instanceof IFElement&&t.hasFlag(IFElement.Flag.Hidden)},visible:function(t){return t instanceof IFElement&&!t.hasFlag(IFElement.Flag.Hidden)}};d.first=d["first-child"],d.last=d["last-child"],d.nth=d["nth-child"],d.eq=d.index;var _=e.propertyOperators={"*=":function(t,e){return e},"^=":function(t,e){return"^"+e},"$=":function(t,e){return t+"$"},"~=":function(t,e){return"(?:^|[ \\t\\r\\n\\f])"+e+"(?:$|[ \\t\\r\\n\\f])"},"|=":function(t,e){return"(?:^|\\|)"+e+"(?:$|\\|)"},"/=":function(t,e){return t}},v=Array.slice||function(t){return Array.prototype.slice.call(t)};try{v(scene.sceneElement.childNodes)}catch(t){v=function(t){if(t instanceof Array)return t;for(var e=t.length,n=new Array(e);e--;)n[e]=t[e];return n}}e.toArray=v;var m=1;e.getUid=window.ActiveXObject?function(t){return(t.__slyUid||(t.__slyUid={id:m++})).id}:function(t){return t.__slyUid||(t.__slyUid=m++)};var I={};e.parseNth=function(t){if(I[t])return I[t];var e=t.match(/^([+-]?\d*)?([a-z]+)?([+-]?\d*)?$/);if(!e)return!1;var n=parseInt(e[1],10),i=(parseInt(e[3],10)||0)-1;if(n=isNaN(n)?1:n){for(;i<1;)i+=n;for(;i>=n;)i-=n}switch(e[2]){case"n":e={a:n,b:i,special:"n"};break;case"odd":e={a:2,b:0,special:"n"};break;case"even":e={a:2,b:1,special:"n"};break;case"first":e={a:0,special:"index"};break;case"last":e={special:"last-child"};break;case"only":e={special:"only-child"};break;default:e={a:n?n-1:i,special:"index"}}return I[t]=e},e.escapeRegExp=function(t){return t.replace(/[-.*+?^${}()|[\]\/\\]/g,"\\$&")},e.generise=function(t){e[t]=function(n){var i=e(n);return i[t].apply(i,Array.prototype.slice.call(arguments,1))}};for(var P=["parse","queryAll","querySingle","match","filter"],C=0;P[C];C++)e.generise(P[C]);return e.recompile(),e}();!function(t){var e=null;function n(){IFNode.call(this)}IFObject.inheritAndMix(n,IFNode,[IFNode.Store,IFNode.Properties]),n.StyleChangeEvent=function(t){this.style=t},IFObject.inherit(n.StyleChangeEvent,GEvent),n.StyleChangeEvent.prototype.style=null,n.StyleChangeEvent.prototype.toString=function(){return"[Event IFStyle.StyleChangeEvent]"},n.HitResult=function(t,e){this.entry=t,this.data=e},n.HitResult.prototype.entry=null,n.HitResult.prototype.data=null,n.prototype.getActualStyle=function(){return this},n.prototype.createPreviewImage=function(t,n){var i=new IFRectangle;i.setProperty("trf",new IFTransform(t/2,0,0,n/2,t/2,n/2));var r=new IFPaintCanvas;r.resize(t,n),r.prepare();var o=new IFPaintContext;o.canvas=r,o.configuration=new IFScenePaintConfiguration,e||(e=IFPaintCanvas.createChessboard(4,"white","rgb(185, 185, 185)")),o.canvas.fillRect(0,0,t,n,o.canvas.createTexture(e));var s=this.getBBox(new IFRect(0,0,t,n)),a=s.getSide(IFRect.Side.CENTER),h=new IFPoint(t/2,n/2),l=1/(s.getWidth()/t),p=1/(s.getHeight()/n),u=(new IFTransform).translated(-a.getX(),-a.getY()).scaled(l,p).translated(h.getX(),h.getY()).getMatrix();return r.setOrigin(new IFPoint(-u[4],-u[5])),r.setScale(l),i.renderStyle(o,this),r.asPNGImage()},n.prototype.getBBox=function(t){for(var e=[0,0,0,0],n=[0,0,0,0],i=[0,0,0,0],r=[0,0,0,0],o=this.getActualStyle().getFirstChild();null!==o;o=o.getNext())if(o instanceof IFStyleEntry&&!0===o.getProperty("vs")){var s=o.getPadding();if(s)if(o instanceof IFVEffectEntry)e=[e[0]+s[0],e[1]+s[1],e[2]+s[2],e[3]+s[3]];else if(o instanceof IFFilterEntry)n=[n[0]+Math.abs(s[0]),n[1]+Math.abs(s[1]),n[2]+Math.abs(s[2]),n[3]+Math.abs(s[3])];else if(o instanceof IFEffectEntry)i=[Math.max(i[0],s[0]),Math.max(i[1],s[1]),Math.max(i[2],s[2]),Math.max(i[3],s[3])];else{if(!(o instanceof IFPaintEntry))throw new Error("Unknown entry with padding.");r=[Math.max(r[0],s[0]),Math.max(r[1],s[1]),Math.max(r[2],s[2]),Math.max(r[3],s[3])]}}var a=t.expanded(e[0]+r[0]+n[0]+i[0],e[1]+r[1]+n[1]+i[1],e[2]+r[2]+n[2]+i[2],e[3]+r[3]+n[3]+i[3]),h=[0,0,0,0];a.getX()!=Math.floor(a.getX())&&(h[0]=.5),a.getY()!=Math.floor(a.getY())&&(h[1]=.5);var l=a.getSide(IFRect.Side.BOTTOM_RIGHT);return l.getX()!=Math.ceil(l.getX())&&(h[2]=.5),l.getY()!=Math.ceil(l.getY())&&(h[3]=.5),a.expanded(h[0],h[1],h[2],h[3])},n.prototype.createVertexSource=function(t){for(var e=this.getActualStyle().getFirstChild();null!==e;e=e.getNext())e instanceof IFVEffectEntry&&!0===e.getProperty("vs")&&(t=e.createEffect(t));return t},n.prototype.hitTest=function(t,e,n,i){t=this.createVertexSource(t);for(var r=this.getActualStyle().getLastChild();null!==r;r=r.getPrevious())if(r instanceof IFPaintEntry&&!0===r.getProperty("vs")){var o=r.hitTest(t,e,n,i);if(o)return o}return null},n.prototype.prepareGeometryChange=function(){},n.prototype.finishGeometryChange=function(){this._canEventBeSend(n.StyleChangeEvent)&&this._scene.trigger(new n.StyleChangeEvent(this))},n.prototype.visualChange=function(){this._canEventBeSend(n.StyleChangeEvent)&&this._scene.trigger(new n.StyleChangeEvent(this))},n.prototype.validateInsertion=function(t,e){return!1},n.prototype._handleChange=function(t,e){t==IFNode._Change.BeforeChildInsert||t===IFNode._Change.BeforeChildRemove?e instanceof IFStyleEntry&&this.prepareGeometryChange():t!=IFNode._Change.AfterChildInsert&&t!==IFNode._Change.AfterChildRemove||e instanceof IFStyleEntry&&this.finishGeometryChange(),IFNode.prototype._handleChange.call(this,t,e)},n.prototype._handleGeometryChangeForProperties=function(t,e,n){if((t==IFNode._Change.BeforePropertiesChange||t==IFNode._Change.AfterPropertiesChange)&&ifUtil.containsObjectKey(e.properties,n)){switch(t){case IFNode._Change.BeforePropertiesChange:this.prepareGeometryChange();break;case IFNode._Change.AfterPropertiesChange:this.finishGeometryChange()}return!0}return!1},n.prototype._handleVisualChangeForProperties=function(t,e,n){return!(t!=IFNode._Change.AfterPropertiesChange||!ifUtil.containsObjectKey(e.properties,n))&&(this.visualChange(),!0)},n.prototype.toString=function(){return"[IFStyle]"},t.IFStyle=n}(this),function(t){function e(){IFStyle.call(this),this._setDefaultProperties(e.MetaProperties)}IFNode.inheritAndMix("sharedStyle",e,IFStyle,[IFNode.Container,IFNode.Reference]),e.MetaProperties={name:null},e.prototype.prepareGeometryChange=function(){var t=this.getScene();t&&t.visitLinks(this,function(t){t instanceof IFStyle&&t.prepareGeometryChange()}),IFStyle.prototype.prepareGeometryChange.call(this)},e.prototype.finishGeometryChange=function(){var t=this.getScene();t&&t.visitLinks(this,function(t){t instanceof IFStyle&&t.finishGeometryChange()}),IFStyle.prototype.finishGeometryChange.call(this)},e.prototype.visualChange=function(){var t=this.getScene();t&&t.visitLinks(this,function(t){t instanceof IFStyle&&t.visualChange()}),IFStyle.prototype.visualChange.call(this)},e.prototype.store=function(t){return!!IFStyle.prototype.store.call(this,t)&&(this.storeProperties(t,e.MetaProperties),!0)},e.prototype.restore=function(t){return!!IFStyle.prototype.restore.call(this,t)&&(this.restoreProperties(t,e.MetaProperties),!0)},e.prototype.validateInsertion=function(t,e){return t instanceof IFScene.StyleCollection},e.prototype.toString=function(){return"[IFSharedStyle]"},t.IFSharedStyle=e}(this),function(t){function e(){IFStyle.call(this),this._setDefaultProperties(e.GeometryProperties,e.VisualProperties)}IFObject.inherit(e,IFStyle),e.Type={Content:"C",Knockout:"K",Mask:"M",Background:"B"},e.GeometryProperties={vs:!0},e.VisualProperties={tp:e.Type.Content,blm:IFPaintCanvas.BlendMode.Normal,opc:1},e.prototype.getOwnerElement=function(){for(var t=this.getParent();null!==t;t=t.getParent())if(t instanceof IFElement)return t;return null},e.prototype.prepareGeometryChange=function(){var t=this.getOwnerElement();t&&t._notifyChange(IFElement._Change.PrepareGeometryUpdate),IFStyle.prototype.prepareGeometryChange.call(this)},e.prototype.finishGeometryChange=function(){var t=this.getOwnerElement();t&&t._notifyChange(IFElement._Change.FinishGeometryUpdate),IFStyle.prototype.finishGeometryChange.call(this)},e.prototype.visualChange=function(){var t=this.getOwnerElement();t&&t._notifyChange(IFElement._Change.InvalidationRequest),IFStyle.prototype.visualChange.call(this)},e.prototype.store=function(t){return!!IFStyle.prototype.store.call(this,t)&&(this.storeProperties(t,e.GeometryProperties),this.storeProperties(t,e.VisualProperties),!0)},e.prototype.restore=function(t){return!!IFStyle.prototype.restore.call(this,t)&&(this.restoreProperties(t,e.GeometryProperties),this.restoreProperties(t,e.VisualProperties),!0)},e.prototype.validateInsertion=function(t,e){return t instanceof IFStyleSet},e.prototype._handleChange=function(t,n){this._handleGeometryChangeForProperties(t,n,e.GeometryProperties),this._handleVisualChangeForProperties(t,n,e.VisualProperties),IFStyle.prototype._handleChange.call(this,t,n)},e.prototype.toString=function(){return"[IFAppliedStyle]"},t.IFAppliedStyle=e}(this),function(t){function e(){IFAppliedStyle.call(this)}IFNode.inheritAndMix("style",e,IFAppliedStyle,[IFNode.Container]),e.prototype.toString=function(){return"[IFInlineStyle]"},t.IFInlineStyle=e}(this),function(t){function e(){IFAppliedStyle.call(this),this._setDefaultProperties(e.GeometryProperties)}IFNode.inherit("lnStyle",e,IFAppliedStyle),e.GeometryProperties={ref:null},e.prototype.getActualStyle=function(){return this.$ref&&this.isAttached()?this.getScene().getReference(this.$ref):null},e.prototype.store=function(t){return!!IFAppliedStyle.prototype.store.call(this,t)&&(this.storeProperties(t,e.GeometryProperties),!0)},e.prototype.restore=function(t){return!!IFAppliedStyle.prototype.restore.call(this,t)&&(this.restoreProperties(t,e.GeometryProperties),!0)},e.prototype._handleChange=function(t,n){if(this._handleGeometryChangeForProperties(t,n,e.GeometryProperties)&&n.properties.indexOf("ref")>=0){var i=this.getActualStyle();if(i)switch(t){case IFNode._Change.BeforePropertiesChange:this.getScene().unlink(i,this);break;case IFNode._Change.AfterPropertiesChange:this.getScene().link(i,this)}}IFAppliedStyle.prototype._handleChange.call(this,t,n)},e.prototype._setScene=function(t){var e;t!==this._scene&&(t?(e=t.getReference(this.$ref))&&t.link(e,this):(e=this._scene.getReference(this.$ref))&&this._scene.unlink(e,this));IFAppliedStyle.prototype._setScene.call(this,t)},e.prototype.toString=function(){return"[IFLinkedStyle]"},t.IFLinkedStyle=e}(this),function(t){function e(){IFNode.call(this)}IFObject.inheritAndMix(e,IFNode,[IFNode.Container,IFNode.Store]),e.prototype.getBBox=function(t){for(var e=t,n=this.getFirstChild();null!=n;n=n.getNext())if(n instanceof IFStyle&&!0===n.getProperty("vs")){var i=n.getBBox(t);i&&!i.isEmpty()&&(e=e.united(i))}return e},e.prototype.hitTest=function(t,e,n,i){for(var r=this.getLastChild();null!==r;r=r.getPrevious())if(r instanceof IFStyle&&!0===r.getProperty("vs")){var o=r.hitTest(t,e,n,i);if(o)return o}return null},e.prototype._handleChange=function(t,e){var n=this.getParent();n&&(t==IFNode._Change.BeforeChildInsert||t===IFNode._Change.BeforeChildRemove?e instanceof IFStyle&&n._notifyChange(IFElement._Change.PrepareGeometryUpdate):t!=IFNode._Change.AfterChildInsert&&t!==IFNode._Change.AfterChildRemove||e instanceof IFStyle&&n._notifyChange(IFElement._Change.FinishGeometryUpdate)),IFNode.prototype._handleChange.call(this,t,e)},e.prototype.toString=function(){return"[IFStyleSet]"},t.IFStyleSet=e}(this),function(t){function e(){IFNode.call(this),this._setDefaultProperties(e.GeometryProperties)}IFObject.inheritAndMix(e,IFNode,[IFNode.Store,IFNode.Properties]),e.GeometryProperties={vs:!0},e.prototype.store=function(t){return!!IFNode.Store.prototype.store.call(this,t)&&(this.storeProperties(t,e.GeometryProperties),!0)},e.prototype.restore=function(t){return!!IFNode.Store.prototype.restore.call(this,t)&&(this.restoreProperties(t,e.GeometryProperties),!0)},e.prototype.getPadding=function(){return null},e.prototype.validateInsertion=function(t,e){return t instanceof IFStyle},e.prototype._handleChange=function(t,n){this._handleGeometryChangeForProperties(t,n,e.GeometryProperties),IFNode.prototype._handleChange.call(this,t,n)},e.prototype._handleGeometryChangeForProperties=function(t,e,n){if(t==IFNode._Change.BeforePropertiesChange||t==IFNode._Change.AfterPropertiesChange){var i=this.getOwnerStyle();if(i&&ifUtil.containsObjectKey(e.properties,n)){switch(t){case IFNode._Change.BeforePropertiesChange:i.prepareGeometryChange();break;case IFNode._Change.AfterPropertiesChange:i.finishGeometryChange()}return!0}return!1}return!1},e.prototype._handleVisualChangeForProperties=function(t,e,n){if(t==IFNode._Change.AfterPropertiesChange){var i=this.getOwnerStyle();return!(!i||!ifUtil.containsObjectKey(e.properties,n))&&(i.visualChange(),!0)}return!1},e.prototype.getOwnerStyle=function(){var t=this.getParent();return t&&t instanceof IFStyle?t:null},e.prototype.toString=function(){return"[IFStyleEntry]"},t.IFStyleEntry=e}(this),function(t){function e(){IFStyleEntry.call(this)}IFObject.inherit(e,IFStyleEntry),e.prototype.apply=function(t,e){throw new Error("Not Supported")},e.prototype.toString=function(){return"[IFFilterEntry]"},t.IFFilterEntry=e}(this),function(t){function e(){IFStyleEntry.call(this)}IFObject.inherit(e,IFStyleEntry),e.prototype.isPost=function(){throw new Error("Not Supported")},e.prototype.render=function(t,e,n){throw new Error("Not Supported")},e.prototype.toString=function(){return"[IFEffectEntry]"},t.IFEffectEntry=e}(this),function(t){function e(){IFStyleEntry.call(this)}IFObject.inherit(e,IFStyleEntry),e.prototype.isSeparate=function(){return!1},e.prototype.getPaintCmpOrBlend=function(){return null},e.prototype.getPaintOpacity=function(){return null},e.prototype.hitTest=function(t,e,n,i){return null},e.prototype.paint=function(t,e){throw new Error("Not Supported")},e.prototype.toString=function(){return"[IFPaintEntry]"},t.IFPaintEntry=e}(this),function(t){function e(){IFStyleEntry.call(this)}IFObject.inherit(e,IFStyleEntry),e.prototype.createEffect=function(t){throw new Error("Not Supported")},e.prototype.toString=function(){return"[IFVEffectEntry]"},t.IFVEffectEntry=e}(this),function(t){function e(){IFEffectEntry.call(this),this._setDefaultProperties(e.GeometryProperties,e.VisualProperties)}IFNode.inherit("shadowEffect",e,IFEffectEntry),e.GeometryProperties={in:!1,r:5,x:0,y:0},e.VisualProperties={cls:IFColor.parseCSSColor("rgba(0,0,0,0.5)")},e.prototype.getPadding=function(){return[this.$r-this.$x,this.$r-this.$y,this.$r+this.$x,this.$r+this.$y]},e.prototype.isPost=function(){return!!this.$in},e.prototype.render=function(t,e,n){t.fillCanvas(this.$cls);var i=this.$x*n,r=this.$y*n,o=this.$r*n;this.$in?(t.drawCanvas(e,i,r,1,IFPaintCanvas.CompositeOperator.DestinationOut),t.getBitmap().blur(o),t.drawCanvas(e,0,0,1,IFPaintCanvas.CompositeOperator.DestinationIn)):(t.drawCanvas(e,i,r,1,IFPaintCanvas.CompositeOperator.DestinationIn),t.getBitmap().blur(o))},e.prototype.store=function(t){return!!IFEffectEntry.prototype.store.call(this,t)&&(this.storeProperties(t,e.GeometryProperties),this.storeProperties(t,e.VisualProperties,function(t,e){return e&&"cls"===t?e.asString():e}),!0)},e.prototype.restore=function(t){return!!IFEffectEntry.prototype.restore.call(this,t)&&(this.restoreProperties(t,e.GeometryProperties),this.restoreProperties(t,e.VisualProperties,function(t,e){if(e&&"cls"===t)return IFColor.parseColor(e)}),!0)},e.prototype._handleChange=function(t,n){this._handleGeometryChangeForProperties(t,n,e.GeometryProperties),this._handleVisualChangeForProperties(t,n,e.VisualProperties),IFEffectEntry.prototype._handleChange.call(this,t,n)},e.prototype.toString=function(){return"[IFShadowEffect]"},t.IFShadowEffect=e}(this),function(t){function e(){IFFilterEntry.call(this),this._setDefaultProperties(e.GeometryProperties)}IFNode.inherit("blurFilter",e,IFFilterEntry),e.GeometryProperties={r:5},e.prototype.getPadding=function(){return[this.$r,this.$r,this.$r,this.$r]},e.prototype.apply=function(t,e){t.getBitmap().blur(this.$r*e)},e.prototype.store=function(t){return!!IFFilterEntry.prototype.store.call(this,t)&&(this.storeProperties(t,e.GeometryProperties),!0)},e.prototype.restore=function(t){return!!IFFilterEntry.prototype.restore.call(this,t)&&(this.restoreProperties(t,e.GeometryProperties),!0)},e.prototype._handleChange=function(t,n){this._handleGeometryChangeForProperties(t,n,e.GeometryProperties),IFFilterEntry.prototype._handleChange.call(this,t,n)},e.prototype.toString=function(){return"[IFBlurFilter]"},t.IFBlurFilter=e}(this),function(t){function e(){IFPaintEntry.call(this),this._setDefaultProperties(e.VisualProperties)}IFObject.inherit(e,IFPaintEntry),e.VisualProperties={pat:IFColor.BLACK,blm:IFPaintCanvas.BlendMode.Normal,opc:1},e.prototype.getPaintCmpOrBlend=function(){return this.$blm},e.prototype.getPaintOpacity=function(){return this.$opc},e.prototype.store=function(t){return!!IFPaintEntry.prototype.store.call(this,t)&&(this.storeProperties(t,e.VisualProperties,function(t,e){return e&&"pat"===t?IFPattern.asString(e):e}),!0)},e.prototype.restore=function(t){return!!IFPaintEntry.prototype.restore.call(this,t)&&(this.restoreProperties(t,e.VisualProperties,function(t,e){return e&&"pat"===t?IFPattern.parsePattern(e):e}),!0)},e.prototype._handleChange=function(t,n){this._handleVisualChangeForProperties(t,n,e.VisualProperties),IFPaintEntry.prototype._handleChange.call(this,t,n)},e.prototype.toString=function(){return"[IFPatternPaint]"},t.IFPatternPaint=e}(this),function(t){function e(){IFPatternPaint.call(this),this._setDefaultProperties(e.VisualProperties)}IFObject.inherit(e,IFPatternPaint),e.VisualProperties={tx:0,ty:0,sx:1,sy:1,rt:0},e.prototype.store=function(t){return!!IFPatternPaint.prototype.store.call(this,t)&&(this.storeProperties(t,e.VisualProperties),!0)},e.prototype.restore=function(t){return!!IFPatternPaint.prototype.restore.call(this,t)&&(this.restoreProperties(t,e.VisualProperties),!0)},e.prototype._handleChange=function(t,n){this._handleVisualChangeForProperties(t,n,e.VisualProperties),IFPatternPaint.prototype._handleChange.call(this,t,n)},e.prototype._createPaintPattern=function(t){if(this.$pat){if(this.$pat instanceof IFColor)return this.$pat;if(this.$pat instanceof IFGradient){if(this.$pat.getType()===IFGradient.Type.Linear)return t.createLinearGradient(-.5,0,.5,0,this.$pat);if(this.$pat.getType()===IFGradient.Type.Radial)return t.createRadialGradient(0,0,.5,this.$pat)}}return null},e.prototype._getPaintPatternTransform=function(t){if(this.$pat&&this.$pat instanceof IFGradient){var e=t.getX(),n=t.getY(),i=t.getWidth(),r=t.getHeight();return(new IFTransform).scaled(this.$sx,this.$sy).rotated(this.$rt).translated(this.$tx,this.$ty).scaled(i,r).translated(e,n)}return null},e.prototype.toString=function(){return"[IFAreaPaint]"},t.IFAreaPaint=e}(this),function(t){function e(){IFAreaPaint.call(this)}IFNode.inherit("fillPaint",e,IFAreaPaint),e.prototype.hitTest=function(t,e,n,i){var r=new IFVertexInfo.HitResult;return ifVertexInfo.hitTest(e.getX(),e.getY(),new IFVertexTransformer(t,n),i,!0,r)?new IFStyle.HitResult(this,r):null},e.prototype.paint=function(t,e){var n=this._createPaintPattern(t);if(n){var i=this._getPaintPatternTransform(e);if(i){var r=t.setTransform(t.getTransform(!0).preMultiplied(i));t.fillVertices(n,this.$opc,this.$blm),t.setTransform(r)}else t.fillVertices(n,this.$opc,this.$blm)}},e.prototype.toString=function(){return"[IFFillPaint]"},t.IFFillPaint=e}(this),function(t){function e(){IFAreaPaint.call(this),this._setDefaultProperties(e.GeometryProperties)}IFNode.inherit("strokePaint",e,IFAreaPaint),e.Alignment={Center:"C",Outside:"O",Inside:"I"},e.GeometryProperties={sw:1,sa:e.Alignment.Center,slc:IFPaintCanvas.LineCap.Square,slj:IFPaintCanvas.LineJoin.Miter,slm:10},e.prototype.isSeparate=function(){return!1===IFAreaPaint.prototype.isSeparate.call(this)&&(this.$sa!==e.Alignment.Center||(1!==this.$sx||1!==this.$sy))},e.prototype.hitTest=function(t,e,n,i){var r=this.$sw*n.getScaleFactor()+2*i,o=new IFVertexInfo.HitResult;return ifVertexInfo.hitTest(e.getX(),e.getY(),new IFVertexTransformer(t,n),r,!1,o)?new IFStyle.HitResult(this,o):null},e.prototype.getPadding=function(){if(this.$sa===e.Alignment.Center){var t=this.$sw/2;return[t,t,t,t]}return this.$sa===e.Alignment.Outside?[this.$sw,this.$sw,this.$sw,this.$sw]:null},e.prototype.paint=function(t,n){var i=n,r=this.getPadding();r&&(i=i.expanded(r[0],r[1],r[2],r[3]));var o=this._createPaintPattern(t);if(o){var s=this._getPaintPatternTransform(i),a=this.$sw;if(this.$sa!==e.Alignment.Center&&(a*=2),s){var h=this.$blm,l=this.$opc;if(this.isSeparate()&&(h=IFPaintCanvas.BlendMode.Normal,l=1),1!==this.$sx||1!==this.$sy){var p=t.setTransform(t.getTransform(!0).multiplied(s)),u=s.inverted().mapRect(n);t.fillRect(u.getX(),u.getY(),u.getWidth(),u.getHeight(),o),t.setTransform(p),t.strokeVertices(o,a,this.$slc,this.$slj,this.$slm,1,IFPaintCanvas.CompositeOperator.DestinationIn)}else{p=t.setTransform(t.getTransform(!0).multiplied(s));t.strokeVertices(o,a/s.getScaleFactor(),this.$slc,this.$slj,this.$slm,l,h),t.setTransform(p)}}else t.strokeVertices(o,a,this.$slc,this.$slj,this.$slm,this.$opc,this.$blm);this.$sa===e.Alignment.Inside?t.fillVertices(IFColor.BLACK,1,IFPaintCanvas.CompositeOperator.DestinationIn):this.$sa===e.Alignment.Outside&&t.fillVertices(IFColor.BLACK,1,IFPaintCanvas.CompositeOperator.DestinationOut)}},e.prototype.store=function(t){return!!IFAreaPaint.prototype.store.call(this,t)&&(this.storeProperties(t,e.GeometryProperties),!0)},e.prototype.restore=function(t){return!!IFAreaPaint.prototype.restore.call(this,t)&&(this.restoreProperties(t,e.GeometryProperties),!0)},e.prototype._handleChange=function(t,n){this._handleGeometryChangeForProperties(t,n,e.GeometryProperties),IFAreaPaint.prototype._handleChange.call(this,t,n)},e.prototype.toString=function(){return"[IFStrokePaint]"},t.IFStrokePaint=e}(this),function(t){function e(){IFVEffectEntry.call(this),this._setDefaultProperties(e.GeometryProperties)}IFNode.inheritAndMix("offsetVEffect",e,IFVEffectEntry),e.OffsetType={Inset:"i",Outset:" o",Both:"b"},e.GeometryProperties={tp:e.OffsetType.Outset,r:5},e.prototype.getPadding=function(){if(this.$r>0){var t=this.$r;return[t,t,t,t]}return null},e.prototype.createEffect=function(t){return this.$r>0?new IFVertexOffsetter(t,this.$r,this.$tp===e.OffsetType.Inset||this.$tp===e.OffsetType.Both,this.$tp===e.OffsetType.Outset||this.$tp===e.OffsetType.Both):t},e.prototype.store=function(t){return!!IFVEffectEntry.prototype.store.call(this,t)&&(this.storeProperties(t,e.GeometryProperties),!0)},e.prototype.restore=function(t){return!!IFVEffectEntry.prototype.restore.call(this,t)&&(this.restoreProperties(t,e.GeometryProperties),!0)},e.prototype._handleChange=function(t,n){this._handleGeometryChangeForProperties(t,n,e.GeometryProperties),IFVEffectEntry.prototype._handleChange.call(this,t,n)},e.prototype.toString=function(){return"[IFOffsetVEffect]"},t.IFOffsetVEffect=e}(this),function(t){function e(){IFBlock.call(this),this._setDefaultProperties(e.GeometryProperties,e.VisualProperties)}IFNode.inheritAndMix("page",e,IFBlock,[IFNode.Container,IFNode.Reference]),e.GeometryProperties={msref:null,x:0,y:0,w:0,h:0,bl:0,ml:0,mt:0,mr:0,mb:0},e.VisualProperties={cls:null},e.prototype.isMaster=function(){return!!this.isAttached()&&this.getScene().hasLinks(this)},e.prototype.getMasterPage=function(){var t=this.$msref&&this.isAttached()?this.getScene().getReference(this.$msref):null;return t===this?null:t},e.prototype.getPageClipBBox=function(){var t=this.getGeometryBBox();if(t&&!t.isEmpty()){var e=this.$bl||0;return t.expanded(e,e,e,e)}return t},e.prototype.store=function(t){return!!IFBlock.prototype.store.call(this,t)&&(this.storeProperties(t,e.GeometryProperties),this.storeProperties(t,e.VisualProperties,function(t,e){return"cls"===t&&e?e.asString():e}),this.hasFlag(IFNode.Flag.Active)&&(t.__active=!0),!0)},e.prototype.restore=function(t){this.__restoring=!0;try{return!!IFBlock.prototype.restore.call(this,t)&&(this.restoreProperties(t,e.GeometryProperties),this.restoreProperties(t,e.VisualProperties,function(t,e){return"cls"===t&&e?IFColor.parseColor(e):e}),t.__active&&this.setFlag(IFNode.Flag.Active),!0)}finally{delete this.__restoring}},e.prototype._getBitmapPaintArea=function(){return this.getPageClipBBox()},e.prototype._renderToBitmap=function(t){return paintConfig.pagesClip=!0,IFBlock.prototype._renderToBitmap(t)},e.prototype._paint=function(t){for(var e=this.getMasterPage(),n=!1,i=!1,r=this.getFirstChild();null!==r;r=r.getNext())if(r instanceof IFElement){i=!0;break}var o=t.canvas.resetTransform(),s=new IFRect(this.$x,this.$y,this.$w,this.$h),a=o.mapRect(s).toAlignedRect(),h=a.getX(),l=a.getY(),p=a.getWidth(),u=a.getHeight();if(i&&e||t.configuration.isPagesClip()){var c=this.$bl||0;t.canvas.clipRect(h-c,l-c,p+2*c,u+2*c),n=!0}if(t.canvas.setTransform(o),e){o=t.canvas.getTransform(!0);var g=e.getProperty("x"),f=e.getProperty("y"),y=this.$x-g,d=this.$y-f,_=new IFTransform(1,0,0,1,y,d);t.canvas.setTransform(o.preMultiplied(_)),t.dirtyMatcher.transform(new IFTransform(1,0,0,1,-y,-d)),e.render(t),t.dirtyMatcher.transform(_),t.canvas.setTransform(o)}i&&this._renderChildren(t),n&&t.canvas.resetClip()},e.prototype.validateInsertion=function(t,e){return t instanceof IFScene},e.prototype._calculateGeometryBBox=function(){return new IFRect(this.$x,this.$y,this.$w,this.$h)},e.prototype._calculatePaintBBox=function(){var t=this.getGeometryBBox();this.$bl&&this.$bl>0&&(t=t.expanded(this.$bl,this.$bl,this.$bl,this.$bl));var e=IFBlock.prototype._calculatePaintBBox.call(this);return e?e.united(t):t},e.prototype._detailHitTest=function(t,e,n,i){var r=this.getGeometryBBox();return e&&(r=e.mapRect(r)),r.expanded(n,n,n,n).containsPoint(t)?new IFBlock.HitResult(this):IFBlock.prototype._detailHitTest.call(this,t,e,n,i)},e.prototype._handleChange=function(t,n){if(this._handleGeometryChangeForProperties(t,n,e.GeometryProperties)){if(t===IFNode._Change.BeforePropertiesChange&&!this.__restoring){var i=n.properties.indexOf("x"),r=n.properties.indexOf("y");if(i>=0||r>=0){var o=i>=0?n.values[i]-this.$x:0,s=r>=0?n.values[r]-this.$y:0;if(0!==o||0!==s)for(var a=new IFTransform(1,0,0,1,o,s),h=this.getFirstChild(!0);null!=h;h=h.getNext(!0))h instanceof IFElement&&h.hasMixin(IFElement.Transform)&&h.transform(a)}}if(n.properties.indexOf("msref")>=0){var l=this.getMasterPage();if(l)switch(t){case IFNode._Change.BeforePropertiesChange:this.getScene().unlink(l,this);break;case IFNode._Change.AfterPropertiesChange:this.getScene().link(l,this)}}}if(this._handleVisualChangeForProperties(t,n,e.VisualProperties),t===IFElement._Change.InvalidationRequested){var p=n;if(p&&!p.isEmpty()&&this.isMaster()&&!1===this.getScene().getProperty("singlePage")){var u=this.getPageClipBBox();u&&!u.isEmpty()&&u.intersectsRect(p)&&this.getScene().visitLinks(this,function(t){if(t instanceof e&&t.isRenderable()){var n=t.getProperty("x")-this.$x,i=t.getProperty("y")-this.$y;t._requestInvalidationArea(p.translated(n,i))}}.bind(this))}}IFBlock.prototype._handleChange.call(this,t,n)},e.prototype._setScene=function(t){var e;t!==this._scene&&(t?(e=t.getReference(this.$msref))&&t.link(e,this):(e=this._scene.getReference(this.$msref))&&this._scene.unlink(e,this));IFBlock.prototype._setScene.call(this,t)},t.IFPage=e}(this),function(t){function e(){IFBlock.call(this),this._setDefaultProperties(e.VisualProperties,e.MetaProperties)}IFNode.inheritAndMix("layer",e,IFBlock,[IFNode.Container,IFElement.Transform]),e.GUIDE_COLOR_DEFAULT=new IFColor(IFColor.Type.RGB,[0,255,255,100]),e.Type={Output:"O",Draft:"D",Guide:"G"},e.TypeName={O:new IFLocale.Key(e,"type.output"),D:new IFLocale.Key(e,"type.draft"),G:new IFLocale.Key(e,"type.guide")},e.MetaProperties={tp:e.Type.Output},e.VisualProperties={otl:!1,cls:new IFColor(IFColor.Type.RGB,[0,168,255,100])},e.prototype.store=function(t){return!!IFBlock.prototype.store.call(this,t)&&(this.storeProperties(t,e.VisualProperties,function(t,e){return"cls"===t&&e?e.asString():e}),this.storeProperties(t,e.MetaProperties),this.hasFlag(IFNode.Flag.Active)&&(t.__active=!0),!0)},e.prototype.restore=function(t){return!!IFBlock.prototype.restore.call(this,t)&&(this.restoreProperties(t,e.VisualProperties,function(t,e){return"cls"===t&&e?IFColor.parseColor(e):e}),this.restoreProperties(t,e.MetaProperties),t.__active&&this.setFlag(IFNode.Flag.Active),!0)},e.prototype.validateInsertion=function(t,n){return t instanceof e||t instanceof IFPage},e.prototype._preparePaint=function(t){if(IFBlock.prototype._preparePaint.call(this,t)){if(this.$tp===e.Type.Guide){if(!t.configuration.isGuidesVisible(t))return!1;t.configuration.paintMode===IFScenePaintConfiguration.PaintMode.Outline||this.$otl||t.outlineColors.push(this.$cls)}else if(this.$tp===e.Type.Draft&&!t.configuration.isAnnotationsVisible(t))return!1;return t.configuration.paintMode!==IFScenePaintConfiguration.PaintMode.Outline&&this.$otl&&t.outlineColors.push(this.$cls),!0}return!1},e.prototype._finishPaint=function(t){this.$tp!==e.Type.Guide||t.configuration.paintMode===IFScenePaintConfiguration.PaintMode.Outline||this.$otl?(this.$tp,e.Type.Draft):t.outlineColors.pop(),t.configuration.paintMode!==IFScenePaintConfiguration.PaintMode.Outline&&this.$otl&&t.outlineColors.pop(),IFBlock.prototype._finishPaint.call(this,t)},e.prototype._detailHitTest=function(t,e,n,i){return new IFBlock.HitResult(this)},e.prototype._handleChange=function(t,n){if(this._handleVisualChangeForProperties(t,n,e.VisualProperties),t==IFNode._Change.AfterPropertiesChange){var i=n.properties.indexOf("tp");if(i>=0)n.values[i]===e.Type.Guide&&this.$cls===e.GUIDE_COLOR_DEFAULT?this.$cls=e.VisualProperties.cls:this.$tp===e.Type.Guide&&this.$cls===e.VisualProperties.cls&&(this.$cls=e.GUIDE_COLOR_DEFAULT),this._notifyChange(IFElement._Change.InvalidationRequest)}IFBlock.prototype._handleChange.call(this,t,n)},t.IFLayer=e}(this),function(t){function e(){IFItem.call(this),this._setDefaultProperties(e.VisualProperties,e.GeometryProperties,e.MetaProperties)}IFNode.inheritAndMix("slice",e,IFItem,[IFElement.Transform]),e.MetaProperties={trm:!0},e.GeometryProperties={trf:null},e.VisualProperties={cls:new IFColor(IFColor.Type.RGB,[0,116,217,100])},e.prototype.getTransform=function(){return this.$trf},e.prototype.setTransform=function(t){this.setProperty("trf",t)},e.prototype.transform=function(t){t&&!t.isIdentity()&&this.setProperty("trf",this.$trf?this.$trf.multiplied(t):t),IFElement.Transform.prototype._transformChildren.call(this,t)},e.prototype.store=function(t){return!!IFItem.prototype.store.call(this,t)&&(this.storeProperties(t,e.VisualProperties,function(t,e){return"cls"===t&&e?e.asString():e}),this.storeProperties(t,e.GeometryProperties,function(t,e){return"trf"===t&&e?IFTransform.serialize(e):e}),this.storeProperties(t,e.MetaProperties),!0)},e.prototype.restore=function(t){return!!IFItem.prototype.restore.call(this,t)&&(this.restoreProperties(t,e.VisualProperties,function(t,e){return"cls"===t&&e?IFColor.parseColor(e):e}),this.restoreProperties(t,e.GeometryProperties,function(t,e){return"trf"===t&&e?IFTransform.deserialize(e):e}),this.restoreProperties(t,e.MetaProperties),!0)},e.prototype.validateInsertion=function(t,e){return t instanceof IFLayer},IFPage.prototype._renderToBitmap=function(t){this.getScene().render(t);var e=t.canvas.getBitmap();return this.getProperty("trm")&&e.trim(),e},e.prototype._paint=function(t){if(t.configuration.isSlicesVisible(t)){var e=new IFRect(-1,-1,2,2);if(e=this.$trf?this.$trf.mapRect(e):e,t.configuration.isOutline(t)){var n=t.canvas.resetTransform(),i=n?n.mapRect(e):e;t.canvas.strokeRect(i.getX(),i.getY(),i.getWidth(),i.getHeight(),1,t.getOutlineColor()),t.canvas.setTransform(n)}else{i=e;t.canvas.fillRect(i.getX(),i.getY(),i.getWidth(),i.getHeight(),this.$cls,.5)}}},e.prototype._calculateGeometryBBox=function(){var t=new IFRect(-1,-1,2,2);return this.$trf?this.$trf.mapRect(t):t},e.prototype._calculatePaintBBox=function(){return this.getGeometryBBox()},e.prototype._handleChange=function(t,n){this._handleGeometryChangeForProperties(t,n,e.GeometryProperties),this._handleVisualChangeForProperties(t,n,e.VisualProperties),IFItem.prototype._handleChange.call(this,t,n)},e.prototype._detailHitTest=function(t,e,n,i){return new IFItem.HitResult(this)},t.IFSlice=e}(this),function(t){function e(){IFNode.call(this),this._setDefaultProperties(e.VisualProperties,e.MetaProperties)}IFNode.inheritAndMix("swatch",e,IFNode,[IFNode.Store,IFNode.Properties]),e.VisualProperties={pat:null},e.MetaProperties={name:null},e.prototype.getPatternType=function(){return this.$pat?this.$pat.getPatternType():null},e.prototype.store=function(t){return!!IFNode.Store.prototype.store.call(this,t)&&(this.storeProperties(t,e.VisualProperties,function(t,e){return e&&"pat"===t?IFPattern.asString(e):e}),this.storeProperties(t,e.MetaProperties),!0)},e.prototype.restore=function(t){return!!IFNode.Store.prototype.restore.call(this,t)&&(this.restoreProperties(t,e.VisualProperties,function(t,e){if(e&&"pat"===t)return IFPattern.parsePattern(e)}),this.restoreProperties(t,e.MetaProperties),!0)},e.prototype.validateInsertion=function(t,e){return t instanceof IFScene.SwatchCollection},t.IFSwatch=e}(this),function(t){function e(){IFItem.call(this),this._setDefaultProperties(e.GeometryProperties)}IFObject.inheritAndMix(e,IFItem,[IFNode.Container,IFElement.Transform,IFElement.Style,IFVertexSource]),e.GeometryProperties={trf:null},e._StyleSet=function(){this._flags|=IFNode.Flag.Shadow},IFNode.inherit("shpStylSet",e._StyleSet,IFStyleSet),e._StyleSet.prototype.validateInsertion=function(t,n){return t instanceof e},e.prototype.getStyleSet=function(){var t=IFElement.Style.prototype.getStyleSet.call(this);return t||(t=new e._StyleSet,this.appendChild(t)),t},e.prototype.getTransform=function(){return this.$trf},e.prototype.setTransform=function(t){this.setProperty("trf",t)},e.prototype.transform=function(t){t&&!t.isIdentity()&&this.setProperty("trf",this.$trf?this.$trf.multiplied(t):t),IFElement.Transform.prototype._transformChildren.call(this,t)},e.prototype.validateInsertion=function(t,n){return t instanceof IFLayer||t instanceof IFShapeSet||t instanceof e},e.prototype.store=function(t){return!!IFItem.prototype.store.call(this,t)&&(this.storeProperties(t,e.GeometryProperties,function(t,e){return"trf"===t&&e?IFTransform.serialize(e):e}),!0)},e.prototype.restore=function(t){return!!IFItem.prototype.restore.call(this,t)&&(this.restoreProperties(t,e.GeometryProperties,function(t,e){return"trf"===t&&e?IFTransform.deserialize(e):e}),!0)},e.prototype._paint=function(t,e,n){if(this.rewindVertices(0)){if(this._paintBackground(t,e,n),t.configuration.isOutline(t)){var i=t.canvas.resetTransform(),r=new IFVertexTransformer(e?e.createVertexSource(this):this,i);t.canvas.putVertices(r),t.canvas.strokeVertices(t.getOutlineColor()),t.canvas.setTransform(i),this._paintContents(t,e,n)}else e&&this._paintStyle(t,e,n);this._paintForeground(t,e,n)}},e.prototype._paintBackground=function(t,e,n){},e.prototype._paintForeground=function(t,e,n){},e.prototype._paintStyle=function(t,e,n){for(var i=null,r=e.getActualStyle().getFirstChild();null!==r;r=r.getNext())r instanceof IFPaintEntry&&!0===r.getProperty("vs")&&(i||(i=[]),i.push(r));if(i){var o=e.createVertexSource(this);t.canvas.putVertices(o);for(var s=e.getBBox(this.getGeometryBBox()),a=0;a<i.length;++a){var h=i[a];if(h.isSeparate()){var l=t.canvas.createCanvas(s);l.putVertices(o),h.paint(l,s),t.canvas.drawCanvas(l,0,0,h.getPaintOpacity(),h.getPaintCmpOrBlend())}else h.paint(t.canvas,s)}}},e.prototype._paintContents=function(t,e,n){for(var i=null,r=this.getFirstChild();null!==r;r=r.getNext())r instanceof IFElement&&(i||(i=t.canvas,t.canvas=i.createCanvas(this.getGeometryBBox())),r.render(t));i&&(t.canvas.putVertices(this),t.canvas.fillVertices(IFColor.BLACK,1,IFPaintCanvas.CompositeOperator.DestinationIn),i.drawCanvas(t.canvas),t.canvas.finish(),t.canvas=i)},e.prototype.renderStyle=function(t,e,n){IFElement.Style.prototype.renderStyle.call(this,t,e,n),0===n&&this._paintContents(t)},e.prototype._calculateGeometryBBox=function(){return ifVertexInfo.calculateBounds(this,!0)},e.prototype._calculatePaintBBox=function(){var t=this.getGeometryBBox();return t?this.getStyleSet().getBBox(t):null},e.prototype._handleChange=function(t,n){this._handleGeometryChangeForProperties(t,n,e.GeometryProperties),IFItem.prototype._handleChange.call(this,t,n)},e.prototype._detailHitTest=function(t,e,n,i){var r=this.getStyleSet().hitTest(this,t,e,n);if(r)return new IFElement.HitResult(this,r);if(i){var o=new IFVertexInfo.HitResult;if(ifVertexInfo.hitTest(t.getX(),t.getY(),new IFVertexTransformer(this,e),n,!0,o))return new IFElement.HitResult(this,o)}else if(n){o=new IFVertexInfo.HitResult;if(ifVertexInfo.hitTest(t.getX(),t.getY(),new IFVertexTransformer(this,e),n,!1,o))return new IFElement.HitResult(this,o)}return null},e.prototype.getCenter=function(t){var e=new IFPoint(0,0);return t&&this.$trf&&(e=this.$trf.mapPoint(e)),e},e.prototype.getOrigHalfWidth=function(){return 1},e.prototype.getOrigHalfHeight=function(){return 1},e.prototype.toString=function(){return"[IFShape]"},t.IFShape=e}(this),function(t){function e(){IFItem.call(this)}IFNode.inheritAndMix("shapeSet",e,IFItem,[IFNode.Container,IFElement.Transform]),e.prototype.validateInsertion=function(t,n){return t instanceof IFLayer||t instanceof e},e.prototype._detailHitTest=function(t,e,n,i){return new IFBlock.HitResult(this)},t.IFShapeSet=e}(this),function(t){function e(){IFShape.call(this),this._setDefaultProperties(e.VisualProperties),this._anchorPoints=new e.AnchorPoints,this.appendChild(this._anchorPoints),this._vertices=new IFVertexContainer,this._verticesDirty=!0}IFObject.inherit(e,IFShape),e.CornerType={Rounded:"R",InverseRounded:"U",Bevel:"B",Inset:"I",Fancy:"F"},e.isCornerType=function(t){for(var n in e.CornerType)if(e[n]===t)return!0;return!1},e.VisualProperties={evenodd:!1},e.AnchorPoint=function(){this._setDefaultProperties(e.AnchorPoint.GeometryProperties),this._leadHr=!1},IFObject.inheritAndMix(e.AnchorPoint,IFNode,[IFNode.Properties]),e.AnchorPoint.Type={Asymmetric:"TA",Symmetric:"TS",Mirror:"TM",Connector:"TC"},e.AnchorPoint.GeometryProperties={tp:e.AnchorPoint.Type.Asymmetric,x:0,y:0,hlx:null,hly:null,hrx:null,hry:null,ah:!1,cu:!0,cl:0,cr:0},e.AnchorPoint.BEST_CIRCLE_COEFF=.55191502,e.AnchorPoint.HANDLE_COEFF=.39026286,e.AnchorPoint.prototype.validateInsertion=function(t,n){return t instanceof e.AnchorPoints},e.AnchorPoint.prototype.serialize=function(){var t=[];return null!==this.$tp&&this.$tp!==e.AnchorPoint.GeometryProperties.tp&&t.push(this.$tp),this.$ah&&this.$ah!==e.AnchorPoint.GeometryProperties.ah&&t.push(this.$ah),t.push(this.$x),t.push(this.$y),this.$ah||(null===this.$hlx&&null===this.$hly||(t.push("h"),t.push(this.$hlx),t.push(this.$hly)),null===this.$hrx&&null===this.$hry||(t.push("H"),t.push(this.$hrx),t.push(this.$hry))),(null!==this.$cl&&!ifMath.isEqualEps(this.$cl,e.AnchorPoint.GeometryProperties.cl)||null!==this.$cr&&!ifMath.isEqualEps(this.$cr,e.AnchorPoint.GeometryProperties.cr))&&(t.push("C"),t.push(this.$cl),t.push(this.$cr)),t},e.AnchorPoint.prototype.deserialize=function(t){var e=0;for(t.length>0&&"string"==typeof t[0]&&(this.$tp=t[0],e++),t.length>e&&"boolean"==typeof t[e]&&(this.$ah=t[e],e++),e+1<t.length&&(this.$x=t[e],this.$y=t[e+1],e+=2);e+2<t.length;)"h"===t[e]?(this.$hlx=t[e+1],this.$hly=t[e+2]):"H"===t[e]?(this.$hrx=t[e+1],this.$hry=t[e+2]):"C"===t[e]&&(this.$cl=t[e+1],this.$cr=t[e+2]),e+=3},e.AnchorPoint.prototype._getTransformedCopy=function(t){var n=new e.AnchorPoint,i=null!==this.$hlx?t.mapPoint(new IFPoint(this.$hlx,this.$hly)):null,r=null!==this.$hrx?t.mapPoint(new IFPoint(this.$hrx,this.$hry)):null,o=t.mapPoint(new IFPoint(this.$x,this.$y));return n.$x=o.getX(),n.$y=o.getY(),n.$hlx=i?i.getX():null,n.$hly=i?i.getY():null,n.$hrx=r?r.getX():null,n.$hry=r?r.getY():null,n.$cl=this.$cl,n.$cr=this.$cr,n.$ah=this.$ah,n.$tp=this.$tp,n},e.AnchorPoint.prototype.getLeftShoulderPoint=function(t){if(this.getPath()&&this.$cl&&(t||this.$cr)){var e=this._parent.getPreviousPoint(this);return this._parent._getLeftShoulderPoint(this,e)}return null},e.AnchorPoint.prototype.getLeftShoulderPointTransformed=function(t,e){var n=null;if(this.getPath()&&this.$cl&&(e||this.$cr)){var i=this._parent.getPreviousPoint(this),r=this._getTransformedCopy(t),o=i._getTransformedCopy(t);n=this._parent._getLeftShoulderPoint(r,o)}return n},e.AnchorPoint.prototype.getRightShoulderPoint=function(t){if(this.getPath()&&this.$cr&&(t||this.$cl)){var e=this._parent.getNextPoint(this);return this._parent._getRightShoulderPoint(this,e)}return null},e.AnchorPoint.prototype.getRightShoulderPointTransformed=function(t,e){var n=null;if(this.getPath()&&this.$cr&&(e||this.$cl)){var i=this._parent.getNextPoint(this),r=this._getTransformedCopy(t),o=i._getTransformedCopy(t);n=this._parent._getRightShoulderPoint(r,o)}return n},e.AnchorPoint.prototype.getLeftShoulderLimitPoint=function(){var t=null;if(this.getPath()){var e=this._parent.getPreviousPoint(this);e&&(t=this._parent._getLeftShoulderPoint(this,e,!0))}return t},e.AnchorPoint.prototype.getRightShoulderLimitPoint=function(){var t=null;if(this.getPath()){var e=this._parent.getNextPoint(this);e&&(t=this._parent._getRightShoulderPoint(this,e,!0))}return t},e.AnchorPoint.prototype._handleChange=function(t,n){var i=this.getPath();if((t==IFNode._Change.BeforePropertiesChange||t==IFNode._Change.AfterPropertiesChange)&&ifUtil.containsObjectKey(n.properties,e.AnchorPoint.GeometryProperties))if(t===IFNode._Change.BeforePropertiesChange){var r=n.properties.indexOf("cu");if(r>=0?n.values[r]:this.$cu){var o=n.properties.indexOf("cl"),s=n.properties.indexOf("cr");if(o>=0){var a=n.values[o];this.$cr!=a&&(s>=0?n.values[s]=a:(n.properties.push("cr"),n.values.push(a)))}else if(s>=0){a=n.values[s];this.$cl!=a&&(n.properties.push("cl"),n.values.push(a))}}i&&i._notifyChange(IFElement._Change.PrepareGeometryUpdate)}else if(t===IFNode._Change.AfterPropertiesChange&&((this.$tp!=e.AnchorPoint.Type.Symmetric||this.$ah||null==this.$hlx||null==this.$hrx)&&(this.$tp!=e.AnchorPoint.Type.Mirror||this.$ah||null==this.$hlx&&null==this.$hrx)||((n.properties.indexOf("hrx")>=0||n.properties.indexOf("hry")>=0)&&n.properties.indexOf("hlx")<0&&n.properties.indexOf("hly")<0||n.properties.indexOf("tp")>=0&&n.properties.indexOf("hlx")<0&&n.properties.indexOf("hly")<0&&null!=this.$hrx?this._leadHr=!0:this._leadHr=!1),(i||this.$tp==e.AnchorPoint.Type.Symmetric&&!this.$ah&&null!=this.$hlx&&null!=this.$hrx||this.$tp==e.AnchorPoint.Type.Mirror&&!this.$ah&&(null!=this.$hlx||null!=this.$hrx))&&this._invalidateCalculations(),i)){if(this._parent)if(n.properties.indexOf("x")>=0||n.properties.indexOf("y")>=0)this._parent._invalidateLeft(this._parent.getPreviousPoint(this)),this._parent._invalidateRight(this._parent.getNextPoint(this));else if(n.properties.indexOf("tp")>=0){var h=this._parent.getPreviousPoint(this);h&&(h.$ah||h.$tp==e.AnchorPoint.Type.Connector)&&h._invalidateCalculations();var l=this._parent.getNextPoint(this);l&&(l.$ah||l.$tp==e.AnchorPoint.Type.Connector)&&l._invalidateCalculations()}i._verticesDirty=!0,i._notifyChange(IFElement._Change.FinishGeometryUpdate)}IFNode.prototype._handleChange.call(this,t,n)},e.AnchorPoint.prototype.getPath=function(){return this._parent?this._parent._parent:null},e.AnchorPoint.prototype._invalidateCalculations=function(){var t=this._parent;t&&this.$tp==e.AnchorPoint.Type.Connector?this._calculateConnectorPoint():this.$tp!=e.AnchorPoint.Type.Symmetric||this.$ah?this.$tp!=e.AnchorPoint.Type.Mirror||this.$ah?t&&this.$ah&&this._calculateAutoHandles():this._calculateMirrorPoint():this._calculateSmoothPoint()},e.AnchorPoint.prototype._calculateConnectorPoint=function(){var t=this._parent;if(t){var n,i,r,o=t.getPreviousPoint(this),s=t.getNextPoint(this),a=0,h=0;s&&(h=Math.sqrt(ifMath.ptSqrDist(this.$x,this.$y,s.$x,s.$y))),o&&(a=Math.sqrt(ifMath.ptSqrDist(this.$x,this.$y,o.$x,o.$y))),this.$ah?(!s||!o||s.$tp!=e.AnchorPoint.Type.Symmetric&&s.$tp!=e.AnchorPoint.Type.Mirror||ifMath.isEqualEps(h,0)||ifMath.isEqualEps(a,0)?this.setProperties(["hrx","hry"],[null,null]):(n=h*e.AnchorPoint.HANDLE_COEFF,i=this.$x+(this.$x-o.$x)/a*n,r=this.$y+(this.$y-o.$y)/a*n,this.setProperties(["hrx","hry"],[i,r])),!o||!s||o.$tp!=e.AnchorPoint.Type.Symmetric&&o.$tp!=e.AnchorPoint.Type.Mirror||ifMath.isEqualEps(h,0)||ifMath.isEqualEps(a,0)?this.setProperties(["hlx","hly"],[null,null]):(n=a*e.AnchorPoint.HANDLE_COEFF,i=this.$x+(this.$x-s.$x)/h*n,r=this.$y+(this.$y-s.$y)/h*n,this.setProperties(["hlx","hly"],[i,r]))):(null!=this.$hlx&&s&&!ifMath.isEqualEps(h,0)&&(n=Math.sqrt(ifMath.ptSqrDist(this.$x,this.$y,this.$hlx,this.$hly)),i=this.$x+(this.$x-s.$x)/h*n,r=this.$y+(this.$y-s.$y)/h*n,this.setProperties(["hlx","hly"],[i,r])),null!=this.$hrx&&o&&!ifMath.isEqualEps(a,0)&&(n=Math.sqrt(ifMath.ptSqrDist(this.$x,this.$y,this.$hrx,this.$hry)),i=this.$x+(this.$x-o.$x)/a*n,r=this.$y+(this.$y-o.$y)/a*n,this.setProperties(["hrx","hry"],[i,r])))}},e.AnchorPoint.prototype._calculateSmoothPoint=function(){var t,e,n,i;null!=this.$hlx&&null!=this.$hrx&&(this._leadHr?(e=Math.sqrt(ifMath.ptSqrDist(this.$x,this.$y,this.$hrx,this.$hry)),ifMath.isEqualEps(e,0)||(t=Math.sqrt(ifMath.ptSqrDist(this.$x,this.$y,this.$hlx,this.$hly)),n=this.$x+(this.$x-this.$hrx)/e*t,i=this.$y+(this.$y-this.$hry)/e*t,this.setProperties(["hlx","hly"],[n,i]))):(e=Math.sqrt(ifMath.ptSqrDist(this.$x,this.$y,this.$hlx,this.$hly)),ifMath.isEqualEps(e,0)||(t=Math.sqrt(ifMath.ptSqrDist(this.$x,this.$y,this.$hrx,this.$hry)),n=this.$x+(this.$x-this.$hlx)/e*t,i=this.$y+(this.$y-this.$hly)/e*t,this.setProperties(["hrx","hry"],[n,i]))))},e.AnchorPoint.prototype._calculateMirrorPoint=function(){if(this._leadHr&&null!=this.$hrx){var t=this.$x+(this.$x-this.$hrx),e=this.$y+(this.$y-this.$hry);this.$hlx==t&&this.$hly==e||this.setProperties(["hlx","hly"],[t,e])}else if(!this._leadHr&&null!=this.$hlx){t=this.$x+(this.$x-this.$hlx),e=this.$y+(this.$y-this.$hly);this.$hrx==t&&this.$hry==e||this.setProperties(["hrx","hry"],[t,e])}},e.AnchorPoint.prototype._calculateAutoHandles=function(){var t=this._parent;if(t){var n,i,r,o,s,a,h,l,p,u=t.getPreviousPoint(this),c=t.getNextPoint(this),g=e.AnchorPoint.HANDLE_COEFF;if(this.$tp==e.AnchorPoint.Type.Symmetric||this.$tp==e.AnchorPoint.Type.Mirror){if(!c&&!u)return;c&&!u||c&&this.$x==u.$x&&this.$y==u.$y?(n=this.$x+(c.$x-this.$x)*g,i=this.$y+(c.$y-this.$y)*g,this.setProperties(["hlx","hly","hrx","hry"],[this.$x+this.$x-n,this.$y+this.$y-i,n,i],!1,!0)):u&&!c||u&&this.$x==c.$x&&this.$y==c.$y?(n=this.$x+(u.$x-this.$x)*g,i=this.$y+(u.$y-this.$y)*g,this.setProperties(["hlx","hly","hrx","hry"],[n,i,this.$x+this.$x-n,this.$y+this.$y-i],!1,!0)):u&&c&&(null==(s=ifMath.getCircumcircleCenter(u.$x,u.$y,this.$x,this.$y,c.$x,c.$y))?(a=(this.$y-u.$y)*g,h=(u.$x-this.$x)*g,this.setProperties(["hlx","hly","hrx","hry"],[this.$x-a,this.$y-h,this.$x+a,this.$y+h],!1,!0)):(r=Math.sqrt(ifMath.ptSqrDist(this.$x,this.$y,s.getX(),s.getY())),a=(this.$y-s.getY())/r,h=(s.getX()-this.$x)/r,l=(u.$x+c.$x)/2,p=(u.$y+c.$y)/2,ifMath.segmentSide(this.$x,this.$y,l,p,u.$x,u.$y)!=ifMath.segmentSide(this.$x,this.$y,l,p,this.$x-a,this.$y-h)&&(a=-a,h=-h),o=Math.sqrt(ifMath.ptSqrDist(this.$x,this.$y,u.$x,u.$y))*g,this.setProperties(["hlx","hly"],[this.$x-a*o,this.$y-h*o]),o=Math.sqrt(ifMath.ptSqrDist(this.$x,this.$y,c.$x,c.$y))*g,this.setProperties(["hrx","hry"],[this.$x+a*o,this.$y+h*o])))}else{if(u&&(u.$x!=this.$x||u.$y!=this.$y))if(u.$tp==e.AnchorPoint.Type.Symmetric||u.$tp==e.AnchorPoint.Type.Mirror){var f=t.getPreviousPoint(u);!f||u.$x==f.$x&&u.$y==f.$y?(n=this.$x+(u.$x-this.$x)*g,i=this.$y+(u.$y-this.$y)*g,this.setProperties(["hlx","hly"],[n,i])):null==(s=ifMath.getCircumcircleCenter(this.$x,this.$y,u.$x,u.$y,f.$x,f.$y))?(a=(this.$y-u.$y)*g,h=(u.$x-this.$x)*g,this.setProperties(["hlx","hly"],[this.$x-a,this.$y-h])):(r=Math.sqrt(ifMath.ptSqrDist(this.$x,this.$y,s.getX(),s.getY())),a=(this.$y-s.getY())/r,h=(s.getX()-this.$x)/r,l=(u.$x+f.$x)/2,p=(u.$y+f.$y)/2,ifMath.segmentSide(this.$x,this.$y,l,p,u.$x,u.$y)!=ifMath.segmentSide(this.$x,this.$y,l,p,this.$x-a,this.$y-h)&&(a=-a,h=-h),o=Math.sqrt(ifMath.ptSqrDist(this.$x,this.$y,u.$x,u.$y))*g,this.setProperties(["hlx","hly"],[this.$x-a*o,this.$y-h*o]))}else this.setProperties(["hlx","hly"],[null,null]);if(c&&(c.$x!=this.$x||c.$y!=this.$y))if(c.$tp==e.AnchorPoint.Type.Symmetric||c.$tp==e.AnchorPoint.Type.Mirror){var y=t.getNextPoint(c);!y||c.$x==y.$x&&c.$y==y.$y?(n=this.$x+(c.$x-this.$x)*g,i=this.$y+(c.$y-this.$y)*g,this.setProperties(["hrx","hry"],[n,i])):null==(s=ifMath.getCircumcircleCenter(this.$x,this.$y,c.$x,c.$y,y.$x,y.$y))?(a=(this.$y-c.$y)*g,h=(c.$x-this.$x)*g,this.setProperties(["hrx","hry"],[this.$x-a,this.$y-h])):(r=Math.sqrt(ifMath.ptSqrDist(this.$x,this.$y,s.getX(),s.getY())),a=(this.$y-s.getY())/r,h=(s.getX()-this.$x)/r,l=(c.$x+y.$x)/2,p=(c.$y+y.$y)/2,ifMath.segmentSide(this.$x,this.$y,l,p,c.$x,c.$y)!=ifMath.segmentSide(this.$x,this.$y,l,p,this.$x+a,this.$y+h)&&(a=-a,h=-h),o=Math.sqrt(ifMath.ptSqrDist(this.$x,this.$y,c.$x,c.$y))*g,this.setProperties(["hrx","hry"],[this.$x+a*o,this.$y+h*o]))}else this.setProperties(["hrx","hry"],[null,null])}}},e.AnchorPoint.prototype.toString=function(){return"[Object IFPathBase.AnchorPoint]"},e.AnchorPoints=function(){this._flags|=IFNode.Flag.Shadow},IFObject.inheritAndMix(e.AnchorPoints,IFNode,[IFNode.Container]),e.AnchorPoints.prototype._dirtyPrev=null,e.AnchorPoints.prototype._dirtyNext=null,e.AnchorPoints.prototype.validateInsertion=function(t,n){return t instanceof e},e.AnchorPoints.prototype.validateRemoval=function(){return!1},e.AnchorPoints.prototype.serialize=function(){for(var t=[],e=this.getFirstChild();null!==e;e=e.getNext())t.push(e.serialize());return t},e.AnchorPoints.prototype.deserialize=function(t){for(var n=0;n<t.length;++n){var i=new e.AnchorPoint;i.deserialize(t[n]),this.appendChild(i)}},e.AnchorPoints.prototype._invalidateLeft=function(t){if(t&&((t.$ah||t.$tp==e.AnchorPoint.Type.Connector)&&t._invalidateCalculations(),t.$tp==e.AnchorPoint.Type.Symmetric||t.$tp==e.AnchorPoint.Type.Mirror)){var n=this.getPreviousPoint(t);n&&n.$ah&&n._invalidateCalculations()}},e.AnchorPoints.prototype._invalidateRight=function(t){if(t&&((t.$ah||t.$tp==e.AnchorPoint.Type.Connector)&&t._invalidateCalculations(),t.$tp==e.AnchorPoint.Type.Symmetric||t.$tp==e.AnchorPoint.Type.Mirror)){var n=this.getNextPoint(t);n&&n.$ah&&n._invalidateCalculations()}},e.AnchorPoints.prototype._generateVertices=function(t,n,i){var r,o,s,a;if(a=this.getFirstChild()){var h,l=this._parent;if(i&&a.$tp!=e.AnchorPoint.Type.Asymmetric&&a.$tp!=e.AnchorPoint.Type.Connector&&a.$tp!=e.AnchorPoint.Type.Symmetric&&a.$tp!=e.AnchorPoint.Type.Mirror&&l&&l.$closed&&a!=this.getLastChild()?(o=(r=this._getPathStartPt(n)).getX(),s=r.getY()):(o=(h=n?a._getTransformedCopy(n):a).$x,s=h.$y),t.addVertex(IFVertex.Command.Move,o,s),a!=this.getLastChild()){var p,u,c=a,g=a=a.getNext(),f=!1,y=this.getNextPoint(a);for(n&&(h=a._getTransformedCopy(n),p=c._getTransformedCopy(n));y&&(a!=g||!f);)f=!0,n?(u=y._getTransformedCopy(n),this._addMiddleVertices(t,h,p,u,i),p=h,h=u):this._addMiddleVertices(t,a,c,y,i),c=a,a=y,y=this.getNextPoint(y);y?t.addVertex(IFVertex.Command.Close,0,0):this._addPathEndVertices(t,n)}}},e.AnchorPoints.prototype._getPathStartPt=function(t){var n=this.getFirstChild(),i=this.getPreviousPoint(n),r=this.getNextPoint(n);return t&&(n=n._getTransformedCopy(t),r=r._getTransformedCopy(t),i=i._getTransformedCopy(t)),n.$cl&&n.$cr&&n.$tp!=e.AnchorPoint.Type.Asymmetric&&n.$tp!=e.AnchorPoint.Type.Connector&&n.$tp!=e.AnchorPoint.Type.Symmetric&&n.$tp!=e.AnchorPoint.Type.Mirror&&i&&(i.$tp!=e.AnchorPoint.Type.Connector||i.$x!=n.$x||i.$y!=n.$y)?this._getRightShoulderPoint(n,r):new IFPoint(n.$x,n.$y)},e.AnchorPoints.prototype._getShoulderPoint=function(t,e,n,i,r,o){var s,a,h=ifMath.ptDist(t,e,i,r),l=(a=null==n||n<=0?0:n)+(null==o||o<=0?0:o);return l<=0?null:(s=h>=l?a:h*a/l,ifMath.getPointAtLength(t,e,i,r,s))},e.AnchorPoints.prototype._getRightShoulderPoint=function(t,e,n){var i=null,r=null;return null!=t.$hrx?(i=t.$hrx,r=t.$hry):null!=e.$hlx&&(i=e.$hlx,r=e.$hly),null!=i?n?new IFPoint(i,r):ifMath.getPointAtLength(t.$x,t.$y,i,r,t.$cr):n?new IFPoint(e.$x,e.$y):this._getShoulderPoint(t.$x,t.$y,t.$cr,e.$x,e.$y,e.$cl)},e.AnchorPoints.prototype._getLeftShoulderPoint=function(t,e,n){var i=null,r=null;return null!=t.$hlx?(i=t.$hlx,r=t.$hly):null!=e.$hrx&&(i=e.$hrx,r=e.$hry),null!=i?n?new IFPoint(i,r):ifMath.getPointAtLength(t.$x,t.$y,i,r,t.$cl):n?new IFPoint(e.$x,e.$y):this._getShoulderPoint(t.$x,t.$y,t.$cl,e.$x,e.$y,e.$cr)},e.AnchorPoints.prototype._addMiddleVertices=function(t,n,i,r,o){var s,a,h=null,l=null,p=null,u=null;null!=n.$hlx&&null!=n.$hly&&null!=i.$hrx&&null!=i.$hry?(p=i.$hrx,u=i.$hry,h=n.$hlx,l=n.$hly):null!=n.$hlx&&null!=n.$hly?(p=n.$hlx,u=n.$hly):null!=i.$hrx&&null!=i.$hry&&(p=i.$hrx,u=i.$hry),o&&n.$tp!=e.AnchorPoint.Type.Asymmetric&&n.$tp!=e.AnchorPoint.Type.Connector&&n.$tp!=e.AnchorPoint.Type.Symmetric&&n.$tp!=e.AnchorPoint.Type.Mirror&&n.$cl&&n.$cr?(null==p?(s=this._getShoulderPoint(n.$x,n.$y,n.$cl,i.$x,i.$y,i.$cr),t.addVertex(IFVertex.Command.Line,s.getX(),s.getY())):null==h?(s=ifMath.getPointAtLength(n.$x,n.$y,p,u,n.$cl),t.addVertex(IFVertex.Command.Curve,s.getX(),s.getY()),t.addVertex(IFVertex.Command.Curve,p,u)):(s=ifMath.getPointAtLength(n.$x,n.$y,h,l,n.$cl),t.addVertex(IFVertex.Command.Curve2,s.getX(),s.getY()),t.addVertex(IFVertex.Command.Curve2,p,u),t.addVertex(IFVertex.Command.Curve2,h,l)),a=this._getRightShoulderPoint(n,r),this._addCornerToVertices(t,s.getX(),s.getY(),a.getX(),a.getY(),n.$x,n.$y,n.$tp)):null==p?t.addVertex(IFVertex.Command.Line,n.$x,n.$y):null==h?(t.addVertex(IFVertex.Command.Curve,n.$x,n.$y),t.addVertex(IFVertex.Command.Curve,p,u)):(t.addVertex(IFVertex.Command.Curve2,n.$x,n.$y),t.addVertex(IFVertex.Command.Curve2,p,u),t.addVertex(IFVertex.Command.Curve2,h,l))},e.AnchorPoints.prototype._addCornerToVertices=function(t,n,i,r,o,s,a,h){var l,p,u,c,g,f,y,d,_,v;n!=r||i!=o?n==s&&i==a||r==s&&o==a?t.addVertex(IFVertex.Command.Line,r,o):h==e.CornerType.Rounded||h==e.CornerType.InverseRounded?n==r&&n==s||i==o&&i==a?(t.addVertex(IFVertex.Command.Curve,r,o),t.addVertex(IFVertex.Command.Curve,s,a)):(h==e.CornerType.Rounded?(_=s,v=a):(_=n+r-s,v=i+o-a),t.addVertex(IFVertex.Command.Curve2,r,o),t.addVertex(IFVertex.Command.Curve2,n+(_-n)*e.AnchorPoint.BEST_CIRCLE_COEFF,i+(v-i)*e.AnchorPoint.BEST_CIRCLE_COEFF),t.addVertex(IFVertex.Command.Curve2,r+(_-r)*e.AnchorPoint.BEST_CIRCLE_COEFF,o+(v-o)*e.AnchorPoint.BEST_CIRCLE_COEFF)):h==e.CornerType.Fancy?(g=(s-n)/3,f=(a-i)/3,l=n+2*(u=(r-s)/3),p=i+2*(c=(o-a)/3),t.addVertex(IFVertex.Command.Line,l,p),l+=2*g,p+=2*f,t.addVertex(IFVertex.Command.Line,l,p),l-=u,p-=c,t.addVertex(IFVertex.Command.Line,l,p),l-=g,p-=f,t.addVertex(IFVertex.Command.Line,l,p),l+=2*u,p+=2*c,t.addVertex(IFVertex.Command.Line,l,p),l+=2*g,p+=2*f,t.addVertex(IFVertex.Command.Line,l,p)):h==e.CornerType.Bevel?t.addVertex(IFVertex.Command.Line,r,o):h==e.CornerType.Inset?(y=n+r-s,d=i+o-a,t.addVertex(IFVertex.Command.Line,y,d),t.addVertex(IFVertex.Command.Line,r,o)):(t.addVertex(IFVertex.Command.Line,s,a),t.addVertex(IFVertex.Command.Line,r,o)):s==n&&a==i||(t.addVertex(IFVertex.Command.Line,s,a),t.addVertex(IFVertex.Command.Line,r,o))},e.AnchorPoints.prototype._addPathEndVertices=function(t,e){var n,i,r=this.getLastChild(),o=r.getPrevious();e&&(r=r._getTransformedCopy(e),o=o._getTransformedCopy(e)),null!=r.$hlx&&null!=r.$hly&&null!=o.$hrx&&null!=o.$hry?(t.addVertex(IFVertex.Command.Curve2,r.$x,r.$y),t.addVertex(IFVertex.Command.Curve2,o.$hrx,o.$hry),t.addVertex(IFVertex.Command.Curve2,r.$hlx,r.$hly)):null!=r.$hlx&&null!=r.$hly||null!=o.$hrx&&null!=o.$hry?(null!=r.$hlx&&null!=r.$hly?(n=r.$hlx,i=r.$hly):(n=o.$hrx,i=o.$hry),t.addVertex(IFVertex.Command.Curve,r.$x,r.$y),t.addVertex(IFVertex.Command.Curve,n,i)):t.addVertex(IFVertex.Command.Line,r.$x,r.$y)},e.AnchorPoints.prototype._handleChange=function(t,n){var i=this._parent;if(i){var r,o,s,a,h=n;t==IFNode._Change.BeforeChildInsert?this.getParent()&&this.getParent().beginUpdate():t==IFNode._Change.AfterChildInsert?((r=this.getPreviousPoint(h))&&null!=r.$hrx&&h.$tp==e.AnchorPoint.Type.Connector&&(s=h.$x+(r.$x-h.$x)*e.AnchorPoint.HANDLE_COEFF,a=h.$y+(r.$y-h.$y)*e.AnchorPoint.HANDLE_COEFF,ifMath.isEqualEps(h.$x-s,0)&&ifMath.isEqualEps(h.$y-a,0)||h.setProperties(["hlx","hly"],[s,a])),(o=this.getNextPoint(h))&&null!=o.$hlx&&h.$tp==e.AnchorPoint.Type.Connector&&(s=h.$x+(o.$x-h.$x)*e.AnchorPoint.HANDLE_COEFF,a=h.$y+(o.$y-h.$y)*e.AnchorPoint.HANDLE_COEFF,ifMath.isEqualEps(h.$x-s,0)&&ifMath.isEqualEps(h.$y-a,0)||h.setProperties(["hrx","hry"],[s,a])),(h.$ah||h.$tp==e.AnchorPoint.Type.Connector)&&h._invalidateCalculations(),this._invalidateLeft(r),this._invalidateRight(o),this.getParent()&&this.getParent().endUpdate()):t==IFNode._Change.BeforeChildRemove?(this.getParent()&&this.getParent().beginUpdate(),this._dirtyPrev=this.getPreviousPoint(h),this._dirtyNext=this.getNextPoint(h)):t==IFNode._Change.AfterChildRemove&&(this._dirtyPrev&&this._invalidateLeft(this._dirtyPrev),this._dirtyNext&&this._invalidateRight(this._dirtyNext),this.getParent()&&this.getParent().endUpdate())}!i||t!=IFNode._Change.AfterChildInsert&&t!=IFNode._Change.AfterChildRemove||(i._notifyChange(IFElement._Change.PrepareGeometryUpdate),i._verticesDirty=!0,i._notifyChange(IFElement._Change.FinishGeometryUpdate)),IFNode.prototype._handleChange.call(this,t,n)},e.AnchorPoints.prototype.getNextPoint=function(t){var e=t?t.getNext():null;return!e&&this._parent&&this._parent.$closed&&t==this.getLastChild()&&(e=this.getFirstChild()),e},e.AnchorPoints.prototype.getPreviousPoint=function(t){var e=t?t.getPrevious():null;return!e&&this._parent&&this._parent.$closed&&t==this.getFirstChild()&&(e=this.getLastChild()),e},e.AnchorPoints.prototype.getLastRelatedPoint=function(t){var n=t,i=this.getNextPoint(t);if(i&&(n=i,i.$tp==e.AnchorPoint.Type.Symmetric||i.$tp==e.AnchorPoint.Type.Mirror)){var r=this.getNextPoint(i);r&&r.$ah&&r!=t&&(n=r)}return n},e.AnchorPoints.prototype.getFirstRelatedPoint=function(t){var n=t,i=this.getPreviousPoint(t);if(i&&(n=i,i.$tp==e.AnchorPoint.Type.Symmetric||i.$tp==e.AnchorPoint.Type.Mirror)){var r=this.getPreviousPoint(i);r&&r.$ah&&r!=t&&(n=r)}return n},e.AnchorPoints.prototype.toString=function(){return"[Object IFPathBase.AnchorPoints]"},e.prototype._vertices=null,e.prototype._verticesDirty=!1,e.prototype._anchorPoints=null,e.prototype.rewindVertices=function(t){return(this._verticesDirty||null==this._vertices||0==this._vertices.getCount())&&(this._vertices.clearVertices(),this._getAnchorPoints()._generateVertices(this._vertices,this.$trf,!0),this._verticesDirty=!1),this._vertices.rewindVertices(t)},e.prototype.readVertex=function(t){return this._vertices.readVertex(t)},e.prototype.store=function(t){return!!IFShape.prototype.store.call(this,t)&&(this.storeProperties(t,e.VisualProperties),!0)},e.prototype.restore=function(t){return!!IFShape.prototype.restore.call(this,t)&&(this.restoreProperties(t,e.VisualProperties),!0)},e.prototype._handleChange=function(t,n){if(this._handleVisualChangeForProperties(t,n,e.VisualProperties),t===IFNode._Change.AfterPropertiesChange)if(n.properties.indexOf("closed")>=0){var i=this._getAnchorPoints();i&&(i._invalidateRight(i.getFirstChild()),i._invalidateLeft(i.getLastChild())),this._verticesDirty=!0}else n.properties.indexOf("trf")>=0&&(this._verticesDirty=!0);IFShape.prototype._handleChange.call(this,t,n)},e.prototype._getAnchorPoints=function(){return this._anchorPoints},e.prototype.toString=function(){return"[IFPathBase]"},t.IFPathBase=e}(this),function(t){function e(){IFShape.call(this),this._setDefaultProperties(e.VisualProperties),this._image=new Image,this._image.onload=this._updatedImage.bind(this),this._image.onerror=this._updatedImage.bind(this),this._image.onabort=this._updatedImage.bind(this),this._updateImage()}IFNode.inheritAndMix("image",e,IFShape),e.VisualProperties={url:null},e.ImageStatus={Loaded:0,Resolving:1,Loading:2,Delayed:3,Error:10},e.NO_IMAGE_WIDTH=100,e.NO_IMAGE_HEIGHT=100,e.NO_IMAGE_BACKGROUND=new IFColor(IFColor.Type.RGB,[240,240,240,100]),e.NO_IMAGE_ERROR_STROKE=new IFColor(IFColor.Type.RGB,[255,0,0,100]),e.StatusEvent=function(t,e){this.image=t,this.status=e},IFObject.inherit(e.StatusEvent,GEvent),e.StatusEvent.prototype.image=null,e.StatusEvent.prototype.status=null,e.StatusEvent.prototype.toString=function(){return"[Event IFImage.StatusEvent]"},e.prototype._status=null,e.prototype._image=null,e.prototype._vertexIterator=0,e.prototype.getStatus=function(){return this._status},e.prototype.getImage=function(){return this._image},e.prototype.store=function(t){return!!IFShape.prototype.store.call(this,t)&&(this.storeProperties(t,e.VisualProperties),!0)},e.prototype.restore=function(t){return!!IFShape.prototype.restore.call(this,t)&&(this.restoreProperties(t,e.VisualProperties),this._updateImage(),!0)},e.prototype.rewindVertices=function(t){return this._vertexIterator=t,!0},e.prototype.readVertex=function(t){switch(this._vertexIterator){case 0:t.command=IFVertex.Command.Move,t.x=0,t.y=0;break;case 1:t.command=IFVertex.Command.Line,t.x=this._getWidth(),t.y=0;break;case 2:t.command=IFVertex.Command.Line,t.x=this._getWidth(),t.y=this._getHeight();break;case 3:t.command=IFVertex.Command.Line,t.x=0,t.y=this._getHeight();break;case 4:t.command=IFVertex.Command.Close;break;default:return!1}return t.command!==IFVertex.Command.Close&&this.$trf&&this.$trf.map(t),this._vertexIterator+=1,!0},e.prototype._paintBackground=function(t,e,n){e||t.configuration.isOutline(t)||this._paintImage(t),IFShape.prototype._paintBackground.call(this,t)},e.prototype._paintStyle=function(t,n,i){if(this._status===e.ImageStatus.Loaded){var r=t.canvas;t.canvas=r.createCanvas(n.getBBox(this.getGeometryBBox())),0===i&&this._paintImage(t);try{IFShape.prototype._paintStyle.call(this,t,n,i)}finally{this._paintImage(t,IFPaintCanvas.CompositeOperator.DestinationIn),r.drawCanvas(t.canvas),t.canvas=r}}else this._paintImage(t),IFShape.prototype._paintStyle.call(this,t,n,i)},e.prototype._detailHitTest=function(t,e,n,i){return new IFElement.HitResult(this)},e.prototype._handleChange=function(t,e){t==IFNode._Change.AfterPropertiesChange&&e.properties.indexOf("url")>=0&&this._updateImage(),IFShape.prototype._handleChange.call(this,t,e)},e.prototype._setScene=function(t){IFShape.prototype._setScene.call(this,t),this._scene&&this._status===e.ImageStatus.Delayed&&this._updateImage()},e.prototype._paintImage=function(t,n){var i=t.canvas.getTransform(!0);if(this.$trf){var r=i.preMultiplied(this.$trf);t.canvas.setTransform(r)}if(this._status===e.ImageStatus.Loaded)t.canvas.drawImage(this._image,0,0,!1,1,n);else{var o=this._getWidth(),s=this._getHeight();t.canvas.fillRect(0,0,o,s,e.NO_IMAGE_BACKGROUND),this._status===e.ImageStatus.Error&&(t.canvas.strokeLine(0,0,o,s,2,e.NO_IMAGE_ERROR_STROKE),t.canvas.strokeLine(o,0,0,s,2,e.NO_IMAGE_ERROR_STROKE))}t.canvas.setTransform(i)},e.prototype._getWidth=function(){return this._image.naturalWidth?this._image.naturalWidth:e.NO_IMAGE_WIDTH},e.prototype._getHeight=function(){return this._image.naturalHeight?this._image.naturalHeight:e.NO_IMAGE_HEIGHT},e.prototype._updateImage=function(){this.isAttached()?(this._setStatus(e.ImageStatus.Resolving),this._scene.resolveUrl(this.$url,this._resolvedImage.bind(this))):this._setStatus(e.ImageStatus.Delayed)},e.prototype._resolvedImage=function(t){this._setStatus(e.ImageStatus.Loading),this._notifyChange(IFElement._Change.InvalidationRequest),this._notifyChange(IFElement._Change.PrepareGeometryUpdate),this._image.src=t},e.prototype._updatedImage=function(){this._notifyChange(IFElement._Change.FinishGeometryUpdate),0!==this._image.naturalWidth&&0!==this._image.naturalHeight?this._setStatus(e.ImageStatus.Loaded):this._setStatus(e.ImageStatus.Error)},e.prototype._setStatus=function(t){t!==this._status&&(this._status=t,this.isAttached()&&this._scene.hasEventListeners(e.StatusEvent)&&this._scene.trigger(new e.StatusEvent(this,this._status)))},e.prototype.toString=function(){return"[IFImage]"},t.IFImage=e}(this),function(t){function e(){IFPathBase.call(this),this.$closed=!0,this._setDefaultProperties(e.GeometryProperties)}IFNode.inherit("polygon",e,IFPathBase),e.GeometryProperties={pts:6,cx:0,cy:0,or:0,ir:0,oa:0,ia:ifMath.PI2-Math.PI/3,oct:IFPathBase.CornerType.Rounded,ict:IFPathBase.CornerType.Rounded,ocr:0,icr:0},e.prototype.iterateSegments=function(t,e){for(var n=this.$oa+ifMath.PI2,i=ifMath.PI2/this.$pts,r=this.$ia-this.$oa,o=e?this.$trf:null,s=this.$oa;s<n-1e-6;s+=i){var a=new IFPoint(this.$or*Math.cos(s)+this.$cx,this.$or*Math.sin(s)+this.$cy);if(o&&(a=o.mapPoint(a)),!0===t(a,!1,s))break;if(a=new IFPoint(this.$ir*Math.cos(s+r)+this.$cx,this.$ir*Math.sin(s+r)+this.$cy),o&&(a=o.mapPoint(a)),!0===t(a,!0,s+r))break}},e.prototype.store=function(t){return!!IFPathBase.prototype.store.call(this,t)&&(this.storeProperties(t,e.GeometryProperties),!0)},e.prototype.restore=function(t){return!!IFPathBase.prototype.restore.call(this,t)&&(this.restoreProperties(t,e.GeometryProperties),this._invalidatePath(),!0)},e.prototype._handleChange=function(t,n){this._handleGeometryChangeForProperties(t,n,e.GeometryProperties)&&t==IFNode._Change.AfterPropertiesChange&&this._invalidatePath(),IFPathBase.prototype._handleChange.call(this,t,n)},e.prototype._invalidatePath=function(){var t=this._getAnchorPoints();this.beginUpdate(),t._beginBlockCompositeEvents(!0,!0,!0);try{t.clearChildren(),this.iterateSegments(function(e,n,i){var r=new IFPathBase.AnchorPoint;r.setProperties(["tp","x","y","cl","cr"],[n?this.$ict:this.$oct,e.getX(),e.getY(),n?this.$icr:this.$ocr,n?this.$icr:this.$ocr]),t.appendChild(r)}.bind(this))}finally{this.endUpdate(),t._endBlockCompositeEvents(!0,!0,!0)}},e.prototype.getCenter=function(t){var e=new IFPoint(this.$cx,this.$cy);return t&&this.$trf&&(e=this.$trf.mapPoint(e)),e},e.prototype.getOrigHalfWidth=function(){return this.$or>=this.$ir?this.$or:this.$ir},e.prototype.getOrigHalfHeight=function(){return this.$or>=this.$ir?this.$or:this.$ir},e.prototype.toString=function(){return"[IFPolygon]"},t.IFPolygon=e}(this),function(t){function e(){IFPathBase.call(this),this.$closed=!0,this._setDefaultProperties(e.GeometryProperties),this._invalidatePath()}IFNode.inherit("rectangle",e,IFPathBase),e.GeometryProperties={uf:!0,tl_uf:!0,tl_ct:IFPathBase.CornerType.Rounded,tl_sx:0,tl_sy:0,tr_uf:!0,tr_ct:IFPathBase.CornerType.Rounded,tr_sx:0,tr_sy:0,br_uf:!0,br_ct:IFPathBase.CornerType.Rounded,br_sx:0,br_sy:0,bl_uf:!0,bl_ct:IFPathBase.CornerType.Rounded,bl_sx:0,bl_sy:0},e.getGeometryPropertiesSidePrefix=function(t){switch(t){case IFRect.Side.TOP_LEFT:return"tl";case IFRect.Side.TOP_RIGHT:return"tr";case IFRect.Side.BOTTOM_RIGHT:return"br";case IFRect.Side.BOTTOM_LEFT:return"bl";default:throw new Error("Invalid side")}},e.SIDES=[IFRect.Side.TOP_LEFT,IFRect.Side.TOP_RIGHT,IFRect.Side.BOTTOM_RIGHT,IFRect.Side.BOTTOM_LEFT],e.prototype.iterateSegments=function(t,n){for(var i=n?this.$trf:null,r=0;r<e.SIDES.length;++r){var o=e.SIDES[r],s=e.getGeometryPropertiesSidePrefix(o),a=null;switch(o){case IFRect.Side.TOP_LEFT:a=new IFPoint(-1,-1);break;case IFRect.Side.TOP_RIGHT:a=new IFPoint(1,-1);break;case IFRect.Side.BOTTOM_RIGHT:a=new IFPoint(1,1);break;case IFRect.Side.BOTTOM_LEFT:a=new IFPoint(-1,1)}if(i&&(a=i.mapPoint(a)),!0===t(a,o,this["$"+s+"_ct"],this["$"+s+"_sx"],this["$"+s+"_sy"],r))break}},e.prototype.store=function(t){if(IFPathBase.prototype.store.call(this,t)){if(this.$uf)t.uf=!0,t.ct=this.$tl_ct,t.sl=this.$tl_sx;else for(var n=0;n<e.SIDES.length;++n){var i=e.SIDES[n],r=e.getGeometryPropertiesSidePrefix(i);t[r+"uf"]=this["$"+r+"_uf"],t[r+"ct"]=this["$"+r+"_ct"],t[r+"sl"]=[this["$"+r+"_sx"],this["$"+r+"_sy"]]}return!0}return!1},e.prototype.restore=function(t){if(IFPathBase.prototype.restore.call(this,t)){for(var n=0;n<e.SIDES.length;++n){var i=e.SIDES[n],r=e.getGeometryPropertiesSidePrefix(i);this.$uf=t.uf,this["$"+r+"_uf"]=t.uf?t.uf:t[r+"uf"],this["$"+r+"_ct"]=t.uf?t.ct:t[r+"ct"],this["$"+r+"_sx"]=t.uf?t.sl:t[r+"sl"][0],this["$"+r+"_sy"]=t.uf?t.sl:t[r+"sl"][1]}return this._invalidatePath(),!0}return!1},e.prototype.getAnchorPoints=function(){return this._getAnchorPoints()},e.prototype._handleChange=function(t,n){if(this._handleGeometryChangeForProperties(t,n,e.GeometryProperties)&&t==IFNode._Change.AfterPropertiesChange){var i=[],r=[],o=n.properties,s=n.values;if(this.$uf){for(var a=null,h=null,l=!1,p=!1,u=0;u<e.SIDES.length&&(!l||!p);++u){var c=e.SIDES[u],g=e.getGeometryPropertiesSidePrefix(c);if(!l){var f=g+"_sx";if((y=o.indexOf(f))>=0)a=s[y],l=!0;else{f=g+"_sy";(y=o.indexOf(f))>=0&&(a=s[y],l=!0)}}if(!p){f=g+"_ct";(y=o.indexOf(f))>=0&&(h=s[y],p=!0)}}l||(a=this.getProperty("tl_sx")),p||(h=this.getProperty("tl_ct")),i.push("tl_uf","tr_uf","br_uf","bl_uf"),r.push(!0,!0,!0,!0),i.push("tl_sx","tl_sy","tr_sx","tr_sy","br_sx","br_sy","bl_sx","bl_sy"),r.push(a,a,a,a,a,a,a,a),i.push("tl_ct","tr_ct","br_ct","bl_ct"),r.push(h,h,h,h)}else for(u=0;u<e.SIDES.length;++u){c=e.SIDES[u],a=null,l=!1;if(this["$"+(g=e.getGeometryPropertiesSidePrefix(c))+"_uf"]){f=g+"_sx";if((y=o.indexOf(f))>=0)a=s[y],l=!0;else{var y;f=g+"_sy";(y=o.indexOf(f))>=0&&(a=s[y],l=!0)}l||(a=this.getProperty(g+"_sx")),i.push(g+"_sx"),r.push(a),i.push(g+"_sy"),r.push(a)}}this.setProperties(i,r)||this._invalidatePath()}IFPathBase.prototype._handleChange.call(this,t,n)},e.prototype._invalidatePath=function(){var t=this._getAnchorPoints();this.beginUpdate(),t._beginBlockCompositeEvents(!0,!0,!0);try{t.clearChildren(),this.iterateSegments(function(e,n,i,r,o){var s=new IFPathBase.AnchorPoint;s.setProperties(["tp","x","y","cl","cr","cu"],[i,e.getX(),e.getY(),r,o,!1]),t.appendChild(s)}.bind(this))}finally{this.endUpdate(),t._endBlockCompositeEvents(!0,!0,!0)}},e.prototype.toString=function(){return"[IFRectangle]"},t.IFRectangle=e}(this),function(t){function e(){IFPathBase.call(this),this._setDefaultProperties(e.GeometryProperties),this._invalidatePath()}IFNode.inherit("ellipse",e,IFPathBase),e.Type={Pie:0,Chord:1,Arc:2},e.GeometryProperties={sa:Math.PI,ea:Math.PI,etp:e.Type.Pie},e.prototype.store=function(t){return!!IFPathBase.prototype.store.call(this,t)&&(this.storeProperties(t,e.GeometryProperties),!0)},e.prototype.restore=function(t){return!!IFPathBase.prototype.restore.call(this,t)&&(this.restoreProperties(t,e.GeometryProperties),this._invalidatePath(),!0)},e.prototype._handleChange=function(t,n){this._handleGeometryChangeForProperties(t,n,e.GeometryProperties)&&t==IFNode._Change.AfterPropertiesChange&&this._invalidatePath(),IFPathBase.prototype._handleChange.call(this,t,n)},e.prototype._invalidatePath=function(){var t=this._getAnchorPoints();this.beginUpdate(),t._beginBlockCompositeEvents(!0,!0,!0);try{var n;for(t.clearChildren(),n=Math.PI/2;n<=this.$sa||ifMath.isEqualEps(n,this.$sa);n+=Math.PI/2);var i=new IFPathBase.AnchorPoint;i.setProperties(["x","y","tp","ah"],[Math.cos(this.$sa),Math.sin(this.$sa),IFPathBase.AnchorPoint.Type.Symmetric,!0]),t.appendChild(i);var r=ifMath.isEqualEps(this.$sa,this.$ea)?this.$sa+ifMath.PI2:this.$ea;for(r<this.$sa&&(r+=ifMath.PI2);n<r&&!ifMath.isEqualEps(n,r);n+=Math.PI/2)(i=new IFPathBase.AnchorPoint).setProperties(["x","y","tp","ah"],[Math.cos(n),Math.sin(n),IFPathBase.AnchorPoint.Type.Symmetric,!0]),t.appendChild(i);ifMath.isEqualEps(this.$sa+ifMath.PI2,r)||((i=new IFPathBase.AnchorPoint).setProperties(["x","y","tp","ah"],[Math.cos(r),Math.sin(r),IFPathBase.AnchorPoint.Type.Symmetric,!0]),t.appendChild(i));var o=null;t.getFirstChild().getNext()==t.getLastChild()&&(i=new IFPathBase.AnchorPoint,ifMath.isEqualEps(n,r)&&(n+=Math.PI/2),i.setProperties(["x","y","tp","ah"],[Math.cos(n),Math.sin(n),IFPathBase.AnchorPoint.Type.Symmetric,!0]),t.appendChild(i),o=i),this.setProperty("closed",!0);for(var s=t.getFirstChild();null!=s;s=s.getNext())s.setProperty("ah",!1);o&&t.removeChild(o),ifMath.isEqualEps(this.$sa+ifMath.PI2,r)||(t.getFirstChild().setProperties(["tp","hlx","hly"],[IFPathBase.AnchorPoint.Type.Asymmetric,null,null]),t.getLastChild().setProperties(["tp","hrx","hry"],[IFPathBase.AnchorPoint.Type.Asymmetric,null,null]),this.$etp==e.Type.Pie?(i=new IFPathBase.AnchorPoint,t.appendChild(i)):this.$etp==e.Type.Arc&&this.setProperty("closed",!1))}finally{this.endUpdate(),t._endBlockCompositeEvents(!0,!0,!0)}},e.prototype.toString=function(){return"[IFEllipse]"},t.IFEllipse=e}(this),function(t){function e(t,n,i){IFPathBase.call(this,t,n,i),this._setDefaultProperties(e.GeometryProperties)}IFNode.inherit("path",e,IFPathBase),e.GeometryProperties={closed:!1},e.prototype.getAnchorPoints=function(){return this._getAnchorPoints()},e.prototype.store=function(t){return!!IFPathBase.prototype.store.call(this,t)&&(this.storeProperties(t,e.GeometryProperties),t.pts=this.getAnchorPoints().serialize(),!0)},e.prototype.restore=function(t){return!!IFPathBase.prototype.restore.call(this,t)&&(this.restoreProperties(t,e.GeometryProperties),t.hasOwnProperty("pts")&&this.getAnchorPoints().deserialize(t.pts),!0)},e.prototype.clone=function(){for(var t=IFPathBase.prototype.clone.call(this),e=this.getAnchorPoints().queryAll(":selected"),n=0;n<e.length;++n){var i=this.getAnchorPoints().getIndexOfChild(e[n]),r=t.getAnchorPoints().getChildByIndex(i);r&&r.setFlag(IFNode.Flag.Selected)}return t},e.prototype.pathHitTest=function(t,e,n,i){i=i||0;var r=t,o=1;e&&(r=(s=e.inverted()).mapPoint(t),o*=s.getScaleFactor());var s,a=null;this.$trf&&(a=this.$trf,this.$trf=null,r=(s=a.inverted()).mapPoint(r),o*=s.getScaleFactor());var h=new IFVertexContainer;this._getAnchorPoints()._generateVertices(h,this.$trf,!1);var l=new IFVertexInfo.HitResult,p=null,u=o+2*i;return ifVertexInfo.hitTest(r.getX(),r.getY(),h,u,!!this.$closed&&n,l)&&(p=new IFElement.HitResult(this,l)),a&&(this.$trf=a),p},e.prototype.insertHitPoint=function(t){if(!t||!t.slope||ifMath.isEqualEps(t.slope,0)||ifMath.isEqualEps(t.slope,1))return null;for(var n=t.slope,i=1,r=this.getAnchorPoints().getFirstChild();null!=r&&i<t.segment;)r=r.getNext(),i++;var o=r,s=o?this.getAnchorPoints().getNextPoint(o):null;if(o&&s){this.beginUpdate(),o.setProperty("ah",!1),s.setProperty("ah",!1);var a,h=o.getProperty("tp"),l=s.getProperty("tp");a=h==IFPathBase.AnchorPoint.Type.Connector||h==IFPathBase.AnchorPoint.Type.Symmetric||h==IFPathBase.AnchorPoint.Type.Mirror||l==IFPathBase.AnchorPoint.Type.Connector||l==IFPathBase.AnchorPoint.Type.Symmetric||l==IFPathBase.AnchorPoint.Type.Mirror||h==IFPathBase.AnchorPoint.Type.Asymmetric&&l==IFPathBase.AnchorPoint.Type.Asymmetric?IFPathBase.AnchorPoint.Type.Asymmetric:h!=IFPathBase.AnchorPoint.Type.Symmetric&&h!=IFPathBase.AnchorPoint.Type.Mirror&&h!=IFPathBase.AnchorPoint.Type.Connector&&h!=IFPathBase.AnchorPoint.Type.Asymmetric?h:l;var p,u,c,g,f,y,d,_,v=null;p=o.getProperty("x"),f=o.getProperty("y"),u=o.getProperty("hrx"),y=o.getProperty("hry"),g=s.getProperty("x"),_=s.getProperty("y"),c=s.getProperty("hlx"),d=s.getProperty("hly");var m=null==u||null==y||ifMath.isEqualEps(u,p)&&ifMath.isEqualEps(y,f),I=null==c||null==d||ifMath.isEqualEps(c,g)&&ifMath.isEqualEps(d,_);if(m&&I)(v=new e.AnchorPoint).setProperties(["x","y","tp"],[p+n*(g-p),f+n*(_-f),a]),this.getAnchorPoints().insertChild(v,s);else if(m||I){var P=m?c:u,C=m?d:y,F=new Float64Array(3),x=new Float64Array(3),S=new Float64Array(3),E=new Float64Array(3);ifMath.divideQuadraticCurve(p,P,g,n,F,S),ifMath.divideQuadraticCurve(f,C,_,n,x,E),(v=new e.AnchorPoint).setProperties(["x","y","tp"],[F[2],x[2],a]),this.getAnchorPoints().insertChild(v,s),m?(ifMath.isEqualEps(F[1],F[2])&&ifMath.isEqualEps(x[1],x[2])?v.setProperties(["hlx","hly"],[null,null]):v.setProperties(["hlx","hly"],[F[1],x[1]]),u=S[0]+2/3*(S[1]-S[0]),y=E[0]+2/3*(E[1]-E[0]),c=S[2]+2/3*(S[1]-S[2]),d=E[2]+2/3*(E[1]-E[2]),ifMath.isEqualEps(u,S[0])&&ifMath.isEqualEps(y,E[0])?v.setProperties(["hrx","hry"],[null,null]):v.setProperties(["hrx","hry"],[u,y]),ifMath.isEqualEps(c,S[2])&&ifMath.isEqualEps(d,E[2])?s.setProperties(["hlx","hly"],[null,null]):s.setProperties(["hlx","hly"],[c,d])):(ifMath.isEqualEps(S[0],S[1])&&ifMath.isEqualEps(E[0],E[1])?v.setProperties(["hrx","hry"],[null,null]):v.setProperties(["hrx","hry"],[S[1],E[1]]),u=F[0]+2/3*(F[1]-F[0]),y=x[0]+2/3*(x[1]-x[0]),c=F[2]+2/3*(F[1]-F[2]),d=x[2]+2/3*(x[1]-x[2]),ifMath.isEqualEps(c,F[2])&&ifMath.isEqualEps(d,x[2])?v.setProperties(["hlx","hly"],[null,null]):v.setProperties(["hlx","hly"],[c,d]),ifMath.isEqualEps(u,F[0])&&ifMath.isEqualEps(y,x[0])?o.setProperties(["hrx","hry"],[null,null]):o.setProperties(["hrx","hry"],[u,y]))}else{F=new Float64Array(4),x=new Float64Array(4),S=new Float64Array(4),E=new Float64Array(4);ifMath.getCtrlPtsCasteljau(p,u,c,g,n,1,F),ifMath.getCtrlPtsCasteljau(f,y,d,_,n,1,x),ifMath.getCtrlPtsCasteljau(p,u,c,g,n,2,S),ifMath.getCtrlPtsCasteljau(f,y,d,_,n,2,E),ifMath.isEqualEps(F[1],p)&&ifMath.isEqualEps(x[1],f)?o.setProperties(["hrx","hry"],[null,null]):o.setProperties(["hrx","hry"],[F[1],x[1]]),(v=new e.AnchorPoint).setProperties(["x","y","tp"],[F[3],x[3],a]),this.getAnchorPoints().insertChild(v,s),ifMath.isEqualEps(F[2],F[3])&&ifMath.isEqualEps(x[2],x[3])?v.setProperties(["hlx","hly"],[null,null]):v.setProperties(["hlx","hly"],[F[2],x[2]]),ifMath.isEqualEps(S[0],S[1])&&ifMath.isEqualEps(E[0],E[1])?v.setProperties(["hrx","hry"],[null,null]):v.setProperties(["hrx","hry"],[S[1],E[1]]),ifMath.isEqualEps(S[2],S[3])&&ifMath.isEqualEps(E[2],E[3])?s.setProperties(["hlx","hly"],[null,null]):s.setProperties(["hlx","hly"],[S[2],E[2]])}return this.endUpdate(),v}return null},e.prototype._handleChange=function(t,n){IFPathBase.prototype._handleChange.call(this,t,n),this._handleGeometryChangeForProperties(t,n,e.GeometryProperties),this._handleGeometryChangeForProperties(t,n,IFPathBase.GeometryProperties)},e.prototype.toString=function(){return"[IFPath]"},t.IFPath=e}(this),function(t){function e(){IFShape.call(this),this._setDefaultProperties(e.GeometryProperties),this._runs=[],this._runsDirty=!1}IFNode.inherit("text",e,IFShape),e.VerticalAlign={Top:"t",Middle:"m",Bottom:"b"},e.GeometryProperties={aw:!0,ah:!0,va:e.VerticalAlign.Top},e.Chunk=function(t){IFNode.call(this),this._content=t},IFNode.inheritAndMix("txChk",e.Chunk,IFNode,[IFNode.Store]),e.Chunk.prototype._content=null,e.Chunk.prototype.getContent=function(){return this._content},e.Chunk.prototype.store=function(t){return!!IFNode.Store.prototype.store.call(this,t)&&(t.cnt=this._content,!0)},e.Chunk.prototype.restore=function(t){return!!IFNode.Store.prototype.restore.call(this,t)&&(this._content=t.cnt,!0)},e.Chunk.prototype.validateInsertion=function(t,n){return t instanceof e.Block},e.Break=function(){IFNode.call(this)},IFNode.inheritAndMix("txBrk",e.Break,IFNode,[IFNode.Store]),e.Break.prototype.validateInsertion=function(t,n){return t instanceof e.Block},e.Block=function(){this._setDefaultProperties(e.Block.Properties)},IFObject.inheritAndMix(e.Block,IFNode,[IFNode.Properties,IFNode.Store]),e.Block.Properties={ff:null,fi:null,fw:null,fs:null,fc:null,cs:null,ws:null},e.Block.propertyToCss=function(t,e,n){if("ff"===t)n["font-family"]=null!==e?e:"";else if("fi"===t)n["font-size"]=null!==e?e+"px":"";else if("fw"===t)n["font-weight"]=null!==e?e.toString():"";else if("fs"===t)if(null===e)n["font-style"]="";else switch(e){case IFFont.Style.Normal:n["font-style"]="normal";break;case IFFont.Style.Italic:n["font-style"]="italic"}else if("fc"===t)n.color=null!==e?e.asCSSString():"";else if("cs"===t)n["letter-spacing"]=null!==e?e+"px":"";else{if("ws"!==t)throw new Error("Unimplemented property (propertyToCss): "+t);n["word-spacing"]=null!==e?e+"px":""}},e.Block.cssToProperty=function(t,e){if("ff"===t){if(e["font-family"]){var n=e["font-family"];if(n.length>0)return n.indexOf(",")>=0&&(n=n.substr(0,n.indexOf(",")).trim()),'"'!==n.charAt(0)&&"'"!==n.charAt(0)||(n=n.substr(1)),'"'!==n.charAt(n.length-1)&&"'"!==n.charAt(n.length-1)||(n=n.substr(0,n.length-1)),n}}else if("fi"===t){var i=parseFloat(e["font-size"]);if(!isNaN(i))return i}else if("fw"===t){i=parseInt(e["font-weight"]);if(!isNaN(i))return i;if("normal"===(i=e["font-weight"]))return IFFont.Weight.Regular;if("bold"===i)return IFFont.Weight.Bold}else if("fs"===t){if("normal"===e["font-style"])return IFFont.Style.Normal;if("italic"===e["font-style"])return IFFont.Style.Italic}else if("fc"===t){if(i=IFColor.parseCSSColor(e.color))return i}else if("cs"===t){i=parseFloat(e["letter-spacing"]);if(!isNaN(i))return i}else{if("ws"!==t)throw new Error("Unimplemented property (cssToProperty): "+t);i=parseFloat(e["word-spacing"]);if(!isNaN(i))return i}return null},e.Block.prototype.getText=function(){for(var t=this.getParent();null!==t;t=t.getParent())if(t instanceof e)return t;return null},e.Block.prototype.validateInsertion=function(t,n){return t instanceof e.Block},e.Block.prototype.store=function(t){return!!IFNode.Store.prototype.store.call(this,t)&&(this.storeProperties(t,e.Block.Properties),!0)},e.Block.prototype.restore=function(t){return!!IFNode.Store.prototype.restore.call(this,t)&&(this.restoreProperties(t,e.Block.Properties),!0)},e.Block.prototype._handleChange=function(t,n){var i=this.getText();i&&(i._handleGeometryChangeForProperties(t,n,e.Block.Properties)&&t==IFNode._Change.BeforePropertiesChange?i._runsDirty=!0:t==IFNode._Change.BeforeChildInsert||t==IFNode._Change.BeforeChildRemove?i.beginUpdate():t!=IFNode._Change.AfterChildInsert&&t!=IFNode._Change.AfterChildRemove||(i._runsDirty=!0,i.endUpdate())),IFNode.prototype._handleChange.call(this,t,n)},e.Block.prototype.propertiesToCss=function(t){return this._propertiesToCss(t,e.Block.Properties,e.Block.propertyToCss)},e.Block.prototype.cssToProperties=function(t){this._cssToProperties(t,e.Block.Properties,e.Block.cssToProperty)},e.Block.prototype._propertiesToCss=function(t,e,n){for(var i in e){var r=this.getProperty(i);null!==r&&n(i,r,t)}return t},e.Block.prototype._cssToProperties=function(t,e,n){var i=[],r=[];for(var o in e){var s=n(o,t);i.push(o),r.push(s)}i.length>0&&this.setProperties(i,r)},e.Span=function(){e.Block.call(this),this._setDefaultProperties(e.Span.Properties)},IFNode.inheritAndMix("txSpan",e.Span,e.Block,[IFNode.Container]),e.Span.prototype.validateInsertion=function(t,n){return t instanceof e.Paragraph||t instanceof e.Span},e.Paragraph=function(){e.Block.call(this),this._setDefaultProperties(e.Paragraph.Properties)},IFNode.inheritAndMix("txPara",e.Paragraph,e.Block,[IFNode.Container]),e.Paragraph.Alignment={Left:"l",Center:"c",Right:"r",Justify:"j"},e.Paragraph.WrapMode={None:"n",Words:"w",All:"a"},e.Paragraph.Properties={cc:null,cg:null,wm:null,al:null,in:null,lh:null},e.Paragraph.propertyToCss=function(t,n,i){if("cc"===t)n=null!==n?n:"",i["column-count"]=n,i["-webkit-column-count"]=n,i["-moz-column-count"]=n;else if("cg"===t)n=null!==n?n:"",i["column-gap"]=n,i["-webkit-column-gap"]=n,i["-moz-column-gap"]=n;else if("wm"===t)if(null===n)i["white-space"]="",i["word-break"]="";else switch(n){case e.Paragraph.WrapMode.None:i["white-space"]="nowrap";break;case e.Paragraph.WrapMode.Words:i["white-space"]="pre-wrap";break;case e.Paragraph.WrapMode.All:i["white-space"]="pre-wrap",i["word-break"]="break-all"}else if("al"===t)if(null===n)i["text-align"]="";else switch(n){case e.Paragraph.Alignment.Left:i["text-align"]="left";break;case e.Paragraph.Alignment.Center:i["text-align"]="center";break;case e.Paragraph.Alignment.Right:i["text-align"]="right";break;case e.Paragraph.Alignment.Justify:i["text-align"]="justify"}else if("in"===t)i["text-indent"]=null!==n?n+"px":"";else{if("lh"!==t)throw new Error("Unimplemented property (propertyToCss): "+t);i["line-height"]=null!==n?n:""}},e.Paragraph.cssToProperty=function(t,n){if("cc"===t){var i=n["column-count"]||n["-webkit-column-count"]||n["-moz-column-count"],r=parseInt(i);if(!isNaN(r))return r}else if("cg"===t){i=n["column-gap"]||n["-webkit-column-gap"]||n["-moz-column-gap"],r=parseFloat(i);if(!isNaN(r))return r}else if("wm"===t){var o=n["white-space"],s=n["word-break"];if("pre-wrap"===o)return"break-all"===s?e.Paragraph.WrapMode.All:e.Paragraph.WrapMode.Words;if("nowrap"===o)return e.Paragraph.WrapMode.None}else if("al"===t){if("left"===r)return e.Paragraph.Alignment.Left;if("center"===r)return e.Paragraph.Alignment.Center;if("right"===r)return e.Paragraph.Alignment.Right;if("justify"===r)return e.Paragraph.Alignment.Justify}else if("in"===t){r=parseFloat(n["text-indent"]);if(!isNaN(r))return r}else{if("lh"!==t)throw new Error("Unimplemented property (cssToProperty): "+t);var a=parseFloat(n["line-height"]);if(!isNaN(a))return a}return null},e.Paragraph.prototype._handleChange=function(t,n){var i=this.getText();i&&i._handleGeometryChangeForProperties(t,n,e.Paragraph.Properties)&&t==IFNode._Change.BeforePropertiesChange&&(i._runsDirty=!0),e.Block.prototype._handleChange.call(this,t,n)},e.Paragraph.prototype.validateInsertion=function(t,n){return t instanceof e.Content},e.Paragraph.prototype.store=function(t){return!!e.Block.prototype.store.call(this,t)&&(this.storeProperties(t,e.Paragraph.Properties),!0)},e.Paragraph.prototype.restore=function(t){return!!e.Block.prototype.restore.call(this,t)&&(this.restoreProperties(t,e.Paragraph.Properties),!0)},e.Paragraph.prototype.propertiesToCss=function(t){return this._propertiesToCss(t,e.Paragraph.Properties,e.Paragraph.propertyToCss),e.Block.prototype.propertiesToCss.call(this,t)},e.Paragraph.prototype.cssToProperties=function(t){this._cssToProperties(t,e.Paragraph.Properties,e.Paragraph.cssToProperty),e.Block.prototype.cssToProperties.call(this,t)},e.Content=function(){e.Paragraph.call(this),this._flags|=IFNode.Flag.Shadow,this.$ff="Open Sans",this.$fi=20,this.$fw=IFFont.Weight.Regular,this.$fs=IFFont.Style.Normal,this.$lh=1,this.$wm=e.Paragraph.WrapMode.All},IFNode.inherit("txContent",e.Content,e.Paragraph),e.Content.prototype.validateInsertion=function(t,n){return t instanceof e},e.Content.prototype.propertiesToCss=function(t){this._parent;return t.color="black",e.Paragraph.prototype.propertiesToCss.call(this,t)},e.prototype._content=null,e.prototype._size=null,e.prototype._runs=null,e.prototype._runsDirty=!1,e.prototype._runItIndex=null,e.prototype._runItOutline=null,e.prototype.getContent=function(){if(this._content&&this._content.getParent()!==this&&(this._content=null),!this._content){for(var t=this.getFirstChild(!0);null!==t;t=t.getNext(!0))if(t instanceof e.Content){this._content=t;break}this._content||(this._content=new e.Content,this.appendChild(this._content))}return this._content},e.prototype.getContentBBox=function(){return this._size?new IFRect(0,0,this._size.getX(),this._size.getY()):null},e.prototype.asHtml=function(t){var e=$("<div></div>");return this._asHtml(e,this.getContent(),t),e.html()},e.prototype.fromHtml=function(t){this.beginUpdate();try{var e=this.getContent();if(e.clearChildren(!0),t&&""!==t){var n=document.createElement("div");n.innerHTML=t;for(var i=n.firstChild;null!==i;i=i.nextSibling)this._fromHtml(i,e)}}finally{this.endUpdate()}},e.prototype.store=function(t){return!!IFShape.prototype.store.call(this,t)&&(this.storeProperties(t,e.GeometryProperties),!0)},e.prototype.restore=function(t){return!!IFShape.prototype.restore.call(this,t)&&(this.restoreProperties(t,e.GeometryProperties),this._runsDirty=!0,!0)},e.prototype.rewindVertices=function(t){if(this._runsDirty||null==this._runs){this._runs=[];var n=IFRect.fromPoints(new IFPoint(0,0),new IFPoint(1,1));this.$trf&&(n=this.$trf.mapRect(n));var i=$("<div></div>").addClass("contenteditable").css(this.getContent().propertiesToCss({})).css({position:"absolute",top:"0px",left:"0px",visibility:"hidden",width:n.getWidth()>1&&!this.$aw?n.getWidth()+"px":"",height:n.getHeight()>1&&this.$ah?n.getHeight()+"px":""}).html(this.asHtml(!0)).appendTo($("body")),r=null,o=null;i.find("p,span").each(function(t,e){var n=$(e),i=n.offset(),s=n.outerWidth(),a=n.outerHeight();(null===r||i.left+s>r)&&(r=i.left+s),(null===o||i.top+a>o)&&(o=i.top+a)}.bind(this)),this._size=null!==r&&null!==o?new IFPoint(r,o):null;var s=0;if(!this.$ah&&this._size&&this._size.getY()<n.getHeight())switch(this.$va){case e.VerticalAlign.Middle:s=(n.getHeight()-this._size.getY())/2;break;case e.VerticalAlign.Bottom:s=n.getHeight()-this._size.getY()}i.find("span:not(:has(span))").each(function(t,i){var r=$(i),o=i.getBoundingClientRect(),a=r.text();if(0!==a.length){var h=a[0];if(!(o.height<=0||o.width<=0||" "===h||h>="\0"&&h<="")){var l={"font-family":r.css("font-family"),"font-size":r.css("font-size"),"font-style":r.css("font-style"),"font-weight":r.css("font-weight")},p=e.Block.cssToProperty("ff",l),u=e.Block.cssToProperty("fi",l),c=e.Block.cssToProperty("fs",l),g=e.Block.cssToProperty("fw",l),f=ifFont.getVariant(p,c,g),y=ifFont.getGlyphBaseline(p,f,u,h);this._runs.push({x:n.getX()+o.left,y:n.getY()+o.top+s+y,char:h,family:p,variant:f,size:u})}}}.bind(this)),i.remove(),this._runsDirty=!1}return!!(this._runs&&this._runs.length>0)&&(this._runItIndex=0,this._runItOutline=null,!0)},e.prototype.readVertex=function(t){if(this._runItOutline){if(this._runItOutline.readVertex(t))return!0;if(this._runItOutline=null,++this._runItIndex>=this._runs.length)return!1}if(!this._runItOutline){var e=this._runs[this._runItIndex];if(!e)return!1;if(this._runItOutline=ifFont.getGlyphOutline(e.family,e.variant,e.size,e.x,e.y,e.char),!this._runItOutline.rewindVertices(0))throw new Error("Unexpected end of outline");return this._runItOutline.readVertex(t)}},e.prototype._calculateGeometryBBox=function(){if(this.rewindVertices(0),!this._size)return null;var t=IFRect.fromPoints(new IFPoint(0,0),new IFPoint(1,1));this.$trf&&(t=this.$trf.mapRect(t));var e=this.$aw?this._size.getX():t.getWidth(),n=this.$ah?this._size.getY():t.getHeight();return new IFRect(t.getX(),t.getY(),e,n)},e.prototype._preparePaint=function(t){if(IFShape.prototype._preparePaint.call(this,t)){var e=this._getClipBox(t);return e&&t.canvas.clipRect(e.getX(),e.getY(),e.getWidth(),e.getHeight()),!0}return!1},e.prototype._finishPaint=function(t){null!==this._getClipBox(t)&&t.canvas.resetClip(),IFShape.prototype._finishPaint.call(this,t)},e.prototype._detailHitTest=function(t,e,n,i){return new IFElement.HitResult(this)},e.prototype._handleChange=function(t,n){(IFShape.prototype._handleChange.call(this,t,n),this._handleGeometryChangeForProperties(t,n,e.GeometryProperties)&&t==IFNode._Change.BeforePropertiesChange&&(this._runsDirty=!0),t===IFNode._Change.BeforePropertiesChange)&&(n.properties.indexOf("trf")>=0&&!this._runsDirty&&(this._runsDirty=!0))},e.prototype._getClipBox=function(t){var e=this.getGeometryBBox();return this._size&&(!this.$aw&&this._size.getX()>=e.getWidth()||!this.$ah&&this._size.getY()>=e.getHeight())?new IFRect(e.getX(),e.getY(),this.$aw?t.canvas.getWidth():e.getWidth(),this.$ah?t.canvas.getHeight():e.getHeight()):null},e.prototype._asHtml=function(t,n,i){if(n instanceof e.Break)$("<br>").appendTo(t);else if(n instanceof e.Chunk){var r=n.getContent();if(r&&""!==r)if(i)for(var o=0;o<r.length;++o)$("<span></span>").text(r[o]).appendTo(t);else t.append(document.createTextNode(r))}else n instanceof e.Content||(n instanceof e.Paragraph?t=$("<p></p>").css("margin","0px").css(n.propertiesToCss({})).appendTo(t):n instanceof e.Span&&(t=$("<span></span>").css(n.propertiesToCss({})).appendTo(t)));if(n.hasMixin(IFNode.Container))for(var s=n.getFirstChild();null!==s;s=s.getNext())this._asHtml(t,s,i)},e.prototype._fromHtml=function(t,n){if(1===t.nodeType){var i=t.nodeName.toLowerCase();if("p"===i||"div"===i){var r=new e.Paragraph;r.cssToProperties(t.style),n.appendChild(r),n=r}else{if("span"!==i&&"b"!==i&&"strong"!==i&&"i"!==i)return"br"===i?void n.appendChild(new e.Break):void 0;var o=new e.Span;o.cssToProperties(t.style),n.appendChild(o),n=o,"b"===i||"strong"===i?o.setProperty("fw",IFFont.Weight.Bold):"i"===i&&o.setProperty("fs",IFFont.Style.Italic)}for(var s=t.firstChild;null!==s;s=s.nextSibling)this._fromHtml(s,n)}else 3===t.nodeType&&""!==t.textContent&&n.appendChild(new e.Chunk(t.textContent))},e.prototype.toString=function(){return"[IFText]"},t.IFText=e}(this),function(t){function e(t){this._view=t,this._canvas=new IFPaintCanvas,this._paintContext=new IFPaintContext,this._paintContext.configuration=t.getViewConfiguration()?t.getViewConfiguration():new IFPaintConfiguration,this._paintContext.canvas=this._canvas,this._dirtyList=new IFDirtyList}e.prototype._view=null,e.prototype._canvas=null,e.prototype._paintContext=null,e.prototype._dirtyList=null,e.prototype._repaintRequestFrameId=null,e.prototype.show=function(){this._canvas._canvasContext.canvas.style.visibility=""},e.prototype.hide=function(){this._canvas._canvasContext.canvas.style.visibility="hidden"},e.prototype.release=function(){},e.prototype.invalidate=function(t){return t&&!t.isEmpty()||(this._dirtyList.reset(),t=this._dirtyList.getArea()),!(!t||!this._dirtyList.dirty(t.getX(),t.getY(),t.getWidth(),t.getHeight()))&&(null==this._repaintRequestFrameId&&(this._repaintRequestFrameId=ifPlatform.scheduleFrame(this._repaint.bind(this))),!0)},e.prototype.paint=function(t){},e.prototype.resize=function(t,e){this._canvas.resize(t,e),this.updateViewArea()},e.prototype.updateViewArea=function(){var t=new IFRect(0,0,this._view.getWidth(),this._view.getHeight());IFRect.equals(this._dirtyList.getArea(),t)||(this._dirtyList.setArea(t),this.invalidate())},e.prototype._repaint=function(){var t=this._dirtyList.flush();null!=t&&(this._canvas.prepare(t.getDirtyRectangles()),this._paintContext.dirtyMatcher=t,this.paint&&this.paint.call(this,this._paintContext),this._canvas.finish()),this._repaintRequestFrameId=null},e.prototype.toString=function(){return"[Object IFStage]"},t.IFStage=e}(this),function(t){function e(t){IFStage.call(this,t),t.getScene().addEventListener(IFScene.InvalidationRequestEvent,this._sceneInvalidationRequest,this)}IFObject.inherit(e,IFStage),e.prototype._pixelContentCanvas=null,e.prototype.release=function(){this._view.getScene().removeEventListener(IFScene.InvalidationRequestEvent,this._sceneInvalidationRequest,this)},e.prototype.resize=function(t,e){IFStage.prototype.resize.call(this,t,e),this._pixelContentCanvas&&this._pixelContentCanvas.resize(t,e)},e.prototype.paint=function(t){if(t.dirtyMatcher&&t.dirtyMatcher.transform(this._view.getViewTransform()),this._view.getViewConfiguration().pixelMode&&!ifMath.isEqualEps(this._view.getZoom(),1)){this._pixelContentCanvas||(this._pixelContentCanvas=new IFPaintCanvas,this._pixelContentCanvas.resize(t.canvas.getWidth(),t.canvas.getHeight()));var e=this._view.getScene().getChildrenPaintBBox();this._pixelContentCanvas.prepare([e]);var n=e.getSide(IFRect.Side.TOP_LEFT),i=e.getWidth(),r=e.getHeight();this._pixelContentCanvas.setTransform(new IFTransform(1,0,0,1,-n.getX(),-n.getY())),this._pixelContentCanvas.resize(i,r);var o=t.canvas;t.canvas=this._pixelContentCanvas,this._view.getScene().render(t),o.setTransform(this._view.getWorldTransform()),o.drawImage(this._pixelContentCanvas,n.getX(),n.getY(),!0),this._pixelContentCanvas.finish(),t.canvas=o}else this._pixelContentCanvas=null,t.canvas.setOrigin(new IFPoint(this._view._scrollX,this._view._scrollY)),t.canvas.setScale(this._view._zoom),this._view.getScene().render(t)},e.prototype._sceneInvalidationRequest=function(t){var e=t.area;e&&(e=this._view.getWorldTransform().mapRect(e)),this.invalidate(e)},e.prototype.toString=function(){return"[Object IFSceneStage]"},t.IFSceneStage=e}(this),function(t){function e(t){this._htmlElement=this._createHTMLElement(),null!=t&&(this._htmlElement.style.position="relative",t.appendChild(this._htmlElement))}IFObject.inheritAndMix(e,IFObject,[GEventTarget]),e.convertClientPositionFromMousePosition=function(t,e){var n=null,i=null;if(e.target==t&&("absolute"===t.style.position?e.hasOwnProperty("offsetX")&&(n=e.offsetX,i=e.offsetY):(n=e.clientX,i=e.clientY)),null==n||null==i){var r=t.getBoundingClientRect();n=e.pageX-(r.left+window.pageXOffset-document.documentElement.clientLeft),i=e.pageY-(r.top+window.pageYOffset-document.documentElement.clientTop)}return new IFPoint(n,i)},e.prototype._htmlElement=null,e.prototype._inputEventCache=null,e.prototype._dragEventCounter=0,e.prototype._id=null,e.prototype._parent=null,e.prototype._x=0,e.prototype._y=0,e.prototype._width=0,e.prototype._height=0,e.prototype._cursor=null,e.prototype.getX=function(){return this._x},e.prototype.getY=function(){return this._y},e.prototype.getWidth=function(){return this._htmlElement.offsetWidth?this._htmlElement.offsetWidth:this._width},e.prototype.getHeight=function(){return this._htmlElement.offsetHeight?this._htmlElement.offsetHeight:this._height},e.prototype.move=function(t,e){this._htmlElement.style.left="number"==typeof t?t.toString()+"px":"",this._htmlElement.style.top="number"==typeof e?e.toString()+"px":"",this._htmlElement.style.position="number"==typeof t||"number"==typeof e?"absolute":"",this._x=t,this._y=e},e.prototype.resize=function(t,e){this._htmlElement.style.width=t?t.toString()+"px":"",this._htmlElement.style.height=e?e.toString()+"px":"",this._htmlElement.style.overflowX=t?"hidden":"",this._htmlElement.style.overflowY=e?"hidden":"",this._width=t,this._height=e},e.prototype.getCursor=function(){return this._cursor},e.prototype.setCursor=function(t){this._cursor!=t&&(this._cursor&&this._removeCSSClass("g-cursor-"+this._cursor,!0),this._cursor=t,this._cursor&&this._addCSSClass("g-cursor-"+this._cursor,!0))},e.prototype.isEnabled=function(){return null==this._htmlElement.className||this._htmlElement.className.indexOf("g-disabled")<0},e.prototype.setEnabled=function(t){t!=this.isEnabled()&&(t?this._removeCSSClass("g-disabled",!0):this._addCSSClass("g-disabled",!0))},e.prototype.isDisplayed=function(){return"none"!=this._htmlElement.style.display},e.prototype.setDisplayed=function(t){this._htmlElement.style.display=t?"":"none"},e.prototype.trigger=function(t){this._dragEventCounter>0&&t instanceof GUIMouseEvent.Release&&this._dragMouseRelease(t),GEventTarget.prototype.trigger.call(this,t),this._dragEventCounter>0&&(t instanceof GUIMouseEvent.Down?this._dragMouseDown(t):t instanceof GUIMouseEvent.Move&&this._dragStartPosition&&this._dragMouseMove(t))},e.prototype.addEventListener=function(t,e,n,i){GEventTarget.prototype.addEventListener.call(this,t,e,n,i),GUIInputEvent.prototype.isPrototypeOf(t.prototype)&&(this._registerInputEventListener(t),GUIMouseEvent.isDragEvent(t)&&(0==this._dragEventCounter&&(this._registerInputEventListener(GUIMouseEvent.Down),this._registerInputEventListener(GUIMouseEvent.Move),this._registerInputEventListener(GUIMouseEvent.Release)),this._dragEventCounter++))},e.prototype.removeEventListener=function(t,e){GEventTarget.prototype.removeEventListener.call(this,t,e),GUIInputEvent.prototype.isPrototypeOf(t.prototype)&&(this._unregisterInputEventListener(t),GUIMouseEvent.isDragEvent(t)&&0==--this._dragEventCounter&&(this._unregisterInputEventListener(GUIMouseEvent.Down),this._unregisterInputEventListener(GUIMouseEvent.Move),this._unregisterInputEventListener(GUIMouseEvent.Release)))},e.prototype.focus=function(){if(this.isDisplayed())try{return this._htmlElement.focus(),!0}catch(t){return!1}return!1},e.prototype._registerInputEventListener=function(t){var e=GUIMouseEvent.isDragEvent(t),n=IFObject.getTypeId(t);this._inputEventCache&&n in this._inputEventCache?this._inputEventCache&&n in this._inputEventCache&&this._inputEventCache[n].counter++:(this._inputEventCache||(this._inputEventCache={}),this._inputEventCache[n]={counter:0,event:new t},e||this._startListeningInputEvent(t))},e.prototype._unregisterInputEventListener=function(t){var e=GUIMouseEvent.isDragEvent(t),n=IFObject.getTypeId(t);this._inputEventCache&&n in this._inputEventCache&&0==--this._inputEventCache[n].counter&&(e||this._stopListeningInputEvent(t),delete this._inputEventCache[n],0==Object.keys(this._inputEventCache).length&&(this._inputEventCache=null))},e.prototype._startListeningInputEvent=function(t){var e=IFObject.getTypeId(t),n=function(e){this._updateAndTriggerInputEvent(e,t)}.bind(this);if(n){this._inputEventCache[e].domListener=n;var i=this._getDomEventNameForEventClass(t);this._htmlElement.addEventListener(i,n)}},e.prototype._stopListeningInputEvent=function(t){var e=IFObject.getTypeId(t),n=this._getDomEventNameForEventClass(t);this._htmlElement.removeEventListener(n,this._inputEventCache[e].domListener),delete this._inputEventCache[e].domListener},e.prototype._dragMouseDown=function(t){t.button==GUIMouseEvent.BUTTON_LEFT&&(this._dragStartPosition=t.client,this._dragIsDragging=!1)},e.prototype._dragMouseMove=function(t){if(this._dragStartPosition&&!this._dragIsDragging){var e=this._dragStartPosition;if((Math.abs(e.getX()-t.client.getX())>=1||Math.abs(e.getY()-t.client.getY())>=1)&&(this._dragIsDragging=!0,this._dragPreviousPosition=this._dragStartPosition,this.hasEventListeners(GUIMouseEvent.DragStart))){var n=this._inputEventCache[IFObject.getTypeId(GUIMouseEvent.DragStart)].event;this._dragAssignMouseEvent(t,n),n.client=this._dragStartPosition,this.trigger(n)}}if(this._dragIsDragging&&this.hasEventListeners(GUIMouseEvent.Drag)){n=this._inputEventCache[IFObject.getTypeId(GUIMouseEvent.Drag)].event;this._dragAssignMouseEvent(t,n),this._dragAssignDragEvent(n,t),this.trigger(n),this._dragPreviousPosition=t.client}},e.prototype._dragMouseRelease=function(t){if(t.button==GUIMouseEvent.BUTTON_LEFT){if(this._dragIsDragging){var e=this._inputEventCache[IFObject.getTypeId(GUIMouseEvent.DragEnd)].event;this._dragAssignMouseEvent(t,e),this._dragAssignDragEvent(e,t),this.trigger(e)}delete this._dragStartPosition,delete this._dragPreviousPosition,delete this._dragIsDragging}},e.prototype._dragAssignMouseEvent=function(t,e){e.client=t.client,e.button=t.button},e.prototype._dragAssignDragEvent=function(t,e){t.clientStart=this._dragStartPosition,t.clientDelta=e.client.subtract(this._dragPreviousPosition)},e.prototype._setParent=function(t){this._parent=t},e.prototype._updateLocale=function(){var t=null;this._hint&&(t=this._hint.asHtml()),t&&0!=t.length?this._htmlElement.setAttribute("data-qhint",qUtil.escape(t)):this._htmlElement.removeAttribute("data-qhint")},e.prototype._triggerWidgetEventFromDom=function(t,e,n){e instanceof GUIMouseEvent.Down&&e.button===GUIMouseEvent.BUTTON_LEFT?this._setCapture():e instanceof GUIMouseEvent.Release&&this._releaseCapture(),this.trigger(e)},e.prototype._updateAndTriggerInputEvent=function(t,e){if(this.isEnabled()){if("keydown"===t.type){if(ifKey.translateKey(t.which||t.keyCode)===IFKey.Constant.TAB)t.preventDefault()}else"mousedown"===t.type&&t.preventDefault();GUIMouseEvent.prototype.isPrototypeOf(e.prototype)?this._updateAndTriggerMouseEvent(t,IFObject.getTypeId(e)):GUIKeyEvent.prototype.isPrototypeOf(e.prototype)&&this._updateAndTriggerKeyEvent(t,IFObject.getTypeId(e))}},e.prototype._updateAndTriggerMouseEvent=function(t,n){var i=this._inputEventCache[n].event;i.client=e.convertClientPositionFromMousePosition(this._htmlElement,t),i.button=t.button,this._triggerWidgetEventFromDom(t,i)},e.prototype._updateAndTriggerKeyEvent=function(t,e){var n=this._inputEventCache[e].event;n.key=ifKey.translateKey(t.which||t.keyCode),this._triggerWidgetEventFromDom(t,n)},e.prototype._getDomEventNameForEventClass=function(t){switch(t){case GUIMouseEvent.Move:return"mousemove";case GUIMouseEvent.Enter:return"mouseover";case GUIMouseEvent.Leave:return"mouseout";case GUIMouseEvent.Down:return"mousedown";case GUIMouseEvent.Release:return"mouseup";case GUIMouseEvent.Click:return"click";case GUIMouseEvent.DblClick:return"dblclick";case GUIKeyEvent.Down:return"keydown";case GUIKeyEvent.Release:return"keyup";case GUIKeyEvent.Press:return"keypress"}throw new Error("Unknown DOMEvent name")};var n=[GUIMouseEvent.Move,GUIMouseEvent.Release,GUIKeyEvent.Down,GUIKeyEvent.Release,GUIKeyEvent.Press];e.prototype._setCapture=function(){var t=this;function e(e){var n=t._getDomEventNameForEventClass(e);t._savedDocumentListeners||(t._savedDocumentListeners={}),t._savedDocumentListeners[n]=function(n){n.target!=this._htmlElement&&(t._updateAndTriggerInputEvent(n,e),n.stopImmediatePropagation())}.bind(t),document.addEventListener(n,t._savedDocumentListeners[n],!0)}for(var i=0;i<n.length;++i){var r=n[i];this._inputEventCache[IFObject.getTypeId(r)]&&e(r)}},e.prototype._releaseCapture=function(){if(this._savedDocumentListeners){for(var t in this._savedDocumentListeners)document.removeEventListener(t,this._savedDocumentListeners[t],!0);delete this._savedDocumentListeners}},e.prototype._addCSSClass=function(t,e){!e&&this._BASE_CSS_CLASS&&(t=this._BASE_CSS_CLASS+"-"+t);var n=this._htmlElement.className;if(n&&0!=n.trim().length){for(var i=!0,r=n.trim().split(" "),o=0;o<r.length;++o){if(r[o].trim()==t){i=!1;break}}i&&(n+=" "+t)}else n=t;this._htmlElement.className=n},e.prototype._removeCSSClass=function(t,e){!e&&this._BASE_CSS_CLASS&&(t=this._BASE_CSS_CLASS+"-"+t);var n=this._htmlElement.className;if(n&&n.indexOf(t)>=0){for(var i="",r=n.trim().split(" "),o=0;o<r.length;++o){var s=r[o].trim();s!=t&&(i.length>0&&(i+=" "),i+=s)}this._htmlElement.className=i}},e.prototype._createHTMLElement=function(){var t=document.createElement("div");return t.setAttribute("tabindex","0"),t},e.prototype.toString=function(){return"[Object GUIWidget]"},t.GUIWidget=e}(this),function(t){function e(t){this._updateViewTransforms(!0),GUIWidget.apply(this,arguments.length>1?Array.prototype.slice.call(arguments,1):null),this._scene=t,this._viewOffset=[0,0,0,0],this._viewMargin=[0,0,0,0],this._pageConfigurations=[],this._viewConfiguration||(this._viewConfiguration=new IFScenePaintConfiguration),this._initStages(),t.addEventListener(IFNode.AfterFlagChangeEvent,this._afterFlagChange,this),t.addEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),t.addEventListener(IFNode.AfterRemoveEvent,this._afterRemove,this)}IFObject.inherit(e,GUIWidget),e.options={minZoomFactor:.05,maxZoomFactor:512,defaultFitActivePage:!1},e.TransformEvent=function(){},IFObject.inherit(e.TransformEvent,GEvent),e.TransformEvent.prototype.toString=function(){return"[Object IFView.TransformEvent]"},e.TRANSFORMEVENT=new e.TransformEvent,e.prototype._scene=null,e.prototype._stages=null,e.prototype._viewOffset=null,e.prototype._viewMargin=null,e.prototype._scrollX=0,e.prototype._scrollY=0,e.prototype._zoom=1,e.prototype._worldToViewTransform=null,e.prototype._viewToWorldTransform=null,e.prototype._viewConfiguration=null,e.prototype._pageConfigurations=null,e.prototype.resize=function(t,e){if(GUIWidget.prototype.resize.call(this,t,e),this._stages)for(var n=0;n<this._stages.length;++n)this._stages[n].resize(this.getWidth(),this.getHeight())},e.prototype.getScene=function(){return this._scene},e.prototype.getViewConfiguration=function(){return this._viewConfiguration},e.prototype.getViewOffset=function(){return this._viewOffset},e.prototype.setViewOffset=function(t){if(this._viewOffset=[0,0,0,0],t&&t.length>0){for(var e=0;e<Math.min(4,t.length);++e)this._viewOffset[e]=t[e];if(this._stages)for(e=0;e<this._stages.length;++e)this._stages[e].updateViewArea()}},e.prototype.getViewMargin=function(){return this._viewMargin},e.prototype.setViewMargin=function(t){if(this._viewMargin=[0,0,0,0],t&&t.length>0)for(var e=0;e<Math.min(4,t.length);++e)this._viewMargin[e]=t[e],this.invalidate()},e.prototype.getScrollX=function(){return this._scrollX},e.prototype.getScrollY=function(){return this._scrollY},e.prototype.getZoom=function(){return this._zoom},e.prototype.getWorldTransform=function(){return this._worldToViewTransform},e.prototype.getViewTransform=function(){return this._viewToWorldTransform},e.prototype.getViewBox=function(t){var e=this._viewOffset[0]+(t?0:this._viewMargin[0]),n=this._viewOffset[1]+(t?0:this._viewMargin[1]);return new IFRect(e,n,this.getWidth()-(this._viewOffset[2]+(t?0:this._viewMargin[2])+e),this.getHeight()-(this._viewOffset[3]+(t?0:this._viewMargin[3])+n))},e.prototype.transform=function(t,e,n){this._scrollX=t,this._scrollY=e,this._zoom=n,this._updateViewTransforms()},e.prototype.zoomAtCenter=function(t,n){n=n||this._zoom;var i=this.getViewBox().getSide(IFRect.Side.CENTER),r=this._worldToViewTransform.mapPoint(t),o=Math.min(e.options.maxZoomFactor,Math.max(n,e.options.minZoomFactor));if(o!=this._zoom||!IFPoint.equals(r,i)){var s=(new IFTransform).translated(-t.getX(),-t.getY()).scaled(o,o).translated(i.getX(),i.getY()).getMatrix();this._scrollX=-s[4],this._scrollY=-s[5],this._zoom=o,this._updateViewTransforms()}},e.prototype.zoomAt=function(t,e){var n=this.getViewBox().getSide(IFRect.Side.CENTER),i=this._viewToWorldTransform.mapPoint(n).subtract(t),r=e/this._zoom;this.zoomAtCenter(new IFPoint(t.getX()+i.getX()/r,t.getY()+i.getY()/r),e)},e.prototype.zoomAll=function(t,e){var n=t.getSide(IFRect.Side.CENTER),i=t.getWidth(),r=t.getHeight(),o=this.getViewBox();if(e){var s=this._worldToViewTransform.mapRect(new IFRect(n.getX()-i/2,n.getY()-r/2,i,r)),a=this._zoom*Math.min(1,Math.max(s.getWidth()/o.getWidth(),s.getHeight()/o.getHeight()));this.zoomAtCenter(n,a)}else this.zoomAtCenter(n,1/Math.max(i/o.getWidth(),r/o.getHeight()))},e.prototype.zoomActivePage=function(){var t=this._scene.getActivePage();if(t){var n=this._getOrCreatePageConfig(t,!1);if(n)this.transform(n.scrollX,n.scrollY,n.zoom);else{var i=t.getPaintBBox();i&&!i.isEmpty()&&(e.options.defaultFitActivePage?this.zoomAll(i,!1):this.zoomAtCenter(i.getSide(IFRect.Side.CENTER),1))}}},e.prototype.scrollBy=function(t,e){0==t&&0==e||(this._scrollX=this._scrollX+t,this._scrollY=this._scrollY+e,this._updateViewTransforms())},e.prototype.invalidate=function(t){var e=!1;if(this._stages)for(var n=0;n<this._stages.length;++n)e=this._stages[n].invalidate(t)||e;return e},e.prototype.addStage=function(t){null==this._stages&&(this._stages=[]),this._stages.push(t);var e=t._canvas._canvasContext.canvas;return e.style.position="absolute",e.style.cursor="inherit",t.resize(this.getWidth(),this.getHeight()),this._htmlElement.appendChild(e),t},e.prototype.getStage=function(t){if(this._stages)for(var e=0;e<this._stages.length;++e)if(t.prototype.isPrototypeOf(this._stages[e]))return this._stages[e];return null},e.prototype.release=function(){if(this._scene.removeEventListener(IFNode.AfterFlagChangeEvent,this._afterFlagChange,this),this._scene.removeEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),this._scene.removeEventListener(IFNode.AfterRemoveEvent,this._afterRemove,this),this._stages)for(var t=0;t<this._stages.length;++t)this._stages[t].release()},e.prototype._updateViewTransforms=function(t){this._scrollX=Math.round(this._scrollX),this._scrollY=Math.round(this._scrollY);var n=(new IFTransform).scaled(this._zoom,this._zoom).translated(-this._scrollX,-this._scrollY);IFTransform.equals(n,this._worldToViewTransform)||(this._worldToViewTransform=n,this._viewToWorldTransform=n.inverted(),this.invalidate(),!t&&this.hasEventListeners(e.TransformEvent)&&this.trigger(e.TRANSFORMEVENT))},e.prototype._initStages=function(){this.addStage(new IFSceneStage(this))},e.prototype._getOrCreatePageConfig=function(t,e){for(var n=null,i=0;i<this._pageConfigurations.length;++i)if(this._pageConfigurations[i].page===t){n=this._pageConfigurations[i];break}return!n&&e&&(n={page:t},this._pageConfigurations.push(n)),n},e.prototype._afterFlagChange=function(t){if(this._scene.getProperty("singlePage")&&t.node instanceof IFPage&&t.flag===IFNode.Flag.Active)if(this.invalidate(),t.set)this.zoomActivePage();else{var e=this._getOrCreatePageConfig(t.node,!0);e.scrollX=this._scrollX,e.scrollY=this._scrollY,e.zoom=this._zoom}},e.prototype._afterPropertiesChange=function(t){t.node===this._scene&&t.properties.indexOf("singlePage")>=0&&(this.zoomActivePage(),this.invalidate())},e.prototype._afterRemove=function(t){if(t.node instanceof IFPage)for(var e=0;e<this._pageConfigurations.length;++e)if(this._pageConfigurations[e].page===t.node){this._pageConfigurations.splice(e,1);break}},e.prototype.toString=function(){return"[Object IFView]"},t.IFView=e}(this),function(t){function e(){document.addEventListener("keydown",function(t){document.activeElement&&($(document.activeElement).is(":input")&&!$(document.activeElement).is(":button")||document.activeElement.isContentEditable)||(document.activeElement&&$(document.activeElement).is(":button")&&(13==t.keyCode||32==t.keyCode)&&(t.preventDefault(),document.activeElement.blur()),this._updateModifiers(t))}.bind(this),!0),document.addEventListener("keyup",function(t){this._updateModifiers(t)}.bind(this),!0)}IFObject.inheritAndMix(e,IFObject,[GEventTarget]),e.Modifiers=function(){},e.Modifiers.metaKey=!1,e.Modifiers.shiftKey=!1,e.Modifiers.optionKey=!1,e.Modifiers.spaceKey=!1,e.Modifiers.prototype.toString=function(){return"[Object GUIPlatform.Modifiers]"},e.ModifiersChangedEvent=function(){this.changed=new e.Modifiers},IFObject.inherit(e.ModifiersChangedEvent,GEvent),e.ModifiersChangedEvent.prototype.changed=null,e.ModifiersChangedEvent.prototype.toString=function(){return"[Object GUIPlatform.ModifiersChangedEvent]"},e.prototype.modifiers=new e.Modifiers,e.prototype._modifiersChangedEventCache=new e.ModifiersChangedEvent,e.prototype.scheduleFrame=function(t){return window.requestAnimationFrame(t)},e.prototype.cancelFrame=function(t){window.cancelRequestAnimationFrame(t)},e.prototype._updateModifiers=function(t){var n=!1,i=!1,r=!1,o=!1,s=ifSystem.operatingSystem!==IFSystem.OperatingSystem.OSX_IOS||ifSystem.hardware!==IFSystem.Hardware.Desktop?t.ctrlKey:t.metaKey;s!=this.modifiers.metaKey&&(r=!0,this.modifiers.metaKey=s),t.altKey!=this.modifiers.optionKey&&(n=!0,this.modifiers.optionKey=t.altKey),t.shiftKey!=this.modifiers.shiftKey&&(i=!0,this.modifiers.shiftKey=t.shiftKey);var a="keydown"===t.type&&32===t.keyCode||("keyup"!==t.type||32!==t.keyCode)&&this.modifiers.spaceKey;a!=this.modifiers.spaceKey&&(o=!0,this.modifiers.spaceKey=a),(r||n||i||r||o)&&this.hasEventListeners(e.ModifiersChangedEvent)&&(this._modifiersChangedEventCache.changed.metaKey=r,this._modifiersChangedEventCache.changed.optionKey=n,this._modifiersChangedEventCache.changed.shiftKey=i,this._modifiersChangedEventCache.changed.spaceKey=o,this.trigger(this._modifiersChangedEventCache))},t.GUIPlatform=e,t.ifPlatform=new e;for(var n=0,i=["ms","moz","webkit","o"],r=0;r<i.length&&!window.requestAnimationFrame;++r)window.requestAnimationFrame=window[i[r]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[i[r]+"CancelAnimationFrame"]||window[i[r]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,e){var i=(new Date).getTime(),r=Math.max(0,16-(i-n)),o=window.setTimeout(function(){t(i+r)},r);return n=i+r,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}(this),ifLocale.setValues(IFLocale,IFLocale.Language.English,["create","add","edit","remove","delete","open","save","cancel","ok","close","loading","loading_of","saving","saving_of","success","failure","waiting"],["Create","Add","Edit","Remove","Delete","Open","Save","Cancel","OK","Close","Loading","Loading of","Saving","Saving of","Success","Failure","Waiting"]),ifLocale.setValues(IFKey,IFLocale.Language.English,["key.1"],["Space"]),ifLocale.setValues(IFKey,IFLocale.Language.English,["key.2"],["Enter"]),ifLocale.setValues(IFKey,IFLocale.Language.English,["key.3"],["Tab"]),ifLocale.setValues(IFKey,IFLocale.Language.English,["key.4"],["Backspace"]),ifLocale.setValues(IFKey,IFLocale.Language.English,["key.5","key.5.short"],["Control","Ctrl"]),ifLocale.setValues(IFKey,IFLocale.Language.English,["key.6"],["Shift"]),ifLocale.setValues(IFKey,IFLocale.Language.English,["key.7"],["Alt"]),ifLocale.setValues(IFKey,IFLocale.Language.English,["key.8"],["Left"]),ifLocale.setValues(IFKey,IFLocale.Language.English,["key.9"],["Up"]),ifLocale.setValues(IFKey,IFLocale.Language.English,["key.10"],["Right"]),ifLocale.setValues(IFKey,IFLocale.Language.English,["key.11"],["Down"]),ifLocale.setValues(IFKey,IFLocale.Language.English,["key.12"],["Page Up"]),ifLocale.setValues(IFKey,IFLocale.Language.English,["key.13"],["Page Down"]),ifLocale.setValues(IFKey,IFLocale.Language.English,["key.14"],["Home"]),ifLocale.setValues(IFKey,IFLocale.Language.English,["key.15"],["End"]),ifLocale.setValues(IFKey,IFLocale.Language.English,["key.16","key.16.short"],["Insert","Ins"]),ifLocale.setValues(IFKey,IFLocale.Language.English,["key.17","key.17.short"],["Delete","Del"]),ifLocale.setValues(IFKey,IFLocale.Language.English,["key.18","key.18.short"],["Escape","Esc"]),ifLocale.setValues(IFKey,IFLocale.Language.English,["key.19","key.19.short"],["Command","Cmd"]),ifLocale.setValues(IFKey,IFLocale.Language.English,["key.30","key.31","key.32","key.33","key.34","key.35","key.36","key.37","key.38","key.39","key.40","key.41"],["F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12"]),ifLocale.setValues(IFFont,IFLocale.Language.English,["weight.thin","weight.extra-light","weight.light","weight.regular","weight.medium","weight.semi-bold","weight.bold","weight.extra-bold","weight.heavy","category.other","category.serif","category.monospace","category.iconic"],["Thin","Extra-Light","Light","Regular","Medium","Semi-Bold","Bold","Extra-Bold","Heavy","Other","Serif","Monospace","Iconic"]),ifLocale.setValues(IFEllipse,IFLocale.Language.English,["name"],["Ellipse"]),ifLocale.setValues(IFRectangle,IFLocale.Language.English,["name"],["Rectangle"]),ifLocale.setValues(IFLayer,IFLocale.Language.English,["name","type.output","type.draft","type.guide"],["Layer","Output","Draft","Guide"]),ifLocale.setValues(IFShapeSet,IFLocale.Language.English,["name"],["Group"]),ifLocale.setValues(IFScene,IFLocale.Language.English,["name"],["Scene"]),ifLocale.setValues(IFPolygon,IFLocale.Language.English,["name"],["Polygon"]),ifLocale.setValues(IFPage,IFLocale.Language.English,["name"],["Page"]),ifLocale.setValues(IFPath,IFLocale.Language.English,["name"],["Path"]),ifLocale.setValues(IFText,IFLocale.Language.English,["name"],["Text"]),ifLocale.setValues(IFScenePaintConfiguration,IFLocale.Language.English,["paint.full","paint.fast","paint.outline","paint.output"],["Full","Fast","Outline","Output"]),ifLocale.setValues(IFSlice,IFLocale.Language.English,["name"],["Slice"]);